/*******************************************************************************
*
* FILE: 
*      test_gps_parse.c
*
* DESCRIPTION: 
*      Unit tests for functions in the sensor module 
*
*******************************************************************************/

/*------------------------------------------------------------------------------
Standard Includes                                                                     
------------------------------------------------------------------------------*/
#include <stdint.h>
#include <string.h>


/*------------------------------------------------------------------------------
Project Includes                                                                     
------------------------------------------------------------------------------*/
#include "unity.h"
#include "sensor.h"
#include "gps.h"
#include "sdr_pin_defines_A0002.h"
#include "stm32h7xx_hal_uart.h"

/* File under test */
#include "test_gps_parse.h"

/*------------------------------------------------------------------------------
Global Variables 
------------------------------------------------------------------------------*/


/*------------------------------------------------------------------------------
Macros
------------------------------------------------------------------------------*/
#define NUM_TESTS_readings_to_bytes ( 3 )

/*------------------------------------------------------------------------------
Procedures 
------------------------------------------------------------------------------*/



/*******************************************************************************
*                                                                              *
* PROCEDURE:                                                                   * 
*       setUp                                                                  *
*                                                                              *
* DESCRIPTION:                                                                 * 
*       Code to run prior to any test                                          *
*                                                                              *
*******************************************************************************/
void setUp
	(
	void
    )
{
} /* setUp */


/*******************************************************************************
*                                                                              *
* PROCEDURE:                                                                   * 
*       tearDown                                                               *
*                                                                              *
* DESCRIPTION:                                                                 * 
*       Code to run after tests                                                *
*                                                                              *
*******************************************************************************/
void tearDown 
	(
	void
    )
{
} /* tearDown */

/*******************************************************************************
*                                                                              *
* PROCEDURE:                                                                   * 
*       test_gps_parse			                                               *
*                                                                              *
* DESCRIPTION:                                                                 * 
*       Test converting extracted dataframe to string in dataframe_to_string.c *
*                                                                              *
*******************************************************************************/
void test_gps_parse 
	(
	void
    )
{
/*------------------------------------------------------------------------------
Initializations
------------------------------------------------------------------------------*/
char buffer_str[175];

char* input_strings[] = 
{
#include "inputs/in_buffer.txt"
};

GPS_DATA expected_data[] = 
{
#include "test_cases/expected_buffer.txt"
};

/*------------------------------------------------------------------------------
Run Tests
------------------------------------------------------------------------------*/
for ( int test_num = 0; test_num < 3; test_num++ )
	{
    /* Initialize input/output */
	memset(&buffer_str, 0, sizeof(char) * 175); /* Clean buffer string every test */
	dataframe_to_string( &(sensor_data_test[test_num]), 0, &buffer_str[0]); /* Call a testing function */
	TEST_ASSERT_EQUAL_STRING(expected_data[test_num], buffer_str); /* Test begins */
    }


}


/*------------------------------------------------------------------------------
Run Tests
------------------------------------------------------------------------------*/
int main
	(
	void
	)
{
UNITY_BEGIN();
RUN_TEST( test_gps_parse );

return UNITY_END();
} /* main */


/*******************************************************************************
* END OF FILE                                                                  * 
*******************************************************************************/