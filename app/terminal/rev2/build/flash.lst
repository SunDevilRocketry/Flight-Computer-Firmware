ARM GAS  /tmp/ccQ0EOEq.s 			page 1


   1              		.cpu cortex-m7
   2              		.arch armv7e-m
   3              		.fpu fpv5-d16
   4              		.eabi_attribute 28, 1
   5              		.eabi_attribute 20, 1
   6              		.eabi_attribute 21, 1
   7              		.eabi_attribute 23, 3
   8              		.eabi_attribute 24, 1
   9              		.eabi_attribute 25, 1
  10              		.eabi_attribute 26, 1
  11              		.eabi_attribute 30, 1
  12              		.eabi_attribute 34, 1
  13              		.eabi_attribute 18, 4
  14              		.file	"flash.c"
  15              		.text
  16              	.Ltext0:
  17              		.cfi_sections	.debug_frame
  18              		.file 1 "../../../mod/flash/flash.c"
  19              		.section	.text.address_to_bytes,"ax",%progbits
  20              		.align	1
  21              		.syntax unified
  22              		.thumb
  23              		.thumb_func
  25              	address_to_bytes:
  26              	.LVL0:
  27              	.LFB155:
   1:../../../mod/flash/flash.c **** /*******************************************************************************
   2:../../../mod/flash/flash.c **** *
   3:../../../mod/flash/flash.c **** * FILE: 
   4:../../../mod/flash/flash.c **** * 		flash.c
   5:../../../mod/flash/flash.c **** *
   6:../../../mod/flash/flash.c **** * DESCRIPTION: 
   7:../../../mod/flash/flash.c **** * 		Contains API functions for writing and reading data from the engine 
   8:../../../mod/flash/flash.c **** *       controller's flash 
   9:../../../mod/flash/flash.c **** *
  10:../../../mod/flash/flash.c **** *******************************************************************************/
  11:../../../mod/flash/flash.c **** 
  12:../../../mod/flash/flash.c **** 
  13:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
  14:../../../mod/flash/flash.c ****  Standard Includes                                                                     
  15:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
  16:../../../mod/flash/flash.c **** #include <string.h>
  17:../../../mod/flash/flash.c **** 
  18:../../../mod/flash/flash.c **** 
  19:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
  20:../../../mod/flash/flash.c ****  MCU Pins 
  21:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
  22:../../../mod/flash/flash.c **** #if   defined( FLIGHT_COMPUTER   )
  23:../../../mod/flash/flash.c **** 	#include "sdr_pin_defines_A0002.h"
  24:../../../mod/flash/flash.c **** #elif defined( ENGINE_CONTROLLER )
  25:../../../mod/flash/flash.c **** 	#include "sdr_pin_defines_L0002.h"
  26:../../../mod/flash/flash.c **** #endif 
  27:../../../mod/flash/flash.c **** 
  28:../../../mod/flash/flash.c **** 
  29:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
  30:../../../mod/flash/flash.c ****  Project Includes                                                                     
  31:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
ARM GAS  /tmp/ccQ0EOEq.s 			page 2


  32:../../../mod/flash/flash.c **** #include "main.h"
  33:../../../mod/flash/flash.c **** #include "flash.h"
  34:../../../mod/flash/flash.c **** #include "usb.h"
  35:../../../mod/flash/flash.c **** #include "led.h"
  36:../../../mod/flash/flash.c **** 
  37:../../../mod/flash/flash.c **** 
  38:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
  39:../../../mod/flash/flash.c ****  Global Variables 
  40:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
  41:../../../mod/flash/flash.c **** static bool write_enabled = false;
  42:../../../mod/flash/flash.c **** 
  43:../../../mod/flash/flash.c **** 
  44:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
  45:../../../mod/flash/flash.c ****  Internal function prototypes 
  46:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
  47:../../../mod/flash/flash.c **** 
  48:../../../mod/flash/flash.c **** /* Converts a flash memory address in uint32_t format to a byte array */
  49:../../../mod/flash/flash.c **** static void address_to_bytes
  50:../../../mod/flash/flash.c **** 	(
  51:../../../mod/flash/flash.c **** 	uint32_t address,
  52:../../../mod/flash/flash.c **** 	uint8_t* address_bytes
  53:../../../mod/flash/flash.c **** 	);
  54:../../../mod/flash/flash.c **** 
  55:../../../mod/flash/flash.c **** /* Converts a flash memory address in byte format to uint32_t format */
  56:../../../mod/flash/flash.c **** static inline uint32_t bytes_to_address 
  57:../../../mod/flash/flash.c **** 	(
  58:../../../mod/flash/flash.c **** 	uint8_t address_bytes[3]
  59:../../../mod/flash/flash.c **** 	);
  60:../../../mod/flash/flash.c **** 
  61:../../../mod/flash/flash.c **** /* Enable writing to the external flash chip hardware */
  62:../../../mod/flash/flash.c **** static FLASH_STATUS write_enable
  63:../../../mod/flash/flash.c ****     (
  64:../../../mod/flash/flash.c ****     void 
  65:../../../mod/flash/flash.c ****     );
  66:../../../mod/flash/flash.c **** 
  67:../../../mod/flash/flash.c **** /* Disable writing to the external flash chip hardware */
  68:../../../mod/flash/flash.c **** static FLASH_STATUS write_disable 
  69:../../../mod/flash/flash.c ****     (
  70:../../../mod/flash/flash.c ****     void 
  71:../../../mod/flash/flash.c ****     );
  72:../../../mod/flash/flash.c **** 
  73:../../../mod/flash/flash.c **** 
  74:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
  75:../../../mod/flash/flash.c ****  Procedures 
  76:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
  77:../../../mod/flash/flash.c **** 
  78:../../../mod/flash/flash.c **** 
  79:../../../mod/flash/flash.c **** /*******************************************************************************
  80:../../../mod/flash/flash.c **** *                                                                              *
  81:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
  82:../../../mod/flash/flash.c **** * 		flash_cmd_execute                                                      *
  83:../../../mod/flash/flash.c **** *                                                                              *
  84:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
  85:../../../mod/flash/flash.c **** * 		Executes a flash subcommand based on input from the sdec terminal      *
  86:../../../mod/flash/flash.c **** *                                                                              *
  87:../../../mod/flash/flash.c **** *******************************************************************************/
  88:../../../mod/flash/flash.c **** FLASH_STATUS flash_cmd_execute
ARM GAS  /tmp/ccQ0EOEq.s 			page 3


  89:../../../mod/flash/flash.c **** 	(
  90:../../../mod/flash/flash.c ****     uint8_t             subcommand   ,
  91:../../../mod/flash/flash.c **** 	HFLASH_BUFFER*      pflash_handle
  92:../../../mod/flash/flash.c ****     )
  93:../../../mod/flash/flash.c **** {
  94:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
  95:../../../mod/flash/flash.c ****  Local Variables 
  96:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
  97:../../../mod/flash/flash.c **** uint8_t          opcode;              /* Subcommand opcode                    */
  98:../../../mod/flash/flash.c **** uint8_t          num_bytes;           /* Number of bytes on which to 
  99:../../../mod/flash/flash.c ****                                          operate                              */
 100:../../../mod/flash/flash.c **** uint8_t          address[3];          /* flash address in byte form           */
 101:../../../mod/flash/flash.c **** uint8_t*         pbuffer;             /* Position within flash buffer         */
 102:../../../mod/flash/flash.c **** uint8_t          buffer[512];         /* buffer (flash extract)               */
 103:../../../mod/flash/flash.c **** FLASH_STATUS     flash_status;        /* Return value of flash API calls      */
 104:../../../mod/flash/flash.c **** USB_STATUS       usb_status;          /* Return value of USB API calls        */
 105:../../../mod/flash/flash.c **** 
 106:../../../mod/flash/flash.c **** 
 107:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 108:../../../mod/flash/flash.c ****  Pre-processing 
 109:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 110:../../../mod/flash/flash.c **** opcode    = ( subcommand & FLASH_SUBCMD_OP_BITMASK ) >>  5;
 111:../../../mod/flash/flash.c **** num_bytes = ( subcommand & FLASH_NBYTES_BITMASK    ); 
 112:../../../mod/flash/flash.c **** pflash_handle -> num_bytes = num_bytes;
 113:../../../mod/flash/flash.c **** pbuffer   = &buffer[0];
 114:../../../mod/flash/flash.c **** memset( pbuffer, 0, sizeof( buffer ) );
 115:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 116:../../../mod/flash/flash.c **** 
 117:../../../mod/flash/flash.c **** 
 118:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 119:../../../mod/flash/flash.c ****  Call API function 
 120:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 121:../../../mod/flash/flash.c **** switch ( opcode )
 122:../../../mod/flash/flash.c **** 	{
 123:../../../mod/flash/flash.c ****     /*-----------------------------READ Subcommand----------------------------*/
 124:../../../mod/flash/flash.c ****     case FLASH_SUBCMD_READ:
 125:../../../mod/flash/flash.c ****         {
 126:../../../mod/flash/flash.c **** 
 127:../../../mod/flash/flash.c **** 		/* Get flash address from USB */
 128:../../../mod/flash/flash.c **** 		usb_status = usb_receive( &( address[0] )  , 
 129:../../../mod/flash/flash.c ****                                   sizeof( address ), 
 130:../../../mod/flash/flash.c ****                                   HAL_DEFAULT_TIMEOUT );
 131:../../../mod/flash/flash.c **** 		
 132:../../../mod/flash/flash.c **** 		if ( usb_status != USB_OK )
 133:../../../mod/flash/flash.c **** 			{
 134:../../../mod/flash/flash.c **** 			return FLASH_USB_ERROR;
 135:../../../mod/flash/flash.c **** 			}
 136:../../../mod/flash/flash.c **** 		else
 137:../../../mod/flash/flash.c **** 			{
 138:../../../mod/flash/flash.c **** 			/* Call API Function */
 139:../../../mod/flash/flash.c **** 			pflash_handle -> address = bytes_to_address( address );
 140:../../../mod/flash/flash.c **** 			flash_status = flash_read( pflash_handle, num_bytes );
 141:../../../mod/flash/flash.c **** 			
 142:../../../mod/flash/flash.c **** 			/* Check for flash error */
 143:../../../mod/flash/flash.c **** 			if ( flash_status != FLASH_OK )
 144:../../../mod/flash/flash.c **** 				{
 145:../../../mod/flash/flash.c **** 				/* Bytes not read */
ARM GAS  /tmp/ccQ0EOEq.s 			page 4


 146:../../../mod/flash/flash.c **** 				return FLASH_FAIL;
 147:../../../mod/flash/flash.c **** 				}
 148:../../../mod/flash/flash.c **** 
 149:../../../mod/flash/flash.c **** 			/* Transmit bytes from pbuffer over USB */
 150:../../../mod/flash/flash.c **** 			usb_status = usb_transmit( pflash_handle -> pbuffer,
 151:../../../mod/flash/flash.c ****                                        num_bytes               ,
 152:../../../mod/flash/flash.c **** 									   HAL_FLASH_TIMEOUT );
 153:../../../mod/flash/flash.c **** 
 154:../../../mod/flash/flash.c **** 			if ( usb_status != USB_OK )
 155:../../../mod/flash/flash.c **** 				{
 156:../../../mod/flash/flash.c **** 				/* Bytes not transimitted */
 157:../../../mod/flash/flash.c **** 				return FLASH_USB_ERROR;
 158:../../../mod/flash/flash.c **** 				}
 159:../../../mod/flash/flash.c **** 
 160:../../../mod/flash/flash.c **** 			}
 161:../../../mod/flash/flash.c **** 
 162:../../../mod/flash/flash.c **** 		/* Bytes read and transimitted back sucessfully */
 163:../../../mod/flash/flash.c **** 		return FLASH_OK;
 164:../../../mod/flash/flash.c **** 
 165:../../../mod/flash/flash.c **** 		} /* FLASH_SUBCMD_READ */
 166:../../../mod/flash/flash.c **** 
 167:../../../mod/flash/flash.c ****     /*------------------------------ENABLE Subcommand-----------------------------*/
 168:../../../mod/flash/flash.c ****     case FLASH_SUBCMD_ENABLE:
 169:../../../mod/flash/flash.c ****         {
 170:../../../mod/flash/flash.c **** 		flash_write_enable();
 171:../../../mod/flash/flash.c **** 		return FLASH_OK;
 172:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_ENABLE */
 173:../../../mod/flash/flash.c **** 
 174:../../../mod/flash/flash.c ****     /*------------------------------DISABLE Subcommand----------------------------*/
 175:../../../mod/flash/flash.c ****     case FLASH_SUBCMD_DISABLE:
 176:../../../mod/flash/flash.c ****         {
 177:../../../mod/flash/flash.c **** 		flash_write_disable();
 178:../../../mod/flash/flash.c **** 		return FLASH_OK;
 179:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_DISABLE */
 180:../../../mod/flash/flash.c **** 
 181:../../../mod/flash/flash.c ****     /*------------------------------WRITE Subcommand------------------------------*/
 182:../../../mod/flash/flash.c ****     case FLASH_SUBCMD_WRITE:
 183:../../../mod/flash/flash.c ****         {
 184:../../../mod/flash/flash.c **** 		/* Get Address bits */
 185:../../../mod/flash/flash.c **** 		usb_status = usb_receive( &( address[0] )  ,
 186:../../../mod/flash/flash.c ****                                   sizeof( address ),
 187:../../../mod/flash/flash.c ****                                   HAL_DEFAULT_TIMEOUT );
 188:../../../mod/flash/flash.c **** 
 189:../../../mod/flash/flash.c **** 		if ( usb_status != USB_OK )	
 190:../../../mod/flash/flash.c **** 			{
 191:../../../mod/flash/flash.c **** 			/* Address not recieved */
 192:../../../mod/flash/flash.c **** 			return FLASH_USB_ERROR;
 193:../../../mod/flash/flash.c ****             }
 194:../../../mod/flash/flash.c **** 		else
 195:../../../mod/flash/flash.c **** 			{
 196:../../../mod/flash/flash.c **** 			/* Convert flash address to uint32_t */
 197:../../../mod/flash/flash.c **** 			pflash_handle -> address = bytes_to_address( address );
 198:../../../mod/flash/flash.c **** 
 199:../../../mod/flash/flash.c **** 			/* Get bytes to be written to flash */
 200:../../../mod/flash/flash.c **** 			for ( int i = 0; i < num_bytes; i++ )
 201:../../../mod/flash/flash.c **** 				{
 202:../../../mod/flash/flash.c **** 				pbuffer = ( pflash_handle -> pbuffer ) + i;
ARM GAS  /tmp/ccQ0EOEq.s 			page 5


 203:../../../mod/flash/flash.c **** 				flash_status = usb_receive( pbuffer          , 
 204:../../../mod/flash/flash.c ****                                             sizeof( uint8_t ),
 205:../../../mod/flash/flash.c ****                                             HAL_DEFAULT_TIMEOUT );
 206:../../../mod/flash/flash.c **** 
 207:../../../mod/flash/flash.c **** 				/* Return if usb call failed */
 208:../../../mod/flash/flash.c **** 				if ( usb_status != USB_OK )
 209:../../../mod/flash/flash.c **** 					{
 210:../../../mod/flash/flash.c **** 					/* Bytes not received */
 211:../../../mod/flash/flash.c **** 				    return FLASH_USB_ERROR;	
 212:../../../mod/flash/flash.c ****                     }
 213:../../../mod/flash/flash.c **** 
 214:../../../mod/flash/flash.c **** 				}
 215:../../../mod/flash/flash.c ****             }
 216:../../../mod/flash/flash.c **** 
 217:../../../mod/flash/flash.c **** 		/* Call API function */
 218:../../../mod/flash/flash.c **** 		flash_status = flash_write( pflash_handle );
 219:../../../mod/flash/flash.c **** 
 220:../../../mod/flash/flash.c **** 	    return flash_status;	
 221:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_WRITE */
 222:../../../mod/flash/flash.c **** 
 223:../../../mod/flash/flash.c ****     /*------------------------------ERASE Subcommand------------------------------*/
 224:../../../mod/flash/flash.c ****     case FLASH_SUBCMD_ERASE:
 225:../../../mod/flash/flash.c ****         {
 226:../../../mod/flash/flash.c **** 		/* Call API Function*/
 227:../../../mod/flash/flash.c **** 		flash_status = flash_erase( pflash_handle );
 228:../../../mod/flash/flash.c **** 
 229:../../../mod/flash/flash.c **** 		return flash_status;
 230:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_ERASE */
 231:../../../mod/flash/flash.c **** 
 232:../../../mod/flash/flash.c ****     /*------------------------------STATUS Subcommand-----------------------------*/
 233:../../../mod/flash/flash.c ****     case FLASH_SUBCMD_STATUS:
 234:../../../mod/flash/flash.c ****         {
 235:../../../mod/flash/flash.c **** 		/* Call API function */
 236:../../../mod/flash/flash.c **** 		flash_status = flash_get_status( pflash_handle );
 237:../../../mod/flash/flash.c **** 
 238:../../../mod/flash/flash.c **** 		/* Send status register contents back to PC */
 239:../../../mod/flash/flash.c **** 		usb_status = usb_transmit( &( pflash_handle -> status_register ),
 240:../../../mod/flash/flash.c ****                                    sizeof( uint8_t )                    ,
 241:../../../mod/flash/flash.c ****                                    HAL_DEFAULT_TIMEOUT );
 242:../../../mod/flash/flash.c **** 
 243:../../../mod/flash/flash.c **** 		/* Return status code */
 244:../../../mod/flash/flash.c **** 		if      ( usb_status   != USB_OK   )
 245:../../../mod/flash/flash.c **** 			{
 246:../../../mod/flash/flash.c **** 			return FLASH_USB_ERROR;
 247:../../../mod/flash/flash.c **** 			}
 248:../../../mod/flash/flash.c **** 		else if ( flash_status != FLASH_OK )
 249:../../../mod/flash/flash.c **** 			{
 250:../../../mod/flash/flash.c **** 			return FLASH_SPI_ERROR;
 251:../../../mod/flash/flash.c **** 			}
 252:../../../mod/flash/flash.c **** 		else
 253:../../../mod/flash/flash.c **** 			{
 254:../../../mod/flash/flash.c **** 			return FLASH_OK;	
 255:../../../mod/flash/flash.c **** 			}
 256:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_STATUS */
 257:../../../mod/flash/flash.c **** 
 258:../../../mod/flash/flash.c ****     /*-----------------------------EXTRACT Subcommand-----------------------------*/
 259:../../../mod/flash/flash.c ****     case FLASH_SUBCMD_EXTRACT:
ARM GAS  /tmp/ccQ0EOEq.s 			page 6


 260:../../../mod/flash/flash.c ****         {
 261:../../../mod/flash/flash.c **** 		/* Extracts the entire flash chip, flash chip address from 0 to 0x7FFFF */
 262:../../../mod/flash/flash.c **** 		pflash_handle->pbuffer = &buffer[0];
 263:../../../mod/flash/flash.c **** 		pflash_handle->address = 0;
 264:../../../mod/flash/flash.c **** 		while( pflash_handle->address <= FLASH_MAX_ADDR )
 265:../../../mod/flash/flash.c **** 			{
 266:../../../mod/flash/flash.c **** 			flash_status = flash_read( pflash_handle, sizeof( buffer ) );
 267:../../../mod/flash/flash.c **** 			if( flash_status == FLASH_OK )
 268:../../../mod/flash/flash.c **** 				{
 269:../../../mod/flash/flash.c **** 				usb_transmit( &buffer  ,
 270:../../../mod/flash/flash.c **** 						      sizeof( buffer ),
 271:../../../mod/flash/flash.c **** 						      HAL_FLASH_TIMEOUT );
 272:../../../mod/flash/flash.c **** 				}
 273:../../../mod/flash/flash.c **** 			else
 274:../../../mod/flash/flash.c **** 				{
 275:../../../mod/flash/flash.c **** 				/* Extract Failed */
 276:../../../mod/flash/flash.c **** 				Error_Handler();
 277:../../../mod/flash/flash.c **** 				}
 278:../../../mod/flash/flash.c **** 
 279:../../../mod/flash/flash.c **** 			/* Read from next address */
 280:../../../mod/flash/flash.c **** 			(pflash_handle->address) += sizeof( buffer ) ;
 281:../../../mod/flash/flash.c **** 			}
 282:../../../mod/flash/flash.c **** 
 283:../../../mod/flash/flash.c **** 		return FLASH_OK;
 284:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_EXTRACT */
 285:../../../mod/flash/flash.c **** 
 286:../../../mod/flash/flash.c ****     /*---------------------------Unrecognized Subcommand--------------------------*/
 287:../../../mod/flash/flash.c **** 	default:
 288:../../../mod/flash/flash.c ****         {
 289:../../../mod/flash/flash.c **** 	    return FLASH_UNRECOGNIZED_OP;	
 290:../../../mod/flash/flash.c ****         }
 291:../../../mod/flash/flash.c **** 
 292:../../../mod/flash/flash.c ****     }
 293:../../../mod/flash/flash.c **** } /* flash_cmd_execute */
 294:../../../mod/flash/flash.c **** 
 295:../../../mod/flash/flash.c **** 
 296:../../../mod/flash/flash.c **** /*******************************************************************************
 297:../../../mod/flash/flash.c **** *                                                                              *
 298:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
 299:../../../mod/flash/flash.c **** * 		flash_init                                                             *
 300:../../../mod/flash/flash.c **** *                                                                              *
 301:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
 302:../../../mod/flash/flash.c **** *       Initializes the flash chip                                             *
 303:../../../mod/flash/flash.c **** *                                                                              *
 304:../../../mod/flash/flash.c **** *******************************************************************************/
 305:../../../mod/flash/flash.c **** FLASH_STATUS flash_init 
 306:../../../mod/flash/flash.c **** 	(
 307:../../../mod/flash/flash.c **** 	HFLASH_BUFFER* pflash_handle  /* Flash handle */
 308:../../../mod/flash/flash.c **** 	)
 309:../../../mod/flash/flash.c **** {
 310:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 311:../../../mod/flash/flash.c ****  Local variables 
 312:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 313:../../../mod/flash/flash.c **** FLASH_STATUS flash_status;    /* Flash API function return codes        */
 314:../../../mod/flash/flash.c **** uint8_t      status_register; /* Desired status register contents       */
 315:../../../mod/flash/flash.c **** 
 316:../../../mod/flash/flash.c **** 
ARM GAS  /tmp/ccQ0EOEq.s 			page 7


 317:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 318:../../../mod/flash/flash.c ****  Initializations 
 319:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 320:../../../mod/flash/flash.c **** flash_status    = FLASH_OK;
 321:../../../mod/flash/flash.c **** status_register = FLASH_REG_RESET_VAL;
 322:../../../mod/flash/flash.c **** 
 323:../../../mod/flash/flash.c **** 
 324:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 325:../../../mod/flash/flash.c ****  Pre-processing 
 326:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 327:../../../mod/flash/flash.c **** 
 328:../../../mod/flash/flash.c **** /* Check for invalid BPL setting */
 329:../../../mod/flash/flash.c **** if ( pflash_handle -> bpl_bits > FLASH_BPL_ALL )
 330:../../../mod/flash/flash.c **** 	{
 331:../../../mod/flash/flash.c **** 	return FLASH_INVALID_INPUT; 
 332:../../../mod/flash/flash.c **** 	}
 333:../../../mod/flash/flash.c **** 
 334:../../../mod/flash/flash.c **** /* Determine the desired status register contents */
 335:../../../mod/flash/flash.c **** status_register &= pflash_handle -> bpl_bits;
 336:../../../mod/flash/flash.c **** status_register |= pflash_handle -> bpl_write_protect;
 337:../../../mod/flash/flash.c **** 
 338:../../../mod/flash/flash.c **** 
 339:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 340:../../../mod/flash/flash.c ****  API Function Implementation 
 341:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 342:../../../mod/flash/flash.c **** 
 343:../../../mod/flash/flash.c **** /* Configure write protection */
 344:../../../mod/flash/flash.c **** if ( pflash_handle -> write_protected )
 345:../../../mod/flash/flash.c **** 	{
 346:../../../mod/flash/flash.c **** 	flash_write_disable();
 347:../../../mod/flash/flash.c **** 	return FLASH_OK;
 348:../../../mod/flash/flash.c **** 	}
 349:../../../mod/flash/flash.c **** else
 350:../../../mod/flash/flash.c **** 	{
 351:../../../mod/flash/flash.c **** 	flash_write_enable();
 352:../../../mod/flash/flash.c **** 	}
 353:../../../mod/flash/flash.c **** 
 354:../../../mod/flash/flash.c **** /* Check the flash chip status register to confirm chip can be reached */
 355:../../../mod/flash/flash.c **** flash_status = flash_get_status( pflash_handle );
 356:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 357:../../../mod/flash/flash.c **** 	{
 358:../../../mod/flash/flash.c **** 	return flash_status;
 359:../../../mod/flash/flash.c **** 	}
 360:../../../mod/flash/flash.c **** else if ( pflash_handle -> status_register == 0xFF )
 361:../../../mod/flash/flash.c **** 	{
 362:../../../mod/flash/flash.c **** 	return FLASH_INIT_FAIL;
 363:../../../mod/flash/flash.c **** 	}
 364:../../../mod/flash/flash.c **** 
 365:../../../mod/flash/flash.c **** /* Disable writing to the chip in case of prior interrupted write operation */
 366:../../../mod/flash/flash.c **** if ( write_disable() != FLASH_OK )
 367:../../../mod/flash/flash.c **** 	{
 368:../../../mod/flash/flash.c **** 	return FLASH_CANNOT_WRITE_DISABLE;
 369:../../../mod/flash/flash.c **** 	}
 370:../../../mod/flash/flash.c **** 
 371:../../../mod/flash/flash.c **** /* Set the bpl bits in the flash chip */
 372:../../../mod/flash/flash.c **** flash_status = flash_set_status( status_register );
 373:../../../mod/flash/flash.c **** 
ARM GAS  /tmp/ccQ0EOEq.s 			page 8


 374:../../../mod/flash/flash.c **** /* Confirm Status register contents */
 375:../../../mod/flash/flash.c **** while( flash_is_flash_busy() == FLASH_BUSY ){}
 376:../../../mod/flash/flash.c **** flash_status = flash_get_status( pflash_handle );
 377:../../../mod/flash/flash.c **** if ( pflash_handle -> status_register != status_register )
 378:../../../mod/flash/flash.c **** 	{
 379:../../../mod/flash/flash.c **** 	return FLASH_INIT_FAIL;
 380:../../../mod/flash/flash.c **** 	}
 381:../../../mod/flash/flash.c **** else
 382:../../../mod/flash/flash.c **** 	{
 383:../../../mod/flash/flash.c **** 	return flash_status;
 384:../../../mod/flash/flash.c **** 	}
 385:../../../mod/flash/flash.c **** 
 386:../../../mod/flash/flash.c **** } /* flash_init */
 387:../../../mod/flash/flash.c **** 
 388:../../../mod/flash/flash.c **** 
 389:../../../mod/flash/flash.c **** /*******************************************************************************
 390:../../../mod/flash/flash.c **** *                                                                              *
 391:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
 392:../../../mod/flash/flash.c **** * 		flash_get_status                                                       *
 393:../../../mod/flash/flash.c **** *                                                                              *
 394:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
 395:../../../mod/flash/flash.c **** *       Read the status register of the flash chip                             *
 396:../../../mod/flash/flash.c **** *                                                                              *
 397:../../../mod/flash/flash.c **** *******************************************************************************/
 398:../../../mod/flash/flash.c **** FLASH_STATUS flash_get_status
 399:../../../mod/flash/flash.c **** 	(
 400:../../../mod/flash/flash.c **** 	HFLASH_BUFFER* pflash_handle
 401:../../../mod/flash/flash.c ****     )
 402:../../../mod/flash/flash.c **** {
 403:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 404:../../../mod/flash/flash.c ****  Local variables 
 405:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 406:../../../mod/flash/flash.c **** HAL_StatusTypeDef hal_status[2];  /* Status codes returned by SPI HAL         */
 407:../../../mod/flash/flash.c **** uint8_t           flash_opcode;   /* Data to be transmitted over SPI          */
 408:../../../mod/flash/flash.c **** 
 409:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 410:../../../mod/flash/flash.c ****  Initialiazations 
 411:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 412:../../../mod/flash/flash.c **** flash_opcode = FLASH_OP_HW_RDSR;
 413:../../../mod/flash/flash.c **** 
 414:../../../mod/flash/flash.c **** 
 415:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 416:../../../mod/flash/flash.c ****  API function implementation 
 417:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 418:../../../mod/flash/flash.c **** 
 419:../../../mod/flash/flash.c **** /* Drive slave select line low */
 420:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
 421:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 422:../../../mod/flash/flash.c ****                    GPIO_PIN_RESET );
 423:../../../mod/flash/flash.c **** 
 424:../../../mod/flash/flash.c **** /* Send RDSR code to flash chip */
 425:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )        ,
 426:../../../mod/flash/flash.c ****                                   &flash_opcode         ,
 427:../../../mod/flash/flash.c ****                                   sizeof( flash_opcode ),
 428:../../../mod/flash/flash.c ****                                   HAL_DEFAULT_TIMEOUT );
 429:../../../mod/flash/flash.c **** 
 430:../../../mod/flash/flash.c **** /* Recieve status code */
ARM GAS  /tmp/ccQ0EOEq.s 			page 9


 431:../../../mod/flash/flash.c **** hal_status[1] = HAL_SPI_Receive( &( FLASH_SPI ),
 432:../../../mod/flash/flash.c ****                                  &( pflash_handle      -> status_register ),
 433:../../../mod/flash/flash.c ****                                  sizeof( pflash_handle -> status_register ),
 434:../../../mod/flash/flash.c **** 							     HAL_DEFAULT_TIMEOUT );
 435:../../../mod/flash/flash.c **** 
 436:../../../mod/flash/flash.c **** /* Drive slave select line high */
 437:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
 438:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 439:../../../mod/flash/flash.c ****                    GPIO_PIN_SET );
 440:../../../mod/flash/flash.c **** 
 441:../../../mod/flash/flash.c **** /* Return flash status code */
 442:../../../mod/flash/flash.c **** if ( hal_status[0] != HAL_OK || hal_status[1] != HAL_OK )
 443:../../../mod/flash/flash.c **** 	{
 444:../../../mod/flash/flash.c **** 	return FLASH_SPI_ERROR;
 445:../../../mod/flash/flash.c **** 	}
 446:../../../mod/flash/flash.c **** else
 447:../../../mod/flash/flash.c **** 	{
 448:../../../mod/flash/flash.c **** 	return FLASH_OK;
 449:../../../mod/flash/flash.c **** 	}
 450:../../../mod/flash/flash.c **** 
 451:../../../mod/flash/flash.c **** } /* flash_get_status */
 452:../../../mod/flash/flash.c **** 
 453:../../../mod/flash/flash.c **** 
 454:../../../mod/flash/flash.c **** /*******************************************************************************
 455:../../../mod/flash/flash.c **** *                                                                              *
 456:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
 457:../../../mod/flash/flash.c **** * 		flash_set_status                                                       *
 458:../../../mod/flash/flash.c **** *                                                                              *
 459:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
 460:../../../mod/flash/flash.c **** *       Writes to the status register                                          *
 461:../../../mod/flash/flash.c **** *                                                                              *
 462:../../../mod/flash/flash.c **** *******************************************************************************/
 463:../../../mod/flash/flash.c **** FLASH_STATUS flash_set_status
 464:../../../mod/flash/flash.c **** 	(
 465:../../../mod/flash/flash.c **** 	uint8_t        flash_status	
 466:../../../mod/flash/flash.c ****     )
 467:../../../mod/flash/flash.c **** {
 468:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 469:../../../mod/flash/flash.c ****  Local variables 
 470:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 471:../../../mod/flash/flash.c **** uint8_t hal_status   [3];   /* Status code returned by hal spi functions      */
 472:../../../mod/flash/flash.c **** uint8_t flash_opcodes[2];   /* Flash instruction cycle bytes                  */
 473:../../../mod/flash/flash.c **** 
 474:../../../mod/flash/flash.c **** 
 475:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 476:../../../mod/flash/flash.c ****  Initializations 
 477:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 478:../../../mod/flash/flash.c **** flash_opcodes[0] = FLASH_OP_HW_EWSR;
 479:../../../mod/flash/flash.c **** flash_opcodes[1] = FLASH_OP_HW_WRSR;
 480:../../../mod/flash/flash.c **** 
 481:../../../mod/flash/flash.c **** 
 482:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 483:../../../mod/flash/flash.c ****  Pre-processing 
 484:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 485:../../../mod/flash/flash.c **** if ( !( write_enabled ) )
 486:../../../mod/flash/flash.c **** 	{
 487:../../../mod/flash/flash.c **** 	return FLASH_WRITE_PROTECTED;
ARM GAS  /tmp/ccQ0EOEq.s 			page 10


 488:../../../mod/flash/flash.c **** 	}
 489:../../../mod/flash/flash.c **** 
 490:../../../mod/flash/flash.c **** 
 491:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 492:../../../mod/flash/flash.c ****  API function implementation 
 493:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 494:../../../mod/flash/flash.c **** 
 495:../../../mod/flash/flash.c **** /* Enable write to status register */
 496:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
 497:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 498:../../../mod/flash/flash.c ****                    GPIO_PIN_RESET );
 499:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )   ,
 500:../../../mod/flash/flash.c ****                                   &flash_opcodes[0],
 501:../../../mod/flash/flash.c ****                                   sizeof( uint8_t ),
 502:../../../mod/flash/flash.c ****                                   HAL_DEFAULT_TIMEOUT );
 503:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
 504:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 505:../../../mod/flash/flash.c ****                    GPIO_PIN_SET );
 506:../../../mod/flash/flash.c **** 
 507:../../../mod/flash/flash.c **** /* Write the Data to the status register */
 508:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
 509:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 510:../../../mod/flash/flash.c ****                    GPIO_PIN_RESET );
 511:../../../mod/flash/flash.c **** hal_status[1] = HAL_SPI_Transmit( &( FLASH_SPI )   ,
 512:../../../mod/flash/flash.c ****                                   &flash_opcodes[1],
 513:../../../mod/flash/flash.c ****                                   sizeof( uint8_t ),
 514:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 515:../../../mod/flash/flash.c **** hal_status[2] = HAL_SPI_Transmit( &( FLASH_SPI )        ,
 516:../../../mod/flash/flash.c ****                                   &flash_status         ,
 517:../../../mod/flash/flash.c ****                                   sizeof( flash_status ),
 518:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 519:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
 520:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 521:../../../mod/flash/flash.c ****                    GPIO_PIN_SET );
 522:../../../mod/flash/flash.c **** 
 523:../../../mod/flash/flash.c **** /* Return flash status */
 524:../../../mod/flash/flash.c **** if ( hal_status[0] != HAL_OK ||
 525:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 526:../../../mod/flash/flash.c **** 	 hal_status[2] != HAL_OK )
 527:../../../mod/flash/flash.c **** 	{
 528:../../../mod/flash/flash.c **** 	return FLASH_SPI_ERROR;
 529:../../../mod/flash/flash.c **** 	}
 530:../../../mod/flash/flash.c **** else
 531:../../../mod/flash/flash.c **** 	{
 532:../../../mod/flash/flash.c **** 	return FLASH_OK;
 533:../../../mod/flash/flash.c **** 	}
 534:../../../mod/flash/flash.c **** 
 535:../../../mod/flash/flash.c **** } /* flash_set_status */
 536:../../../mod/flash/flash.c **** 
 537:../../../mod/flash/flash.c **** 
 538:../../../mod/flash/flash.c **** /*******************************************************************************
 539:../../../mod/flash/flash.c **** *                                                                              *
 540:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   *
 541:../../../mod/flash/flash.c **** * 		flash_is_flash_busy                                                    *
 542:../../../mod/flash/flash.c **** *                                                                              *
 543:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 *
 544:../../../mod/flash/flash.c **** *       Polls the flash status register to see if the chip is busy. False      *
ARM GAS  /tmp/ccQ0EOEq.s 			page 11


 545:../../../mod/flash/flash.c **** *       boolean return value indicates the chip is ready for write operations  *
 546:../../../mod/flash/flash.c **** *                                                                              *
 547:../../../mod/flash/flash.c **** *******************************************************************************/
 548:../../../mod/flash/flash.c **** bool flash_is_flash_busy
 549:../../../mod/flash/flash.c **** 	(
 550:../../../mod/flash/flash.c **** 	void
 551:../../../mod/flash/flash.c **** 	)
 552:../../../mod/flash/flash.c **** {
 553:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 554:../../../mod/flash/flash.c ****  Local variables  
 555:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 556:../../../mod/flash/flash.c **** HFLASH_BUFFER flash_handle; /* Flash handle to store status reg contents      */
 557:../../../mod/flash/flash.c **** FLASH_STATUS  flash_status; /* Flash API return codes                         */
 558:../../../mod/flash/flash.c **** 
 559:../../../mod/flash/flash.c **** 
 560:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 561:../../../mod/flash/flash.c ****  Initializations 
 562:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 563:../../../mod/flash/flash.c **** flash_status                 = FLASH_OK;
 564:../../../mod/flash/flash.c **** flash_handle.status_register = 0xFF;
 565:../../../mod/flash/flash.c **** 
 566:../../../mod/flash/flash.c **** 
 567:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 568:../../../mod/flash/flash.c ****  Implementation 
 569:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 570:../../../mod/flash/flash.c **** 
 571:../../../mod/flash/flash.c **** /* Read status register */
 572:../../../mod/flash/flash.c **** flash_status = flash_get_status( &flash_handle );
 573:../../../mod/flash/flash.c **** if      ( flash_status != FLASH_OK                          )
 574:../../../mod/flash/flash.c **** 	{
 575:../../../mod/flash/flash.c **** 	return FLASH_BUSY;
 576:../../../mod/flash/flash.c **** 	}
 577:../../../mod/flash/flash.c **** else if ( flash_handle.status_register & FLASH_BUSY_BITMASK )
 578:../../../mod/flash/flash.c **** 	{
 579:../../../mod/flash/flash.c **** 	return FLASH_BUSY;
 580:../../../mod/flash/flash.c **** 	}
 581:../../../mod/flash/flash.c **** else
 582:../../../mod/flash/flash.c **** 	{
 583:../../../mod/flash/flash.c **** 	return FLASH_READY;
 584:../../../mod/flash/flash.c **** 	}
 585:../../../mod/flash/flash.c **** 
 586:../../../mod/flash/flash.c **** } /* flash_is_flash_busy */
 587:../../../mod/flash/flash.c **** 
 588:../../../mod/flash/flash.c **** 
 589:../../../mod/flash/flash.c **** /*******************************************************************************
 590:../../../mod/flash/flash.c **** *                                                                              *
 591:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
 592:../../../mod/flash/flash.c **** * 		flash_write_enable                                                     *
 593:../../../mod/flash/flash.c **** *                                                                              *
 594:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
 595:../../../mod/flash/flash.c **** *       Enable writing to the external flash chip by configuring the global    *
 596:../../../mod/flash/flash.c **** *       write protection variable                                              *
 597:../../../mod/flash/flash.c **** *                                                                              *
 598:../../../mod/flash/flash.c **** *******************************************************************************/
 599:../../../mod/flash/flash.c **** void flash_write_enable
 600:../../../mod/flash/flash.c **** 	(
 601:../../../mod/flash/flash.c **** 	void
ARM GAS  /tmp/ccQ0EOEq.s 			page 12


 602:../../../mod/flash/flash.c **** 	)
 603:../../../mod/flash/flash.c **** {
 604:../../../mod/flash/flash.c **** write_enabled = true;
 605:../../../mod/flash/flash.c **** } /* flash_write_enable */
 606:../../../mod/flash/flash.c **** 
 607:../../../mod/flash/flash.c **** 
 608:../../../mod/flash/flash.c **** /*******************************************************************************
 609:../../../mod/flash/flash.c **** *                                                                              *
 610:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
 611:../../../mod/flash/flash.c **** * 		flash_write_disable                                                    *
 612:../../../mod/flash/flash.c **** *                                                                              *
 613:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
 614:../../../mod/flash/flash.c **** *       Disable writing to the external flash chip                             *
 615:../../../mod/flash/flash.c **** *                                                                              *
 616:../../../mod/flash/flash.c **** *******************************************************************************/
 617:../../../mod/flash/flash.c **** void flash_write_disable
 618:../../../mod/flash/flash.c ****     (
 619:../../../mod/flash/flash.c ****     void 
 620:../../../mod/flash/flash.c ****     )
 621:../../../mod/flash/flash.c **** {
 622:../../../mod/flash/flash.c **** write_enabled = false;
 623:../../../mod/flash/flash.c **** } /* flash_write_disable */
 624:../../../mod/flash/flash.c **** 
 625:../../../mod/flash/flash.c **** 
 626:../../../mod/flash/flash.c **** /*******************************************************************************
 627:../../../mod/flash/flash.c **** *                                                                              *
 628:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
 629:../../../mod/flash/flash.c **** * 		flash_write_byte                                                       *
 630:../../../mod/flash/flash.c **** *                                                                              *
 631:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
 632:../../../mod/flash/flash.c **** *       writes a byte to the external flash                                    *
 633:../../../mod/flash/flash.c **** *                                                                              *
 634:../../../mod/flash/flash.c **** *******************************************************************************/
 635:../../../mod/flash/flash.c **** FLASH_STATUS flash_write_byte 
 636:../../../mod/flash/flash.c ****     (
 637:../../../mod/flash/flash.c **** 	HFLASH_BUFFER* pflash_handle,
 638:../../../mod/flash/flash.c **** 	uint8_t        byte
 639:../../../mod/flash/flash.c ****     )
 640:../../../mod/flash/flash.c **** {
 641:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 642:../../../mod/flash/flash.c ****  Local variables 
 643:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 644:../../../mod/flash/flash.c **** HAL_StatusTypeDef hal_status[3];    /* Status code return by hal functions    */
 645:../../../mod/flash/flash.c **** FLASH_STATUS      flash_status;     /* Status code returned by flash API      */
 646:../../../mod/flash/flash.c **** uint8_t           flash_opcode;     /* Data to be transmitted over SPI        */
 647:../../../mod/flash/flash.c **** uint8_t           address[3];       /* Flash memory address in byte form      */
 648:../../../mod/flash/flash.c **** 
 649:../../../mod/flash/flash.c **** 
 650:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 651:../../../mod/flash/flash.c ****  Initializations 
 652:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 653:../../../mod/flash/flash.c **** flash_status  = FLASH_OK;
 654:../../../mod/flash/flash.c **** flash_opcode  = FLASH_OP_HW_BYTE_PROGRAM;
 655:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 656:../../../mod/flash/flash.c **** 
 657:../../../mod/flash/flash.c **** 
 658:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
ARM GAS  /tmp/ccQ0EOEq.s 			page 13


 659:../../../mod/flash/flash.c ****  Pre-processing 
 660:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 661:../../../mod/flash/flash.c **** 
 662:../../../mod/flash/flash.c **** /* Check if write_enabled */
 663:../../../mod/flash/flash.c **** if( !( write_enabled ) )
 664:../../../mod/flash/flash.c **** 	{
 665:../../../mod/flash/flash.c **** 	return FLASH_WRITE_PROTECTED;
 666:../../../mod/flash/flash.c **** 	}
 667:../../../mod/flash/flash.c **** 
 668:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 669:../../../mod/flash/flash.c ****  API function implementation
 670:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 671:../../../mod/flash/flash.c **** 
 672:../../../mod/flash/flash.c **** /* Enable the chip for writing */
 673:../../../mod/flash/flash.c **** flash_status = write_enable();
 674:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 675:../../../mod/flash/flash.c **** 	{
 676:../../../mod/flash/flash.c **** 	return FLASH_CANNOT_WRITE_ENABLE;
 677:../../../mod/flash/flash.c **** 	}
 678:../../../mod/flash/flash.c **** 
 679:../../../mod/flash/flash.c **** /* Send the byte program command to the flash over SPI */
 680:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_RESET );
 681:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )       ,
 682:../../../mod/flash/flash.c **** 							      &flash_opcode        ,
 683:../../../mod/flash/flash.c **** 							      sizeof( flash_opcode ),
 684:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 685:../../../mod/flash/flash.c **** 
 686:../../../mod/flash/flash.c **** /* Send address bytes */
 687:../../../mod/flash/flash.c **** hal_status[1] = HAL_SPI_Transmit( &( FLASH_SPI )   ,
 688:../../../mod/flash/flash.c **** 							      &address[0]      ,
 689:../../../mod/flash/flash.c **** 							      sizeof( address ),
 690:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 691:../../../mod/flash/flash.c **** 
 692:../../../mod/flash/flash.c **** /* Write bytes */
 693:../../../mod/flash/flash.c **** hal_status[2] = HAL_SPI_Transmit( &( FLASH_SPI ),
 694:../../../mod/flash/flash.c **** 							     &byte          ,
 695:../../../mod/flash/flash.c **** 							     sizeof( byte ) ,
 696:../../../mod/flash/flash.c **** 							     HAL_FLASH_TIMEOUT );
 697:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_SET );
 698:../../../mod/flash/flash.c **** 
 699:../../../mod/flash/flash.c **** /* Return flash status */
 700:../../../mod/flash/flash.c **** if ( hal_status[0] != HAL_OK ||
 701:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 702:../../../mod/flash/flash.c **** 	 hal_status[2] != HAL_OK )
 703:../../../mod/flash/flash.c **** 	{
 704:../../../mod/flash/flash.c **** 	return FLASH_SPI_ERROR;
 705:../../../mod/flash/flash.c **** 	}
 706:../../../mod/flash/flash.c **** else
 707:../../../mod/flash/flash.c **** 	{
 708:../../../mod/flash/flash.c **** 	return FLASH_OK;
 709:../../../mod/flash/flash.c **** 	}
 710:../../../mod/flash/flash.c **** 
 711:../../../mod/flash/flash.c **** } /* flash_write_byte */
 712:../../../mod/flash/flash.c **** 
 713:../../../mod/flash/flash.c **** 
 714:../../../mod/flash/flash.c **** /*******************************************************************************
 715:../../../mod/flash/flash.c **** *                                                                              *
ARM GAS  /tmp/ccQ0EOEq.s 			page 14


 716:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
 717:../../../mod/flash/flash.c **** * 		flash_write                                                            *
 718:../../../mod/flash/flash.c **** *                                                                              *
 719:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
 720:../../../mod/flash/flash.c **** *       writes bytes from a flash buffer to the external flash                 *
 721:../../../mod/flash/flash.c **** *                                                                              *
 722:../../../mod/flash/flash.c **** *******************************************************************************/
 723:../../../mod/flash/flash.c **** FLASH_STATUS flash_write 
 724:../../../mod/flash/flash.c ****     (
 725:../../../mod/flash/flash.c **** 	HFLASH_BUFFER* pflash_handle
 726:../../../mod/flash/flash.c ****     )
 727:../../../mod/flash/flash.c **** {
 728:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 729:../../../mod/flash/flash.c ****  Local variables 
 730:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 731:../../../mod/flash/flash.c **** HAL_StatusTypeDef hal_status[3];    /* Status codes returned by HAL           */
 732:../../../mod/flash/flash.c **** FLASH_STATUS      flash_status;     /* Status codes returned by flash API     */
 733:../../../mod/flash/flash.c **** uint8_t           flash_opcode;     /* Opcode for flash instructions          */
 734:../../../mod/flash/flash.c **** uint32_t          timeout;          /* Timeout for flash write calls          */
 735:../../../mod/flash/flash.c **** uint32_t          timeout_ctr;      /* Counter to trigger timeout             */
 736:../../../mod/flash/flash.c **** uint8_t*          pbuffer;          /* Pointer to data in flash buffer        */
 737:../../../mod/flash/flash.c **** uint8_t           address_bytes[3]; /* Flash memory address in byte form      */
 738:../../../mod/flash/flash.c **** 
 739:../../../mod/flash/flash.c **** 
 740:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 741:../../../mod/flash/flash.c ****  Initializations 
 742:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 743:../../../mod/flash/flash.c **** flash_opcode  = FLASH_OP_HW_AAI_PROGRAM; 
 744:../../../mod/flash/flash.c **** flash_status  = FLASH_OK;
 745:../../../mod/flash/flash.c **** timeout       = 100;
 746:../../../mod/flash/flash.c **** timeout_ctr   = 0;
 747:../../../mod/flash/flash.c **** pbuffer       = pflash_handle -> pbuffer;
 748:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address_bytes[0] );
 749:../../../mod/flash/flash.c **** 
 750:../../../mod/flash/flash.c **** 
 751:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 752:../../../mod/flash/flash.c ****  Pre-processing 
 753:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 754:../../../mod/flash/flash.c **** 
 755:../../../mod/flash/flash.c **** /* Check if write_enabled */
 756:../../../mod/flash/flash.c **** if( !( write_enabled ) )
 757:../../../mod/flash/flash.c **** 	{
 758:../../../mod/flash/flash.c **** 	return FLASH_WRITE_PROTECTED;
 759:../../../mod/flash/flash.c **** 	}
 760:../../../mod/flash/flash.c **** 
 761:../../../mod/flash/flash.c **** /* Check for 1/0 byte edge case */
 762:../../../mod/flash/flash.c **** if      ( pflash_handle -> num_bytes == 1 )
 763:../../../mod/flash/flash.c **** 	{
 764:../../../mod/flash/flash.c **** 	return flash_write_byte( pflash_handle, *( pflash_handle -> pbuffer ) );
 765:../../../mod/flash/flash.c **** 	}
 766:../../../mod/flash/flash.c **** else if ( pflash_handle -> num_bytes == 0 )
 767:../../../mod/flash/flash.c **** 	{
 768:../../../mod/flash/flash.c **** 	return FLASH_ERROR_MISSING_DATA;
 769:../../../mod/flash/flash.c **** 	}
 770:../../../mod/flash/flash.c **** 
 771:../../../mod/flash/flash.c **** 
 772:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
ARM GAS  /tmp/ccQ0EOEq.s 			page 15


 773:../../../mod/flash/flash.c ****  API function implementation
 774:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 775:../../../mod/flash/flash.c **** 
 776:../../../mod/flash/flash.c **** /* Enable the chip for writing */
 777:../../../mod/flash/flash.c **** flash_status = write_enable();
 778:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 779:../../../mod/flash/flash.c **** 	{
 780:../../../mod/flash/flash.c **** 	return FLASH_CANNOT_WRITE_ENABLE;
 781:../../../mod/flash/flash.c **** 	}
 782:../../../mod/flash/flash.c **** 
 783:../../../mod/flash/flash.c **** /* Initial SPI transmission */
 784:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_RESET );
 785:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )        ,
 786:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 787:../../../mod/flash/flash.c **** 							      sizeof( flash_opcode ),
 788:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 789:../../../mod/flash/flash.c **** hal_status[1] = HAL_SPI_Transmit( &( FLASH_SPI )         ,
 790:../../../mod/flash/flash.c **** 							      &address_bytes[0]      ,
 791:../../../mod/flash/flash.c **** 							      sizeof( address_bytes ),
 792:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 793:../../../mod/flash/flash.c **** hal_status[2] = HAL_SPI_Transmit( &( FLASH_SPI ), 
 794:../../../mod/flash/flash.c ****                                   pbuffer       ,
 795:../../../mod/flash/flash.c **** 								  2             , 
 796:../../../mod/flash/flash.c **** 								  HAL_DEFAULT_TIMEOUT );						
 797:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_SET );
 798:../../../mod/flash/flash.c **** 
 799:../../../mod/flash/flash.c **** /* Check for SPI errors */
 800:../../../mod/flash/flash.c **** if ( hal_status[0] != HAL_OK ||
 801:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 802:../../../mod/flash/flash.c **** 	 hal_status[2] != HAL_OK )
 803:../../../mod/flash/flash.c **** 	{
 804:../../../mod/flash/flash.c **** 	return FLASH_SPI_ERROR;
 805:../../../mod/flash/flash.c **** 	}
 806:../../../mod/flash/flash.c **** 
 807:../../../mod/flash/flash.c **** /* Transmit remaining data */
 808:../../../mod/flash/flash.c **** for ( int i = 2; i < pflash_handle -> num_bytes; i += 2 )
 809:../../../mod/flash/flash.c **** 	{
 810:../../../mod/flash/flash.c **** 	/* Setup buffer pointer  */
 811:../../../mod/flash/flash.c **** 	pbuffer += 2;
 812:../../../mod/flash/flash.c **** 
 813:../../../mod/flash/flash.c **** 	/* Wait for flash to be ready */
 814:../../../mod/flash/flash.c **** 	while( flash_is_flash_busy() == FLASH_BUSY )
 815:../../../mod/flash/flash.c **** 		{
 816:../../../mod/flash/flash.c **** 		if ( timeout_ctr >= timeout )
 817:../../../mod/flash/flash.c **** 			{
 818:../../../mod/flash/flash.c **** 			return FLASH_TIMEOUT;
 819:../../../mod/flash/flash.c **** 			}
 820:../../../mod/flash/flash.c **** 		else
 821:../../../mod/flash/flash.c **** 			{
 822:../../../mod/flash/flash.c **** 			timeout_ctr++;
 823:../../../mod/flash/flash.c **** 			HAL_Delay( 1 );
 824:../../../mod/flash/flash.c **** 			}
 825:../../../mod/flash/flash.c **** 		}
 826:../../../mod/flash/flash.c **** 
 827:../../../mod/flash/flash.c **** 	/* SPI Transmission */	
 828:../../../mod/flash/flash.c **** 	HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_RESET );
 829:../../../mod/flash/flash.c **** 	hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )        ,
ARM GAS  /tmp/ccQ0EOEq.s 			page 16


 830:../../../mod/flash/flash.c **** 									&flash_opcode         ,
 831:../../../mod/flash/flash.c **** 									sizeof( flash_opcode ),
 832:../../../mod/flash/flash.c **** 									HAL_DEFAULT_TIMEOUT );
 833:../../../mod/flash/flash.c **** 	hal_status[1] = HAL_SPI_Transmit( &( FLASH_SPI ), 
 834:../../../mod/flash/flash.c **** 									pbuffer       ,
 835:../../../mod/flash/flash.c **** 									2             , 
 836:../../../mod/flash/flash.c **** 									HAL_DEFAULT_TIMEOUT );						
 837:../../../mod/flash/flash.c **** 	HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_SET );
 838:../../../mod/flash/flash.c **** 
 839:../../../mod/flash/flash.c **** 	/* Check for errors */
 840:../../../mod/flash/flash.c **** 	if ( hal_status[0] != HAL_OK || hal_status[1] != HAL_OK )
 841:../../../mod/flash/flash.c **** 		{
 842:../../../mod/flash/flash.c **** 		return FLASH_WRITE_ERROR;
 843:../../../mod/flash/flash.c **** 		}
 844:../../../mod/flash/flash.c **** 	} /* for ( i < pflash_handle -> num_bytes )*/
 845:../../../mod/flash/flash.c **** 
 846:../../../mod/flash/flash.c **** /* Wait for AAI to complete */
 847:../../../mod/flash/flash.c **** while ( flash_is_flash_busy() == FLASH_BUSY ){}
 848:../../../mod/flash/flash.c **** 
 849:../../../mod/flash/flash.c **** /* Terminate AAI Programming */
 850:../../../mod/flash/flash.c **** flash_status = write_disable();
 851:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 852:../../../mod/flash/flash.c **** 	{
 853:../../../mod/flash/flash.c **** 	return FLASH_CANNOT_EXIT_AAI;
 854:../../../mod/flash/flash.c **** 	}
 855:../../../mod/flash/flash.c **** 
 856:../../../mod/flash/flash.c **** /* Wait for WRDI to complete */
 857:../../../mod/flash/flash.c **** while ( flash_is_flash_busy() == FLASH_BUSY ){}
 858:../../../mod/flash/flash.c **** 
 859:../../../mod/flash/flash.c **** /* Transmit final byte if num_bytes is odd */
 860:../../../mod/flash/flash.c **** if ( ( pflash_handle -> num_bytes ) %2 == 1 )
 861:../../../mod/flash/flash.c **** 	{
 862:../../../mod/flash/flash.c **** 	pbuffer += 1;
 863:../../../mod/flash/flash.c **** 	return flash_write_byte( pflash_handle, *pbuffer );
 864:../../../mod/flash/flash.c **** 	}
 865:../../../mod/flash/flash.c **** else
 866:../../../mod/flash/flash.c **** 	{
 867:../../../mod/flash/flash.c **** 	/* Flash write successful */
 868:../../../mod/flash/flash.c **** 	return FLASH_OK;
 869:../../../mod/flash/flash.c **** 	}
 870:../../../mod/flash/flash.c **** 
 871:../../../mod/flash/flash.c **** } /* flash_write */
 872:../../../mod/flash/flash.c **** 
 873:../../../mod/flash/flash.c **** 
 874:../../../mod/flash/flash.c **** /*******************************************************************************
 875:../../../mod/flash/flash.c **** *                                                                              *
 876:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
 877:../../../mod/flash/flash.c **** * 		flash_read                                                             *
 878:../../../mod/flash/flash.c **** *                                                                              *
 879:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
 880:../../../mod/flash/flash.c **** *       reads a specified number of bytes using a flash buffer                 *
 881:../../../mod/flash/flash.c **** *                                                                              *
 882:../../../mod/flash/flash.c **** *******************************************************************************/
 883:../../../mod/flash/flash.c **** FLASH_STATUS flash_read
 884:../../../mod/flash/flash.c ****     (
 885:../../../mod/flash/flash.c **** 	HFLASH_BUFFER* pflash_handle,
 886:../../../mod/flash/flash.c ****     uint32_t       num_bytes
ARM GAS  /tmp/ccQ0EOEq.s 			page 17


 887:../../../mod/flash/flash.c ****     )
 888:../../../mod/flash/flash.c **** {
 889:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 890:../../../mod/flash/flash.c ****  Local variables 
 891:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 892:../../../mod/flash/flash.c **** HAL_StatusTypeDef hal_status[4]; /* Status code return by hal spi functions   */
 893:../../../mod/flash/flash.c **** uint8_t           flash_opcode;  /* Data to be transmitted over SPI           */
 894:../../../mod/flash/flash.c **** uint8_t           address[3];    /* Flash address in byte format              */
 895:../../../mod/flash/flash.c **** uint8_t*          pbuffer;       /* Pointer to position in output buffer      */
 896:../../../mod/flash/flash.c **** uint8_t           dummy_byte;    /* Dummy byte needed for high speed read     */
 897:../../../mod/flash/flash.c **** 
 898:../../../mod/flash/flash.c **** 
 899:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 900:../../../mod/flash/flash.c ****  Initializations 
 901:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 902:../../../mod/flash/flash.c **** flash_opcode = FLASH_OP_HW_READ_HS;
 903:../../../mod/flash/flash.c **** dummy_byte   = 0;
 904:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 905:../../../mod/flash/flash.c **** 
 906:../../../mod/flash/flash.c **** 
 907:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 908:../../../mod/flash/flash.c ****  API function implementation
 909:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 910:../../../mod/flash/flash.c **** 
 911:../../../mod/flash/flash.c **** /* Initiate SPI transmission */
 912:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_RESET );
 913:../../../mod/flash/flash.c **** 
 914:../../../mod/flash/flash.c **** /* Command opcode */
 915:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )        ,
 916:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 917:../../../mod/flash/flash.c **** 							      sizeof( flash_opcode ),
 918:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 919:../../../mod/flash/flash.c **** 
 920:../../../mod/flash/flash.c **** /* Address */
 921:../../../mod/flash/flash.c **** hal_status[1] = HAL_SPI_Transmit( &( FLASH_SPI )   ,
 922:../../../mod/flash/flash.c **** 							      &( address[0] )  ,
 923:../../../mod/flash/flash.c **** 							      sizeof( address ),
 924:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 925:../../../mod/flash/flash.c **** 
 926:../../../mod/flash/flash.c **** /* Dummy Cycle */
 927:../../../mod/flash/flash.c **** hal_status[2] = HAL_SPI_Transmit( &( FLASH_SPI )   ,
 928:../../../mod/flash/flash.c **** 							      &( dummy_byte )  ,
 929:../../../mod/flash/flash.c **** 							      sizeof( dummy_byte ),
 930:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 931:../../../mod/flash/flash.c **** 
 932:../../../mod/flash/flash.c **** /* Check for SPI errors */
 933:../../../mod/flash/flash.c **** if ( hal_status[0] != HAL_OK || 
 934:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK || 
 935:../../../mod/flash/flash.c **** 	 hal_status[2] != HAL_OK )
 936:../../../mod/flash/flash.c **** 	{   
 937:../../../mod/flash/flash.c **** 	return FLASH_SPI_ERROR;
 938:../../../mod/flash/flash.c **** 	}
 939:../../../mod/flash/flash.c **** 
 940:../../../mod/flash/flash.c **** /* Recieve output into buffer*/
 941:../../../mod/flash/flash.c **** for ( int i = 0; i < num_bytes; ++i )
 942:../../../mod/flash/flash.c **** 	{
 943:../../../mod/flash/flash.c **** 	pbuffer = ( pflash_handle -> pbuffer ) + i;
ARM GAS  /tmp/ccQ0EOEq.s 			page 18


 944:../../../mod/flash/flash.c **** 	hal_status[3] = HAL_SPI_Receive( &( FLASH_SPI )      ,
 945:../../../mod/flash/flash.c **** 								     pbuffer             ,
 946:../../../mod/flash/flash.c **** 								     sizeof( uint8_t )   ,
 947:../../../mod/flash/flash.c **** 								     HAL_DEFAULT_TIMEOUT );
 948:../../../mod/flash/flash.c **** 
 949:../../../mod/flash/flash.c **** 	if ( hal_status[3] != HAL_OK )
 950:../../../mod/flash/flash.c **** 		{
 951:../../../mod/flash/flash.c **** 		return FLASH_SPI_ERROR;
 952:../../../mod/flash/flash.c **** 		}
 953:../../../mod/flash/flash.c **** 	}
 954:../../../mod/flash/flash.c **** 
 955:../../../mod/flash/flash.c **** /* Drive chip enable line high */
 956:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_SET );
 957:../../../mod/flash/flash.c **** 
 958:../../../mod/flash/flash.c **** /* Flash read successful */
 959:../../../mod/flash/flash.c **** return FLASH_OK;
 960:../../../mod/flash/flash.c **** 
 961:../../../mod/flash/flash.c **** } /* flash_read */
 962:../../../mod/flash/flash.c **** 
 963:../../../mod/flash/flash.c **** 
 964:../../../mod/flash/flash.c **** /*******************************************************************************
 965:../../../mod/flash/flash.c **** *                                                                              *
 966:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
 967:../../../mod/flash/flash.c **** * 		flash_erase                                                            *
 968:../../../mod/flash/flash.c **** *                                                                              *
 969:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
 970:../../../mod/flash/flash.c **** *       erases the entire flash chip                                           *
 971:../../../mod/flash/flash.c **** *                                                                              *
 972:../../../mod/flash/flash.c **** *******************************************************************************/
 973:../../../mod/flash/flash.c **** FLASH_STATUS flash_erase
 974:../../../mod/flash/flash.c ****     (
 975:../../../mod/flash/flash.c ****     HFLASH_BUFFER* pflash_handle	
 976:../../../mod/flash/flash.c ****     )
 977:../../../mod/flash/flash.c **** {
 978:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 979:../../../mod/flash/flash.c ****  Local variables 
 980:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 981:../../../mod/flash/flash.c **** int8_t       hal_status;    /* Status code return by hal spi functions        */
 982:../../../mod/flash/flash.c **** uint8_t      flash_opcode;  /* Data to be transmitted over SPI                */
 983:../../../mod/flash/flash.c **** FLASH_STATUS flash_status;
 984:../../../mod/flash/flash.c **** 
 985:../../../mod/flash/flash.c **** 
 986:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 987:../../../mod/flash/flash.c ****  Initializations 
 988:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 989:../../../mod/flash/flash.c **** flash_opcode = FLASH_OP_HW_FULL_ERASE;
 990:../../../mod/flash/flash.c **** 
 991:../../../mod/flash/flash.c **** 
 992:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 993:../../../mod/flash/flash.c ****  Pre-processing 
 994:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 995:../../../mod/flash/flash.c **** 
 996:../../../mod/flash/flash.c **** /* Check if write_enabled */
 997:../../../mod/flash/flash.c **** if( !( write_enabled ) )
 998:../../../mod/flash/flash.c ****     {
 999:../../../mod/flash/flash.c ****     return FLASH_WRITE_PROTECTED;
1000:../../../mod/flash/flash.c ****     }
ARM GAS  /tmp/ccQ0EOEq.s 			page 19


1001:../../../mod/flash/flash.c **** 
1002:../../../mod/flash/flash.c **** 
1003:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1004:../../../mod/flash/flash.c ****  API function implementation
1005:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1006:../../../mod/flash/flash.c **** 
1007:../../../mod/flash/flash.c **** /* Enable writing to flash */
1008:../../../mod/flash/flash.c **** flash_status = write_enable();
1009:../../../mod/flash/flash.c **** 
1010:../../../mod/flash/flash.c **** /* Full chip erase */
1011:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_RESET );
1012:../../../mod/flash/flash.c **** hal_status = HAL_SPI_Transmit( &( FLASH_SPI )        ,
1013:../../../mod/flash/flash.c **** 							   &flash_opcode         ,
1014:../../../mod/flash/flash.c **** 							   sizeof( flash_opcode ),
1015:../../../mod/flash/flash.c **** 							   HAL_DEFAULT_TIMEOUT );
1016:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_SET );
1017:../../../mod/flash/flash.c **** 
1018:../../../mod/flash/flash.c **** /* Return status code */
1019:../../../mod/flash/flash.c **** if      ( hal_status   != HAL_OK   )
1020:../../../mod/flash/flash.c **** 	{
1021:../../../mod/flash/flash.c **** 	return FLASH_SPI_ERROR;
1022:../../../mod/flash/flash.c **** 	}
1023:../../../mod/flash/flash.c **** else if ( flash_status != FLASH_OK )
1024:../../../mod/flash/flash.c **** 	{
1025:../../../mod/flash/flash.c **** 	return FLASH_FAIL;
1026:../../../mod/flash/flash.c **** 	}
1027:../../../mod/flash/flash.c **** else
1028:../../../mod/flash/flash.c **** 	{
1029:../../../mod/flash/flash.c **** 	return FLASH_OK;
1030:../../../mod/flash/flash.c **** 	}
1031:../../../mod/flash/flash.c **** 
1032:../../../mod/flash/flash.c **** } /* flash_erase */
1033:../../../mod/flash/flash.c **** 
1034:../../../mod/flash/flash.c **** 
1035:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1036:../../../mod/flash/flash.c ****  Internal procedures 
1037:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1038:../../../mod/flash/flash.c **** 
1039:../../../mod/flash/flash.c **** 
1040:../../../mod/flash/flash.c **** /*******************************************************************************
1041:../../../mod/flash/flash.c **** *                                                                              *
1042:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
1043:../../../mod/flash/flash.c **** * 		address_to_bytes                                                       *
1044:../../../mod/flash/flash.c **** *                                                                              *
1045:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
1046:../../../mod/flash/flash.c **** * 		Converts a flash memory address in uint32_t format to a byte array     *
1047:../../../mod/flash/flash.c **** *                                                                              *
1048:../../../mod/flash/flash.c **** *******************************************************************************/
1049:../../../mod/flash/flash.c **** static void address_to_bytes
1050:../../../mod/flash/flash.c **** 	(
1051:../../../mod/flash/flash.c **** 	uint32_t address,
1052:../../../mod/flash/flash.c **** 	uint8_t* address_bytes
1053:../../../mod/flash/flash.c **** 	)
1054:../../../mod/flash/flash.c **** {
  28              		.loc 1 1054 1 view -0
  29              		.cfi_startproc
  30              		@ args = 0, pretend = 0, frame = 0
ARM GAS  /tmp/ccQ0EOEq.s 			page 20


  31              		@ frame_needed = 0, uses_anonymous_args = 0
  32              		@ link register save eliminated.
1055:../../../mod/flash/flash.c **** address_bytes[0] = (address >> 16) & 0xFF;
  33              		.loc 1 1055 1 view .LVU1
  34              		.loc 1 1055 29 is_stmt 0 view .LVU2
  35 0000 030C     		lsrs	r3, r0, #16
  36              		.loc 1 1055 18 view .LVU3
  37 0002 0B70     		strb	r3, [r1]
1056:../../../mod/flash/flash.c **** address_bytes[1] = (address >> 8 ) & 0xFF;
  38              		.loc 1 1056 1 is_stmt 1 view .LVU4
  39              		.loc 1 1056 29 is_stmt 0 view .LVU5
  40 0004 030A     		lsrs	r3, r0, #8
  41              		.loc 1 1056 18 view .LVU6
  42 0006 4B70     		strb	r3, [r1, #1]
1057:../../../mod/flash/flash.c **** address_bytes[2] =  address        & 0xFF;
  43              		.loc 1 1057 1 is_stmt 1 view .LVU7
  44              		.loc 1 1057 18 is_stmt 0 view .LVU8
  45 0008 8870     		strb	r0, [r1, #2]
1058:../../../mod/flash/flash.c **** } /* address_to_bytes */
  46              		.loc 1 1058 1 view .LVU9
  47 000a 7047     		bx	lr
  48              		.cfi_endproc
  49              	.LFE155:
  51              		.section	.text.write_disable,"ax",%progbits
  52              		.align	1
  53              		.syntax unified
  54              		.thumb
  55              		.thumb_func
  57              	write_disable:
  58              	.LFB158:
1059:../../../mod/flash/flash.c **** 
1060:../../../mod/flash/flash.c **** 
1061:../../../mod/flash/flash.c **** /*******************************************************************************
1062:../../../mod/flash/flash.c **** *                                                                              *
1063:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
1064:../../../mod/flash/flash.c **** * 		bytes_to_address                                                       *
1065:../../../mod/flash/flash.c **** *                                                                              *
1066:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
1067:../../../mod/flash/flash.c **** * 		Converts a flash memory address in byte format to uint32_t format      *
1068:../../../mod/flash/flash.c **** *                                                                              *
1069:../../../mod/flash/flash.c **** *******************************************************************************/
1070:../../../mod/flash/flash.c **** static inline uint32_t bytes_to_address 
1071:../../../mod/flash/flash.c **** 	(
1072:../../../mod/flash/flash.c **** 	uint8_t address_bytes[3]
1073:../../../mod/flash/flash.c **** 	)
1074:../../../mod/flash/flash.c **** {
1075:../../../mod/flash/flash.c **** return ( (uint32_t) address_bytes[0] << 16 ) |
1076:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[1] << 8  ) |
1077:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
1078:../../../mod/flash/flash.c **** } /* address_to_bytes */
1079:../../../mod/flash/flash.c **** 
1080:../../../mod/flash/flash.c **** 
1081:../../../mod/flash/flash.c **** /*******************************************************************************
1082:../../../mod/flash/flash.c **** *                                                                              *
1083:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   *
1084:../../../mod/flash/flash.c **** * 		write_enable                                                           *
1085:../../../mod/flash/flash.c **** *                                                                              *
ARM GAS  /tmp/ccQ0EOEq.s 			page 21


1086:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 *
1087:../../../mod/flash/flash.c **** *       Enable writing to the external flash chip hardware                     *
1088:../../../mod/flash/flash.c **** *                                                                              *
1089:../../../mod/flash/flash.c **** *******************************************************************************/
1090:../../../mod/flash/flash.c **** static FLASH_STATUS write_enable
1091:../../../mod/flash/flash.c ****     (
1092:../../../mod/flash/flash.c ****     void 
1093:../../../mod/flash/flash.c ****     )
1094:../../../mod/flash/flash.c **** {
1095:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1096:../../../mod/flash/flash.c ****  Local variables  
1097:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1098:../../../mod/flash/flash.c **** uint8_t hal_status;        /* Status code return by hal spi functions         */
1099:../../../mod/flash/flash.c **** uint8_t flash_opcode;      /* Flash operation/instruction cyle byte           */
1100:../../../mod/flash/flash.c **** 
1101:../../../mod/flash/flash.c **** 
1102:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1103:../../../mod/flash/flash.c ****  Local variables  
1104:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1105:../../../mod/flash/flash.c **** hal_status    = HAL_OK;
1106:../../../mod/flash/flash.c **** flash_opcode  = FLASH_OP_HW_WREN;
1107:../../../mod/flash/flash.c **** 
1108:../../../mod/flash/flash.c **** 
1109:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1110:../../../mod/flash/flash.c ****  API function implementation 
1111:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1112:../../../mod/flash/flash.c **** 
1113:../../../mod/flash/flash.c **** /* Send the write enable instruction to the flash over SPI */
1114:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
1115:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
1116:../../../mod/flash/flash.c ****                    GPIO_PIN_RESET );
1117:../../../mod/flash/flash.c **** hal_status = HAL_SPI_Transmit( &( FLASH_SPI )        ,
1118:../../../mod/flash/flash.c ****                                &flash_opcode         ,
1119:../../../mod/flash/flash.c ****                                sizeof( flash_opcode ),
1120:../../../mod/flash/flash.c ****                                HAL_DEFAULT_TIMEOUT );
1121:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
1122:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
1123:../../../mod/flash/flash.c ****                    GPIO_PIN_SET );
1124:../../../mod/flash/flash.c **** 
1125:../../../mod/flash/flash.c **** /* Set write enabled bit in flash buffer handle */
1126:../../../mod/flash/flash.c **** if ( hal_status != HAL_OK )
1127:../../../mod/flash/flash.c **** 	{
1128:../../../mod/flash/flash.c **** 	return FLASH_SPI_ERROR;
1129:../../../mod/flash/flash.c ****     }
1130:../../../mod/flash/flash.c **** else
1131:../../../mod/flash/flash.c **** 	{
1132:../../../mod/flash/flash.c **** 	return FLASH_OK;
1133:../../../mod/flash/flash.c ****     }
1134:../../../mod/flash/flash.c **** 
1135:../../../mod/flash/flash.c **** } /* write_enable */
1136:../../../mod/flash/flash.c **** 
1137:../../../mod/flash/flash.c **** 
1138:../../../mod/flash/flash.c **** /*******************************************************************************
1139:../../../mod/flash/flash.c **** *                                                                              *
1140:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   *
1141:../../../mod/flash/flash.c **** * 		write_disable                                                          *
1142:../../../mod/flash/flash.c **** *                                                                              *
ARM GAS  /tmp/ccQ0EOEq.s 			page 22


1143:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 *
1144:../../../mod/flash/flash.c **** *       Disable writing to the external flash chip hardware                    *
1145:../../../mod/flash/flash.c **** *                                                                              *
1146:../../../mod/flash/flash.c **** *******************************************************************************/
1147:../../../mod/flash/flash.c **** static FLASH_STATUS write_disable 
1148:../../../mod/flash/flash.c ****     (
1149:../../../mod/flash/flash.c ****     void 
1150:../../../mod/flash/flash.c ****     )
1151:../../../mod/flash/flash.c **** {
  59              		.loc 1 1151 1 is_stmt 1 view -0
  60              		.cfi_startproc
  61              		@ args = 0, pretend = 0, frame = 8
  62              		@ frame_needed = 0, uses_anonymous_args = 0
  63 0000 30B5     		push	{r4, r5, lr}
  64              	.LCFI0:
  65              		.cfi_def_cfa_offset 12
  66              		.cfi_offset 4, -12
  67              		.cfi_offset 5, -8
  68              		.cfi_offset 14, -4
  69 0002 83B0     		sub	sp, sp, #12
  70              	.LCFI1:
  71              		.cfi_def_cfa_offset 24
1152:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1153:../../../mod/flash/flash.c ****  Local variables  
1154:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1155:../../../mod/flash/flash.c **** uint8_t hal_status;        /* Status code return by hal spi functions         */
  72              		.loc 1 1155 1 view .LVU11
1156:../../../mod/flash/flash.c **** uint8_t flash_opcode;      /* Flash operation/instruction cyle byte           */
  73              		.loc 1 1156 1 view .LVU12
1157:../../../mod/flash/flash.c **** 
1158:../../../mod/flash/flash.c **** 
1159:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1160:../../../mod/flash/flash.c ****  Local variables  
1161:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1162:../../../mod/flash/flash.c **** hal_status    = HAL_OK;
  74              		.loc 1 1162 1 view .LVU13
  75              	.LVL1:
1163:../../../mod/flash/flash.c **** flash_opcode  = FLASH_OP_HW_WRDI;
  76              		.loc 1 1163 1 view .LVU14
  77              		.loc 1 1163 15 is_stmt 0 view .LVU15
  78 0004 0423     		movs	r3, #4
  79 0006 8DF80730 		strb	r3, [sp, #7]
1164:../../../mod/flash/flash.c **** 
1165:../../../mod/flash/flash.c **** 
1166:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1167:../../../mod/flash/flash.c ****  API function implementation 
1168:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1169:../../../mod/flash/flash.c **** 
1170:../../../mod/flash/flash.c **** /* Send the write enable instruction to the flash over SPI */
1171:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
  80              		.loc 1 1171 1 is_stmt 1 view .LVU16
  81 000a 0E4D     		ldr	r5, .L6
  82 000c 0022     		movs	r2, #0
  83 000e 4FF48051 		mov	r1, #4096
  84 0012 2846     		mov	r0, r5
  85 0014 FFF7FEFF 		bl	HAL_GPIO_WritePin
  86              	.LVL2:
ARM GAS  /tmp/ccQ0EOEq.s 			page 23


1172:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
1173:../../../mod/flash/flash.c ****                    GPIO_PIN_RESET );
1174:../../../mod/flash/flash.c **** hal_status = HAL_SPI_Transmit( &( FLASH_SPI )        ,
  87              		.loc 1 1174 1 view .LVU17
  88              		.loc 1 1174 14 is_stmt 0 view .LVU18
  89 0018 4FF0FF33 		mov	r3, #-1
  90 001c 0122     		movs	r2, #1
  91 001e 0DF10701 		add	r1, sp, #7
  92 0022 0948     		ldr	r0, .L6+4
  93 0024 FFF7FEFF 		bl	HAL_SPI_Transmit
  94              	.LVL3:
  95 0028 0446     		mov	r4, r0
  96              	.LVL4:
1175:../../../mod/flash/flash.c ****                                &flash_opcode         ,
1176:../../../mod/flash/flash.c ****                                sizeof( flash_opcode ),
1177:../../../mod/flash/flash.c ****                                HAL_DEFAULT_TIMEOUT );
1178:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
  97              		.loc 1 1178 1 is_stmt 1 view .LVU19
  98 002a 0122     		movs	r2, #1
  99 002c 4FF48051 		mov	r1, #4096
 100 0030 2846     		mov	r0, r5
 101 0032 FFF7FEFF 		bl	HAL_GPIO_WritePin
 102              	.LVL5:
1179:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
1180:../../../mod/flash/flash.c ****                    GPIO_PIN_SET );
1181:../../../mod/flash/flash.c **** 
1182:../../../mod/flash/flash.c **** /* Return results of SPI HAL calls */
1183:../../../mod/flash/flash.c **** if ( hal_status != HAL_OK )
 103              		.loc 1 1183 1 view .LVU20
 104              		.loc 1 1183 4 is_stmt 0 view .LVU21
 105 0036 14B9     		cbnz	r4, .L5
 106              	.LVL6:
 107              	.L3:
1184:../../../mod/flash/flash.c **** 	{
1185:../../../mod/flash/flash.c **** 	return FLASH_SPI_ERROR;
1186:../../../mod/flash/flash.c ****     }
1187:../../../mod/flash/flash.c **** else
1188:../../../mod/flash/flash.c **** 	{
1189:../../../mod/flash/flash.c **** 	return FLASH_OK;
1190:../../../mod/flash/flash.c ****     }
1191:../../../mod/flash/flash.c **** 
1192:../../../mod/flash/flash.c **** } /* write_disable */
 108              		.loc 1 1192 1 view .LVU22
 109 0038 2046     		mov	r0, r4
 110 003a 03B0     		add	sp, sp, #12
 111              	.LCFI2:
 112              		.cfi_remember_state
 113              		.cfi_def_cfa_offset 12
 114              		@ sp needed
 115 003c 30BD     		pop	{r4, r5, pc}
 116              	.LVL7:
 117              	.L5:
 118              	.LCFI3:
 119              		.cfi_restore_state
1185:../../../mod/flash/flash.c ****     }
 120              		.loc 1 1185 9 view .LVU23
 121 003e 0824     		movs	r4, #8
ARM GAS  /tmp/ccQ0EOEq.s 			page 24


 122              	.LVL8:
1185:../../../mod/flash/flash.c ****     }
 123              		.loc 1 1185 9 view .LVU24
 124 0040 FAE7     		b	.L3
 125              	.L7:
 126 0042 00BF     		.align	2
 127              	.L6:
 128 0044 00040258 		.word	1476527104
 129 0048 00000000 		.word	hspi2
 130              		.cfi_endproc
 131              	.LFE158:
 133              		.section	.text.write_enable,"ax",%progbits
 134              		.align	1
 135              		.syntax unified
 136              		.thumb
 137              		.thumb_func
 139              	write_enable:
 140              	.LFB157:
1094:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 141              		.loc 1 1094 1 is_stmt 1 view -0
 142              		.cfi_startproc
 143              		@ args = 0, pretend = 0, frame = 8
 144              		@ frame_needed = 0, uses_anonymous_args = 0
 145 0000 30B5     		push	{r4, r5, lr}
 146              	.LCFI4:
 147              		.cfi_def_cfa_offset 12
 148              		.cfi_offset 4, -12
 149              		.cfi_offset 5, -8
 150              		.cfi_offset 14, -4
 151 0002 83B0     		sub	sp, sp, #12
 152              	.LCFI5:
 153              		.cfi_def_cfa_offset 24
1098:../../../mod/flash/flash.c **** uint8_t flash_opcode;      /* Flash operation/instruction cyle byte           */
 154              		.loc 1 1098 1 view .LVU26
1099:../../../mod/flash/flash.c **** 
 155              		.loc 1 1099 1 view .LVU27
1105:../../../mod/flash/flash.c **** flash_opcode  = FLASH_OP_HW_WREN;
 156              		.loc 1 1105 1 view .LVU28
 157              	.LVL9:
1106:../../../mod/flash/flash.c **** 
 158              		.loc 1 1106 1 view .LVU29
1106:../../../mod/flash/flash.c **** 
 159              		.loc 1 1106 15 is_stmt 0 view .LVU30
 160 0004 0623     		movs	r3, #6
 161 0006 8DF80730 		strb	r3, [sp, #7]
1114:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 162              		.loc 1 1114 1 is_stmt 1 view .LVU31
 163 000a 0E4D     		ldr	r5, .L12
 164 000c 0022     		movs	r2, #0
 165 000e 4FF48051 		mov	r1, #4096
 166 0012 2846     		mov	r0, r5
 167 0014 FFF7FEFF 		bl	HAL_GPIO_WritePin
 168              	.LVL10:
1117:../../../mod/flash/flash.c ****                                &flash_opcode         ,
 169              		.loc 1 1117 1 view .LVU32
1117:../../../mod/flash/flash.c ****                                &flash_opcode         ,
 170              		.loc 1 1117 14 is_stmt 0 view .LVU33
ARM GAS  /tmp/ccQ0EOEq.s 			page 25


 171 0018 4FF0FF33 		mov	r3, #-1
 172 001c 0122     		movs	r2, #1
 173 001e 0DF10701 		add	r1, sp, #7
 174 0022 0948     		ldr	r0, .L12+4
 175 0024 FFF7FEFF 		bl	HAL_SPI_Transmit
 176              	.LVL11:
 177 0028 0446     		mov	r4, r0
 178              	.LVL12:
1121:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 179              		.loc 1 1121 1 is_stmt 1 view .LVU34
 180 002a 0122     		movs	r2, #1
 181 002c 4FF48051 		mov	r1, #4096
 182 0030 2846     		mov	r0, r5
 183 0032 FFF7FEFF 		bl	HAL_GPIO_WritePin
 184              	.LVL13:
1126:../../../mod/flash/flash.c **** 	{
 185              		.loc 1 1126 1 view .LVU35
1126:../../../mod/flash/flash.c **** 	{
 186              		.loc 1 1126 4 is_stmt 0 view .LVU36
 187 0036 14B9     		cbnz	r4, .L11
 188              	.LVL14:
 189              	.L9:
1135:../../../mod/flash/flash.c **** 
 190              		.loc 1 1135 1 view .LVU37
 191 0038 2046     		mov	r0, r4
 192 003a 03B0     		add	sp, sp, #12
 193              	.LCFI6:
 194              		.cfi_remember_state
 195              		.cfi_def_cfa_offset 12
 196              		@ sp needed
 197 003c 30BD     		pop	{r4, r5, pc}
 198              	.LVL15:
 199              	.L11:
 200              	.LCFI7:
 201              		.cfi_restore_state
1128:../../../mod/flash/flash.c ****     }
 202              		.loc 1 1128 9 view .LVU38
 203 003e 0824     		movs	r4, #8
 204              	.LVL16:
1128:../../../mod/flash/flash.c ****     }
 205              		.loc 1 1128 9 view .LVU39
 206 0040 FAE7     		b	.L9
 207              	.L13:
 208 0042 00BF     		.align	2
 209              	.L12:
 210 0044 00040258 		.word	1476527104
 211 0048 00000000 		.word	hspi2
 212              		.cfi_endproc
 213              	.LFE157:
 215              		.section	.text.flash_get_status,"ax",%progbits
 216              		.align	1
 217              		.global	flash_get_status
 218              		.syntax unified
 219              		.thumb
 220              		.thumb_func
 222              	flash_get_status:
 223              	.LVL17:
ARM GAS  /tmp/ccQ0EOEq.s 			page 26


 224              	.LFB146:
 402:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 225              		.loc 1 402 1 is_stmt 1 view -0
 226              		.cfi_startproc
 227              		@ args = 0, pretend = 0, frame = 8
 228              		@ frame_needed = 0, uses_anonymous_args = 0
 402:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 229              		.loc 1 402 1 is_stmt 0 view .LVU41
 230 0000 F0B5     		push	{r4, r5, r6, r7, lr}
 231              	.LCFI8:
 232              		.cfi_def_cfa_offset 20
 233              		.cfi_offset 4, -20
 234              		.cfi_offset 5, -16
 235              		.cfi_offset 6, -12
 236              		.cfi_offset 7, -8
 237              		.cfi_offset 14, -4
 238 0002 83B0     		sub	sp, sp, #12
 239              	.LCFI9:
 240              		.cfi_def_cfa_offset 32
 241 0004 0446     		mov	r4, r0
 406:../../../mod/flash/flash.c **** uint8_t           flash_opcode;   /* Data to be transmitted over SPI          */
 242              		.loc 1 406 1 is_stmt 1 view .LVU42
 407:../../../mod/flash/flash.c **** 
 243              		.loc 1 407 1 view .LVU43
 412:../../../mod/flash/flash.c **** 
 244              		.loc 1 412 1 view .LVU44
 412:../../../mod/flash/flash.c **** 
 245              		.loc 1 412 14 is_stmt 0 view .LVU45
 246 0006 0523     		movs	r3, #5
 247 0008 8DF80330 		strb	r3, [sp, #3]
 420:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 248              		.loc 1 420 1 is_stmt 1 view .LVU46
 249 000c 164E     		ldr	r6, .L19
 250 000e 0022     		movs	r2, #0
 251 0010 4FF48051 		mov	r1, #4096
 252 0014 3046     		mov	r0, r6
 253              	.LVL18:
 420:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 254              		.loc 1 420 1 is_stmt 0 view .LVU47
 255 0016 FFF7FEFF 		bl	HAL_GPIO_WritePin
 256              	.LVL19:
 425:../../../mod/flash/flash.c ****                                   &flash_opcode         ,
 257              		.loc 1 425 1 is_stmt 1 view .LVU48
 425:../../../mod/flash/flash.c ****                                   &flash_opcode         ,
 258              		.loc 1 425 17 is_stmt 0 view .LVU49
 259 001a 144F     		ldr	r7, .L19+4
 260 001c 4FF0FF33 		mov	r3, #-1
 261 0020 0122     		movs	r2, #1
 262 0022 0DF10301 		add	r1, sp, #3
 263 0026 3846     		mov	r0, r7
 264 0028 FFF7FEFF 		bl	HAL_SPI_Transmit
 265              	.LVL20:
 266 002c 0546     		mov	r5, r0
 425:../../../mod/flash/flash.c ****                                   &flash_opcode         ,
 267              		.loc 1 425 15 view .LVU50
 268 002e 8DF80400 		strb	r0, [sp, #4]
 431:../../../mod/flash/flash.c ****                                  &( pflash_handle      -> status_register ),
ARM GAS  /tmp/ccQ0EOEq.s 			page 27


 269              		.loc 1 431 1 is_stmt 1 view .LVU51
 431:../../../mod/flash/flash.c ****                                  &( pflash_handle      -> status_register ),
 270              		.loc 1 431 17 is_stmt 0 view .LVU52
 271 0032 4FF0FF33 		mov	r3, #-1
 272 0036 0122     		movs	r2, #1
 273 0038 04F10F01 		add	r1, r4, #15
 274 003c 3846     		mov	r0, r7
 275 003e FFF7FEFF 		bl	HAL_SPI_Receive
 276              	.LVL21:
 277 0042 0446     		mov	r4, r0
 278              	.LVL22:
 431:../../../mod/flash/flash.c ****                                  &( pflash_handle      -> status_register ),
 279              		.loc 1 431 15 view .LVU53
 280 0044 8DF80500 		strb	r0, [sp, #5]
 437:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 281              		.loc 1 437 1 is_stmt 1 view .LVU54
 282 0048 0122     		movs	r2, #1
 283 004a 4FF48051 		mov	r1, #4096
 284 004e 3046     		mov	r0, r6
 285 0050 FFF7FEFF 		bl	HAL_GPIO_WritePin
 286              	.LVL23:
 442:../../../mod/flash/flash.c **** 	{
 287              		.loc 1 442 1 view .LVU55
 442:../../../mod/flash/flash.c **** 	{
 288              		.loc 1 442 4 is_stmt 0 view .LVU56
 289 0054 2DB9     		cbnz	r5, .L16
 442:../../../mod/flash/flash.c **** 	{
 290              		.loc 1 442 30 discriminator 1 view .LVU57
 291 0056 14B9     		cbnz	r4, .L18
 292              	.L15:
 451:../../../mod/flash/flash.c **** 
 293              		.loc 1 451 1 view .LVU58
 294 0058 2046     		mov	r0, r4
 295 005a 03B0     		add	sp, sp, #12
 296              	.LCFI10:
 297              		.cfi_remember_state
 298              		.cfi_def_cfa_offset 20
 299              		@ sp needed
 300 005c F0BD     		pop	{r4, r5, r6, r7, pc}
 301              	.L18:
 302              	.LCFI11:
 303              		.cfi_restore_state
 444:../../../mod/flash/flash.c **** 	}
 304              		.loc 1 444 9 view .LVU59
 305 005e 0824     		movs	r4, #8
 306 0060 FAE7     		b	.L15
 307              	.L16:
 308 0062 0824     		movs	r4, #8
 309 0064 F8E7     		b	.L15
 310              	.L20:
 311 0066 00BF     		.align	2
 312              	.L19:
 313 0068 00040258 		.word	1476527104
 314 006c 00000000 		.word	hspi2
 315              		.cfi_endproc
 316              	.LFE146:
 318              		.section	.text.flash_set_status,"ax",%progbits
ARM GAS  /tmp/ccQ0EOEq.s 			page 28


 319              		.align	1
 320              		.global	flash_set_status
 321              		.syntax unified
 322              		.thumb
 323              		.thumb_func
 325              	flash_set_status:
 326              	.LVL24:
 327              	.LFB147:
 467:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 328              		.loc 1 467 1 is_stmt 1 view -0
 329              		.cfi_startproc
 330              		@ args = 0, pretend = 0, frame = 16
 331              		@ frame_needed = 0, uses_anonymous_args = 0
 467:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 332              		.loc 1 467 1 is_stmt 0 view .LVU61
 333 0000 F0B5     		push	{r4, r5, r6, r7, lr}
 334              	.LCFI12:
 335              		.cfi_def_cfa_offset 20
 336              		.cfi_offset 4, -20
 337              		.cfi_offset 5, -16
 338              		.cfi_offset 6, -12
 339              		.cfi_offset 7, -8
 340              		.cfi_offset 14, -4
 341 0002 85B0     		sub	sp, sp, #20
 342              	.LCFI13:
 343              		.cfi_def_cfa_offset 40
 344 0004 8DF80700 		strb	r0, [sp, #7]
 471:../../../mod/flash/flash.c **** uint8_t flash_opcodes[2];   /* Flash instruction cycle bytes                  */
 345              		.loc 1 471 1 is_stmt 1 view .LVU62
 472:../../../mod/flash/flash.c **** 
 346              		.loc 1 472 1 view .LVU63
 478:../../../mod/flash/flash.c **** flash_opcodes[1] = FLASH_OP_HW_WRSR;
 347              		.loc 1 478 1 view .LVU64
 478:../../../mod/flash/flash.c **** flash_opcodes[1] = FLASH_OP_HW_WRSR;
 348              		.loc 1 478 18 is_stmt 0 view .LVU65
 349 0008 5023     		movs	r3, #80
 350 000a 8DF80830 		strb	r3, [sp, #8]
 479:../../../mod/flash/flash.c **** 
 351              		.loc 1 479 1 is_stmt 1 view .LVU66
 479:../../../mod/flash/flash.c **** 
 352              		.loc 1 479 18 is_stmt 0 view .LVU67
 353 000e 0123     		movs	r3, #1
 354 0010 8DF80930 		strb	r3, [sp, #9]
 485:../../../mod/flash/flash.c **** 	{
 355              		.loc 1 485 1 is_stmt 1 view .LVU68
 485:../../../mod/flash/flash.c **** 	{
 356              		.loc 1 485 6 is_stmt 0 view .LVU69
 357 0014 254B     		ldr	r3, .L27
 358 0016 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 485:../../../mod/flash/flash.c **** 	{
 359              		.loc 1 485 4 view .LVU70
 360 0018 002B     		cmp	r3, #0
 361 001a 3ED0     		beq	.L23
 496:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 362              		.loc 1 496 1 is_stmt 1 view .LVU71
 363 001c 244E     		ldr	r6, .L27+4
 364 001e 0022     		movs	r2, #0
ARM GAS  /tmp/ccQ0EOEq.s 			page 29


 365 0020 4FF48051 		mov	r1, #4096
 366 0024 3046     		mov	r0, r6
 367              	.LVL25:
 496:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 368              		.loc 1 496 1 is_stmt 0 view .LVU72
 369 0026 FFF7FEFF 		bl	HAL_GPIO_WritePin
 370              	.LVL26:
 499:../../../mod/flash/flash.c ****                                   &flash_opcodes[0],
 371              		.loc 1 499 1 is_stmt 1 view .LVU73
 499:../../../mod/flash/flash.c ****                                   &flash_opcodes[0],
 372              		.loc 1 499 17 is_stmt 0 view .LVU74
 373 002a 224C     		ldr	r4, .L27+8
 374 002c 4FF0FF33 		mov	r3, #-1
 375 0030 0122     		movs	r2, #1
 376 0032 02A9     		add	r1, sp, #8
 377 0034 2046     		mov	r0, r4
 378 0036 FFF7FEFF 		bl	HAL_SPI_Transmit
 379              	.LVL27:
 380 003a 0546     		mov	r5, r0
 499:../../../mod/flash/flash.c ****                                   &flash_opcodes[0],
 381              		.loc 1 499 15 view .LVU75
 382 003c 8DF80C00 		strb	r0, [sp, #12]
 503:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 383              		.loc 1 503 1 is_stmt 1 view .LVU76
 384 0040 0122     		movs	r2, #1
 385 0042 4FF48051 		mov	r1, #4096
 386 0046 3046     		mov	r0, r6
 387 0048 FFF7FEFF 		bl	HAL_GPIO_WritePin
 388              	.LVL28:
 508:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 389              		.loc 1 508 1 view .LVU77
 390 004c 0022     		movs	r2, #0
 391 004e 4FF48051 		mov	r1, #4096
 392 0052 3046     		mov	r0, r6
 393 0054 FFF7FEFF 		bl	HAL_GPIO_WritePin
 394              	.LVL29:
 511:../../../mod/flash/flash.c ****                                   &flash_opcodes[1],
 395              		.loc 1 511 1 view .LVU78
 511:../../../mod/flash/flash.c ****                                   &flash_opcodes[1],
 396              		.loc 1 511 17 is_stmt 0 view .LVU79
 397 0058 4FF0FF33 		mov	r3, #-1
 398 005c 0122     		movs	r2, #1
 399 005e 0DF10901 		add	r1, sp, #9
 400 0062 2046     		mov	r0, r4
 401 0064 FFF7FEFF 		bl	HAL_SPI_Transmit
 402              	.LVL30:
 403 0068 0746     		mov	r7, r0
 511:../../../mod/flash/flash.c ****                                   &flash_opcodes[1],
 404              		.loc 1 511 15 view .LVU80
 405 006a 8DF80D00 		strb	r0, [sp, #13]
 515:../../../mod/flash/flash.c ****                                   &flash_status         ,
 406              		.loc 1 515 1 is_stmt 1 view .LVU81
 515:../../../mod/flash/flash.c ****                                   &flash_status         ,
 407              		.loc 1 515 17 is_stmt 0 view .LVU82
 408 006e 4FF0FF33 		mov	r3, #-1
 409 0072 0122     		movs	r2, #1
 410 0074 0DF10701 		add	r1, sp, #7
ARM GAS  /tmp/ccQ0EOEq.s 			page 30


 411 0078 2046     		mov	r0, r4
 412 007a FFF7FEFF 		bl	HAL_SPI_Transmit
 413              	.LVL31:
 414 007e 0446     		mov	r4, r0
 515:../../../mod/flash/flash.c ****                                   &flash_status         ,
 415              		.loc 1 515 15 view .LVU83
 416 0080 8DF80E00 		strb	r0, [sp, #14]
 519:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 417              		.loc 1 519 1 is_stmt 1 view .LVU84
 418 0084 0122     		movs	r2, #1
 419 0086 4FF48051 		mov	r1, #4096
 420 008a 3046     		mov	r0, r6
 421 008c FFF7FEFF 		bl	HAL_GPIO_WritePin
 422              	.LVL32:
 524:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 423              		.loc 1 524 1 view .LVU85
 524:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 424              		.loc 1 524 4 is_stmt 0 view .LVU86
 425 0090 3DB9     		cbnz	r5, .L24
 524:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 426              		.loc 1 524 30 discriminator 1 view .LVU87
 427 0092 47B9     		cbnz	r7, .L25
 525:../../../mod/flash/flash.c **** 	 hal_status[2] != HAL_OK )
 428              		.loc 1 525 30 view .LVU88
 429 0094 14B1     		cbz	r4, .L22
 528:../../../mod/flash/flash.c **** 	}
 430              		.loc 1 528 9 view .LVU89
 431 0096 0824     		movs	r4, #8
 432 0098 00E0     		b	.L22
 433              	.LVL33:
 434              	.L23:
 487:../../../mod/flash/flash.c **** 	}
 435              		.loc 1 487 9 view .LVU90
 436 009a 0524     		movs	r4, #5
 437              	.LVL34:
 438              	.L22:
 535:../../../mod/flash/flash.c **** 
 439              		.loc 1 535 1 view .LVU91
 440 009c 2046     		mov	r0, r4
 441 009e 05B0     		add	sp, sp, #20
 442              	.LCFI14:
 443              		.cfi_remember_state
 444              		.cfi_def_cfa_offset 20
 445              		@ sp needed
 446 00a0 F0BD     		pop	{r4, r5, r6, r7, pc}
 447              	.L24:
 448              	.LCFI15:
 449              		.cfi_restore_state
 528:../../../mod/flash/flash.c **** 	}
 450              		.loc 1 528 9 view .LVU92
 451 00a2 0824     		movs	r4, #8
 452 00a4 FAE7     		b	.L22
 453              	.L25:
 454 00a6 0824     		movs	r4, #8
 455 00a8 F8E7     		b	.L22
 456              	.L28:
 457 00aa 00BF     		.align	2
ARM GAS  /tmp/ccQ0EOEq.s 			page 31


 458              	.L27:
 459 00ac 00000000 		.word	write_enabled
 460 00b0 00040258 		.word	1476527104
 461 00b4 00000000 		.word	hspi2
 462              		.cfi_endproc
 463              	.LFE147:
 465              		.section	.text.flash_is_flash_busy,"ax",%progbits
 466              		.align	1
 467              		.global	flash_is_flash_busy
 468              		.syntax unified
 469              		.thumb
 470              		.thumb_func
 472              	flash_is_flash_busy:
 473              	.LFB148:
 552:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 474              		.loc 1 552 1 is_stmt 1 view -0
 475              		.cfi_startproc
 476              		@ args = 0, pretend = 0, frame = 16
 477              		@ frame_needed = 0, uses_anonymous_args = 0
 478 0000 00B5     		push	{lr}
 479              	.LCFI16:
 480              		.cfi_def_cfa_offset 4
 481              		.cfi_offset 14, -4
 482 0002 85B0     		sub	sp, sp, #20
 483              	.LCFI17:
 484              		.cfi_def_cfa_offset 24
 556:../../../mod/flash/flash.c **** FLASH_STATUS  flash_status; /* Flash API return codes                         */
 485              		.loc 1 556 1 view .LVU94
 557:../../../mod/flash/flash.c **** 
 486              		.loc 1 557 1 view .LVU95
 563:../../../mod/flash/flash.c **** flash_handle.status_register = 0xFF;
 487              		.loc 1 563 1 view .LVU96
 488              	.LVL35:
 564:../../../mod/flash/flash.c **** 
 489              		.loc 1 564 1 view .LVU97
 564:../../../mod/flash/flash.c **** 
 490              		.loc 1 564 30 is_stmt 0 view .LVU98
 491 0004 FF23     		movs	r3, #255
 492 0006 8DF80F30 		strb	r3, [sp, #15]
 572:../../../mod/flash/flash.c **** if      ( flash_status != FLASH_OK                          )
 493              		.loc 1 572 1 is_stmt 1 view .LVU99
 572:../../../mod/flash/flash.c **** if      ( flash_status != FLASH_OK                          )
 494              		.loc 1 572 16 is_stmt 0 view .LVU100
 495 000a 6846     		mov	r0, sp
 496 000c FFF7FEFF 		bl	flash_get_status
 497              	.LVL36:
 573:../../../mod/flash/flash.c **** 	{
 498              		.loc 1 573 1 is_stmt 1 view .LVU101
 573:../../../mod/flash/flash.c **** 	{
 499              		.loc 1 573 9 is_stmt 0 view .LVU102
 500 0010 30B9     		cbnz	r0, .L31
 577:../../../mod/flash/flash.c **** 	{
 501              		.loc 1 577 6 is_stmt 1 view .LVU103
 577:../../../mod/flash/flash.c **** 	{
 502              		.loc 1 577 23 is_stmt 0 view .LVU104
 503 0012 9DF80F30 		ldrb	r3, [sp, #15]	@ zero_extendqisi2
 577:../../../mod/flash/flash.c **** 	{
ARM GAS  /tmp/ccQ0EOEq.s 			page 32


 504              		.loc 1 577 9 view .LVU105
 505 0016 13F0010F 		tst	r3, #1
 506 001a 05D0     		beq	.L32
 579:../../../mod/flash/flash.c **** 	}
 507              		.loc 1 579 9 view .LVU106
 508 001c 0120     		movs	r0, #1
 509              	.LVL37:
 579:../../../mod/flash/flash.c **** 	}
 510              		.loc 1 579 9 view .LVU107
 511 001e 00E0     		b	.L30
 512              	.LVL38:
 513              	.L31:
 575:../../../mod/flash/flash.c **** 	}
 514              		.loc 1 575 9 view .LVU108
 515 0020 0120     		movs	r0, #1
 516              	.LVL39:
 517              	.L30:
 586:../../../mod/flash/flash.c **** 
 518              		.loc 1 586 1 view .LVU109
 519 0022 05B0     		add	sp, sp, #20
 520              	.LCFI18:
 521              		.cfi_remember_state
 522              		.cfi_def_cfa_offset 4
 523              		@ sp needed
 524 0024 5DF804FB 		ldr	pc, [sp], #4
 525              	.LVL40:
 526              	.L32:
 527              	.LCFI19:
 528              		.cfi_restore_state
 583:../../../mod/flash/flash.c **** 	}
 529              		.loc 1 583 9 view .LVU110
 530 0028 0020     		movs	r0, #0
 531              	.LVL41:
 583:../../../mod/flash/flash.c **** 	}
 532              		.loc 1 583 9 view .LVU111
 533 002a FAE7     		b	.L30
 534              		.cfi_endproc
 535              	.LFE148:
 537              		.section	.text.flash_write_enable,"ax",%progbits
 538              		.align	1
 539              		.global	flash_write_enable
 540              		.syntax unified
 541              		.thumb
 542              		.thumb_func
 544              	flash_write_enable:
 545              	.LFB149:
 603:../../../mod/flash/flash.c **** write_enabled = true;
 546              		.loc 1 603 1 is_stmt 1 view -0
 547              		.cfi_startproc
 548              		@ args = 0, pretend = 0, frame = 0
 549              		@ frame_needed = 0, uses_anonymous_args = 0
 550              		@ link register save eliminated.
 604:../../../mod/flash/flash.c **** } /* flash_write_enable */
 551              		.loc 1 604 1 view .LVU113
 604:../../../mod/flash/flash.c **** } /* flash_write_enable */
 552              		.loc 1 604 15 is_stmt 0 view .LVU114
 553 0000 014B     		ldr	r3, .L35
ARM GAS  /tmp/ccQ0EOEq.s 			page 33


 554 0002 0122     		movs	r2, #1
 555 0004 1A70     		strb	r2, [r3]
 605:../../../mod/flash/flash.c **** 
 556              		.loc 1 605 1 view .LVU115
 557 0006 7047     		bx	lr
 558              	.L36:
 559              		.align	2
 560              	.L35:
 561 0008 00000000 		.word	write_enabled
 562              		.cfi_endproc
 563              	.LFE149:
 565              		.section	.text.flash_write_disable,"ax",%progbits
 566              		.align	1
 567              		.global	flash_write_disable
 568              		.syntax unified
 569              		.thumb
 570              		.thumb_func
 572              	flash_write_disable:
 573              	.LFB150:
 621:../../../mod/flash/flash.c **** write_enabled = false;
 574              		.loc 1 621 1 is_stmt 1 view -0
 575              		.cfi_startproc
 576              		@ args = 0, pretend = 0, frame = 0
 577              		@ frame_needed = 0, uses_anonymous_args = 0
 578              		@ link register save eliminated.
 622:../../../mod/flash/flash.c **** } /* flash_write_disable */
 579              		.loc 1 622 1 view .LVU117
 622:../../../mod/flash/flash.c **** } /* flash_write_disable */
 580              		.loc 1 622 15 is_stmt 0 view .LVU118
 581 0000 014B     		ldr	r3, .L38
 582 0002 0022     		movs	r2, #0
 583 0004 1A70     		strb	r2, [r3]
 623:../../../mod/flash/flash.c **** 
 584              		.loc 1 623 1 view .LVU119
 585 0006 7047     		bx	lr
 586              	.L39:
 587              		.align	2
 588              	.L38:
 589 0008 00000000 		.word	write_enabled
 590              		.cfi_endproc
 591              	.LFE150:
 593              		.section	.text.flash_init,"ax",%progbits
 594              		.align	1
 595              		.global	flash_init
 596              		.syntax unified
 597              		.thumb
 598              		.thumb_func
 600              	flash_init:
 601              	.LVL42:
 602              	.LFB145:
 309:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 603              		.loc 1 309 1 is_stmt 1 view -0
 604              		.cfi_startproc
 605              		@ args = 0, pretend = 0, frame = 0
 606              		@ frame_needed = 0, uses_anonymous_args = 0
 309:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 607              		.loc 1 309 1 is_stmt 0 view .LVU121
ARM GAS  /tmp/ccQ0EOEq.s 			page 34


 608 0000 38B5     		push	{r3, r4, r5, lr}
 609              	.LCFI20:
 610              		.cfi_def_cfa_offset 16
 611              		.cfi_offset 3, -16
 612              		.cfi_offset 4, -12
 613              		.cfi_offset 5, -8
 614              		.cfi_offset 14, -4
 615 0002 0446     		mov	r4, r0
 313:../../../mod/flash/flash.c **** uint8_t      status_register; /* Desired status register contents       */
 616              		.loc 1 313 1 is_stmt 1 view .LVU122
 314:../../../mod/flash/flash.c **** 
 617              		.loc 1 314 1 view .LVU123
 320:../../../mod/flash/flash.c **** status_register = FLASH_REG_RESET_VAL;
 618              		.loc 1 320 1 view .LVU124
 619              	.LVL43:
 321:../../../mod/flash/flash.c **** 
 620              		.loc 1 321 1 view .LVU125
 329:../../../mod/flash/flash.c **** 	{
 621              		.loc 1 329 1 view .LVU126
 329:../../../mod/flash/flash.c **** 	{
 622              		.loc 1 329 20 is_stmt 0 view .LVU127
 623 0004 407B     		ldrb	r0, [r0, #13]	@ zero_extendqisi2
 624              	.LVL44:
 329:../../../mod/flash/flash.c **** 	{
 625              		.loc 1 329 4 view .LVU128
 626 0006 DC28     		cmp	r0, #220
 627 0008 25D8     		bhi	.L44
 335:../../../mod/flash/flash.c **** status_register |= pflash_handle -> bpl_write_protect;
 628              		.loc 1 335 1 is_stmt 1 view .LVU129
 335:../../../mod/flash/flash.c **** status_register |= pflash_handle -> bpl_write_protect;
 629              		.loc 1 335 17 is_stmt 0 view .LVU130
 630 000a 00F03800 		and	r0, r0, #56
 631              	.LVL45:
 336:../../../mod/flash/flash.c **** 
 632              		.loc 1 336 1 is_stmt 1 view .LVU131
 336:../../../mod/flash/flash.c **** 
 633              		.loc 1 336 34 is_stmt 0 view .LVU132
 634 000e A37B     		ldrb	r3, [r4, #14]	@ zero_extendqisi2
 336:../../../mod/flash/flash.c **** 
 635              		.loc 1 336 17 view .LVU133
 636 0010 43EA0005 		orr	r5, r3, r0
 637              	.LVL46:
 344:../../../mod/flash/flash.c **** 	{
 638              		.loc 1 344 1 is_stmt 1 view .LVU134
 344:../../../mod/flash/flash.c **** 	{
 639              		.loc 1 344 20 is_stmt 0 view .LVU135
 640 0014 237B     		ldrb	r3, [r4, #12]	@ zero_extendqisi2
 344:../../../mod/flash/flash.c **** 	{
 641              		.loc 1 344 4 view .LVU136
 642 0016 D3B9     		cbnz	r3, .L48
 351:../../../mod/flash/flash.c **** 	}
 643              		.loc 1 351 2 is_stmt 1 view .LVU137
 644 0018 FFF7FEFF 		bl	flash_write_enable
 645              	.LVL47:
 355:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 646              		.loc 1 355 1 view .LVU138
 355:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
ARM GAS  /tmp/ccQ0EOEq.s 			page 35


 647              		.loc 1 355 16 is_stmt 0 view .LVU139
 648 001c 2046     		mov	r0, r4
 649 001e FFF7FEFF 		bl	flash_get_status
 650              	.LVL48:
 356:../../../mod/flash/flash.c **** 	{
 651              		.loc 1 356 1 is_stmt 1 view .LVU140
 356:../../../mod/flash/flash.c **** 	{
 652              		.loc 1 356 4 is_stmt 0 view .LVU141
 653 0022 B8B9     		cbnz	r0, .L41
 360:../../../mod/flash/flash.c **** 	{
 654              		.loc 1 360 6 is_stmt 1 view .LVU142
 360:../../../mod/flash/flash.c **** 	{
 655              		.loc 1 360 25 is_stmt 0 view .LVU143
 656 0024 E37B     		ldrb	r3, [r4, #15]	@ zero_extendqisi2
 360:../../../mod/flash/flash.c **** 	{
 657              		.loc 1 360 9 view .LVU144
 658 0026 FF2B     		cmp	r3, #255
 659 0028 17D0     		beq	.L45
 366:../../../mod/flash/flash.c **** 	{
 660              		.loc 1 366 1 is_stmt 1 view .LVU145
 366:../../../mod/flash/flash.c **** 	{
 661              		.loc 1 366 6 is_stmt 0 view .LVU146
 662 002a FFF7FEFF 		bl	write_disable
 663              	.LVL49:
 366:../../../mod/flash/flash.c **** 	{
 664              		.loc 1 366 4 view .LVU147
 665 002e B0B9     		cbnz	r0, .L46
 372:../../../mod/flash/flash.c **** 
 666              		.loc 1 372 1 is_stmt 1 view .LVU148
 372:../../../mod/flash/flash.c **** 
 667              		.loc 1 372 16 is_stmt 0 view .LVU149
 668 0030 2846     		mov	r0, r5
 669 0032 FFF7FEFF 		bl	flash_set_status
 670              	.LVL50:
 375:../../../mod/flash/flash.c **** flash_status = flash_get_status( pflash_handle );
 671              		.loc 1 375 1 is_stmt 1 view .LVU150
 672              	.L43:
 375:../../../mod/flash/flash.c **** flash_status = flash_get_status( pflash_handle );
 673              		.loc 1 375 46 discriminator 1 view .LVU151
 375:../../../mod/flash/flash.c **** flash_status = flash_get_status( pflash_handle );
 674              		.loc 1 375 30 discriminator 1 view .LVU152
 375:../../../mod/flash/flash.c **** flash_status = flash_get_status( pflash_handle );
 675              		.loc 1 375 8 is_stmt 0 discriminator 1 view .LVU153
 676 0036 FFF7FEFF 		bl	flash_is_flash_busy
 677              	.LVL51:
 375:../../../mod/flash/flash.c **** flash_status = flash_get_status( pflash_handle );
 678              		.loc 1 375 30 discriminator 1 view .LVU154
 679 003a 0028     		cmp	r0, #0
 680 003c FBD1     		bne	.L43
 376:../../../mod/flash/flash.c **** if ( pflash_handle -> status_register != status_register )
 681              		.loc 1 376 1 is_stmt 1 view .LVU155
 376:../../../mod/flash/flash.c **** if ( pflash_handle -> status_register != status_register )
 682              		.loc 1 376 16 is_stmt 0 view .LVU156
 683 003e 2046     		mov	r0, r4
 684 0040 FFF7FEFF 		bl	flash_get_status
 685              	.LVL52:
 377:../../../mod/flash/flash.c **** 	{
ARM GAS  /tmp/ccQ0EOEq.s 			page 36


 686              		.loc 1 377 1 is_stmt 1 view .LVU157
 377:../../../mod/flash/flash.c **** 	{
 687              		.loc 1 377 20 is_stmt 0 view .LVU158
 688 0044 E37B     		ldrb	r3, [r4, #15]	@ zero_extendqisi2
 377:../../../mod/flash/flash.c **** 	{
 689              		.loc 1 377 4 view .LVU159
 690 0046 AB42     		cmp	r3, r5
 691 0048 04D0     		beq	.L41
 379:../../../mod/flash/flash.c **** 	}
 692              		.loc 1 379 9 view .LVU160
 693 004a 0F20     		movs	r0, #15
 694              	.LVL53:
 379:../../../mod/flash/flash.c **** 	}
 695              		.loc 1 379 9 view .LVU161
 696 004c 02E0     		b	.L41
 697              	.LVL54:
 698              	.L48:
 346:../../../mod/flash/flash.c **** 	return FLASH_OK;
 699              		.loc 1 346 2 is_stmt 1 view .LVU162
 700 004e FFF7FEFF 		bl	flash_write_disable
 701              	.LVL55:
 347:../../../mod/flash/flash.c **** 	}
 702              		.loc 1 347 2 view .LVU163
 347:../../../mod/flash/flash.c **** 	}
 703              		.loc 1 347 9 is_stmt 0 view .LVU164
 704 0052 0020     		movs	r0, #0
 705              	.LVL56:
 706              	.L41:
 386:../../../mod/flash/flash.c **** 
 707              		.loc 1 386 1 view .LVU165
 708 0054 38BD     		pop	{r3, r4, r5, pc}
 709              	.LVL57:
 710              	.L44:
 331:../../../mod/flash/flash.c **** 	}
 711              		.loc 1 331 9 view .LVU166
 712 0056 0A20     		movs	r0, #10
 713 0058 FCE7     		b	.L41
 714              	.LVL58:
 715              	.L45:
 362:../../../mod/flash/flash.c **** 	}
 716              		.loc 1 362 9 view .LVU167
 717 005a 0F20     		movs	r0, #15
 718              	.LVL59:
 362:../../../mod/flash/flash.c **** 	}
 719              		.loc 1 362 9 view .LVU168
 720 005c FAE7     		b	.L41
 721              	.L46:
 368:../../../mod/flash/flash.c **** 	}
 722              		.loc 1 368 9 view .LVU169
 723 005e 0E20     		movs	r0, #14
 724 0060 F8E7     		b	.L41
 725              		.cfi_endproc
 726              	.LFE145:
 728              		.section	.text.flash_write_byte,"ax",%progbits
 729              		.align	1
 730              		.global	flash_write_byte
 731              		.syntax unified
ARM GAS  /tmp/ccQ0EOEq.s 			page 37


 732              		.thumb
 733              		.thumb_func
 735              	flash_write_byte:
 736              	.LVL60:
 737              	.LFB151:
 640:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 738              		.loc 1 640 1 is_stmt 1 view -0
 739              		.cfi_startproc
 740              		@ args = 0, pretend = 0, frame = 16
 741              		@ frame_needed = 0, uses_anonymous_args = 0
 640:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 742              		.loc 1 640 1 is_stmt 0 view .LVU171
 743 0000 F0B5     		push	{r4, r5, r6, r7, lr}
 744              	.LCFI21:
 745              		.cfi_def_cfa_offset 20
 746              		.cfi_offset 4, -20
 747              		.cfi_offset 5, -16
 748              		.cfi_offset 6, -12
 749              		.cfi_offset 7, -8
 750              		.cfi_offset 14, -4
 751 0002 85B0     		sub	sp, sp, #20
 752              	.LCFI22:
 753              		.cfi_def_cfa_offset 40
 754 0004 8DF80710 		strb	r1, [sp, #7]
 644:../../../mod/flash/flash.c **** FLASH_STATUS      flash_status;     /* Status code returned by flash API      */
 755              		.loc 1 644 1 is_stmt 1 view .LVU172
 645:../../../mod/flash/flash.c **** uint8_t           flash_opcode;     /* Data to be transmitted over SPI        */
 756              		.loc 1 645 1 view .LVU173
 646:../../../mod/flash/flash.c **** uint8_t           address[3];       /* Flash memory address in byte form      */
 757              		.loc 1 646 1 view .LVU174
 647:../../../mod/flash/flash.c **** 
 758              		.loc 1 647 1 view .LVU175
 653:../../../mod/flash/flash.c **** flash_opcode  = FLASH_OP_HW_BYTE_PROGRAM;
 759              		.loc 1 653 1 view .LVU176
 760              	.LVL61:
 654:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 761              		.loc 1 654 1 view .LVU177
 654:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 762              		.loc 1 654 15 is_stmt 0 view .LVU178
 763 0008 0223     		movs	r3, #2
 764 000a 8DF80B30 		strb	r3, [sp, #11]
 655:../../../mod/flash/flash.c **** 
 765              		.loc 1 655 1 is_stmt 1 view .LVU179
 766 000e 02A9     		add	r1, sp, #8
 767              	.LVL62:
 655:../../../mod/flash/flash.c **** 
 768              		.loc 1 655 1 is_stmt 0 view .LVU180
 769 0010 4068     		ldr	r0, [r0, #4]
 770              	.LVL63:
 655:../../../mod/flash/flash.c **** 
 771              		.loc 1 655 1 view .LVU181
 772 0012 FFF7FEFF 		bl	address_to_bytes
 773              	.LVL64:
 663:../../../mod/flash/flash.c **** 	{
 774              		.loc 1 663 1 is_stmt 1 view .LVU182
 663:../../../mod/flash/flash.c **** 	{
 775              		.loc 1 663 5 is_stmt 0 view .LVU183
ARM GAS  /tmp/ccQ0EOEq.s 			page 38


 776 0016 214B     		ldr	r3, .L56
 777 0018 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 663:../../../mod/flash/flash.c **** 	{
 778              		.loc 1 663 3 view .LVU184
 779 001a ABB3     		cbz	r3, .L51
 673:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 780              		.loc 1 673 1 is_stmt 1 view .LVU185
 673:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 781              		.loc 1 673 16 is_stmt 0 view .LVU186
 782 001c FFF7FEFF 		bl	write_enable
 783              	.LVL65:
 674:../../../mod/flash/flash.c **** 	{
 784              		.loc 1 674 1 is_stmt 1 view .LVU187
 674:../../../mod/flash/flash.c **** 	{
 785              		.loc 1 674 4 is_stmt 0 view .LVU188
 786 0020 B0BB     		cbnz	r0, .L52
 680:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )       ,
 787              		.loc 1 680 1 is_stmt 1 view .LVU189
 788 0022 1F4F     		ldr	r7, .L56+4
 789 0024 0022     		movs	r2, #0
 790 0026 4FF48051 		mov	r1, #4096
 791 002a 3846     		mov	r0, r7
 792              	.LVL66:
 680:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )       ,
 793              		.loc 1 680 1 is_stmt 0 view .LVU190
 794 002c FFF7FEFF 		bl	HAL_GPIO_WritePin
 795              	.LVL67:
 681:../../../mod/flash/flash.c **** 							      &flash_opcode        ,
 796              		.loc 1 681 1 is_stmt 1 view .LVU191
 681:../../../mod/flash/flash.c **** 							      &flash_opcode        ,
 797              		.loc 1 681 17 is_stmt 0 view .LVU192
 798 0030 1C4C     		ldr	r4, .L56+8
 799 0032 4FF0FF33 		mov	r3, #-1
 800 0036 0122     		movs	r2, #1
 801 0038 0DF10B01 		add	r1, sp, #11
 802 003c 2046     		mov	r0, r4
 803 003e FFF7FEFF 		bl	HAL_SPI_Transmit
 804              	.LVL68:
 805 0042 0546     		mov	r5, r0
 681:../../../mod/flash/flash.c **** 							      &flash_opcode        ,
 806              		.loc 1 681 15 view .LVU193
 807 0044 8DF80C00 		strb	r0, [sp, #12]
 687:../../../mod/flash/flash.c **** 							      &address[0]      ,
 808              		.loc 1 687 1 is_stmt 1 view .LVU194
 687:../../../mod/flash/flash.c **** 							      &address[0]      ,
 809              		.loc 1 687 17 is_stmt 0 view .LVU195
 810 0048 4FF0FF33 		mov	r3, #-1
 811 004c 0322     		movs	r2, #3
 812 004e 02A9     		add	r1, sp, #8
 813 0050 2046     		mov	r0, r4
 814 0052 FFF7FEFF 		bl	HAL_SPI_Transmit
 815              	.LVL69:
 816 0056 0646     		mov	r6, r0
 687:../../../mod/flash/flash.c **** 							      &address[0]      ,
 817              		.loc 1 687 15 view .LVU196
 818 0058 8DF80D00 		strb	r0, [sp, #13]
 693:../../../mod/flash/flash.c **** 							     &byte          ,
ARM GAS  /tmp/ccQ0EOEq.s 			page 39


 819              		.loc 1 693 1 is_stmt 1 view .LVU197
 693:../../../mod/flash/flash.c **** 							     &byte          ,
 820              		.loc 1 693 17 is_stmt 0 view .LVU198
 821 005c 4FF0FF33 		mov	r3, #-1
 822 0060 0122     		movs	r2, #1
 823 0062 0DF10701 		add	r1, sp, #7
 824 0066 2046     		mov	r0, r4
 825 0068 FFF7FEFF 		bl	HAL_SPI_Transmit
 826              	.LVL70:
 827 006c 0446     		mov	r4, r0
 693:../../../mod/flash/flash.c **** 							     &byte          ,
 828              		.loc 1 693 15 view .LVU199
 829 006e 8DF80E00 		strb	r0, [sp, #14]
 697:../../../mod/flash/flash.c **** 
 830              		.loc 1 697 1 is_stmt 1 view .LVU200
 831 0072 0122     		movs	r2, #1
 832 0074 4FF48051 		mov	r1, #4096
 833 0078 3846     		mov	r0, r7
 834 007a FFF7FEFF 		bl	HAL_GPIO_WritePin
 835              	.LVL71:
 700:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 836              		.loc 1 700 1 view .LVU201
 700:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 837              		.loc 1 700 4 is_stmt 0 view .LVU202
 838 007e 4DB9     		cbnz	r5, .L53
 700:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 839              		.loc 1 700 30 discriminator 1 view .LVU203
 840 0080 56B9     		cbnz	r6, .L54
 701:../../../mod/flash/flash.c **** 	 hal_status[2] != HAL_OK )
 841              		.loc 1 701 30 view .LVU204
 842 0082 14B1     		cbz	r4, .L50
 704:../../../mod/flash/flash.c **** 	}
 843              		.loc 1 704 9 view .LVU205
 844 0084 0824     		movs	r4, #8
 845 0086 00E0     		b	.L50
 846              	.LVL72:
 847              	.L51:
 665:../../../mod/flash/flash.c **** 	}
 848              		.loc 1 665 9 view .LVU206
 849 0088 0524     		movs	r4, #5
 850              	.LVL73:
 851              	.L50:
 711:../../../mod/flash/flash.c **** 
 852              		.loc 1 711 1 view .LVU207
 853 008a 2046     		mov	r0, r4
 854 008c 05B0     		add	sp, sp, #20
 855              	.LCFI23:
 856              		.cfi_remember_state
 857              		.cfi_def_cfa_offset 20
 858              		@ sp needed
 859 008e F0BD     		pop	{r4, r5, r6, r7, pc}
 860              	.LVL74:
 861              	.L52:
 862              	.LCFI24:
 863              		.cfi_restore_state
 676:../../../mod/flash/flash.c **** 	}
 864              		.loc 1 676 9 view .LVU208
ARM GAS  /tmp/ccQ0EOEq.s 			page 40


 865 0090 0924     		movs	r4, #9
 866 0092 FAE7     		b	.L50
 867              	.LVL75:
 868              	.L53:
 704:../../../mod/flash/flash.c **** 	}
 869              		.loc 1 704 9 view .LVU209
 870 0094 0824     		movs	r4, #8
 871 0096 F8E7     		b	.L50
 872              	.L54:
 873 0098 0824     		movs	r4, #8
 874 009a F6E7     		b	.L50
 875              	.L57:
 876              		.align	2
 877              	.L56:
 878 009c 00000000 		.word	write_enabled
 879 00a0 00040258 		.word	1476527104
 880 00a4 00000000 		.word	hspi2
 881              		.cfi_endproc
 882              	.LFE151:
 884              		.section	.text.flash_write,"ax",%progbits
 885              		.align	1
 886              		.global	flash_write
 887              		.syntax unified
 888              		.thumb
 889              		.thumb_func
 891              	flash_write:
 892              	.LVL76:
 893              	.LFB152:
 727:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 894              		.loc 1 727 1 is_stmt 1 view -0
 895              		.cfi_startproc
 896              		@ args = 0, pretend = 0, frame = 8
 897              		@ frame_needed = 0, uses_anonymous_args = 0
 727:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 898              		.loc 1 727 1 is_stmt 0 view .LVU211
 899 0000 2DE9F047 		push	{r4, r5, r6, r7, r8, r9, r10, lr}
 900              	.LCFI25:
 901              		.cfi_def_cfa_offset 32
 902              		.cfi_offset 4, -32
 903              		.cfi_offset 5, -28
 904              		.cfi_offset 6, -24
 905              		.cfi_offset 7, -20
 906              		.cfi_offset 8, -16
 907              		.cfi_offset 9, -12
 908              		.cfi_offset 10, -8
 909              		.cfi_offset 14, -4
 910 0004 82B0     		sub	sp, sp, #8
 911              	.LCFI26:
 912              		.cfi_def_cfa_offset 40
 913 0006 0546     		mov	r5, r0
 731:../../../mod/flash/flash.c **** FLASH_STATUS      flash_status;     /* Status codes returned by flash API     */
 914              		.loc 1 731 1 is_stmt 1 view .LVU212
 732:../../../mod/flash/flash.c **** uint8_t           flash_opcode;     /* Opcode for flash instructions          */
 915              		.loc 1 732 1 view .LVU213
 733:../../../mod/flash/flash.c **** uint32_t          timeout;          /* Timeout for flash write calls          */
 916              		.loc 1 733 1 view .LVU214
 734:../../../mod/flash/flash.c **** uint32_t          timeout_ctr;      /* Counter to trigger timeout             */
ARM GAS  /tmp/ccQ0EOEq.s 			page 41


 917              		.loc 1 734 1 view .LVU215
 735:../../../mod/flash/flash.c **** uint8_t*          pbuffer;          /* Pointer to data in flash buffer        */
 918              		.loc 1 735 1 view .LVU216
 736:../../../mod/flash/flash.c **** uint8_t           address_bytes[3]; /* Flash memory address in byte form      */
 919              		.loc 1 736 1 view .LVU217
 737:../../../mod/flash/flash.c **** 
 920              		.loc 1 737 1 view .LVU218
 743:../../../mod/flash/flash.c **** flash_status  = FLASH_OK;
 921              		.loc 1 743 1 view .LVU219
 743:../../../mod/flash/flash.c **** flash_status  = FLASH_OK;
 922              		.loc 1 743 15 is_stmt 0 view .LVU220
 923 0008 AD23     		movs	r3, #173
 924 000a 8DF80330 		strb	r3, [sp, #3]
 744:../../../mod/flash/flash.c **** timeout       = 100;
 925              		.loc 1 744 1 is_stmt 1 view .LVU221
 926              	.LVL77:
 745:../../../mod/flash/flash.c **** timeout_ctr   = 0;
 927              		.loc 1 745 1 view .LVU222
 746:../../../mod/flash/flash.c **** pbuffer       = pflash_handle -> pbuffer;
 928              		.loc 1 746 1 view .LVU223
 747:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address_bytes[0] );
 929              		.loc 1 747 1 view .LVU224
 747:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address_bytes[0] );
 930              		.loc 1 747 15 is_stmt 0 view .LVU225
 931 000e 8668     		ldr	r6, [r0, #8]
 932              	.LVL78:
 748:../../../mod/flash/flash.c **** 
 933              		.loc 1 748 1 is_stmt 1 view .LVU226
 934 0010 6946     		mov	r1, sp
 935 0012 4068     		ldr	r0, [r0, #4]
 936              	.LVL79:
 748:../../../mod/flash/flash.c **** 
 937              		.loc 1 748 1 is_stmt 0 view .LVU227
 938 0014 FFF7FEFF 		bl	address_to_bytes
 939              	.LVL80:
 756:../../../mod/flash/flash.c **** 	{
 940              		.loc 1 756 1 is_stmt 1 view .LVU228
 756:../../../mod/flash/flash.c **** 	{
 941              		.loc 1 756 5 is_stmt 0 view .LVU229
 942 0018 584B     		ldr	r3, .L80
 943 001a 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 756:../../../mod/flash/flash.c **** 	{
 944              		.loc 1 756 3 view .LVU230
 945 001c 002B     		cmp	r3, #0
 946 001e 00F09780 		beq	.L67
 762:../../../mod/flash/flash.c **** 	{
 947              		.loc 1 762 1 is_stmt 1 view .LVU231
 762:../../../mod/flash/flash.c **** 	{
 948              		.loc 1 762 25 is_stmt 0 view .LVU232
 949 0022 2B78     		ldrb	r3, [r5]	@ zero_extendqisi2
 762:../../../mod/flash/flash.c **** 	{
 950              		.loc 1 762 9 view .LVU233
 951 0024 012B     		cmp	r3, #1
 952 0026 4DD0     		beq	.L78
 766:../../../mod/flash/flash.c **** 	{
 953              		.loc 1 766 6 is_stmt 1 view .LVU234
 766:../../../mod/flash/flash.c **** 	{
ARM GAS  /tmp/ccQ0EOEq.s 			page 42


 954              		.loc 1 766 9 is_stmt 0 view .LVU235
 955 0028 002B     		cmp	r3, #0
 956 002a 00F09380 		beq	.L68
 777:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 957              		.loc 1 777 1 is_stmt 1 view .LVU236
 777:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 958              		.loc 1 777 16 is_stmt 0 view .LVU237
 959 002e FFF7FEFF 		bl	write_enable
 960              	.LVL81:
 778:../../../mod/flash/flash.c **** 	{
 961              		.loc 1 778 1 is_stmt 1 view .LVU238
 778:../../../mod/flash/flash.c **** 	{
 962              		.loc 1 778 4 is_stmt 0 view .LVU239
 963 0032 0028     		cmp	r0, #0
 964 0034 40F09280 		bne	.L69
 784:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )        ,
 965              		.loc 1 784 1 is_stmt 1 view .LVU240
 966 0038 DFF84491 		ldr	r9, .L80+4
 967 003c 0022     		movs	r2, #0
 968 003e 4FF48051 		mov	r1, #4096
 969 0042 4846     		mov	r0, r9
 970              	.LVL82:
 784:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )        ,
 971              		.loc 1 784 1 is_stmt 0 view .LVU241
 972 0044 FFF7FEFF 		bl	HAL_GPIO_WritePin
 973              	.LVL83:
 785:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 974              		.loc 1 785 1 is_stmt 1 view .LVU242
 785:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 975              		.loc 1 785 17 is_stmt 0 view .LVU243
 976 0048 DFF83881 		ldr	r8, .L80+8
 977 004c 4FF0FF33 		mov	r3, #-1
 978 0050 0122     		movs	r2, #1
 979 0052 0DF10301 		add	r1, sp, #3
 980 0056 4046     		mov	r0, r8
 981 0058 FFF7FEFF 		bl	HAL_SPI_Transmit
 982              	.LVL84:
 983 005c 0446     		mov	r4, r0
 785:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 984              		.loc 1 785 15 view .LVU244
 985 005e 8DF80400 		strb	r0, [sp, #4]
 789:../../../mod/flash/flash.c **** 							      &address_bytes[0]      ,
 986              		.loc 1 789 1 is_stmt 1 view .LVU245
 789:../../../mod/flash/flash.c **** 							      &address_bytes[0]      ,
 987              		.loc 1 789 17 is_stmt 0 view .LVU246
 988 0062 4FF0FF33 		mov	r3, #-1
 989 0066 0322     		movs	r2, #3
 990 0068 6946     		mov	r1, sp
 991 006a 4046     		mov	r0, r8
 992 006c FFF7FEFF 		bl	HAL_SPI_Transmit
 993              	.LVL85:
 994 0070 0746     		mov	r7, r0
 789:../../../mod/flash/flash.c **** 							      &address_bytes[0]      ,
 995              		.loc 1 789 15 view .LVU247
 996 0072 8DF80500 		strb	r0, [sp, #5]
 793:../../../mod/flash/flash.c ****                                   pbuffer       ,
 997              		.loc 1 793 1 is_stmt 1 view .LVU248
ARM GAS  /tmp/ccQ0EOEq.s 			page 43


 793:../../../mod/flash/flash.c ****                                   pbuffer       ,
 998              		.loc 1 793 17 is_stmt 0 view .LVU249
 999 0076 4FF0FF33 		mov	r3, #-1
 1000 007a 0222     		movs	r2, #2
 1001 007c 3146     		mov	r1, r6
 1002 007e 4046     		mov	r0, r8
 1003 0080 FFF7FEFF 		bl	HAL_SPI_Transmit
 1004              	.LVL86:
 1005 0084 8046     		mov	r8, r0
 793:../../../mod/flash/flash.c ****                                   pbuffer       ,
 1006              		.loc 1 793 15 view .LVU250
 1007 0086 8DF80600 		strb	r0, [sp, #6]
 797:../../../mod/flash/flash.c **** 
 1008              		.loc 1 797 1 is_stmt 1 view .LVU251
 1009 008a 0122     		movs	r2, #1
 1010 008c 4FF48051 		mov	r1, #4096
 1011 0090 4846     		mov	r0, r9
 1012 0092 FFF7FEFF 		bl	HAL_GPIO_WritePin
 1013              	.LVL87:
 800:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 1014              		.loc 1 800 1 view .LVU252
 800:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 1015              		.loc 1 800 4 is_stmt 0 view .LVU253
 1016 0096 002C     		cmp	r4, #0
 1017 0098 62D1     		bne	.L70
 800:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 1018              		.loc 1 800 30 discriminator 1 view .LVU254
 1019 009a 002F     		cmp	r7, #0
 1020 009c 62D1     		bne	.L71
 801:../../../mod/flash/flash.c **** 	 hal_status[2] != HAL_OK )
 1021              		.loc 1 801 30 view .LVU255
 1022 009e B8F1000F 		cmp	r8, #0
 1023 00a2 61D1     		bne	.L72
 1024              	.LBB7:
 808:../../../mod/flash/flash.c **** 	{
 1025              		.loc 1 808 11 view .LVU256
 1026 00a4 4FF00209 		mov	r9, #2
 1027              	.LVL88:
 1028              	.L61:
 808:../../../mod/flash/flash.c **** 	{
 1029              		.loc 1 808 20 is_stmt 1 discriminator 1 view .LVU257
 808:../../../mod/flash/flash.c **** 	{
 1030              		.loc 1 808 36 is_stmt 0 discriminator 1 view .LVU258
 1031 00a8 2B78     		ldrb	r3, [r5]	@ zero_extendqisi2
 808:../../../mod/flash/flash.c **** 	{
 1032              		.loc 1 808 20 discriminator 1 view .LVU259
 1033 00aa 4B45     		cmp	r3, r9
 1034 00ac 3CDD     		ble	.L65
 811:../../../mod/flash/flash.c **** 
 1035              		.loc 1 811 2 is_stmt 1 view .LVU260
 811:../../../mod/flash/flash.c **** 
 1036              		.loc 1 811 10 is_stmt 0 view .LVU261
 1037 00ae 0236     		adds	r6, r6, #2
 1038              	.LVL89:
 814:../../../mod/flash/flash.c **** 		{
 1039              		.loc 1 814 2 is_stmt 1 view .LVU262
 1040              	.L62:
ARM GAS  /tmp/ccQ0EOEq.s 			page 44


 814:../../../mod/flash/flash.c **** 		{
 1041              		.loc 1 814 31 view .LVU263
 814:../../../mod/flash/flash.c **** 		{
 1042              		.loc 1 814 9 is_stmt 0 view .LVU264
 1043 00b0 FFF7FEFF 		bl	flash_is_flash_busy
 1044              	.LVL90:
 814:../../../mod/flash/flash.c **** 		{
 1045              		.loc 1 814 31 view .LVU265
 1046 00b4 60B1     		cbz	r0, .L79
 816:../../../mod/flash/flash.c **** 			{
 1047              		.loc 1 816 3 is_stmt 1 view .LVU266
 816:../../../mod/flash/flash.c **** 			{
 1048              		.loc 1 816 6 is_stmt 0 view .LVU267
 1049 00b6 632C     		cmp	r4, #99
 1050 00b8 58D8     		bhi	.L73
 822:../../../mod/flash/flash.c **** 			HAL_Delay( 1 );
 1051              		.loc 1 822 4 is_stmt 1 view .LVU268
 822:../../../mod/flash/flash.c **** 			HAL_Delay( 1 );
 1052              		.loc 1 822 15 is_stmt 0 view .LVU269
 1053 00ba 0134     		adds	r4, r4, #1
 1054              	.LVL91:
 823:../../../mod/flash/flash.c **** 			}
 1055              		.loc 1 823 4 is_stmt 1 view .LVU270
 1056 00bc 0120     		movs	r0, #1
 1057 00be FFF7FEFF 		bl	HAL_Delay
 1058              	.LVL92:
 1059 00c2 F5E7     		b	.L62
 1060              	.LVL93:
 1061              	.L78:
 823:../../../mod/flash/flash.c **** 			}
 1062              		.loc 1 823 4 is_stmt 0 view .LVU271
 1063              	.LBE7:
 764:../../../mod/flash/flash.c **** 	}
 1064              		.loc 1 764 2 is_stmt 1 view .LVU272
 764:../../../mod/flash/flash.c **** 	}
 1065              		.loc 1 764 59 is_stmt 0 view .LVU273
 1066 00c4 AB68     		ldr	r3, [r5, #8]
 764:../../../mod/flash/flash.c **** 	}
 1067              		.loc 1 764 9 view .LVU274
 1068 00c6 1978     		ldrb	r1, [r3]	@ zero_extendqisi2
 1069 00c8 2846     		mov	r0, r5
 1070 00ca FFF7FEFF 		bl	flash_write_byte
 1071              	.LVL94:
 1072 00ce 42E0     		b	.L59
 1073              	.LVL95:
 1074              	.L79:
 1075              	.LBB8:
 828:../../../mod/flash/flash.c **** 	hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )        ,
 1076              		.loc 1 828 2 is_stmt 1 view .LVU275
 1077 00d0 DFF8ACA0 		ldr	r10, .L80+4
 1078 00d4 0022     		movs	r2, #0
 1079 00d6 4FF48051 		mov	r1, #4096
 1080 00da 5046     		mov	r0, r10
 1081 00dc FFF7FEFF 		bl	HAL_GPIO_WritePin
 1082              	.LVL96:
 829:../../../mod/flash/flash.c **** 									&flash_opcode         ,
 1083              		.loc 1 829 2 view .LVU276
ARM GAS  /tmp/ccQ0EOEq.s 			page 45


 829:../../../mod/flash/flash.c **** 									&flash_opcode         ,
 1084              		.loc 1 829 18 is_stmt 0 view .LVU277
 1085 00e0 DFF8A080 		ldr	r8, .L80+8
 1086 00e4 4FF0FF33 		mov	r3, #-1
 1087 00e8 0122     		movs	r2, #1
 1088 00ea 0DF10301 		add	r1, sp, #3
 1089 00ee 4046     		mov	r0, r8
 1090 00f0 FFF7FEFF 		bl	HAL_SPI_Transmit
 1091              	.LVL97:
 1092 00f4 0746     		mov	r7, r0
 829:../../../mod/flash/flash.c **** 									&flash_opcode         ,
 1093              		.loc 1 829 16 view .LVU278
 1094 00f6 8DF80400 		strb	r0, [sp, #4]
 833:../../../mod/flash/flash.c **** 									pbuffer       ,
 1095              		.loc 1 833 2 is_stmt 1 view .LVU279
 833:../../../mod/flash/flash.c **** 									pbuffer       ,
 1096              		.loc 1 833 18 is_stmt 0 view .LVU280
 1097 00fa 4FF0FF33 		mov	r3, #-1
 1098 00fe 0222     		movs	r2, #2
 1099 0100 3146     		mov	r1, r6
 1100 0102 4046     		mov	r0, r8
 1101 0104 FFF7FEFF 		bl	HAL_SPI_Transmit
 1102              	.LVL98:
 1103 0108 8046     		mov	r8, r0
 833:../../../mod/flash/flash.c **** 									pbuffer       ,
 1104              		.loc 1 833 16 view .LVU281
 1105 010a 8DF80500 		strb	r0, [sp, #5]
 837:../../../mod/flash/flash.c **** 
 1106              		.loc 1 837 2 is_stmt 1 view .LVU282
 1107 010e 0122     		movs	r2, #1
 1108 0110 4FF48051 		mov	r1, #4096
 1109 0114 5046     		mov	r0, r10
 1110 0116 FFF7FEFF 		bl	HAL_GPIO_WritePin
 1111              	.LVL99:
 840:../../../mod/flash/flash.c **** 		{
 1112              		.loc 1 840 2 view .LVU283
 840:../../../mod/flash/flash.c **** 		{
 1113              		.loc 1 840 5 is_stmt 0 view .LVU284
 1114 011a 4FBB     		cbnz	r7, .L74
 840:../../../mod/flash/flash.c **** 		{
 1115              		.loc 1 840 31 discriminator 1 view .LVU285
 1116 011c B8F1000F 		cmp	r8, #0
 1117 0120 28D1     		bne	.L75
 808:../../../mod/flash/flash.c **** 	{
 1118              		.loc 1 808 52 is_stmt 1 discriminator 2 view .LVU286
 1119 0122 09F10209 		add	r9, r9, #2
 1120              	.LVL100:
 808:../../../mod/flash/flash.c **** 	{
 1121              		.loc 1 808 52 is_stmt 0 discriminator 2 view .LVU287
 1122 0126 BFE7     		b	.L61
 1123              	.L65:
 808:../../../mod/flash/flash.c **** 	{
 1124              		.loc 1 808 52 discriminator 2 view .LVU288
 1125              	.LBE8:
 847:../../../mod/flash/flash.c **** 
 1126              		.loc 1 847 47 is_stmt 1 discriminator 1 view .LVU289
 847:../../../mod/flash/flash.c **** 
ARM GAS  /tmp/ccQ0EOEq.s 			page 46


 1127              		.loc 1 847 31 discriminator 1 view .LVU290
 847:../../../mod/flash/flash.c **** 
 1128              		.loc 1 847 9 is_stmt 0 discriminator 1 view .LVU291
 1129 0128 FFF7FEFF 		bl	flash_is_flash_busy
 1130              	.LVL101:
 847:../../../mod/flash/flash.c **** 
 1131              		.loc 1 847 31 discriminator 1 view .LVU292
 1132 012c 0028     		cmp	r0, #0
 1133 012e FBD1     		bne	.L65
 850:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 1134              		.loc 1 850 1 is_stmt 1 view .LVU293
 850:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 1135              		.loc 1 850 16 is_stmt 0 view .LVU294
 1136 0130 FFF7FEFF 		bl	write_disable
 1137              	.LVL102:
 851:../../../mod/flash/flash.c **** 	{
 1138              		.loc 1 851 1 is_stmt 1 view .LVU295
 851:../../../mod/flash/flash.c **** 	{
 1139              		.loc 1 851 4 is_stmt 0 view .LVU296
 1140 0134 00BB     		cbnz	r0, .L76
 1141              	.LVL103:
 1142              	.L66:
 857:../../../mod/flash/flash.c **** 
 1143              		.loc 1 857 47 is_stmt 1 discriminator 1 view .LVU297
 857:../../../mod/flash/flash.c **** 
 1144              		.loc 1 857 31 discriminator 1 view .LVU298
 857:../../../mod/flash/flash.c **** 
 1145              		.loc 1 857 9 is_stmt 0 discriminator 1 view .LVU299
 1146 0136 FFF7FEFF 		bl	flash_is_flash_busy
 1147              	.LVL104:
 857:../../../mod/flash/flash.c **** 
 1148              		.loc 1 857 31 discriminator 1 view .LVU300
 1149 013a 0028     		cmp	r0, #0
 1150 013c FBD1     		bne	.L66
 860:../../../mod/flash/flash.c **** 	{
 1151              		.loc 1 860 1 is_stmt 1 view .LVU301
 860:../../../mod/flash/flash.c **** 	{
 1152              		.loc 1 860 22 is_stmt 0 view .LVU302
 1153 013e 2878     		ldrb	r0, [r5]	@ zero_extendqisi2
 860:../../../mod/flash/flash.c **** 	{
 1154              		.loc 1 860 4 view .LVU303
 1155 0140 10F00100 		ands	r0, r0, #1
 1156 0144 07D0     		beq	.L59
 862:../../../mod/flash/flash.c **** 	return flash_write_byte( pflash_handle, *pbuffer );
 1157              		.loc 1 862 2 is_stmt 1 view .LVU304
 1158              	.LVL105:
 863:../../../mod/flash/flash.c **** 	}
 1159              		.loc 1 863 2 view .LVU305
 863:../../../mod/flash/flash.c **** 	}
 1160              		.loc 1 863 9 is_stmt 0 view .LVU306
 1161 0146 7178     		ldrb	r1, [r6, #1]	@ zero_extendqisi2
 1162 0148 2846     		mov	r0, r5
 1163 014a FFF7FEFF 		bl	flash_write_byte
 1164              	.LVL106:
 1165 014e 02E0     		b	.L59
 1166              	.LVL107:
 1167              	.L67:
ARM GAS  /tmp/ccQ0EOEq.s 			page 47


 758:../../../mod/flash/flash.c **** 	}
 1168              		.loc 1 758 9 view .LVU307
 1169 0150 0520     		movs	r0, #5
 1170 0152 00E0     		b	.L59
 1171              	.L68:
 768:../../../mod/flash/flash.c **** 	}
 1172              		.loc 1 768 9 view .LVU308
 1173 0154 0C20     		movs	r0, #12
 1174              	.LVL108:
 1175              	.L59:
 871:../../../mod/flash/flash.c **** 
 1176              		.loc 1 871 1 view .LVU309
 1177 0156 02B0     		add	sp, sp, #8
 1178              	.LCFI27:
 1179              		.cfi_remember_state
 1180              		.cfi_def_cfa_offset 32
 1181              		@ sp needed
 1182 0158 BDE8F087 		pop	{r4, r5, r6, r7, r8, r9, r10, pc}
 1183              	.LVL109:
 1184              	.L69:
 1185              	.LCFI28:
 1186              		.cfi_restore_state
 780:../../../mod/flash/flash.c **** 	}
 1187              		.loc 1 780 9 view .LVU310
 1188 015c 0920     		movs	r0, #9
 1189              	.LVL110:
 780:../../../mod/flash/flash.c **** 	}
 1190              		.loc 1 780 9 view .LVU311
 1191 015e FAE7     		b	.L59
 1192              	.L70:
 804:../../../mod/flash/flash.c **** 	}
 1193              		.loc 1 804 9 view .LVU312
 1194 0160 0820     		movs	r0, #8
 1195 0162 F8E7     		b	.L59
 1196              	.L71:
 1197 0164 0820     		movs	r0, #8
 1198 0166 F6E7     		b	.L59
 1199              	.L72:
 1200 0168 0820     		movs	r0, #8
 1201 016a F4E7     		b	.L59
 1202              	.LVL111:
 1203              	.L73:
 1204              	.LBB9:
 818:../../../mod/flash/flash.c **** 			}
 1205              		.loc 1 818 11 view .LVU313
 1206 016c 0420     		movs	r0, #4
 1207 016e F2E7     		b	.L59
 1208              	.L74:
 842:../../../mod/flash/flash.c **** 		}
 1209              		.loc 1 842 10 view .LVU314
 1210 0170 0B20     		movs	r0, #11
 1211 0172 F0E7     		b	.L59
 1212              	.L75:
 1213 0174 0B20     		movs	r0, #11
 1214 0176 EEE7     		b	.L59
 1215              	.LVL112:
 1216              	.L76:
ARM GAS  /tmp/ccQ0EOEq.s 			page 48


 842:../../../mod/flash/flash.c **** 		}
 1217              		.loc 1 842 10 view .LVU315
 1218              	.LBE9:
 853:../../../mod/flash/flash.c **** 	}
 1219              		.loc 1 853 9 view .LVU316
 1220 0178 0D20     		movs	r0, #13
 1221              	.LVL113:
 853:../../../mod/flash/flash.c **** 	}
 1222              		.loc 1 853 9 view .LVU317
 1223 017a ECE7     		b	.L59
 1224              	.L81:
 1225              		.align	2
 1226              	.L80:
 1227 017c 00000000 		.word	write_enabled
 1228 0180 00040258 		.word	1476527104
 1229 0184 00000000 		.word	hspi2
 1230              		.cfi_endproc
 1231              	.LFE152:
 1233              		.section	.text.flash_read,"ax",%progbits
 1234              		.align	1
 1235              		.global	flash_read
 1236              		.syntax unified
 1237              		.thumb
 1238              		.thumb_func
 1240              	flash_read:
 1241              	.LVL114:
 1242              	.LFB153:
 888:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 1243              		.loc 1 888 1 is_stmt 1 view -0
 1244              		.cfi_startproc
 1245              		@ args = 0, pretend = 0, frame = 16
 1246              		@ frame_needed = 0, uses_anonymous_args = 0
 888:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 1247              		.loc 1 888 1 is_stmt 0 view .LVU319
 1248 0000 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
 1249              	.LCFI29:
 1250              		.cfi_def_cfa_offset 24
 1251              		.cfi_offset 4, -24
 1252              		.cfi_offset 5, -20
 1253              		.cfi_offset 6, -16
 1254              		.cfi_offset 7, -12
 1255              		.cfi_offset 8, -8
 1256              		.cfi_offset 14, -4
 1257 0004 84B0     		sub	sp, sp, #16
 1258              	.LCFI30:
 1259              		.cfi_def_cfa_offset 40
 1260 0006 0546     		mov	r5, r0
 1261 0008 0E46     		mov	r6, r1
 892:../../../mod/flash/flash.c **** uint8_t           flash_opcode;  /* Data to be transmitted over SPI           */
 1262              		.loc 1 892 1 is_stmt 1 view .LVU320
 893:../../../mod/flash/flash.c **** uint8_t           address[3];    /* Flash address in byte format              */
 1263              		.loc 1 893 1 view .LVU321
 894:../../../mod/flash/flash.c **** uint8_t*          pbuffer;       /* Pointer to position in output buffer      */
 1264              		.loc 1 894 1 view .LVU322
 895:../../../mod/flash/flash.c **** uint8_t           dummy_byte;    /* Dummy byte needed for high speed read     */
 1265              		.loc 1 895 1 view .LVU323
 896:../../../mod/flash/flash.c **** 
ARM GAS  /tmp/ccQ0EOEq.s 			page 49


 1266              		.loc 1 896 1 view .LVU324
 902:../../../mod/flash/flash.c **** dummy_byte   = 0;
 1267              		.loc 1 902 1 view .LVU325
 902:../../../mod/flash/flash.c **** dummy_byte   = 0;
 1268              		.loc 1 902 14 is_stmt 0 view .LVU326
 1269 000a 0B23     		movs	r3, #11
 1270 000c 8DF80B30 		strb	r3, [sp, #11]
 903:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 1271              		.loc 1 903 1 is_stmt 1 view .LVU327
 903:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 1272              		.loc 1 903 14 is_stmt 0 view .LVU328
 1273 0010 0024     		movs	r4, #0
 1274 0012 8DF80740 		strb	r4, [sp, #7]
 904:../../../mod/flash/flash.c **** 
 1275              		.loc 1 904 1 is_stmt 1 view .LVU329
 1276 0016 02A9     		add	r1, sp, #8
 1277              	.LVL115:
 904:../../../mod/flash/flash.c **** 
 1278              		.loc 1 904 1 is_stmt 0 view .LVU330
 1279 0018 4068     		ldr	r0, [r0, #4]
 1280              	.LVL116:
 904:../../../mod/flash/flash.c **** 
 1281              		.loc 1 904 1 view .LVU331
 1282 001a FFF7FEFF 		bl	address_to_bytes
 1283              	.LVL117:
 912:../../../mod/flash/flash.c **** 
 1284              		.loc 1 912 1 is_stmt 1 view .LVU332
 1285 001e 2246     		mov	r2, r4
 1286 0020 4FF48051 		mov	r1, #4096
 1287 0024 2448     		ldr	r0, .L92
 1288 0026 FFF7FEFF 		bl	HAL_GPIO_WritePin
 1289              	.LVL118:
 915:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 1290              		.loc 1 915 1 view .LVU333
 915:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 1291              		.loc 1 915 17 is_stmt 0 view .LVU334
 1292 002a 244F     		ldr	r7, .L92+4
 1293 002c 4FF0FF33 		mov	r3, #-1
 1294 0030 0122     		movs	r2, #1
 1295 0032 0DF10B01 		add	r1, sp, #11
 1296 0036 3846     		mov	r0, r7
 1297 0038 FFF7FEFF 		bl	HAL_SPI_Transmit
 1298              	.LVL119:
 1299 003c 0446     		mov	r4, r0
 915:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 1300              		.loc 1 915 15 view .LVU335
 1301 003e 8DF80C00 		strb	r0, [sp, #12]
 921:../../../mod/flash/flash.c **** 							      &( address[0] )  ,
 1302              		.loc 1 921 1 is_stmt 1 view .LVU336
 921:../../../mod/flash/flash.c **** 							      &( address[0] )  ,
 1303              		.loc 1 921 17 is_stmt 0 view .LVU337
 1304 0042 4FF0FF33 		mov	r3, #-1
 1305 0046 0322     		movs	r2, #3
 1306 0048 02A9     		add	r1, sp, #8
 1307 004a 3846     		mov	r0, r7
 1308 004c FFF7FEFF 		bl	HAL_SPI_Transmit
 1309              	.LVL120:
ARM GAS  /tmp/ccQ0EOEq.s 			page 50


 1310 0050 8046     		mov	r8, r0
 921:../../../mod/flash/flash.c **** 							      &( address[0] )  ,
 1311              		.loc 1 921 15 view .LVU338
 1312 0052 8DF80D00 		strb	r0, [sp, #13]
 927:../../../mod/flash/flash.c **** 							      &( dummy_byte )  ,
 1313              		.loc 1 927 1 is_stmt 1 view .LVU339
 927:../../../mod/flash/flash.c **** 							      &( dummy_byte )  ,
 1314              		.loc 1 927 17 is_stmt 0 view .LVU340
 1315 0056 4FF0FF33 		mov	r3, #-1
 1316 005a 0122     		movs	r2, #1
 1317 005c 0DF10701 		add	r1, sp, #7
 1318 0060 3846     		mov	r0, r7
 1319 0062 FFF7FEFF 		bl	HAL_SPI_Transmit
 1320              	.LVL121:
 927:../../../mod/flash/flash.c **** 							      &( dummy_byte )  ,
 1321              		.loc 1 927 15 view .LVU341
 1322 0066 8DF80E00 		strb	r0, [sp, #14]
 933:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK || 
 1323              		.loc 1 933 1 is_stmt 1 view .LVU342
 933:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK || 
 1324              		.loc 1 933 4 is_stmt 0 view .LVU343
 1325 006a ECB9     		cbnz	r4, .L86
 1326 006c 0746     		mov	r7, r0
 933:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK || 
 1327              		.loc 1 933 30 discriminator 1 view .LVU344
 1328 006e B8F1000F 		cmp	r8, #0
 1329 0072 1BD1     		bne	.L87
 934:../../../mod/flash/flash.c **** 	 hal_status[2] != HAL_OK )
 1330              		.loc 1 934 30 view .LVU345
 1331 0074 E0B9     		cbnz	r0, .L88
 1332              	.L84:
 1333              	.LVL122:
 1334              	.LBB10:
 941:../../../mod/flash/flash.c **** 	{
 1335              		.loc 1 941 20 is_stmt 1 discriminator 1 view .LVU346
 1336 0076 B442     		cmp	r4, r6
 1337 0078 0CD2     		bcs	.L91
 943:../../../mod/flash/flash.c **** 	hal_status[3] = HAL_SPI_Receive( &( FLASH_SPI )      ,
 1338              		.loc 1 943 2 view .LVU347
 943:../../../mod/flash/flash.c **** 	hal_status[3] = HAL_SPI_Receive( &( FLASH_SPI )      ,
 1339              		.loc 1 943 28 is_stmt 0 view .LVU348
 1340 007a A968     		ldr	r1, [r5, #8]
 1341              	.LVL123:
 944:../../../mod/flash/flash.c **** 								     pbuffer             ,
 1342              		.loc 1 944 2 is_stmt 1 view .LVU349
 944:../../../mod/flash/flash.c **** 								     pbuffer             ,
 1343              		.loc 1 944 18 is_stmt 0 view .LVU350
 1344 007c 4FF0FF33 		mov	r3, #-1
 1345 0080 0122     		movs	r2, #1
 1346 0082 2144     		add	r1, r1, r4
 1347              	.LVL124:
 944:../../../mod/flash/flash.c **** 								     pbuffer             ,
 1348              		.loc 1 944 18 view .LVU351
 1349 0084 0D48     		ldr	r0, .L92+4
 1350 0086 FFF7FEFF 		bl	HAL_SPI_Receive
 1351              	.LVL125:
 944:../../../mod/flash/flash.c **** 								     pbuffer             ,
ARM GAS  /tmp/ccQ0EOEq.s 			page 51


 1352              		.loc 1 944 16 view .LVU352
 1353 008a 8DF80F00 		strb	r0, [sp, #15]
 949:../../../mod/flash/flash.c **** 		{
 1354              		.loc 1 949 2 is_stmt 1 view .LVU353
 949:../../../mod/flash/flash.c **** 		{
 1355              		.loc 1 949 5 is_stmt 0 view .LVU354
 1356 008e 88B9     		cbnz	r0, .L89
 941:../../../mod/flash/flash.c **** 	{
 1357              		.loc 1 941 33 is_stmt 1 discriminator 2 view .LVU355
 1358 0090 0134     		adds	r4, r4, #1
 1359              	.LVL126:
 941:../../../mod/flash/flash.c **** 	{
 1360              		.loc 1 941 33 is_stmt 0 discriminator 2 view .LVU356
 1361 0092 F0E7     		b	.L84
 1362              	.LVL127:
 1363              	.L91:
 941:../../../mod/flash/flash.c **** 	{
 1364              		.loc 1 941 33 discriminator 2 view .LVU357
 1365              	.LBE10:
 956:../../../mod/flash/flash.c **** 
 1366              		.loc 1 956 1 is_stmt 1 view .LVU358
 1367 0094 0122     		movs	r2, #1
 1368 0096 4FF48051 		mov	r1, #4096
 1369 009a 0748     		ldr	r0, .L92
 1370 009c FFF7FEFF 		bl	HAL_GPIO_WritePin
 1371              	.LVL128:
 959:../../../mod/flash/flash.c **** 
 1372              		.loc 1 959 1 view .LVU359
 1373              	.L83:
 961:../../../mod/flash/flash.c **** 
 1374              		.loc 1 961 1 is_stmt 0 view .LVU360
 1375 00a0 3846     		mov	r0, r7
 1376 00a2 04B0     		add	sp, sp, #16
 1377              	.LCFI31:
 1378              		.cfi_remember_state
 1379              		.cfi_def_cfa_offset 24
 1380              		@ sp needed
 1381 00a4 BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 1382              	.LVL129:
 1383              	.L86:
 1384              	.LCFI32:
 1385              		.cfi_restore_state
 937:../../../mod/flash/flash.c **** 	}
 1386              		.loc 1 937 9 view .LVU361
 1387 00a8 0827     		movs	r7, #8
 1388 00aa F9E7     		b	.L83
 1389              	.L87:
 1390 00ac 0827     		movs	r7, #8
 1391 00ae F7E7     		b	.L83
 1392              	.L88:
 1393 00b0 0827     		movs	r7, #8
 1394 00b2 F5E7     		b	.L83
 1395              	.LVL130:
 1396              	.L89:
 1397              	.LBB11:
 951:../../../mod/flash/flash.c **** 		}
 1398              		.loc 1 951 10 view .LVU362
ARM GAS  /tmp/ccQ0EOEq.s 			page 52


 1399 00b4 0827     		movs	r7, #8
 1400 00b6 F3E7     		b	.L83
 1401              	.L93:
 1402              		.align	2
 1403              	.L92:
 1404 00b8 00040258 		.word	1476527104
 1405 00bc 00000000 		.word	hspi2
 1406              	.LBE11:
 1407              		.cfi_endproc
 1408              	.LFE153:
 1410              		.section	.text.flash_erase,"ax",%progbits
 1411              		.align	1
 1412              		.global	flash_erase
 1413              		.syntax unified
 1414              		.thumb
 1415              		.thumb_func
 1417              	flash_erase:
 1418              	.LVL131:
 1419              	.LFB154:
 977:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 1420              		.loc 1 977 1 is_stmt 1 view -0
 1421              		.cfi_startproc
 1422              		@ args = 0, pretend = 0, frame = 8
 1423              		@ frame_needed = 0, uses_anonymous_args = 0
 977:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 1424              		.loc 1 977 1 is_stmt 0 view .LVU364
 1425 0000 70B5     		push	{r4, r5, r6, lr}
 1426              	.LCFI33:
 1427              		.cfi_def_cfa_offset 16
 1428              		.cfi_offset 4, -16
 1429              		.cfi_offset 5, -12
 1430              		.cfi_offset 6, -8
 1431              		.cfi_offset 14, -4
 1432 0002 82B0     		sub	sp, sp, #8
 1433              	.LCFI34:
 1434              		.cfi_def_cfa_offset 24
 981:../../../mod/flash/flash.c **** uint8_t      flash_opcode;  /* Data to be transmitted over SPI                */
 1435              		.loc 1 981 1 is_stmt 1 view .LVU365
 982:../../../mod/flash/flash.c **** FLASH_STATUS flash_status;
 1436              		.loc 1 982 1 view .LVU366
 983:../../../mod/flash/flash.c **** 
 1437              		.loc 1 983 1 view .LVU367
 989:../../../mod/flash/flash.c **** 
 1438              		.loc 1 989 1 view .LVU368
 989:../../../mod/flash/flash.c **** 
 1439              		.loc 1 989 14 is_stmt 0 view .LVU369
 1440 0004 6023     		movs	r3, #96
 1441 0006 8DF80730 		strb	r3, [sp, #7]
 997:../../../mod/flash/flash.c ****     {
 1442              		.loc 1 997 1 is_stmt 1 view .LVU370
 997:../../../mod/flash/flash.c ****     {
 1443              		.loc 1 997 5 is_stmt 0 view .LVU371
 1444 000a 134B     		ldr	r3, .L99
 1445 000c 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 997:../../../mod/flash/flash.c ****     {
 1446              		.loc 1 997 3 view .LVU372
 1447 000e E3B1     		cbz	r3, .L96
ARM GAS  /tmp/ccQ0EOEq.s 			page 53


1008:../../../mod/flash/flash.c **** 
 1448              		.loc 1 1008 1 is_stmt 1 view .LVU373
1008:../../../mod/flash/flash.c **** 
 1449              		.loc 1 1008 16 is_stmt 0 view .LVU374
 1450 0010 FFF7FEFF 		bl	write_enable
 1451              	.LVL132:
1008:../../../mod/flash/flash.c **** 
 1452              		.loc 1 1008 16 view .LVU375
 1453 0014 0446     		mov	r4, r0
 1454              	.LVL133:
1011:../../../mod/flash/flash.c **** hal_status = HAL_SPI_Transmit( &( FLASH_SPI )        ,
 1455              		.loc 1 1011 1 is_stmt 1 view .LVU376
 1456 0016 114E     		ldr	r6, .L99+4
 1457 0018 0022     		movs	r2, #0
 1458 001a 4FF48051 		mov	r1, #4096
 1459 001e 3046     		mov	r0, r6
 1460 0020 FFF7FEFF 		bl	HAL_GPIO_WritePin
 1461              	.LVL134:
1012:../../../mod/flash/flash.c **** 							   &flash_opcode         ,
 1462              		.loc 1 1012 1 view .LVU377
1012:../../../mod/flash/flash.c **** 							   &flash_opcode         ,
 1463              		.loc 1 1012 14 is_stmt 0 view .LVU378
 1464 0024 4FF0FF33 		mov	r3, #-1
 1465 0028 0122     		movs	r2, #1
 1466 002a 0DF10701 		add	r1, sp, #7
 1467 002e 0C48     		ldr	r0, .L99+8
 1468 0030 FFF7FEFF 		bl	HAL_SPI_Transmit
 1469              	.LVL135:
 1470 0034 0546     		mov	r5, r0
 1471              	.LVL136:
1016:../../../mod/flash/flash.c **** 
 1472              		.loc 1 1016 1 is_stmt 1 view .LVU379
 1473 0036 0122     		movs	r2, #1
 1474 0038 4FF48051 		mov	r1, #4096
 1475 003c 3046     		mov	r0, r6
 1476 003e FFF7FEFF 		bl	HAL_GPIO_WritePin
 1477              	.LVL137:
1019:../../../mod/flash/flash.c **** 	{
 1478              		.loc 1 1019 1 view .LVU380
1019:../../../mod/flash/flash.c **** 	{
 1479              		.loc 1 1019 9 is_stmt 0 view .LVU381
 1480 0042 35B9     		cbnz	r5, .L97
1023:../../../mod/flash/flash.c **** 	{
 1481              		.loc 1 1023 6 is_stmt 1 view .LVU382
1023:../../../mod/flash/flash.c **** 	{
 1482              		.loc 1 1023 9 is_stmt 0 view .LVU383
 1483 0044 14B1     		cbz	r4, .L95
1025:../../../mod/flash/flash.c **** 	}
 1484              		.loc 1 1025 9 view .LVU384
 1485 0046 0124     		movs	r4, #1
 1486              	.LVL138:
1025:../../../mod/flash/flash.c **** 	}
 1487              		.loc 1 1025 9 view .LVU385
 1488 0048 00E0     		b	.L95
 1489              	.LVL139:
 1490              	.L96:
 999:../../../mod/flash/flash.c ****     }
ARM GAS  /tmp/ccQ0EOEq.s 			page 54


 1491              		.loc 1 999 12 view .LVU386
 1492 004a 0524     		movs	r4, #5
 1493              	.LVL140:
 1494              	.L95:
1032:../../../mod/flash/flash.c **** 
 1495              		.loc 1 1032 1 view .LVU387
 1496 004c 2046     		mov	r0, r4
 1497 004e 02B0     		add	sp, sp, #8
 1498              	.LCFI35:
 1499              		.cfi_remember_state
 1500              		.cfi_def_cfa_offset 16
 1501              		@ sp needed
 1502 0050 70BD     		pop	{r4, r5, r6, pc}
 1503              	.LVL141:
 1504              	.L97:
 1505              	.LCFI36:
 1506              		.cfi_restore_state
1021:../../../mod/flash/flash.c **** 	}
 1507              		.loc 1 1021 9 view .LVU388
 1508 0052 0824     		movs	r4, #8
 1509              	.LVL142:
1021:../../../mod/flash/flash.c **** 	}
 1510              		.loc 1 1021 9 view .LVU389
 1511 0054 FAE7     		b	.L95
 1512              	.L100:
 1513 0056 00BF     		.align	2
 1514              	.L99:
 1515 0058 00000000 		.word	write_enabled
 1516 005c 00040258 		.word	1476527104
 1517 0060 00000000 		.word	hspi2
 1518              		.cfi_endproc
 1519              	.LFE154:
 1521              		.section	.text.flash_cmd_execute,"ax",%progbits
 1522              		.align	1
 1523              		.global	flash_cmd_execute
 1524              		.syntax unified
 1525              		.thumb
 1526              		.thumb_func
 1528              	flash_cmd_execute:
 1529              	.LVL143:
 1530              	.LFB144:
  93:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 1531              		.loc 1 93 1 is_stmt 1 view -0
 1532              		.cfi_startproc
 1533              		@ args = 0, pretend = 0, frame = 520
 1534              		@ frame_needed = 0, uses_anonymous_args = 0
  93:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 1535              		.loc 1 93 1 is_stmt 0 view .LVU391
 1536 0000 70B5     		push	{r4, r5, r6, lr}
 1537              	.LCFI37:
 1538              		.cfi_def_cfa_offset 16
 1539              		.cfi_offset 4, -16
 1540              		.cfi_offset 5, -12
 1541              		.cfi_offset 6, -8
 1542              		.cfi_offset 14, -4
 1543 0002 ADF5027D 		sub	sp, sp, #520
 1544              	.LCFI38:
ARM GAS  /tmp/ccQ0EOEq.s 			page 55


 1545              		.cfi_def_cfa_offset 536
 1546 0006 0C46     		mov	r4, r1
  97:../../../mod/flash/flash.c **** uint8_t          num_bytes;           /* Number of bytes on which to 
 1547              		.loc 1 97 1 is_stmt 1 view .LVU392
  98:../../../mod/flash/flash.c ****                                          operate                              */
 1548              		.loc 1 98 1 view .LVU393
 100:../../../mod/flash/flash.c **** uint8_t*         pbuffer;             /* Position within flash buffer         */
 1549              		.loc 1 100 1 view .LVU394
 101:../../../mod/flash/flash.c **** uint8_t          buffer[512];         /* buffer (flash extract)               */
 1550              		.loc 1 101 1 view .LVU395
 102:../../../mod/flash/flash.c **** FLASH_STATUS     flash_status;        /* Return value of flash API calls      */
 1551              		.loc 1 102 1 view .LVU396
 103:../../../mod/flash/flash.c **** USB_STATUS       usb_status;          /* Return value of USB API calls        */
 1552              		.loc 1 103 1 view .LVU397
 104:../../../mod/flash/flash.c **** 
 1553              		.loc 1 104 1 view .LVU398
 110:../../../mod/flash/flash.c **** num_bytes = ( subcommand & FLASH_NBYTES_BITMASK    ); 
 1554              		.loc 1 110 1 view .LVU399
 110:../../../mod/flash/flash.c **** num_bytes = ( subcommand & FLASH_NBYTES_BITMASK    ); 
 1555              		.loc 1 110 11 is_stmt 0 view .LVU400
 1556 0008 4609     		lsrs	r6, r0, #5
 1557              	.LVL144:
 111:../../../mod/flash/flash.c **** pflash_handle -> num_bytes = num_bytes;
 1558              		.loc 1 111 1 is_stmt 1 view .LVU401
 111:../../../mod/flash/flash.c **** pflash_handle -> num_bytes = num_bytes;
 1559              		.loc 1 111 11 is_stmt 0 view .LVU402
 1560 000a 00F01F05 		and	r5, r0, #31
 1561              	.LVL145:
 112:../../../mod/flash/flash.c **** pbuffer   = &buffer[0];
 1562              		.loc 1 112 1 is_stmt 1 view .LVU403
 112:../../../mod/flash/flash.c **** pbuffer   = &buffer[0];
 1563              		.loc 1 112 28 is_stmt 0 view .LVU404
 1564 000e 0D70     		strb	r5, [r1]
 113:../../../mod/flash/flash.c **** memset( pbuffer, 0, sizeof( buffer ) );
 1565              		.loc 1 113 1 is_stmt 1 view .LVU405
 1566              	.LVL146:
 114:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 1567              		.loc 1 114 1 view .LVU406
 1568 0010 4FF40072 		mov	r2, #512
 1569 0014 0021     		movs	r1, #0
 1570              	.LVL147:
 114:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 1571              		.loc 1 114 1 is_stmt 0 view .LVU407
 1572 0016 01A8     		add	r0, sp, #4
 1573              	.LVL148:
 114:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 1574              		.loc 1 114 1 view .LVU408
 1575 0018 FFF7FEFF 		bl	memset
 1576              	.LVL149:
 115:../../../mod/flash/flash.c **** 
 1577              		.loc 1 115 1 is_stmt 1 view .LVU409
 1578 001c 81A9     		add	r1, sp, #516
 1579 001e 6068     		ldr	r0, [r4, #4]
 1580 0020 FFF7FEFF 		bl	address_to_bytes
 1581              	.LVL150:
 121:../../../mod/flash/flash.c **** 	{
 1582              		.loc 1 121 1 view .LVU410
ARM GAS  /tmp/ccQ0EOEq.s 			page 56


 1583 0024 062E     		cmp	r6, #6
 1584 0026 00F28F80 		bhi	.L117
 1585 002a DFE806F0 		tbb	[pc, r6]
 1586              	.L104:
 1587 002e 04       		.byte	(.L110-.L104)/2
 1588 002f 29       		.byte	(.L109-.L104)/2
 1589 0030 30       		.byte	(.L108-.L104)/2
 1590 0031 34       		.byte	(.L107-.L104)/2
 1591 0032 58       		.byte	(.L106-.L104)/2
 1592 0033 5D       		.byte	(.L105-.L104)/2
 1593 0034 6D       		.byte	(.L103-.L104)/2
 1594 0035 00       		.p2align 1
 1595              	.L110:
 128:../../../mod/flash/flash.c ****                                   sizeof( address ), 
 1596              		.loc 1 128 3 view .LVU411
 128:../../../mod/flash/flash.c ****                                   sizeof( address ), 
 1597              		.loc 1 128 16 is_stmt 0 view .LVU412
 1598 0036 4FF0FF32 		mov	r2, #-1
 1599 003a 0321     		movs	r1, #3
 1600 003c 81A8     		add	r0, sp, #516
 1601 003e FFF7FEFF 		bl	usb_receive
 1602              	.LVL151:
 132:../../../mod/flash/flash.c **** 			{
 1603              		.loc 1 132 3 is_stmt 1 view .LVU413
 132:../../../mod/flash/flash.c **** 			{
 1604              		.loc 1 132 6 is_stmt 0 view .LVU414
 1605 0042 0028     		cmp	r0, #0
 1606 0044 40F08280 		bne	.L118
 139:../../../mod/flash/flash.c **** 			flash_status = flash_read( pflash_handle, num_bytes );
 1607              		.loc 1 139 4 is_stmt 1 view .LVU415
 1608              	.LVL152:
 1609              	.LBB12:
 1610              	.LBI12:
1070:../../../mod/flash/flash.c **** 	(
 1611              		.loc 1 1070 24 view .LVU416
 1612              	.LBB13:
1075:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[1] << 8  ) |
 1613              		.loc 1 1075 1 view .LVU417
1075:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[1] << 8  ) |
 1614              		.loc 1 1075 34 is_stmt 0 view .LVU418
 1615 0048 9DF80422 		ldrb	r2, [sp, #516]	@ zero_extendqisi2
1076:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
 1616              		.loc 1 1076 31 view .LVU419
 1617 004c 9DF80532 		ldrb	r3, [sp, #517]	@ zero_extendqisi2
1076:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
 1618              		.loc 1 1076 35 view .LVU420
 1619 0050 1B02     		lsls	r3, r3, #8
1075:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[1] << 8  ) |
 1620              		.loc 1 1075 46 view .LVU421
 1621 0052 43EA0243 		orr	r3, r3, r2, lsl #16
1077:../../../mod/flash/flash.c **** } /* address_to_bytes */
 1622              		.loc 1 1077 31 view .LVU422
 1623 0056 9DF80622 		ldrb	r2, [sp, #518]	@ zero_extendqisi2
1076:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
 1624              		.loc 1 1076 43 view .LVU423
 1625 005a 1343     		orrs	r3, r3, r2
 1626              	.LVL153:
ARM GAS  /tmp/ccQ0EOEq.s 			page 57


1076:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
 1627              		.loc 1 1076 43 view .LVU424
 1628              	.LBE13:
 1629              	.LBE12:
 139:../../../mod/flash/flash.c **** 			flash_status = flash_read( pflash_handle, num_bytes );
 1630              		.loc 1 139 29 view .LVU425
 1631 005c 6360     		str	r3, [r4, #4]
 140:../../../mod/flash/flash.c **** 			
 1632              		.loc 1 140 4 is_stmt 1 view .LVU426
 140:../../../mod/flash/flash.c **** 			
 1633              		.loc 1 140 19 is_stmt 0 view .LVU427
 1634 005e 2946     		mov	r1, r5
 1635 0060 2046     		mov	r0, r4
 1636              	.LVL154:
 140:../../../mod/flash/flash.c **** 			
 1637              		.loc 1 140 19 view .LVU428
 1638 0062 FFF7FEFF 		bl	flash_read
 1639              	.LVL155:
 143:../../../mod/flash/flash.c **** 				{
 1640              		.loc 1 143 4 is_stmt 1 view .LVU429
 143:../../../mod/flash/flash.c **** 				{
 1641              		.loc 1 143 7 is_stmt 0 view .LVU430
 1642 0066 08B1     		cbz	r0, .L124
 146:../../../mod/flash/flash.c **** 				}
 1643              		.loc 1 146 12 view .LVU431
 1644 0068 0125     		movs	r5, #1
 1645              	.LVL156:
 146:../../../mod/flash/flash.c **** 				}
 1646              		.loc 1 146 12 view .LVU432
 1647 006a 0CE0     		b	.L102
 1648              	.LVL157:
 1649              	.L124:
 150:../../../mod/flash/flash.c ****                                        num_bytes               ,
 1650              		.loc 1 150 4 is_stmt 1 view .LVU433
 150:../../../mod/flash/flash.c ****                                        num_bytes               ,
 1651              		.loc 1 150 17 is_stmt 0 view .LVU434
 1652 006c 4FF0FF32 		mov	r2, #-1
 1653 0070 2946     		mov	r1, r5
 1654 0072 A068     		ldr	r0, [r4, #8]
 1655              	.LVL158:
 150:../../../mod/flash/flash.c ****                                        num_bytes               ,
 1656              		.loc 1 150 17 view .LVU435
 1657 0074 FFF7FEFF 		bl	usb_transmit
 1658              	.LVL159:
 154:../../../mod/flash/flash.c **** 				{
 1659              		.loc 1 154 4 is_stmt 1 view .LVU436
 154:../../../mod/flash/flash.c **** 				{
 1660              		.loc 1 154 7 is_stmt 0 view .LVU437
 1661 0078 0546     		mov	r5, r0
 1662              	.LVL160:
 154:../../../mod/flash/flash.c **** 				{
 1663              		.loc 1 154 7 view .LVU438
 1664 007a 20B1     		cbz	r0, .L102
 157:../../../mod/flash/flash.c **** 				}
 1665              		.loc 1 157 12 view .LVU439
 1666 007c 0725     		movs	r5, #7
 1667 007e 02E0     		b	.L102
ARM GAS  /tmp/ccQ0EOEq.s 			page 58


 1668              	.LVL161:
 1669              	.L109:
 170:../../../mod/flash/flash.c **** 		return FLASH_OK;
 1670              		.loc 1 170 3 is_stmt 1 view .LVU440
 1671 0080 FFF7FEFF 		bl	flash_write_enable
 1672              	.LVL162:
 171:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_ENABLE */
 1673              		.loc 1 171 3 view .LVU441
 171:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_ENABLE */
 1674              		.loc 1 171 10 is_stmt 0 view .LVU442
 1675 0084 0025     		movs	r5, #0
 1676              	.LVL163:
 1677              	.L102:
 293:../../../mod/flash/flash.c **** 
 1678              		.loc 1 293 1 view .LVU443
 1679 0086 2846     		mov	r0, r5
 1680 0088 0DF5027D 		add	sp, sp, #520
 1681              	.LCFI39:
 1682              		.cfi_remember_state
 1683              		.cfi_def_cfa_offset 16
 1684              		@ sp needed
 1685 008c 70BD     		pop	{r4, r5, r6, pc}
 1686              	.LVL164:
 1687              	.L108:
 1688              	.LCFI40:
 1689              		.cfi_restore_state
 177:../../../mod/flash/flash.c **** 		return FLASH_OK;
 1690              		.loc 1 177 3 is_stmt 1 view .LVU444
 1691 008e FFF7FEFF 		bl	flash_write_disable
 1692              	.LVL165:
 178:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_DISABLE */
 1693              		.loc 1 178 3 view .LVU445
 178:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_DISABLE */
 1694              		.loc 1 178 10 is_stmt 0 view .LVU446
 1695 0092 0025     		movs	r5, #0
 1696              	.LVL166:
 178:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_DISABLE */
 1697              		.loc 1 178 10 view .LVU447
 1698 0094 F7E7     		b	.L102
 1699              	.LVL167:
 1700              	.L107:
 185:../../../mod/flash/flash.c ****                                   sizeof( address ),
 1701              		.loc 1 185 3 is_stmt 1 view .LVU448
 185:../../../mod/flash/flash.c ****                                   sizeof( address ),
 1702              		.loc 1 185 16 is_stmt 0 view .LVU449
 1703 0096 4FF0FF32 		mov	r2, #-1
 1704 009a 0321     		movs	r1, #3
 1705 009c 81A8     		add	r0, sp, #516
 1706 009e FFF7FEFF 		bl	usb_receive
 1707              	.LVL168:
 189:../../../mod/flash/flash.c **** 			{
 1708              		.loc 1 189 3 is_stmt 1 view .LVU450
 189:../../../mod/flash/flash.c **** 			{
 1709              		.loc 1 189 6 is_stmt 0 view .LVU451
 1710 00a2 0028     		cmp	r0, #0
 1711 00a4 54D1     		bne	.L121
 197:../../../mod/flash/flash.c **** 
ARM GAS  /tmp/ccQ0EOEq.s 			page 59


 1712              		.loc 1 197 4 is_stmt 1 view .LVU452
 1713              	.LVL169:
 1714              	.LBB14:
 1715              	.LBI14:
1070:../../../mod/flash/flash.c **** 	(
 1716              		.loc 1 1070 24 view .LVU453
 1717              	.LBB15:
1075:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[1] << 8  ) |
 1718              		.loc 1 1075 1 view .LVU454
1075:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[1] << 8  ) |
 1719              		.loc 1 1075 34 is_stmt 0 view .LVU455
 1720 00a6 9DF80422 		ldrb	r2, [sp, #516]	@ zero_extendqisi2
1076:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
 1721              		.loc 1 1076 31 view .LVU456
 1722 00aa 9DF80532 		ldrb	r3, [sp, #517]	@ zero_extendqisi2
1076:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
 1723              		.loc 1 1076 35 view .LVU457
 1724 00ae 1B02     		lsls	r3, r3, #8
1075:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[1] << 8  ) |
 1725              		.loc 1 1075 46 view .LVU458
 1726 00b0 43EA0243 		orr	r3, r3, r2, lsl #16
1077:../../../mod/flash/flash.c **** } /* address_to_bytes */
 1727              		.loc 1 1077 31 view .LVU459
 1728 00b4 9DF80622 		ldrb	r2, [sp, #518]	@ zero_extendqisi2
1076:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
 1729              		.loc 1 1076 43 view .LVU460
 1730 00b8 1343     		orrs	r3, r3, r2
 1731              	.LVL170:
1076:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
 1732              		.loc 1 1076 43 view .LVU461
 1733              	.LBE15:
 1734              	.LBE14:
 197:../../../mod/flash/flash.c **** 
 1735              		.loc 1 197 29 view .LVU462
 1736 00ba 6360     		str	r3, [r4, #4]
 200:../../../mod/flash/flash.c **** 				{
 1737              		.loc 1 200 4 is_stmt 1 view .LVU463
 1738              	.LBB16:
 200:../../../mod/flash/flash.c **** 				{
 1739              		.loc 1 200 10 view .LVU464
 1740              	.LVL171:
 200:../../../mod/flash/flash.c **** 				{
 1741              		.loc 1 200 14 is_stmt 0 view .LVU465
 1742 00bc 0026     		movs	r6, #0
 1743              	.LVL172:
 200:../../../mod/flash/flash.c **** 				{
 1744              		.loc 1 200 4 view .LVU466
 1745 00be 07E0     		b	.L111
 1746              	.LVL173:
 1747              	.L112:
 202:../../../mod/flash/flash.c **** 				flash_status = usb_receive( pbuffer          , 
 1748              		.loc 1 202 5 is_stmt 1 view .LVU467
 202:../../../mod/flash/flash.c **** 				flash_status = usb_receive( pbuffer          , 
 1749              		.loc 1 202 31 is_stmt 0 view .LVU468
 1750 00c0 A068     		ldr	r0, [r4, #8]
 1751              	.LVL174:
 203:../../../mod/flash/flash.c ****                                             sizeof( uint8_t ),
ARM GAS  /tmp/ccQ0EOEq.s 			page 60


 1752              		.loc 1 203 5 is_stmt 1 view .LVU469
 203:../../../mod/flash/flash.c ****                                             sizeof( uint8_t ),
 1753              		.loc 1 203 20 is_stmt 0 view .LVU470
 1754 00c2 4FF0FF32 		mov	r2, #-1
 1755 00c6 0121     		movs	r1, #1
 1756 00c8 3044     		add	r0, r0, r6
 1757              	.LVL175:
 203:../../../mod/flash/flash.c ****                                             sizeof( uint8_t ),
 1758              		.loc 1 203 20 view .LVU471
 1759 00ca FFF7FEFF 		bl	usb_receive
 1760              	.LVL176:
 208:../../../mod/flash/flash.c **** 					{
 1761              		.loc 1 208 5 is_stmt 1 view .LVU472
 200:../../../mod/flash/flash.c **** 				{
 1762              		.loc 1 200 37 view .LVU473
 1763 00ce 0136     		adds	r6, r6, #1
 1764              	.LVL177:
 1765              	.L111:
 200:../../../mod/flash/flash.c **** 				{
 1766              		.loc 1 200 23 discriminator 1 view .LVU474
 1767 00d0 B542     		cmp	r5, r6
 1768 00d2 F5DC     		bgt	.L112
 1769              	.LBE16:
 218:../../../mod/flash/flash.c **** 
 1770              		.loc 1 218 3 view .LVU475
 218:../../../mod/flash/flash.c **** 
 1771              		.loc 1 218 18 is_stmt 0 view .LVU476
 1772 00d4 2046     		mov	r0, r4
 1773 00d6 FFF7FEFF 		bl	flash_write
 1774              	.LVL178:
 1775 00da 0546     		mov	r5, r0
 1776              	.LVL179:
 220:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_WRITE */
 1777              		.loc 1 220 6 is_stmt 1 view .LVU477
 220:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_WRITE */
 1778              		.loc 1 220 13 is_stmt 0 view .LVU478
 1779 00dc D3E7     		b	.L102
 1780              	.LVL180:
 1781              	.L106:
 227:../../../mod/flash/flash.c **** 
 1782              		.loc 1 227 3 is_stmt 1 view .LVU479
 227:../../../mod/flash/flash.c **** 
 1783              		.loc 1 227 18 is_stmt 0 view .LVU480
 1784 00de 2046     		mov	r0, r4
 1785 00e0 FFF7FEFF 		bl	flash_erase
 1786              	.LVL181:
 1787 00e4 0546     		mov	r5, r0
 1788              	.LVL182:
 229:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_ERASE */
 1789              		.loc 1 229 3 is_stmt 1 view .LVU481
 229:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_ERASE */
 1790              		.loc 1 229 10 is_stmt 0 view .LVU482
 1791 00e6 CEE7     		b	.L102
 1792              	.LVL183:
 1793              	.L105:
 236:../../../mod/flash/flash.c **** 
 1794              		.loc 1 236 3 is_stmt 1 view .LVU483
ARM GAS  /tmp/ccQ0EOEq.s 			page 61


 236:../../../mod/flash/flash.c **** 
 1795              		.loc 1 236 18 is_stmt 0 view .LVU484
 1796 00e8 2046     		mov	r0, r4
 1797 00ea FFF7FEFF 		bl	flash_get_status
 1798              	.LVL184:
 1799 00ee 0546     		mov	r5, r0
 1800              	.LVL185:
 239:../../../mod/flash/flash.c ****                                    sizeof( uint8_t )                    ,
 1801              		.loc 1 239 3 is_stmt 1 view .LVU485
 239:../../../mod/flash/flash.c ****                                    sizeof( uint8_t )                    ,
 1802              		.loc 1 239 16 is_stmt 0 view .LVU486
 1803 00f0 4FF0FF32 		mov	r2, #-1
 1804 00f4 0121     		movs	r1, #1
 1805 00f6 04F10F00 		add	r0, r4, #15
 1806 00fa FFF7FEFF 		bl	usb_transmit
 1807              	.LVL186:
 244:../../../mod/flash/flash.c **** 			{
 1808              		.loc 1 244 3 is_stmt 1 view .LVU487
 244:../../../mod/flash/flash.c **** 			{
 1809              		.loc 1 244 11 is_stmt 0 view .LVU488
 1810 00fe 48BB     		cbnz	r0, .L122
 248:../../../mod/flash/flash.c **** 			{
 1811              		.loc 1 248 8 is_stmt 1 view .LVU489
 248:../../../mod/flash/flash.c **** 			{
 1812              		.loc 1 248 11 is_stmt 0 view .LVU490
 1813 0100 002D     		cmp	r5, #0
 1814 0102 C0D0     		beq	.L102
 250:../../../mod/flash/flash.c **** 			}
 1815              		.loc 1 250 11 view .LVU491
 1816 0104 0825     		movs	r5, #8
 1817              	.LVL187:
 250:../../../mod/flash/flash.c **** 			}
 1818              		.loc 1 250 11 view .LVU492
 1819 0106 BEE7     		b	.L102
 1820              	.LVL188:
 1821              	.L103:
 262:../../../mod/flash/flash.c **** 		pflash_handle->address = 0;
 1822              		.loc 1 262 3 is_stmt 1 view .LVU493
 262:../../../mod/flash/flash.c **** 		pflash_handle->address = 0;
 1823              		.loc 1 262 26 is_stmt 0 view .LVU494
 1824 0108 01AB     		add	r3, sp, #4
 1825              	.LVL189:
 262:../../../mod/flash/flash.c **** 		pflash_handle->address = 0;
 1826              		.loc 1 262 26 view .LVU495
 1827 010a A360     		str	r3, [r4, #8]
 263:../../../mod/flash/flash.c **** 		while( pflash_handle->address <= FLASH_MAX_ADDR )
 1828              		.loc 1 263 3 is_stmt 1 view .LVU496
 263:../../../mod/flash/flash.c **** 		while( pflash_handle->address <= FLASH_MAX_ADDR )
 1829              		.loc 1 263 26 is_stmt 0 view .LVU497
 1830 010c 0023     		movs	r3, #0
 1831              	.LVL190:
 263:../../../mod/flash/flash.c **** 		while( pflash_handle->address <= FLASH_MAX_ADDR )
 1832              		.loc 1 263 26 view .LVU498
 1833 010e 6360     		str	r3, [r4, #4]
 264:../../../mod/flash/flash.c **** 			{
 1834              		.loc 1 264 3 is_stmt 1 view .LVU499
 264:../../../mod/flash/flash.c **** 			{
ARM GAS  /tmp/ccQ0EOEq.s 			page 62


 1835              		.loc 1 264 8 is_stmt 0 view .LVU500
 1836 0110 05E0     		b	.L113
 1837              	.LVL191:
 1838              	.L114:
 276:../../../mod/flash/flash.c **** 				}
 1839              		.loc 1 276 5 is_stmt 1 view .LVU501
 1840 0112 FFF7FEFF 		bl	Error_Handler
 1841              	.LVL192:
 1842              	.L115:
 280:../../../mod/flash/flash.c **** 			}
 1843              		.loc 1 280 4 view .LVU502
 280:../../../mod/flash/flash.c **** 			}
 1844              		.loc 1 280 18 is_stmt 0 view .LVU503
 1845 0116 6368     		ldr	r3, [r4, #4]
 280:../../../mod/flash/flash.c **** 			}
 1846              		.loc 1 280 29 view .LVU504
 1847 0118 03F50073 		add	r3, r3, #512
 1848 011c 6360     		str	r3, [r4, #4]
 1849              	.LVL193:
 1850              	.L113:
 264:../../../mod/flash/flash.c **** 			{
 1851              		.loc 1 264 33 is_stmt 1 view .LVU505
 264:../../../mod/flash/flash.c **** 			{
 1852              		.loc 1 264 23 is_stmt 0 view .LVU506
 1853 011e 6368     		ldr	r3, [r4, #4]
 264:../../../mod/flash/flash.c **** 			{
 1854              		.loc 1 264 33 view .LVU507
 1855 0120 B3F5002F 		cmp	r3, #524288
 1856 0124 0ED2     		bcs	.L125
 266:../../../mod/flash/flash.c **** 			if( flash_status == FLASH_OK )
 1857              		.loc 1 266 4 is_stmt 1 view .LVU508
 266:../../../mod/flash/flash.c **** 			if( flash_status == FLASH_OK )
 1858              		.loc 1 266 19 is_stmt 0 view .LVU509
 1859 0126 4FF40071 		mov	r1, #512
 1860 012a 2046     		mov	r0, r4
 1861 012c FFF7FEFF 		bl	flash_read
 1862              	.LVL194:
 267:../../../mod/flash/flash.c **** 				{
 1863              		.loc 1 267 4 is_stmt 1 view .LVU510
 267:../../../mod/flash/flash.c **** 				{
 1864              		.loc 1 267 6 is_stmt 0 view .LVU511
 1865 0130 0028     		cmp	r0, #0
 1866 0132 EED1     		bne	.L114
 269:../../../mod/flash/flash.c **** 						      sizeof( buffer ),
 1867              		.loc 1 269 5 is_stmt 1 view .LVU512
 1868 0134 4FF0FF32 		mov	r2, #-1
 1869 0138 4FF40071 		mov	r1, #512
 1870 013c 01A8     		add	r0, sp, #4
 1871              	.LVL195:
 269:../../../mod/flash/flash.c **** 						      sizeof( buffer ),
 1872              		.loc 1 269 5 is_stmt 0 view .LVU513
 1873 013e FFF7FEFF 		bl	usb_transmit
 1874              	.LVL196:
 269:../../../mod/flash/flash.c **** 						      sizeof( buffer ),
 1875              		.loc 1 269 5 view .LVU514
 1876 0142 E8E7     		b	.L115
 1877              	.LVL197:
ARM GAS  /tmp/ccQ0EOEq.s 			page 63


 1878              	.L125:
 283:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_EXTRACT */
 1879              		.loc 1 283 10 view .LVU515
 1880 0144 0025     		movs	r5, #0
 1881              	.LVL198:
 283:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_EXTRACT */
 1882              		.loc 1 283 10 view .LVU516
 1883 0146 9EE7     		b	.L102
 1884              	.LVL199:
 1885              	.L117:
 121:../../../mod/flash/flash.c **** 	{
 1886              		.loc 1 121 1 view .LVU517
 1887 0148 0325     		movs	r5, #3
 1888              	.LVL200:
 121:../../../mod/flash/flash.c **** 	{
 1889              		.loc 1 121 1 view .LVU518
 1890 014a 9CE7     		b	.L102
 1891              	.LVL201:
 1892              	.L118:
 134:../../../mod/flash/flash.c **** 			}
 1893              		.loc 1 134 11 view .LVU519
 1894 014c 0725     		movs	r5, #7
 1895              	.LVL202:
 134:../../../mod/flash/flash.c **** 			}
 1896              		.loc 1 134 11 view .LVU520
 1897 014e 9AE7     		b	.L102
 1898              	.LVL203:
 1899              	.L121:
 192:../../../mod/flash/flash.c ****             }
 1900              		.loc 1 192 11 view .LVU521
 1901 0150 0725     		movs	r5, #7
 1902              	.LVL204:
 192:../../../mod/flash/flash.c ****             }
 1903              		.loc 1 192 11 view .LVU522
 1904 0152 98E7     		b	.L102
 1905              	.LVL205:
 1906              	.L122:
 246:../../../mod/flash/flash.c **** 			}
 1907              		.loc 1 246 11 view .LVU523
 1908 0154 0725     		movs	r5, #7
 1909              	.LVL206:
 246:../../../mod/flash/flash.c **** 			}
 1910              		.loc 1 246 11 view .LVU524
 1911 0156 96E7     		b	.L102
 1912              		.cfi_endproc
 1913              	.LFE144:
 1915              		.section	.bss.write_enabled,"aw",%nobits
 1918              	write_enabled:
 1919 0000 00       		.space	1
 1920              		.text
 1921              	.Letext0:
 1922              		.file 2 "/usr/lib/gcc/arm-none-eabi/12.2.0/include/stddef.h"
 1923              		.file 3 "/usr/arm-none-eabi/include/machine/_default_types.h"
 1924              		.file 4 "/usr/arm-none-eabi/include/sys/_stdint.h"
 1925              		.file 5 "../../../lib/Drivers/CMSIS/Device/ST/STM32H7xx/Include/stm32h750xx.h"
 1926              		.file 6 "../../../lib/Drivers/STM32H7xx_HAL_Driver/Inc/stm32h7xx_hal_def.h"
 1927              		.file 7 "../../../lib/Drivers/STM32H7xx_HAL_Driver/Inc/stm32h7xx_hal_gpio.h"
ARM GAS  /tmp/ccQ0EOEq.s 			page 64


 1928              		.file 8 "../../../lib/Drivers/STM32H7xx_HAL_Driver/Inc/stm32h7xx_hal_dma.h"
 1929              		.file 9 "../../../lib/Drivers/STM32H7xx_HAL_Driver/Inc/stm32h7xx_hal_spi.h"
 1930              		.file 10 "../../../mod/flash/flash.h"
 1931              		.file 11 "../../../mod/usb/usb.h"
 1932              		.file 12 "../../../lib/Drivers/STM32H7xx_HAL_Driver/Inc/stm32h7xx_hal.h"
 1933              		.file 13 "/usr/arm-none-eabi/include/string.h"
 1934              		.file 14 "../../../lib/sdr_pin_defines_A0002.h"
 1935              		.file 15 "./main.h"
 1936              		.file 16 "<built-in>"
ARM GAS  /tmp/ccQ0EOEq.s 			page 65


DEFINED SYMBOLS
                            *ABS*:0000000000000000 flash.c
     /tmp/ccQ0EOEq.s:20     .text.address_to_bytes:0000000000000000 $t
     /tmp/ccQ0EOEq.s:25     .text.address_to_bytes:0000000000000000 address_to_bytes
     /tmp/ccQ0EOEq.s:52     .text.write_disable:0000000000000000 $t
     /tmp/ccQ0EOEq.s:57     .text.write_disable:0000000000000000 write_disable
     /tmp/ccQ0EOEq.s:128    .text.write_disable:0000000000000044 $d
     /tmp/ccQ0EOEq.s:134    .text.write_enable:0000000000000000 $t
     /tmp/ccQ0EOEq.s:139    .text.write_enable:0000000000000000 write_enable
     /tmp/ccQ0EOEq.s:210    .text.write_enable:0000000000000044 $d
     /tmp/ccQ0EOEq.s:216    .text.flash_get_status:0000000000000000 $t
     /tmp/ccQ0EOEq.s:222    .text.flash_get_status:0000000000000000 flash_get_status
     /tmp/ccQ0EOEq.s:313    .text.flash_get_status:0000000000000068 $d
     /tmp/ccQ0EOEq.s:319    .text.flash_set_status:0000000000000000 $t
     /tmp/ccQ0EOEq.s:325    .text.flash_set_status:0000000000000000 flash_set_status
     /tmp/ccQ0EOEq.s:459    .text.flash_set_status:00000000000000ac $d
     /tmp/ccQ0EOEq.s:1918   .bss.write_enabled:0000000000000000 write_enabled
     /tmp/ccQ0EOEq.s:466    .text.flash_is_flash_busy:0000000000000000 $t
     /tmp/ccQ0EOEq.s:472    .text.flash_is_flash_busy:0000000000000000 flash_is_flash_busy
     /tmp/ccQ0EOEq.s:538    .text.flash_write_enable:0000000000000000 $t
     /tmp/ccQ0EOEq.s:544    .text.flash_write_enable:0000000000000000 flash_write_enable
     /tmp/ccQ0EOEq.s:561    .text.flash_write_enable:0000000000000008 $d
     /tmp/ccQ0EOEq.s:566    .text.flash_write_disable:0000000000000000 $t
     /tmp/ccQ0EOEq.s:572    .text.flash_write_disable:0000000000000000 flash_write_disable
     /tmp/ccQ0EOEq.s:589    .text.flash_write_disable:0000000000000008 $d
     /tmp/ccQ0EOEq.s:594    .text.flash_init:0000000000000000 $t
     /tmp/ccQ0EOEq.s:600    .text.flash_init:0000000000000000 flash_init
     /tmp/ccQ0EOEq.s:729    .text.flash_write_byte:0000000000000000 $t
     /tmp/ccQ0EOEq.s:735    .text.flash_write_byte:0000000000000000 flash_write_byte
     /tmp/ccQ0EOEq.s:878    .text.flash_write_byte:000000000000009c $d
     /tmp/ccQ0EOEq.s:885    .text.flash_write:0000000000000000 $t
     /tmp/ccQ0EOEq.s:891    .text.flash_write:0000000000000000 flash_write
     /tmp/ccQ0EOEq.s:1227   .text.flash_write:000000000000017c $d
     /tmp/ccQ0EOEq.s:1234   .text.flash_read:0000000000000000 $t
     /tmp/ccQ0EOEq.s:1240   .text.flash_read:0000000000000000 flash_read
     /tmp/ccQ0EOEq.s:1404   .text.flash_read:00000000000000b8 $d
     /tmp/ccQ0EOEq.s:1411   .text.flash_erase:0000000000000000 $t
     /tmp/ccQ0EOEq.s:1417   .text.flash_erase:0000000000000000 flash_erase
     /tmp/ccQ0EOEq.s:1515   .text.flash_erase:0000000000000058 $d
     /tmp/ccQ0EOEq.s:1522   .text.flash_cmd_execute:0000000000000000 $t
     /tmp/ccQ0EOEq.s:1528   .text.flash_cmd_execute:0000000000000000 flash_cmd_execute
     /tmp/ccQ0EOEq.s:1587   .text.flash_cmd_execute:000000000000002e $d
     /tmp/ccQ0EOEq.s:1919   .bss.write_enabled:0000000000000000 $d
     /tmp/ccQ0EOEq.s:1594   .text.flash_cmd_execute:0000000000000035 $d
     /tmp/ccQ0EOEq.s:1594   .text.flash_cmd_execute:0000000000000036 $t

UNDEFINED SYMBOLS
HAL_GPIO_WritePin
HAL_SPI_Transmit
hspi2
HAL_SPI_Receive
HAL_Delay
memset
usb_receive
usb_transmit
Error_Handler
