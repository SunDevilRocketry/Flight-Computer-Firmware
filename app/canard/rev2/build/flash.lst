ARM GAS  /tmp/ccKy2Hdq.s 			page 1


   1              		.cpu cortex-m7
   2              		.arch armv7e-m
   3              		.fpu fpv5-d16
   4              		.eabi_attribute 28, 1
   5              		.eabi_attribute 20, 1
   6              		.eabi_attribute 21, 1
   7              		.eabi_attribute 23, 3
   8              		.eabi_attribute 24, 1
   9              		.eabi_attribute 25, 1
  10              		.eabi_attribute 26, 1
  11              		.eabi_attribute 30, 1
  12              		.eabi_attribute 34, 1
  13              		.eabi_attribute 18, 4
  14              		.file	"flash.c"
  15              		.text
  16              	.Ltext0:
  17              		.cfi_sections	.debug_frame
  18              		.file 1 "../../../mod/flash/flash.c"
  19              		.section	.text.address_to_bytes,"ax",%progbits
  20              		.align	1
  21              		.syntax unified
  22              		.thumb
  23              		.thumb_func
  25              	address_to_bytes:
  26              	.LVL0:
  27              	.LFB156:
   1:../../../mod/flash/flash.c **** /*******************************************************************************
   2:../../../mod/flash/flash.c **** *
   3:../../../mod/flash/flash.c **** * FILE: 
   4:../../../mod/flash/flash.c **** * 		flash.c
   5:../../../mod/flash/flash.c **** *
   6:../../../mod/flash/flash.c **** * DESCRIPTION: 
   7:../../../mod/flash/flash.c **** * 		Contains API functions for writing and reading data from the engine 
   8:../../../mod/flash/flash.c **** *       controller's flash 
   9:../../../mod/flash/flash.c **** *
  10:../../../mod/flash/flash.c **** *******************************************************************************/
  11:../../../mod/flash/flash.c **** 
  12:../../../mod/flash/flash.c **** 
  13:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
  14:../../../mod/flash/flash.c ****  Standard Includes                                                                     
  15:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
  16:../../../mod/flash/flash.c **** #include <string.h>
  17:../../../mod/flash/flash.c **** 
  18:../../../mod/flash/flash.c **** 
  19:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
  20:../../../mod/flash/flash.c ****  MCU Pins 
  21:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
  22:../../../mod/flash/flash.c **** #if   defined( FLIGHT_COMPUTER   )
  23:../../../mod/flash/flash.c **** 	#include "sdr_pin_defines_A0002.h"
  24:../../../mod/flash/flash.c **** #elif defined( ENGINE_CONTROLLER )
  25:../../../mod/flash/flash.c **** 	#include "sdr_pin_defines_L0002.h"
  26:../../../mod/flash/flash.c **** #elif defined( FLIGHT_COMPUTER_LITE )
  27:../../../mod/flash/flash.c **** 	#include "sdr_pin_defines_A0007.h"
  28:../../../mod/flash/flash.c **** #endif 
  29:../../../mod/flash/flash.c **** 
  30:../../../mod/flash/flash.c **** 
  31:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
ARM GAS  /tmp/ccKy2Hdq.s 			page 2


  32:../../../mod/flash/flash.c ****  Project Includes                                                                     
  33:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
  34:../../../mod/flash/flash.c **** #include "main.h"
  35:../../../mod/flash/flash.c **** #include "flash.h"
  36:../../../mod/flash/flash.c **** #include "usb.h"
  37:../../../mod/flash/flash.c **** #include "led.h"
  38:../../../mod/flash/flash.c **** 
  39:../../../mod/flash/flash.c **** 
  40:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
  41:../../../mod/flash/flash.c ****  Global Variables 
  42:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
  43:../../../mod/flash/flash.c **** static bool write_enabled = false;
  44:../../../mod/flash/flash.c **** 
  45:../../../mod/flash/flash.c **** 
  46:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
  47:../../../mod/flash/flash.c ****  Internal function prototypes 
  48:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
  49:../../../mod/flash/flash.c **** 
  50:../../../mod/flash/flash.c **** /* Converts a flash memory address in uint32_t format to a byte array */
  51:../../../mod/flash/flash.c **** static void address_to_bytes
  52:../../../mod/flash/flash.c **** 	(
  53:../../../mod/flash/flash.c **** 	uint32_t address,
  54:../../../mod/flash/flash.c **** 	uint8_t* address_bytes
  55:../../../mod/flash/flash.c **** 	);
  56:../../../mod/flash/flash.c **** 
  57:../../../mod/flash/flash.c **** /* Converts a flash memory address in byte format to uint32_t format */
  58:../../../mod/flash/flash.c **** static inline uint32_t bytes_to_address 
  59:../../../mod/flash/flash.c **** 	(
  60:../../../mod/flash/flash.c **** 	uint8_t address_bytes[3]
  61:../../../mod/flash/flash.c **** 	);
  62:../../../mod/flash/flash.c **** 
  63:../../../mod/flash/flash.c **** /* Enable writing to the external flash chip hardware */
  64:../../../mod/flash/flash.c **** static FLASH_STATUS write_enable
  65:../../../mod/flash/flash.c ****     (
  66:../../../mod/flash/flash.c ****     void 
  67:../../../mod/flash/flash.c ****     );
  68:../../../mod/flash/flash.c **** 
  69:../../../mod/flash/flash.c **** /* Disable writing to the external flash chip hardware */
  70:../../../mod/flash/flash.c **** static FLASH_STATUS write_disable 
  71:../../../mod/flash/flash.c ****     (
  72:../../../mod/flash/flash.c ****     void 
  73:../../../mod/flash/flash.c ****     );
  74:../../../mod/flash/flash.c **** 
  75:../../../mod/flash/flash.c **** 
  76:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
  77:../../../mod/flash/flash.c ****  Procedures 
  78:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
  79:../../../mod/flash/flash.c **** 
  80:../../../mod/flash/flash.c **** 
  81:../../../mod/flash/flash.c **** /*******************************************************************************
  82:../../../mod/flash/flash.c **** *                                                                              *
  83:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
  84:../../../mod/flash/flash.c **** * 		flash_cmd_execute                                                      *
  85:../../../mod/flash/flash.c **** *                                                                              *
  86:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
  87:../../../mod/flash/flash.c **** * 		Executes a flash subcommand based on input from the sdec terminal      *
  88:../../../mod/flash/flash.c **** *                                                                              *
ARM GAS  /tmp/ccKy2Hdq.s 			page 3


  89:../../../mod/flash/flash.c **** *******************************************************************************/
  90:../../../mod/flash/flash.c **** FLASH_STATUS flash_cmd_execute
  91:../../../mod/flash/flash.c **** 	(
  92:../../../mod/flash/flash.c ****     uint8_t             subcommand   ,
  93:../../../mod/flash/flash.c **** 	HFLASH_BUFFER*      pflash_handle
  94:../../../mod/flash/flash.c ****     )
  95:../../../mod/flash/flash.c **** {
  96:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
  97:../../../mod/flash/flash.c ****  Local Variables 
  98:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
  99:../../../mod/flash/flash.c **** uint8_t          opcode;              /* Subcommand opcode                    */
 100:../../../mod/flash/flash.c **** uint8_t          num_bytes;           /* Number of bytes on which to 
 101:../../../mod/flash/flash.c ****                                          operate                              */
 102:../../../mod/flash/flash.c **** uint8_t          address[3];          /* flash address in byte form           */
 103:../../../mod/flash/flash.c **** uint8_t*         pbuffer;             /* Position within flash buffer         */
 104:../../../mod/flash/flash.c **** uint8_t          buffer[512];         /* buffer (flash extract)               */
 105:../../../mod/flash/flash.c **** FLASH_STATUS     flash_status;        /* Return value of flash API calls      */
 106:../../../mod/flash/flash.c **** USB_STATUS       usb_status;          /* Return value of USB API calls        */
 107:../../../mod/flash/flash.c **** 
 108:../../../mod/flash/flash.c **** 
 109:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 110:../../../mod/flash/flash.c ****  Pre-processing 
 111:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 112:../../../mod/flash/flash.c **** opcode    = ( subcommand & FLASH_SUBCMD_OP_BITMASK ) >>  5;
 113:../../../mod/flash/flash.c **** num_bytes = ( subcommand & FLASH_NBYTES_BITMASK    ); 
 114:../../../mod/flash/flash.c **** pflash_handle -> num_bytes = num_bytes;
 115:../../../mod/flash/flash.c **** pbuffer   = &buffer[0];
 116:../../../mod/flash/flash.c **** memset( pbuffer, 0, sizeof( buffer ) );
 117:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 118:../../../mod/flash/flash.c **** 
 119:../../../mod/flash/flash.c **** 
 120:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 121:../../../mod/flash/flash.c ****  Call API function 
 122:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 123:../../../mod/flash/flash.c **** switch ( opcode )
 124:../../../mod/flash/flash.c **** 	{
 125:../../../mod/flash/flash.c ****     /*-----------------------------READ Subcommand----------------------------*/
 126:../../../mod/flash/flash.c ****     case FLASH_SUBCMD_READ:
 127:../../../mod/flash/flash.c ****         {
 128:../../../mod/flash/flash.c **** 
 129:../../../mod/flash/flash.c **** 		/* Get flash address from USB */
 130:../../../mod/flash/flash.c **** 		usb_status = usb_receive( &( address[0] )  , 
 131:../../../mod/flash/flash.c ****                                   sizeof( address ), 
 132:../../../mod/flash/flash.c ****                                   HAL_DEFAULT_TIMEOUT );
 133:../../../mod/flash/flash.c **** 		
 134:../../../mod/flash/flash.c **** 		if ( usb_status != USB_OK )
 135:../../../mod/flash/flash.c **** 			{
 136:../../../mod/flash/flash.c **** 			return FLASH_USB_ERROR;
 137:../../../mod/flash/flash.c **** 			}
 138:../../../mod/flash/flash.c **** 		else
 139:../../../mod/flash/flash.c **** 			{
 140:../../../mod/flash/flash.c **** 			/* Call API Function */
 141:../../../mod/flash/flash.c **** 			pflash_handle -> address = bytes_to_address( address );
 142:../../../mod/flash/flash.c **** 			flash_status = flash_read( pflash_handle, num_bytes );
 143:../../../mod/flash/flash.c **** 			
 144:../../../mod/flash/flash.c **** 			/* Check for flash error */
 145:../../../mod/flash/flash.c **** 			if ( flash_status != FLASH_OK )
ARM GAS  /tmp/ccKy2Hdq.s 			page 4


 146:../../../mod/flash/flash.c **** 				{
 147:../../../mod/flash/flash.c **** 				/* Bytes not read */
 148:../../../mod/flash/flash.c **** 				return FLASH_FAIL;
 149:../../../mod/flash/flash.c **** 				}
 150:../../../mod/flash/flash.c **** 
 151:../../../mod/flash/flash.c **** 			/* Transmit bytes from pbuffer over USB */
 152:../../../mod/flash/flash.c **** 			usb_status = usb_transmit( pflash_handle -> pbuffer,
 153:../../../mod/flash/flash.c ****                                        num_bytes               ,
 154:../../../mod/flash/flash.c **** 									   HAL_FLASH_TIMEOUT );
 155:../../../mod/flash/flash.c **** 
 156:../../../mod/flash/flash.c **** 			if ( usb_status != USB_OK )
 157:../../../mod/flash/flash.c **** 				{
 158:../../../mod/flash/flash.c **** 				/* Bytes not transimitted */
 159:../../../mod/flash/flash.c **** 				return FLASH_USB_ERROR;
 160:../../../mod/flash/flash.c **** 				}
 161:../../../mod/flash/flash.c **** 
 162:../../../mod/flash/flash.c **** 			}
 163:../../../mod/flash/flash.c **** 
 164:../../../mod/flash/flash.c **** 		/* Bytes read and transimitted back sucessfully */
 165:../../../mod/flash/flash.c **** 		return FLASH_OK;
 166:../../../mod/flash/flash.c **** 
 167:../../../mod/flash/flash.c **** 		} /* FLASH_SUBCMD_READ */
 168:../../../mod/flash/flash.c **** 
 169:../../../mod/flash/flash.c ****     /*------------------------------ENABLE Subcommand-----------------------------*/
 170:../../../mod/flash/flash.c ****     case FLASH_SUBCMD_ENABLE:
 171:../../../mod/flash/flash.c ****         {
 172:../../../mod/flash/flash.c **** 		flash_write_enable();
 173:../../../mod/flash/flash.c **** 		return FLASH_OK;
 174:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_ENABLE */
 175:../../../mod/flash/flash.c **** 
 176:../../../mod/flash/flash.c ****     /*------------------------------DISABLE Subcommand----------------------------*/
 177:../../../mod/flash/flash.c ****     case FLASH_SUBCMD_DISABLE:
 178:../../../mod/flash/flash.c ****         {
 179:../../../mod/flash/flash.c **** 		flash_write_disable();
 180:../../../mod/flash/flash.c **** 		return FLASH_OK;
 181:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_DISABLE */
 182:../../../mod/flash/flash.c **** 
 183:../../../mod/flash/flash.c ****     /*------------------------------WRITE Subcommand------------------------------*/
 184:../../../mod/flash/flash.c ****     case FLASH_SUBCMD_WRITE:
 185:../../../mod/flash/flash.c ****         {
 186:../../../mod/flash/flash.c **** 		/* Get Address bits */
 187:../../../mod/flash/flash.c **** 		usb_status = usb_receive( &( address[0] )  ,
 188:../../../mod/flash/flash.c ****                                   sizeof( address ),
 189:../../../mod/flash/flash.c ****                                   HAL_DEFAULT_TIMEOUT );
 190:../../../mod/flash/flash.c **** 
 191:../../../mod/flash/flash.c **** 		if ( usb_status != USB_OK )	
 192:../../../mod/flash/flash.c **** 			{
 193:../../../mod/flash/flash.c **** 			/* Address not recieved */
 194:../../../mod/flash/flash.c **** 			return FLASH_USB_ERROR;
 195:../../../mod/flash/flash.c ****             }
 196:../../../mod/flash/flash.c **** 		else
 197:../../../mod/flash/flash.c **** 			{
 198:../../../mod/flash/flash.c **** 			/* Convert flash address to uint32_t */
 199:../../../mod/flash/flash.c **** 			pflash_handle -> address = bytes_to_address( address );
 200:../../../mod/flash/flash.c **** 
 201:../../../mod/flash/flash.c **** 			/* Get bytes to be written to flash */
 202:../../../mod/flash/flash.c **** 			for ( int i = 0; i < num_bytes; i++ )
ARM GAS  /tmp/ccKy2Hdq.s 			page 5


 203:../../../mod/flash/flash.c **** 				{
 204:../../../mod/flash/flash.c **** 				pbuffer = ( pflash_handle -> pbuffer ) + i;
 205:../../../mod/flash/flash.c **** 				flash_status = usb_receive( pbuffer          , 
 206:../../../mod/flash/flash.c ****                                             sizeof( uint8_t ),
 207:../../../mod/flash/flash.c ****                                             HAL_DEFAULT_TIMEOUT );
 208:../../../mod/flash/flash.c **** 
 209:../../../mod/flash/flash.c **** 				/* Return if usb call failed */
 210:../../../mod/flash/flash.c **** 				if ( usb_status != USB_OK )
 211:../../../mod/flash/flash.c **** 					{
 212:../../../mod/flash/flash.c **** 					/* Bytes not received */
 213:../../../mod/flash/flash.c **** 				    return FLASH_USB_ERROR;	
 214:../../../mod/flash/flash.c ****                     }
 215:../../../mod/flash/flash.c **** 
 216:../../../mod/flash/flash.c **** 				}
 217:../../../mod/flash/flash.c ****             }
 218:../../../mod/flash/flash.c **** 
 219:../../../mod/flash/flash.c **** 		/* Call API function */
 220:../../../mod/flash/flash.c **** 		flash_status = flash_write( pflash_handle );
 221:../../../mod/flash/flash.c **** 
 222:../../../mod/flash/flash.c **** 	    return flash_status;	
 223:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_WRITE */
 224:../../../mod/flash/flash.c **** 
 225:../../../mod/flash/flash.c ****     /*------------------------------ERASE Subcommand------------------------------*/
 226:../../../mod/flash/flash.c ****     case FLASH_SUBCMD_ERASE:
 227:../../../mod/flash/flash.c ****         {
 228:../../../mod/flash/flash.c **** 		/* Call API Function*/
 229:../../../mod/flash/flash.c **** 		flash_status = flash_erase( pflash_handle );
 230:../../../mod/flash/flash.c **** 
 231:../../../mod/flash/flash.c **** 		return flash_status;
 232:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_ERASE */
 233:../../../mod/flash/flash.c **** 
 234:../../../mod/flash/flash.c ****     /*------------------------------STATUS Subcommand-----------------------------*/
 235:../../../mod/flash/flash.c ****     case FLASH_SUBCMD_STATUS:
 236:../../../mod/flash/flash.c ****         {
 237:../../../mod/flash/flash.c **** 		/* Call API function */
 238:../../../mod/flash/flash.c **** 		flash_status = flash_get_status( pflash_handle );
 239:../../../mod/flash/flash.c **** 
 240:../../../mod/flash/flash.c **** 		/* Send status register contents back to PC */
 241:../../../mod/flash/flash.c **** 		usb_status = usb_transmit( &( pflash_handle -> status_register ),
 242:../../../mod/flash/flash.c ****                                    sizeof( uint8_t )                    ,
 243:../../../mod/flash/flash.c ****                                    HAL_DEFAULT_TIMEOUT );
 244:../../../mod/flash/flash.c **** 
 245:../../../mod/flash/flash.c **** 		/* Return status code */
 246:../../../mod/flash/flash.c **** 		if      ( usb_status   != USB_OK   )
 247:../../../mod/flash/flash.c **** 			{
 248:../../../mod/flash/flash.c **** 			return FLASH_USB_ERROR;
 249:../../../mod/flash/flash.c **** 			}
 250:../../../mod/flash/flash.c **** 		else if ( flash_status != FLASH_OK )
 251:../../../mod/flash/flash.c **** 			{
 252:../../../mod/flash/flash.c **** 			return FLASH_SPI_ERROR;
 253:../../../mod/flash/flash.c **** 			}
 254:../../../mod/flash/flash.c **** 		else
 255:../../../mod/flash/flash.c **** 			{
 256:../../../mod/flash/flash.c **** 			return FLASH_OK;	
 257:../../../mod/flash/flash.c **** 			}
 258:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_STATUS */
 259:../../../mod/flash/flash.c **** 
ARM GAS  /tmp/ccKy2Hdq.s 			page 6


 260:../../../mod/flash/flash.c ****     /*-----------------------------EXTRACT Subcommand-----------------------------*/
 261:../../../mod/flash/flash.c ****     case FLASH_SUBCMD_EXTRACT:
 262:../../../mod/flash/flash.c ****         {
 263:../../../mod/flash/flash.c **** 		/* Extracts the entire flash chip, flash chip address from 0 to 0x7FFFF */
 264:../../../mod/flash/flash.c **** 		pflash_handle->pbuffer = &buffer[0];
 265:../../../mod/flash/flash.c **** 		pflash_handle->address = 0;
 266:../../../mod/flash/flash.c **** 		while( pflash_handle->address <= FLASH_MAX_ADDR )
 267:../../../mod/flash/flash.c **** 			{
 268:../../../mod/flash/flash.c **** 			flash_status = flash_read( pflash_handle, sizeof( buffer ) );
 269:../../../mod/flash/flash.c **** 			if( flash_status == FLASH_OK )
 270:../../../mod/flash/flash.c **** 				{
 271:../../../mod/flash/flash.c **** 				usb_transmit( &buffer, sizeof( buffer ), HAL_FLASH_TIMEOUT );
 272:../../../mod/flash/flash.c **** 				}
 273:../../../mod/flash/flash.c **** 			else
 274:../../../mod/flash/flash.c **** 				{
 275:../../../mod/flash/flash.c **** 				/* Extract Failed */
 276:../../../mod/flash/flash.c **** 				return FLASH_EXTRACT_ERROR;
 277:../../../mod/flash/flash.c **** 				}
 278:../../../mod/flash/flash.c **** 
 279:../../../mod/flash/flash.c **** 			/* Read from next address */
 280:../../../mod/flash/flash.c **** 			(pflash_handle->address) += sizeof( buffer ) ;
 281:../../../mod/flash/flash.c **** 			}
 282:../../../mod/flash/flash.c **** 
 283:../../../mod/flash/flash.c **** 		return FLASH_OK;
 284:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_EXTRACT */
 285:../../../mod/flash/flash.c **** 
 286:../../../mod/flash/flash.c ****     /*---------------------------Unrecognized Subcommand--------------------------*/
 287:../../../mod/flash/flash.c **** 	default:
 288:../../../mod/flash/flash.c ****         {
 289:../../../mod/flash/flash.c **** 	    return FLASH_UNRECOGNIZED_OP;	
 290:../../../mod/flash/flash.c ****         }
 291:../../../mod/flash/flash.c **** 
 292:../../../mod/flash/flash.c ****     }
 293:../../../mod/flash/flash.c **** } /* flash_cmd_execute */
 294:../../../mod/flash/flash.c **** 
 295:../../../mod/flash/flash.c **** 
 296:../../../mod/flash/flash.c **** /*******************************************************************************
 297:../../../mod/flash/flash.c **** *                                                                              *
 298:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
 299:../../../mod/flash/flash.c **** * 		flash_init                                                             *
 300:../../../mod/flash/flash.c **** *                                                                              *
 301:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
 302:../../../mod/flash/flash.c **** *       Initializes the flash chip                                             *
 303:../../../mod/flash/flash.c **** *                                                                              *
 304:../../../mod/flash/flash.c **** *******************************************************************************/
 305:../../../mod/flash/flash.c **** FLASH_STATUS flash_init 
 306:../../../mod/flash/flash.c **** 	(
 307:../../../mod/flash/flash.c **** 	HFLASH_BUFFER* pflash_handle  /* Flash handle */
 308:../../../mod/flash/flash.c **** 	)
 309:../../../mod/flash/flash.c **** {
 310:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 311:../../../mod/flash/flash.c ****  Local variables 
 312:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 313:../../../mod/flash/flash.c **** FLASH_STATUS flash_status;    /* Flash API function return codes        */
 314:../../../mod/flash/flash.c **** uint8_t      status_register; /* Desired status register contents       */
 315:../../../mod/flash/flash.c **** 
 316:../../../mod/flash/flash.c **** 
ARM GAS  /tmp/ccKy2Hdq.s 			page 7


 317:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 318:../../../mod/flash/flash.c ****  Initializations 
 319:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 320:../../../mod/flash/flash.c **** flash_status    = FLASH_OK;
 321:../../../mod/flash/flash.c **** status_register = FLASH_REG_RESET_VAL;
 322:../../../mod/flash/flash.c **** 
 323:../../../mod/flash/flash.c **** 
 324:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 325:../../../mod/flash/flash.c ****  Pre-processing 
 326:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 327:../../../mod/flash/flash.c **** 
 328:../../../mod/flash/flash.c **** /* Check for invalid BPL setting */
 329:../../../mod/flash/flash.c **** if ( pflash_handle -> bpl_bits > FLASH_BPL_ALL )
 330:../../../mod/flash/flash.c **** 	{
 331:../../../mod/flash/flash.c **** 	return FLASH_INVALID_INPUT; 
 332:../../../mod/flash/flash.c **** 	}
 333:../../../mod/flash/flash.c **** 
 334:../../../mod/flash/flash.c **** /* Determine the desired status register contents */
 335:../../../mod/flash/flash.c **** status_register &= pflash_handle -> bpl_bits;
 336:../../../mod/flash/flash.c **** status_register |= pflash_handle -> bpl_write_protect;
 337:../../../mod/flash/flash.c **** 
 338:../../../mod/flash/flash.c **** 
 339:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 340:../../../mod/flash/flash.c ****  API Function Implementation 
 341:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 342:../../../mod/flash/flash.c **** 
 343:../../../mod/flash/flash.c **** /* Configure write protection */
 344:../../../mod/flash/flash.c **** if ( pflash_handle -> write_protected )
 345:../../../mod/flash/flash.c **** 	{
 346:../../../mod/flash/flash.c **** 	flash_write_disable();
 347:../../../mod/flash/flash.c **** 	return FLASH_OK;
 348:../../../mod/flash/flash.c **** 	}
 349:../../../mod/flash/flash.c **** else
 350:../../../mod/flash/flash.c **** 	{
 351:../../../mod/flash/flash.c **** 	flash_write_enable();
 352:../../../mod/flash/flash.c **** 	}
 353:../../../mod/flash/flash.c **** 
 354:../../../mod/flash/flash.c **** /* Check the flash chip status register to confirm chip can be reached */
 355:../../../mod/flash/flash.c **** flash_status = flash_get_status( pflash_handle );
 356:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 357:../../../mod/flash/flash.c **** 	{
 358:../../../mod/flash/flash.c **** 	return flash_status;
 359:../../../mod/flash/flash.c **** 	}
 360:../../../mod/flash/flash.c **** else if ( pflash_handle -> status_register == 0xFF )
 361:../../../mod/flash/flash.c **** 	{
 362:../../../mod/flash/flash.c **** 	return FLASH_INIT_FAIL;
 363:../../../mod/flash/flash.c **** 	}
 364:../../../mod/flash/flash.c **** 
 365:../../../mod/flash/flash.c **** /* Disable writing to the chip in case of prior interrupted write operation */
 366:../../../mod/flash/flash.c **** if ( write_disable() != FLASH_OK )
 367:../../../mod/flash/flash.c **** 	{
 368:../../../mod/flash/flash.c **** 	return FLASH_CANNOT_WRITE_DISABLE;
 369:../../../mod/flash/flash.c **** 	}
 370:../../../mod/flash/flash.c **** 
 371:../../../mod/flash/flash.c **** /* Set the bpl bits in the flash chip */
 372:../../../mod/flash/flash.c **** flash_status = flash_set_status( status_register );
 373:../../../mod/flash/flash.c **** 
ARM GAS  /tmp/ccKy2Hdq.s 			page 8


 374:../../../mod/flash/flash.c **** /* Confirm Status register contents */
 375:../../../mod/flash/flash.c **** while( flash_is_flash_busy() == FLASH_BUSY ){}
 376:../../../mod/flash/flash.c **** flash_status = flash_get_status( pflash_handle );
 377:../../../mod/flash/flash.c **** if ( pflash_handle -> status_register != status_register )
 378:../../../mod/flash/flash.c **** 	{
 379:../../../mod/flash/flash.c **** 	return FLASH_INIT_FAIL;
 380:../../../mod/flash/flash.c **** 	}
 381:../../../mod/flash/flash.c **** else
 382:../../../mod/flash/flash.c **** 	{
 383:../../../mod/flash/flash.c **** 	return flash_status;
 384:../../../mod/flash/flash.c **** 	}
 385:../../../mod/flash/flash.c **** 
 386:../../../mod/flash/flash.c **** } /* flash_init */
 387:../../../mod/flash/flash.c **** 
 388:../../../mod/flash/flash.c **** 
 389:../../../mod/flash/flash.c **** /*******************************************************************************
 390:../../../mod/flash/flash.c **** *                                                                              *
 391:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
 392:../../../mod/flash/flash.c **** * 		flash_get_status                                                       *
 393:../../../mod/flash/flash.c **** *                                                                              *
 394:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
 395:../../../mod/flash/flash.c **** *       Read the status register of the flash chip                             *
 396:../../../mod/flash/flash.c **** *                                                                              *
 397:../../../mod/flash/flash.c **** *******************************************************************************/
 398:../../../mod/flash/flash.c **** FLASH_STATUS flash_get_status
 399:../../../mod/flash/flash.c **** 	(
 400:../../../mod/flash/flash.c **** 	HFLASH_BUFFER* pflash_handle
 401:../../../mod/flash/flash.c ****     )
 402:../../../mod/flash/flash.c **** {
 403:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 404:../../../mod/flash/flash.c ****  Local variables 
 405:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 406:../../../mod/flash/flash.c **** HAL_StatusTypeDef hal_status[2];  /* Status codes returned by SPI HAL         */
 407:../../../mod/flash/flash.c **** uint8_t           flash_opcode;   /* Data to be transmitted over SPI          */
 408:../../../mod/flash/flash.c **** 
 409:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 410:../../../mod/flash/flash.c ****  Initialiazations 
 411:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 412:../../../mod/flash/flash.c **** flash_opcode = FLASH_OP_HW_RDSR;
 413:../../../mod/flash/flash.c **** 
 414:../../../mod/flash/flash.c **** 
 415:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 416:../../../mod/flash/flash.c ****  API function implementation 
 417:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 418:../../../mod/flash/flash.c **** 
 419:../../../mod/flash/flash.c **** /* Drive slave select line low */
 420:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
 421:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 422:../../../mod/flash/flash.c ****                    GPIO_PIN_RESET );
 423:../../../mod/flash/flash.c **** 
 424:../../../mod/flash/flash.c **** /* Send RDSR code to flash chip */
 425:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )        ,
 426:../../../mod/flash/flash.c ****                                   &flash_opcode         ,
 427:../../../mod/flash/flash.c ****                                   sizeof( flash_opcode ),
 428:../../../mod/flash/flash.c ****                                   HAL_DEFAULT_TIMEOUT );
 429:../../../mod/flash/flash.c **** 
 430:../../../mod/flash/flash.c **** /* Recieve status code */
ARM GAS  /tmp/ccKy2Hdq.s 			page 9


 431:../../../mod/flash/flash.c **** hal_status[1] = HAL_SPI_Receive( &( FLASH_SPI ),
 432:../../../mod/flash/flash.c ****                                  &( pflash_handle      -> status_register ),
 433:../../../mod/flash/flash.c ****                                  sizeof( pflash_handle -> status_register ),
 434:../../../mod/flash/flash.c **** 							     HAL_DEFAULT_TIMEOUT );
 435:../../../mod/flash/flash.c **** 
 436:../../../mod/flash/flash.c **** /* Drive slave select line high */
 437:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
 438:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 439:../../../mod/flash/flash.c ****                    GPIO_PIN_SET );
 440:../../../mod/flash/flash.c **** 
 441:../../../mod/flash/flash.c **** /* Return flash status code */
 442:../../../mod/flash/flash.c **** if ( hal_status[0] != HAL_OK || hal_status[1] != HAL_OK )
 443:../../../mod/flash/flash.c **** 	{
 444:../../../mod/flash/flash.c **** 	return FLASH_SPI_ERROR;
 445:../../../mod/flash/flash.c **** 	}
 446:../../../mod/flash/flash.c **** else
 447:../../../mod/flash/flash.c **** 	{
 448:../../../mod/flash/flash.c **** 	return FLASH_OK;
 449:../../../mod/flash/flash.c **** 	}
 450:../../../mod/flash/flash.c **** 
 451:../../../mod/flash/flash.c **** } /* flash_get_status */
 452:../../../mod/flash/flash.c **** 
 453:../../../mod/flash/flash.c **** 
 454:../../../mod/flash/flash.c **** /*******************************************************************************
 455:../../../mod/flash/flash.c **** *                                                                              *
 456:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
 457:../../../mod/flash/flash.c **** * 		flash_set_status                                                       *
 458:../../../mod/flash/flash.c **** *                                                                              *
 459:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
 460:../../../mod/flash/flash.c **** *       Writes to the status register                                          *
 461:../../../mod/flash/flash.c **** *                                                                              *
 462:../../../mod/flash/flash.c **** *******************************************************************************/
 463:../../../mod/flash/flash.c **** FLASH_STATUS flash_set_status
 464:../../../mod/flash/flash.c **** 	(
 465:../../../mod/flash/flash.c **** 	uint8_t        flash_status	
 466:../../../mod/flash/flash.c ****     )
 467:../../../mod/flash/flash.c **** {
 468:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 469:../../../mod/flash/flash.c ****  Local variables 
 470:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 471:../../../mod/flash/flash.c **** uint8_t hal_status   [3];   /* Status code returned by hal spi functions      */
 472:../../../mod/flash/flash.c **** uint8_t flash_opcodes[2];   /* Flash instruction cycle bytes                  */
 473:../../../mod/flash/flash.c **** 
 474:../../../mod/flash/flash.c **** 
 475:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 476:../../../mod/flash/flash.c ****  Initializations 
 477:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 478:../../../mod/flash/flash.c **** flash_opcodes[0] = FLASH_OP_HW_EWSR;
 479:../../../mod/flash/flash.c **** flash_opcodes[1] = FLASH_OP_HW_WRSR;
 480:../../../mod/flash/flash.c **** 
 481:../../../mod/flash/flash.c **** 
 482:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 483:../../../mod/flash/flash.c ****  Pre-processing 
 484:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 485:../../../mod/flash/flash.c **** if ( !( write_enabled ) )
 486:../../../mod/flash/flash.c **** 	{
 487:../../../mod/flash/flash.c **** 	return FLASH_WRITE_PROTECTED;
ARM GAS  /tmp/ccKy2Hdq.s 			page 10


 488:../../../mod/flash/flash.c **** 	}
 489:../../../mod/flash/flash.c **** 
 490:../../../mod/flash/flash.c **** 
 491:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 492:../../../mod/flash/flash.c ****  API function implementation 
 493:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 494:../../../mod/flash/flash.c **** 
 495:../../../mod/flash/flash.c **** /* Enable write to status register */
 496:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
 497:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 498:../../../mod/flash/flash.c ****                    GPIO_PIN_RESET );
 499:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )   ,
 500:../../../mod/flash/flash.c ****                                   &flash_opcodes[0],
 501:../../../mod/flash/flash.c ****                                   sizeof( uint8_t ),
 502:../../../mod/flash/flash.c ****                                   HAL_DEFAULT_TIMEOUT );
 503:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
 504:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 505:../../../mod/flash/flash.c ****                    GPIO_PIN_SET );
 506:../../../mod/flash/flash.c **** 
 507:../../../mod/flash/flash.c **** /* Write the Data to the status register */
 508:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
 509:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 510:../../../mod/flash/flash.c ****                    GPIO_PIN_RESET );
 511:../../../mod/flash/flash.c **** hal_status[1] = HAL_SPI_Transmit( &( FLASH_SPI )   ,
 512:../../../mod/flash/flash.c ****                                   &flash_opcodes[1],
 513:../../../mod/flash/flash.c ****                                   sizeof( uint8_t ),
 514:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 515:../../../mod/flash/flash.c **** hal_status[2] = HAL_SPI_Transmit( &( FLASH_SPI )        ,
 516:../../../mod/flash/flash.c ****                                   &flash_status         ,
 517:../../../mod/flash/flash.c ****                                   sizeof( flash_status ),
 518:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 519:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
 520:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 521:../../../mod/flash/flash.c ****                    GPIO_PIN_SET );
 522:../../../mod/flash/flash.c **** 
 523:../../../mod/flash/flash.c **** /* Return flash status */
 524:../../../mod/flash/flash.c **** if ( hal_status[0] != HAL_OK ||
 525:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 526:../../../mod/flash/flash.c **** 	 hal_status[2] != HAL_OK )
 527:../../../mod/flash/flash.c **** 	{
 528:../../../mod/flash/flash.c **** 	return FLASH_SPI_ERROR;
 529:../../../mod/flash/flash.c **** 	}
 530:../../../mod/flash/flash.c **** else
 531:../../../mod/flash/flash.c **** 	{
 532:../../../mod/flash/flash.c **** 	return FLASH_OK;
 533:../../../mod/flash/flash.c **** 	}
 534:../../../mod/flash/flash.c **** 
 535:../../../mod/flash/flash.c **** } /* flash_set_status */
 536:../../../mod/flash/flash.c **** 
 537:../../../mod/flash/flash.c **** 
 538:../../../mod/flash/flash.c **** /*******************************************************************************
 539:../../../mod/flash/flash.c **** *                                                                              *
 540:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   *
 541:../../../mod/flash/flash.c **** * 		flash_is_flash_busy                                                    *
 542:../../../mod/flash/flash.c **** *                                                                              *
 543:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 *
 544:../../../mod/flash/flash.c **** *       Polls the flash status register to see if the chip is busy. False      *
ARM GAS  /tmp/ccKy2Hdq.s 			page 11


 545:../../../mod/flash/flash.c **** *       boolean return value indicates the chip is ready for write operations  *
 546:../../../mod/flash/flash.c **** *                                                                              *
 547:../../../mod/flash/flash.c **** *******************************************************************************/
 548:../../../mod/flash/flash.c **** bool flash_is_flash_busy
 549:../../../mod/flash/flash.c **** 	(
 550:../../../mod/flash/flash.c **** 	void
 551:../../../mod/flash/flash.c **** 	)
 552:../../../mod/flash/flash.c **** {
 553:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 554:../../../mod/flash/flash.c ****  Local variables  
 555:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 556:../../../mod/flash/flash.c **** HFLASH_BUFFER flash_handle; /* Flash handle to store status reg contents      */
 557:../../../mod/flash/flash.c **** FLASH_STATUS  flash_status; /* Flash API return codes                         */
 558:../../../mod/flash/flash.c **** 
 559:../../../mod/flash/flash.c **** 
 560:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 561:../../../mod/flash/flash.c ****  Initializations 
 562:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 563:../../../mod/flash/flash.c **** flash_status                 = FLASH_OK;
 564:../../../mod/flash/flash.c **** flash_handle.status_register = 0xFF;
 565:../../../mod/flash/flash.c **** 
 566:../../../mod/flash/flash.c **** 
 567:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 568:../../../mod/flash/flash.c ****  Implementation 
 569:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 570:../../../mod/flash/flash.c **** 
 571:../../../mod/flash/flash.c **** /* Read status register */
 572:../../../mod/flash/flash.c **** flash_status = flash_get_status( &flash_handle );
 573:../../../mod/flash/flash.c **** if      ( flash_status != FLASH_OK                          )
 574:../../../mod/flash/flash.c **** 	{
 575:../../../mod/flash/flash.c **** 	return FLASH_BUSY;
 576:../../../mod/flash/flash.c **** 	}
 577:../../../mod/flash/flash.c **** else if ( flash_handle.status_register & FLASH_BUSY_BITMASK )
 578:../../../mod/flash/flash.c **** 	{
 579:../../../mod/flash/flash.c **** 	return FLASH_BUSY;
 580:../../../mod/flash/flash.c **** 	}
 581:../../../mod/flash/flash.c **** else
 582:../../../mod/flash/flash.c **** 	{
 583:../../../mod/flash/flash.c **** 	return FLASH_READY;
 584:../../../mod/flash/flash.c **** 	}
 585:../../../mod/flash/flash.c **** 
 586:../../../mod/flash/flash.c **** } /* flash_is_flash_busy */
 587:../../../mod/flash/flash.c **** 
 588:../../../mod/flash/flash.c **** 
 589:../../../mod/flash/flash.c **** /*******************************************************************************
 590:../../../mod/flash/flash.c **** *                                                                              *
 591:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
 592:../../../mod/flash/flash.c **** * 		flash_write_enable                                                     *
 593:../../../mod/flash/flash.c **** *                                                                              *
 594:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
 595:../../../mod/flash/flash.c **** *       Enable writing to the external flash chip by configuring the global    *
 596:../../../mod/flash/flash.c **** *       write protection variable                                              *
 597:../../../mod/flash/flash.c **** *                                                                              *
 598:../../../mod/flash/flash.c **** *******************************************************************************/
 599:../../../mod/flash/flash.c **** void flash_write_enable
 600:../../../mod/flash/flash.c **** 	(
 601:../../../mod/flash/flash.c **** 	void
ARM GAS  /tmp/ccKy2Hdq.s 			page 12


 602:../../../mod/flash/flash.c **** 	)
 603:../../../mod/flash/flash.c **** {
 604:../../../mod/flash/flash.c **** write_enabled = true;
 605:../../../mod/flash/flash.c **** } /* flash_write_enable */
 606:../../../mod/flash/flash.c **** 
 607:../../../mod/flash/flash.c **** 
 608:../../../mod/flash/flash.c **** /*******************************************************************************
 609:../../../mod/flash/flash.c **** *                                                                              *
 610:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
 611:../../../mod/flash/flash.c **** * 		flash_write_disable                                                    *
 612:../../../mod/flash/flash.c **** *                                                                              *
 613:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
 614:../../../mod/flash/flash.c **** *       Disable writing to the external flash chip                             *
 615:../../../mod/flash/flash.c **** *                                                                              *
 616:../../../mod/flash/flash.c **** *******************************************************************************/
 617:../../../mod/flash/flash.c **** void flash_write_disable
 618:../../../mod/flash/flash.c ****     (
 619:../../../mod/flash/flash.c ****     void 
 620:../../../mod/flash/flash.c ****     )
 621:../../../mod/flash/flash.c **** {
 622:../../../mod/flash/flash.c **** write_enabled = false;
 623:../../../mod/flash/flash.c **** } /* flash_write_disable */
 624:../../../mod/flash/flash.c **** 
 625:../../../mod/flash/flash.c **** 
 626:../../../mod/flash/flash.c **** /*******************************************************************************
 627:../../../mod/flash/flash.c **** *                                                                              *
 628:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
 629:../../../mod/flash/flash.c **** * 		flash_write_byte                                                       *
 630:../../../mod/flash/flash.c **** *                                                                              *
 631:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
 632:../../../mod/flash/flash.c **** *       writes a byte to the external flash                                    *
 633:../../../mod/flash/flash.c **** *                                                                              *
 634:../../../mod/flash/flash.c **** *******************************************************************************/
 635:../../../mod/flash/flash.c **** FLASH_STATUS flash_write_byte 
 636:../../../mod/flash/flash.c ****     (
 637:../../../mod/flash/flash.c **** 	HFLASH_BUFFER* pflash_handle,
 638:../../../mod/flash/flash.c **** 	uint8_t        byte
 639:../../../mod/flash/flash.c ****     )
 640:../../../mod/flash/flash.c **** {
 641:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 642:../../../mod/flash/flash.c ****  Local variables 
 643:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 644:../../../mod/flash/flash.c **** HAL_StatusTypeDef hal_status[3];    /* Status code return by hal functions    */
 645:../../../mod/flash/flash.c **** FLASH_STATUS      flash_status;     /* Status code returned by flash API      */
 646:../../../mod/flash/flash.c **** uint8_t           flash_opcode;     /* Data to be transmitted over SPI        */
 647:../../../mod/flash/flash.c **** uint8_t           address[3];       /* Flash memory address in byte form      */
 648:../../../mod/flash/flash.c **** 
 649:../../../mod/flash/flash.c **** 
 650:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 651:../../../mod/flash/flash.c ****  Initializations 
 652:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 653:../../../mod/flash/flash.c **** flash_status  = FLASH_OK;
 654:../../../mod/flash/flash.c **** flash_opcode  = FLASH_OP_HW_BYTE_PROGRAM;
 655:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 656:../../../mod/flash/flash.c **** 
 657:../../../mod/flash/flash.c **** 
 658:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
ARM GAS  /tmp/ccKy2Hdq.s 			page 13


 659:../../../mod/flash/flash.c ****  Pre-processing 
 660:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 661:../../../mod/flash/flash.c **** 
 662:../../../mod/flash/flash.c **** /* Check if write_enabled */
 663:../../../mod/flash/flash.c **** if( !( write_enabled ) )
 664:../../../mod/flash/flash.c **** 	{
 665:../../../mod/flash/flash.c **** 	return FLASH_WRITE_PROTECTED;
 666:../../../mod/flash/flash.c **** 	}
 667:../../../mod/flash/flash.c **** 
 668:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 669:../../../mod/flash/flash.c ****  API function implementation
 670:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 671:../../../mod/flash/flash.c **** 
 672:../../../mod/flash/flash.c **** /* Enable the chip for writing */
 673:../../../mod/flash/flash.c **** flash_status = write_enable();
 674:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 675:../../../mod/flash/flash.c **** 	{
 676:../../../mod/flash/flash.c **** 	return FLASH_CANNOT_WRITE_ENABLE;
 677:../../../mod/flash/flash.c **** 	}
 678:../../../mod/flash/flash.c **** 
 679:../../../mod/flash/flash.c **** /* Send the byte program command to the flash over SPI */
 680:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_RESET );
 681:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )       ,
 682:../../../mod/flash/flash.c **** 							      &flash_opcode        ,
 683:../../../mod/flash/flash.c **** 							      sizeof( flash_opcode ),
 684:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 685:../../../mod/flash/flash.c **** 
 686:../../../mod/flash/flash.c **** /* Send address bytes */
 687:../../../mod/flash/flash.c **** hal_status[1] = HAL_SPI_Transmit( &( FLASH_SPI )   ,
 688:../../../mod/flash/flash.c **** 							      &address[0]      ,
 689:../../../mod/flash/flash.c **** 							      sizeof( address ),
 690:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 691:../../../mod/flash/flash.c **** 
 692:../../../mod/flash/flash.c **** /* Write bytes */
 693:../../../mod/flash/flash.c **** hal_status[2] = HAL_SPI_Transmit( &( FLASH_SPI ),
 694:../../../mod/flash/flash.c **** 							     &byte          ,
 695:../../../mod/flash/flash.c **** 							     sizeof( byte ) ,
 696:../../../mod/flash/flash.c **** 							     HAL_FLASH_TIMEOUT );
 697:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_SET );
 698:../../../mod/flash/flash.c **** 
 699:../../../mod/flash/flash.c **** /* Return flash status */
 700:../../../mod/flash/flash.c **** if ( hal_status[0] != HAL_OK ||
 701:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 702:../../../mod/flash/flash.c **** 	 hal_status[2] != HAL_OK )
 703:../../../mod/flash/flash.c **** 	{
 704:../../../mod/flash/flash.c **** 	return FLASH_SPI_ERROR;
 705:../../../mod/flash/flash.c **** 	}
 706:../../../mod/flash/flash.c **** else
 707:../../../mod/flash/flash.c **** 	{
 708:../../../mod/flash/flash.c **** 	return FLASH_OK;
 709:../../../mod/flash/flash.c **** 	}
 710:../../../mod/flash/flash.c **** 
 711:../../../mod/flash/flash.c **** } /* flash_write_byte */
 712:../../../mod/flash/flash.c **** 
 713:../../../mod/flash/flash.c **** 
 714:../../../mod/flash/flash.c **** /*******************************************************************************
 715:../../../mod/flash/flash.c **** *                                                                              *
ARM GAS  /tmp/ccKy2Hdq.s 			page 14


 716:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
 717:../../../mod/flash/flash.c **** * 		flash_write                                                            *
 718:../../../mod/flash/flash.c **** *                                                                              *
 719:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
 720:../../../mod/flash/flash.c **** *       writes bytes from a flash buffer to the external flash                 *
 721:../../../mod/flash/flash.c **** *                                                                              *
 722:../../../mod/flash/flash.c **** *******************************************************************************/
 723:../../../mod/flash/flash.c **** FLASH_STATUS flash_write 
 724:../../../mod/flash/flash.c ****     (
 725:../../../mod/flash/flash.c **** 	HFLASH_BUFFER* pflash_handle
 726:../../../mod/flash/flash.c ****     )
 727:../../../mod/flash/flash.c **** {
 728:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 729:../../../mod/flash/flash.c ****  Local variables 
 730:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 731:../../../mod/flash/flash.c **** HAL_StatusTypeDef hal_status[3];    /* Status codes returned by HAL           */
 732:../../../mod/flash/flash.c **** FLASH_STATUS      flash_status;     /* Status codes returned by flash API     */
 733:../../../mod/flash/flash.c **** uint8_t           flash_opcode;     /* Opcode for flash instructions          */
 734:../../../mod/flash/flash.c **** uint32_t          timeout;          /* Timeout for flash write calls          */
 735:../../../mod/flash/flash.c **** uint32_t          timeout_ctr;      /* Counter to trigger timeout             */
 736:../../../mod/flash/flash.c **** uint8_t*          pbuffer;          /* Pointer to data in flash buffer        */
 737:../../../mod/flash/flash.c **** uint8_t           address_bytes[3]; /* Flash memory address in byte form      */
 738:../../../mod/flash/flash.c **** 
 739:../../../mod/flash/flash.c **** 
 740:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 741:../../../mod/flash/flash.c ****  Initializations 
 742:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 743:../../../mod/flash/flash.c **** flash_opcode  = FLASH_OP_HW_AAI_PROGRAM; 
 744:../../../mod/flash/flash.c **** flash_status  = FLASH_OK;
 745:../../../mod/flash/flash.c **** timeout       = pflash_handle -> num_bytes; /* 1 ms/byte timeout */
 746:../../../mod/flash/flash.c **** timeout_ctr   = 0;
 747:../../../mod/flash/flash.c **** pbuffer       = pflash_handle -> pbuffer;
 748:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address_bytes[0] );
 749:../../../mod/flash/flash.c **** 
 750:../../../mod/flash/flash.c **** 
 751:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 752:../../../mod/flash/flash.c ****  Pre-processing 
 753:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 754:../../../mod/flash/flash.c **** 
 755:../../../mod/flash/flash.c **** /* Check if write_enabled */
 756:../../../mod/flash/flash.c **** if( !( write_enabled ) )
 757:../../../mod/flash/flash.c **** 	{
 758:../../../mod/flash/flash.c **** 	return FLASH_WRITE_PROTECTED;
 759:../../../mod/flash/flash.c **** 	}
 760:../../../mod/flash/flash.c **** 
 761:../../../mod/flash/flash.c **** /* Check for 1/0 byte edge case */
 762:../../../mod/flash/flash.c **** if      ( pflash_handle -> num_bytes == 1 )
 763:../../../mod/flash/flash.c **** 	{
 764:../../../mod/flash/flash.c **** 	return flash_write_byte( pflash_handle, *( pflash_handle -> pbuffer ) );
 765:../../../mod/flash/flash.c **** 	}
 766:../../../mod/flash/flash.c **** else if ( pflash_handle -> num_bytes == 0 )
 767:../../../mod/flash/flash.c **** 	{
 768:../../../mod/flash/flash.c **** 	return FLASH_ERROR_MISSING_DATA;
 769:../../../mod/flash/flash.c **** 	}
 770:../../../mod/flash/flash.c **** 
 771:../../../mod/flash/flash.c **** 
 772:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
ARM GAS  /tmp/ccKy2Hdq.s 			page 15


 773:../../../mod/flash/flash.c ****  API function implementation
 774:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 775:../../../mod/flash/flash.c **** 
 776:../../../mod/flash/flash.c **** /* Enable the chip for writing */
 777:../../../mod/flash/flash.c **** flash_status = write_enable();
 778:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 779:../../../mod/flash/flash.c **** 	{
 780:../../../mod/flash/flash.c **** 	return FLASH_CANNOT_WRITE_ENABLE;
 781:../../../mod/flash/flash.c **** 	}
 782:../../../mod/flash/flash.c **** 
 783:../../../mod/flash/flash.c **** /* Initial SPI transmission */
 784:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_RESET );
 785:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )        ,
 786:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 787:../../../mod/flash/flash.c **** 							      sizeof( flash_opcode ),
 788:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 789:../../../mod/flash/flash.c **** hal_status[1] = HAL_SPI_Transmit( &( FLASH_SPI )         ,
 790:../../../mod/flash/flash.c **** 							      &address_bytes[0]      ,
 791:../../../mod/flash/flash.c **** 							      sizeof( address_bytes ),
 792:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 793:../../../mod/flash/flash.c **** hal_status[2] = HAL_SPI_Transmit( &( FLASH_SPI ), 
 794:../../../mod/flash/flash.c ****                                   pbuffer       ,
 795:../../../mod/flash/flash.c **** 								  2             , 
 796:../../../mod/flash/flash.c **** 								  HAL_DEFAULT_TIMEOUT );						
 797:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_SET );
 798:../../../mod/flash/flash.c **** 
 799:../../../mod/flash/flash.c **** /* Check for SPI errors */
 800:../../../mod/flash/flash.c **** if ( hal_status[0] != HAL_OK ||
 801:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 802:../../../mod/flash/flash.c **** 	 hal_status[2] != HAL_OK )
 803:../../../mod/flash/flash.c **** 	{
 804:../../../mod/flash/flash.c **** 	return FLASH_SPI_ERROR;
 805:../../../mod/flash/flash.c **** 	}
 806:../../../mod/flash/flash.c **** 
 807:../../../mod/flash/flash.c **** /* Transmit remaining data */
 808:../../../mod/flash/flash.c **** for ( int i = 2; i < pflash_handle -> num_bytes; i += 2 )
 809:../../../mod/flash/flash.c **** 	{
 810:../../../mod/flash/flash.c **** 	/* Setup buffer pointer  */
 811:../../../mod/flash/flash.c **** 	pbuffer += 2;
 812:../../../mod/flash/flash.c **** 
 813:../../../mod/flash/flash.c **** 	/* Wait for flash to be ready */
 814:../../../mod/flash/flash.c **** 	while( flash_is_flash_busy() == FLASH_BUSY )
 815:../../../mod/flash/flash.c **** 		{
 816:../../../mod/flash/flash.c **** 		if ( timeout_ctr >= timeout )
 817:../../../mod/flash/flash.c **** 			{
 818:../../../mod/flash/flash.c **** 			return FLASH_TIMEOUT;
 819:../../../mod/flash/flash.c **** 			}
 820:../../../mod/flash/flash.c **** 		else
 821:../../../mod/flash/flash.c **** 			{
 822:../../../mod/flash/flash.c **** 			timeout_ctr++;
 823:../../../mod/flash/flash.c **** 			HAL_Delay( 1 );
 824:../../../mod/flash/flash.c **** 			}
 825:../../../mod/flash/flash.c **** 		}
 826:../../../mod/flash/flash.c **** 
 827:../../../mod/flash/flash.c **** 	/* SPI Transmission */	
 828:../../../mod/flash/flash.c **** 	HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_RESET );
 829:../../../mod/flash/flash.c **** 	hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )        ,
ARM GAS  /tmp/ccKy2Hdq.s 			page 16


 830:../../../mod/flash/flash.c **** 									&flash_opcode         ,
 831:../../../mod/flash/flash.c **** 									sizeof( flash_opcode ),
 832:../../../mod/flash/flash.c **** 									HAL_DEFAULT_TIMEOUT );
 833:../../../mod/flash/flash.c **** 	hal_status[1] = HAL_SPI_Transmit( &( FLASH_SPI ), 
 834:../../../mod/flash/flash.c **** 									pbuffer       ,
 835:../../../mod/flash/flash.c **** 									2             , 
 836:../../../mod/flash/flash.c **** 									HAL_DEFAULT_TIMEOUT );						
 837:../../../mod/flash/flash.c **** 	HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_SET );
 838:../../../mod/flash/flash.c **** 
 839:../../../mod/flash/flash.c **** 	/* Check for errors */
 840:../../../mod/flash/flash.c **** 	if ( hal_status[0] != HAL_OK || hal_status[1] != HAL_OK )
 841:../../../mod/flash/flash.c **** 		{
 842:../../../mod/flash/flash.c **** 		return FLASH_WRITE_ERROR;
 843:../../../mod/flash/flash.c **** 		}
 844:../../../mod/flash/flash.c **** 	} /* for ( i < pflash_handle -> num_bytes )*/
 845:../../../mod/flash/flash.c **** 
 846:../../../mod/flash/flash.c **** /* Wait for AAI to complete */
 847:../../../mod/flash/flash.c **** while ( flash_is_flash_busy() == FLASH_BUSY ){}
 848:../../../mod/flash/flash.c **** 
 849:../../../mod/flash/flash.c **** /* Terminate AAI Programming */
 850:../../../mod/flash/flash.c **** flash_status = write_disable();
 851:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 852:../../../mod/flash/flash.c **** 	{
 853:../../../mod/flash/flash.c **** 	return FLASH_CANNOT_EXIT_AAI;
 854:../../../mod/flash/flash.c **** 	}
 855:../../../mod/flash/flash.c **** 
 856:../../../mod/flash/flash.c **** /* Wait for WRDI to complete */
 857:../../../mod/flash/flash.c **** while ( flash_is_flash_busy() == FLASH_BUSY ){}
 858:../../../mod/flash/flash.c **** 
 859:../../../mod/flash/flash.c **** /* Transmit final byte if num_bytes is odd */
 860:../../../mod/flash/flash.c **** if ( ( pflash_handle -> num_bytes ) %2 == 1 )
 861:../../../mod/flash/flash.c **** 	{
 862:../../../mod/flash/flash.c **** 	pbuffer += 1;
 863:../../../mod/flash/flash.c **** 	return flash_write_byte( pflash_handle, *pbuffer );
 864:../../../mod/flash/flash.c **** 	}
 865:../../../mod/flash/flash.c **** else
 866:../../../mod/flash/flash.c **** 	{
 867:../../../mod/flash/flash.c **** 	/* Flash write successful */
 868:../../../mod/flash/flash.c **** 	return FLASH_OK;
 869:../../../mod/flash/flash.c **** 	}
 870:../../../mod/flash/flash.c **** 
 871:../../../mod/flash/flash.c **** } /* flash_write */
 872:../../../mod/flash/flash.c **** 
 873:../../../mod/flash/flash.c **** 
 874:../../../mod/flash/flash.c **** /*******************************************************************************
 875:../../../mod/flash/flash.c **** *                                                                              *
 876:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
 877:../../../mod/flash/flash.c **** * 		flash_read                                                             *
 878:../../../mod/flash/flash.c **** *                                                                              *
 879:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
 880:../../../mod/flash/flash.c **** *       reads a specified number of bytes using a flash buffer                 *
 881:../../../mod/flash/flash.c **** *                                                                              *
 882:../../../mod/flash/flash.c **** *******************************************************************************/
 883:../../../mod/flash/flash.c **** FLASH_STATUS flash_read
 884:../../../mod/flash/flash.c ****     (
 885:../../../mod/flash/flash.c **** 	HFLASH_BUFFER* pflash_handle,
 886:../../../mod/flash/flash.c ****     uint32_t       num_bytes
ARM GAS  /tmp/ccKy2Hdq.s 			page 17


 887:../../../mod/flash/flash.c ****     )
 888:../../../mod/flash/flash.c **** {
 889:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 890:../../../mod/flash/flash.c ****  Local variables 
 891:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 892:../../../mod/flash/flash.c **** HAL_StatusTypeDef hal_status[4]; /* Status code return by hal spi functions   */
 893:../../../mod/flash/flash.c **** uint8_t           flash_opcode;  /* Data to be transmitted over SPI           */
 894:../../../mod/flash/flash.c **** uint8_t           address[3];    /* Flash address in byte format              */
 895:../../../mod/flash/flash.c **** uint8_t*          pbuffer;       /* Pointer to position in output buffer      */
 896:../../../mod/flash/flash.c **** uint8_t           dummy_byte;    /* Dummy byte needed for high speed read     */
 897:../../../mod/flash/flash.c **** 
 898:../../../mod/flash/flash.c **** 
 899:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 900:../../../mod/flash/flash.c ****  Initializations 
 901:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 902:../../../mod/flash/flash.c **** flash_opcode = FLASH_OP_HW_READ_HS;
 903:../../../mod/flash/flash.c **** dummy_byte   = 0;
 904:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 905:../../../mod/flash/flash.c **** 
 906:../../../mod/flash/flash.c **** 
 907:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 908:../../../mod/flash/flash.c ****  API function implementation
 909:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 910:../../../mod/flash/flash.c **** 
 911:../../../mod/flash/flash.c **** /* Initiate SPI transmission */
 912:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_RESET );
 913:../../../mod/flash/flash.c **** 
 914:../../../mod/flash/flash.c **** /* Command opcode */
 915:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )        ,
 916:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 917:../../../mod/flash/flash.c **** 							      sizeof( flash_opcode ),
 918:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 919:../../../mod/flash/flash.c **** 
 920:../../../mod/flash/flash.c **** /* Address */
 921:../../../mod/flash/flash.c **** hal_status[1] = HAL_SPI_Transmit( &( FLASH_SPI )   ,
 922:../../../mod/flash/flash.c **** 							      &( address[0] )  ,
 923:../../../mod/flash/flash.c **** 							      sizeof( address ),
 924:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 925:../../../mod/flash/flash.c **** 
 926:../../../mod/flash/flash.c **** /* Dummy Cycle */
 927:../../../mod/flash/flash.c **** hal_status[2] = HAL_SPI_Transmit( &( FLASH_SPI )   ,
 928:../../../mod/flash/flash.c **** 							      &( dummy_byte )  ,
 929:../../../mod/flash/flash.c **** 							      sizeof( dummy_byte ),
 930:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
 931:../../../mod/flash/flash.c **** 
 932:../../../mod/flash/flash.c **** /* Check for SPI errors */
 933:../../../mod/flash/flash.c **** if ( hal_status[0] != HAL_OK || 
 934:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK || 
 935:../../../mod/flash/flash.c **** 	 hal_status[2] != HAL_OK )
 936:../../../mod/flash/flash.c **** 	{   
 937:../../../mod/flash/flash.c **** 	return FLASH_SPI_ERROR;
 938:../../../mod/flash/flash.c **** 	}
 939:../../../mod/flash/flash.c **** 
 940:../../../mod/flash/flash.c **** /* Recieve output into buffer*/
 941:../../../mod/flash/flash.c **** for ( int i = 0; i < num_bytes; ++i )
 942:../../../mod/flash/flash.c **** 	{
 943:../../../mod/flash/flash.c **** 	pbuffer = ( pflash_handle -> pbuffer ) + i;
ARM GAS  /tmp/ccKy2Hdq.s 			page 18


 944:../../../mod/flash/flash.c **** 	hal_status[3] = HAL_SPI_Receive( &( FLASH_SPI )      ,
 945:../../../mod/flash/flash.c **** 								     pbuffer             ,
 946:../../../mod/flash/flash.c **** 								     sizeof( uint8_t )   ,
 947:../../../mod/flash/flash.c **** 								     HAL_DEFAULT_TIMEOUT );
 948:../../../mod/flash/flash.c **** 
 949:../../../mod/flash/flash.c **** 	if ( hal_status[3] != HAL_OK )
 950:../../../mod/flash/flash.c **** 		{
 951:../../../mod/flash/flash.c **** 		return FLASH_SPI_ERROR;
 952:../../../mod/flash/flash.c **** 		}
 953:../../../mod/flash/flash.c **** 	}
 954:../../../mod/flash/flash.c **** 
 955:../../../mod/flash/flash.c **** /* Drive chip enable line high */
 956:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_SET );
 957:../../../mod/flash/flash.c **** 
 958:../../../mod/flash/flash.c **** /* Flash read successful */
 959:../../../mod/flash/flash.c **** return FLASH_OK;
 960:../../../mod/flash/flash.c **** 
 961:../../../mod/flash/flash.c **** } /* flash_read */
 962:../../../mod/flash/flash.c **** 
 963:../../../mod/flash/flash.c **** 
 964:../../../mod/flash/flash.c **** /*******************************************************************************
 965:../../../mod/flash/flash.c **** *                                                                              *
 966:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   *
 967:../../../mod/flash/flash.c **** * 		flash_erase                                                            *
 968:../../../mod/flash/flash.c **** *                                                                              *
 969:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 *
 970:../../../mod/flash/flash.c **** *       erases the entire flash chip                                           *
 971:../../../mod/flash/flash.c **** *                                                                              *
 972:../../../mod/flash/flash.c **** *******************************************************************************/
 973:../../../mod/flash/flash.c **** FLASH_STATUS flash_erase
 974:../../../mod/flash/flash.c ****     (
 975:../../../mod/flash/flash.c ****     HFLASH_BUFFER* pflash_handle	
 976:../../../mod/flash/flash.c ****     )
 977:../../../mod/flash/flash.c **** {
 978:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 979:../../../mod/flash/flash.c ****  Local variables 
 980:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 981:../../../mod/flash/flash.c **** int8_t       hal_status;    /* Status code return by hal spi functions        */
 982:../../../mod/flash/flash.c **** uint8_t      flash_opcode;  /* Data to be transmitted over SPI                */
 983:../../../mod/flash/flash.c **** FLASH_STATUS flash_status;
 984:../../../mod/flash/flash.c **** 
 985:../../../mod/flash/flash.c **** 
 986:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 987:../../../mod/flash/flash.c ****  Initializations 
 988:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 989:../../../mod/flash/flash.c **** flash_opcode = FLASH_OP_HW_FULL_ERASE;
 990:../../../mod/flash/flash.c **** 
 991:../../../mod/flash/flash.c **** 
 992:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 993:../../../mod/flash/flash.c ****  Pre-processing 
 994:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
 995:../../../mod/flash/flash.c **** 
 996:../../../mod/flash/flash.c **** /* Check if write_enabled */
 997:../../../mod/flash/flash.c **** if( !( write_enabled ) )
 998:../../../mod/flash/flash.c ****     {
 999:../../../mod/flash/flash.c ****     return FLASH_WRITE_PROTECTED;
1000:../../../mod/flash/flash.c ****     }
ARM GAS  /tmp/ccKy2Hdq.s 			page 19


1001:../../../mod/flash/flash.c **** 
1002:../../../mod/flash/flash.c **** 
1003:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1004:../../../mod/flash/flash.c ****  API function implementation
1005:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1006:../../../mod/flash/flash.c **** 
1007:../../../mod/flash/flash.c **** /* Enable writing to flash */
1008:../../../mod/flash/flash.c **** flash_status = write_enable();
1009:../../../mod/flash/flash.c **** 
1010:../../../mod/flash/flash.c **** /* Full chip erase */
1011:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_RESET );
1012:../../../mod/flash/flash.c **** hal_status = HAL_SPI_Transmit( &( FLASH_SPI )        ,
1013:../../../mod/flash/flash.c **** 							   &flash_opcode         ,
1014:../../../mod/flash/flash.c **** 							   sizeof( flash_opcode ),
1015:../../../mod/flash/flash.c **** 							   HAL_DEFAULT_TIMEOUT );
1016:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_SET );
1017:../../../mod/flash/flash.c **** 
1018:../../../mod/flash/flash.c **** /* Return status code */
1019:../../../mod/flash/flash.c **** if      ( hal_status   != HAL_OK   )
1020:../../../mod/flash/flash.c **** 	{
1021:../../../mod/flash/flash.c **** 	return FLASH_SPI_ERROR;
1022:../../../mod/flash/flash.c **** 	}
1023:../../../mod/flash/flash.c **** else if ( flash_status != FLASH_OK )
1024:../../../mod/flash/flash.c **** 	{
1025:../../../mod/flash/flash.c **** 	return FLASH_FAIL;
1026:../../../mod/flash/flash.c **** 	}
1027:../../../mod/flash/flash.c **** else
1028:../../../mod/flash/flash.c **** 	{
1029:../../../mod/flash/flash.c **** 	return FLASH_OK;
1030:../../../mod/flash/flash.c **** 	}
1031:../../../mod/flash/flash.c **** 
1032:../../../mod/flash/flash.c **** } /* flash_erase */
1033:../../../mod/flash/flash.c **** 
1034:../../../mod/flash/flash.c **** 
1035:../../../mod/flash/flash.c **** /*******************************************************************************
1036:../../../mod/flash/flash.c **** *                                                                              *
1037:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   *
1038:../../../mod/flash/flash.c **** * 		flash_block_erase                                                      *
1039:../../../mod/flash/flash.c **** *                                                                              *
1040:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 *
1041:../../../mod/flash/flash.c **** *       Erase a block of flash                                                 *
1042:../../../mod/flash/flash.c **** *                                                                              *
1043:../../../mod/flash/flash.c **** *******************************************************************************/
1044:../../../mod/flash/flash.c **** FLASH_STATUS flash_block_erase
1045:../../../mod/flash/flash.c **** 	(
1046:../../../mod/flash/flash.c **** 	FLASH_BLOCK      flash_block_num, /* Block of flash to erase */
1047:../../../mod/flash/flash.c **** 	FLASH_BLOCK_SIZE size             /* Size of block           */
1048:../../../mod/flash/flash.c **** 	)
1049:../../../mod/flash/flash.c **** {
1050:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1051:../../../mod/flash/flash.c ****  Local variables 
1052:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1053:../../../mod/flash/flash.c **** int8_t       hal_status[2];       /* Status code return by hal spi functions  */
1054:../../../mod/flash/flash.c **** uint8_t      flash_opcode;        /* Data to be transmitted over SPI          */
1055:../../../mod/flash/flash.c **** FLASH_STATUS flash_status;        /* Return codes from flash API              */
1056:../../../mod/flash/flash.c **** uint32_t     flash_addr;          /* Address of block to erase                */
1057:../../../mod/flash/flash.c **** uint8_t      flash_addr_bytes[3]; /* Address of block to erase in byte form   */
ARM GAS  /tmp/ccKy2Hdq.s 			page 20


1058:../../../mod/flash/flash.c **** 
1059:../../../mod/flash/flash.c **** 
1060:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1061:../../../mod/flash/flash.c ****  Initializations 
1062:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1063:../../../mod/flash/flash.c **** flash_status = FLASH_OK;
1064:../../../mod/flash/flash.c **** 
1065:../../../mod/flash/flash.c **** 
1066:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1067:../../../mod/flash/flash.c ****  Pre-processing 
1068:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1069:../../../mod/flash/flash.c **** 
1070:../../../mod/flash/flash.c **** /* Determine block setting */
1071:../../../mod/flash/flash.c **** switch( size )
1072:../../../mod/flash/flash.c **** 	{
1073:../../../mod/flash/flash.c **** 	case FLASH_BLOCK_4K:
1074:../../../mod/flash/flash.c **** 		{
1075:../../../mod/flash/flash.c **** 		flash_opcode = FLASH_OP_HW_4K_ERASE;
1076:../../../mod/flash/flash.c **** 		flash_addr   = flash_block_num*(0x1000);
1077:../../../mod/flash/flash.c **** 		address_to_bytes( flash_addr, &flash_addr_bytes[0] );
1078:../../../mod/flash/flash.c **** 		break;
1079:../../../mod/flash/flash.c **** 		}
1080:../../../mod/flash/flash.c **** 
1081:../../../mod/flash/flash.c **** 	case FLASH_BLOCK_32K:
1082:../../../mod/flash/flash.c **** 		{
1083:../../../mod/flash/flash.c **** 		flash_opcode = FLASH_OP_HW_32K_ERASE;
1084:../../../mod/flash/flash.c **** 		flash_addr   = flash_block_num*(0x8000);
1085:../../../mod/flash/flash.c **** 		address_to_bytes( flash_addr, &flash_addr_bytes[0] );
1086:../../../mod/flash/flash.c **** 		break;
1087:../../../mod/flash/flash.c **** 		}
1088:../../../mod/flash/flash.c **** 
1089:../../../mod/flash/flash.c **** 	case FLASH_BLOCK_64K:
1090:../../../mod/flash/flash.c **** 		{
1091:../../../mod/flash/flash.c **** 		flash_opcode = FLASH_OP_HW_64K_ERASE;
1092:../../../mod/flash/flash.c **** 		flash_addr   = flash_block_num*(0x10000);
1093:../../../mod/flash/flash.c **** 		address_to_bytes( flash_addr, &flash_addr_bytes[0] );
1094:../../../mod/flash/flash.c **** 
1095:../../../mod/flash/flash.c **** 		/* Error check */
1096:../../../mod/flash/flash.c **** 		if ( flash_block_num >= FLASH_BLOCK_8 )
1097:../../../mod/flash/flash.c **** 			{
1098:../../../mod/flash/flash.c **** 			return FLASH_ADDR_OUT_OF_BOUNDS;
1099:../../../mod/flash/flash.c **** 			}
1100:../../../mod/flash/flash.c **** 		break;
1101:../../../mod/flash/flash.c **** 		}
1102:../../../mod/flash/flash.c **** 	}
1103:../../../mod/flash/flash.c **** 
1104:../../../mod/flash/flash.c **** /* Check if write_enabled */
1105:../../../mod/flash/flash.c **** if( !( write_enabled ) )
1106:../../../mod/flash/flash.c ****     {
1107:../../../mod/flash/flash.c ****     return FLASH_WRITE_PROTECTED;
1108:../../../mod/flash/flash.c ****     }
1109:../../../mod/flash/flash.c **** 
1110:../../../mod/flash/flash.c **** 
1111:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1112:../../../mod/flash/flash.c ****  API function implementation
1113:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1114:../../../mod/flash/flash.c **** 
ARM GAS  /tmp/ccKy2Hdq.s 			page 21


1115:../../../mod/flash/flash.c **** /* Enable writing to flash */
1116:../../../mod/flash/flash.c **** flash_status = write_enable();
1117:../../../mod/flash/flash.c **** 
1118:../../../mod/flash/flash.c **** /* Sector erase sequence */
1119:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_RESET );
1120:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )        ,
1121:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
1122:../../../mod/flash/flash.c **** 							      sizeof( flash_opcode ),
1123:../../../mod/flash/flash.c **** 							      HAL_DEFAULT_TIMEOUT );
1124:../../../mod/flash/flash.c **** hal_status[1] = HAL_SPI_Transmit( &( FLASH_SPI )            , 
1125:../../../mod/flash/flash.c ****                                   &flash_addr_bytes[0]      ,
1126:../../../mod/flash/flash.c **** 								  sizeof( flash_addr_bytes ), 
1127:../../../mod/flash/flash.c **** 								  HAL_DEFAULT_TIMEOUT );
1128:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT, FLASH_SS_PIN, GPIO_PIN_SET );
1129:../../../mod/flash/flash.c **** 
1130:../../../mod/flash/flash.c **** /* Return status code */
1131:../../../mod/flash/flash.c **** if      ( hal_status[0] != HAL_OK || hal_status[1] != HAL_OK )
1132:../../../mod/flash/flash.c **** 	{
1133:../../../mod/flash/flash.c **** 	return FLASH_SPI_ERROR;
1134:../../../mod/flash/flash.c **** 	}
1135:../../../mod/flash/flash.c **** else if ( flash_status != FLASH_OK )
1136:../../../mod/flash/flash.c **** 	{
1137:../../../mod/flash/flash.c **** 	return FLASH_FAIL;
1138:../../../mod/flash/flash.c **** 	}
1139:../../../mod/flash/flash.c **** else
1140:../../../mod/flash/flash.c **** 	{
1141:../../../mod/flash/flash.c **** 	return FLASH_OK;
1142:../../../mod/flash/flash.c **** 	}
1143:../../../mod/flash/flash.c **** } /* flash_block_erase */
1144:../../../mod/flash/flash.c **** 
1145:../../../mod/flash/flash.c **** 
1146:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1147:../../../mod/flash/flash.c ****  Internal procedures 
1148:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1149:../../../mod/flash/flash.c **** 
1150:../../../mod/flash/flash.c **** 
1151:../../../mod/flash/flash.c **** /*******************************************************************************
1152:../../../mod/flash/flash.c **** *                                                                              *
1153:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
1154:../../../mod/flash/flash.c **** * 		address_to_bytes                                                       *
1155:../../../mod/flash/flash.c **** *                                                                              *
1156:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
1157:../../../mod/flash/flash.c **** * 		Converts a flash memory address in uint32_t format to a byte array     *
1158:../../../mod/flash/flash.c **** *                                                                              *
1159:../../../mod/flash/flash.c **** *******************************************************************************/
1160:../../../mod/flash/flash.c **** static void address_to_bytes
1161:../../../mod/flash/flash.c **** 	(
1162:../../../mod/flash/flash.c **** 	uint32_t address,
1163:../../../mod/flash/flash.c **** 	uint8_t* address_bytes
1164:../../../mod/flash/flash.c **** 	)
1165:../../../mod/flash/flash.c **** {
  28              		.loc 1 1165 1 view -0
  29              		.cfi_startproc
  30              		@ args = 0, pretend = 0, frame = 0
  31              		@ frame_needed = 0, uses_anonymous_args = 0
  32              		@ link register save eliminated.
1166:../../../mod/flash/flash.c **** address_bytes[0] = (address >> 16) & 0xFF;
ARM GAS  /tmp/ccKy2Hdq.s 			page 22


  33              		.loc 1 1166 1 view .LVU1
  34              		.loc 1 1166 29 is_stmt 0 view .LVU2
  35 0000 030C     		lsrs	r3, r0, #16
  36              		.loc 1 1166 18 view .LVU3
  37 0002 0B70     		strb	r3, [r1]
1167:../../../mod/flash/flash.c **** address_bytes[1] = (address >> 8 ) & 0xFF;
  38              		.loc 1 1167 1 is_stmt 1 view .LVU4
  39              		.loc 1 1167 29 is_stmt 0 view .LVU5
  40 0004 030A     		lsrs	r3, r0, #8
  41              		.loc 1 1167 18 view .LVU6
  42 0006 4B70     		strb	r3, [r1, #1]
1168:../../../mod/flash/flash.c **** address_bytes[2] =  address        & 0xFF;
  43              		.loc 1 1168 1 is_stmt 1 view .LVU7
  44              		.loc 1 1168 18 is_stmt 0 view .LVU8
  45 0008 8870     		strb	r0, [r1, #2]
1169:../../../mod/flash/flash.c **** } /* address_to_bytes */
  46              		.loc 1 1169 1 view .LVU9
  47 000a 7047     		bx	lr
  48              		.cfi_endproc
  49              	.LFE156:
  51              		.section	.text.write_disable,"ax",%progbits
  52              		.align	1
  53              		.syntax unified
  54              		.thumb
  55              		.thumb_func
  57              	write_disable:
  58              	.LFB159:
1170:../../../mod/flash/flash.c **** 
1171:../../../mod/flash/flash.c **** 
1172:../../../mod/flash/flash.c **** /*******************************************************************************
1173:../../../mod/flash/flash.c **** *                                                                              *
1174:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   * 
1175:../../../mod/flash/flash.c **** * 		bytes_to_address                                                       *
1176:../../../mod/flash/flash.c **** *                                                                              *
1177:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 * 
1178:../../../mod/flash/flash.c **** * 		Converts a flash memory address in byte format to uint32_t format      *
1179:../../../mod/flash/flash.c **** *                                                                              *
1180:../../../mod/flash/flash.c **** *******************************************************************************/
1181:../../../mod/flash/flash.c **** static inline uint32_t bytes_to_address 
1182:../../../mod/flash/flash.c **** 	(
1183:../../../mod/flash/flash.c **** 	uint8_t address_bytes[3]
1184:../../../mod/flash/flash.c **** 	)
1185:../../../mod/flash/flash.c **** {
1186:../../../mod/flash/flash.c **** return ( (uint32_t) address_bytes[0] << 16 ) |
1187:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[1] << 8  ) |
1188:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
1189:../../../mod/flash/flash.c **** } /* address_to_bytes */
1190:../../../mod/flash/flash.c **** 
1191:../../../mod/flash/flash.c **** 
1192:../../../mod/flash/flash.c **** /*******************************************************************************
1193:../../../mod/flash/flash.c **** *                                                                              *
1194:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   *
1195:../../../mod/flash/flash.c **** * 		write_enable                                                           *
1196:../../../mod/flash/flash.c **** *                                                                              *
1197:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 *
1198:../../../mod/flash/flash.c **** *       Enable writing to the external flash chip hardware                     *
1199:../../../mod/flash/flash.c **** *                                                                              *
ARM GAS  /tmp/ccKy2Hdq.s 			page 23


1200:../../../mod/flash/flash.c **** *******************************************************************************/
1201:../../../mod/flash/flash.c **** static FLASH_STATUS write_enable
1202:../../../mod/flash/flash.c ****     (
1203:../../../mod/flash/flash.c ****     void 
1204:../../../mod/flash/flash.c ****     )
1205:../../../mod/flash/flash.c **** {
1206:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1207:../../../mod/flash/flash.c ****  Local variables  
1208:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1209:../../../mod/flash/flash.c **** uint8_t hal_status;        /* Status code return by hal spi functions         */
1210:../../../mod/flash/flash.c **** uint8_t flash_opcode;      /* Flash operation/instruction cyle byte           */
1211:../../../mod/flash/flash.c **** 
1212:../../../mod/flash/flash.c **** 
1213:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1214:../../../mod/flash/flash.c ****  Local variables  
1215:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1216:../../../mod/flash/flash.c **** hal_status    = HAL_OK;
1217:../../../mod/flash/flash.c **** flash_opcode  = FLASH_OP_HW_WREN;
1218:../../../mod/flash/flash.c **** 
1219:../../../mod/flash/flash.c **** 
1220:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1221:../../../mod/flash/flash.c ****  API function implementation 
1222:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1223:../../../mod/flash/flash.c **** 
1224:../../../mod/flash/flash.c **** /* Send the write enable instruction to the flash over SPI */
1225:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
1226:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
1227:../../../mod/flash/flash.c ****                    GPIO_PIN_RESET );
1228:../../../mod/flash/flash.c **** hal_status = HAL_SPI_Transmit( &( FLASH_SPI )        ,
1229:../../../mod/flash/flash.c ****                                &flash_opcode         ,
1230:../../../mod/flash/flash.c ****                                sizeof( flash_opcode ),
1231:../../../mod/flash/flash.c ****                                HAL_DEFAULT_TIMEOUT );
1232:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
1233:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
1234:../../../mod/flash/flash.c ****                    GPIO_PIN_SET );
1235:../../../mod/flash/flash.c **** 
1236:../../../mod/flash/flash.c **** /* Set write enabled bit in flash buffer handle */
1237:../../../mod/flash/flash.c **** if ( hal_status != HAL_OK )
1238:../../../mod/flash/flash.c **** 	{
1239:../../../mod/flash/flash.c **** 	return FLASH_SPI_ERROR;
1240:../../../mod/flash/flash.c ****     }
1241:../../../mod/flash/flash.c **** else
1242:../../../mod/flash/flash.c **** 	{
1243:../../../mod/flash/flash.c **** 	return FLASH_OK;
1244:../../../mod/flash/flash.c ****     }
1245:../../../mod/flash/flash.c **** 
1246:../../../mod/flash/flash.c **** } /* write_enable */
1247:../../../mod/flash/flash.c **** 
1248:../../../mod/flash/flash.c **** 
1249:../../../mod/flash/flash.c **** /*******************************************************************************
1250:../../../mod/flash/flash.c **** *                                                                              *
1251:../../../mod/flash/flash.c **** * PROCEDURE:                                                                   *
1252:../../../mod/flash/flash.c **** * 		write_disable                                                          *
1253:../../../mod/flash/flash.c **** *                                                                              *
1254:../../../mod/flash/flash.c **** * DESCRIPTION:                                                                 *
1255:../../../mod/flash/flash.c **** *       Disable writing to the external flash chip hardware                    *
1256:../../../mod/flash/flash.c **** *                                                                              *
ARM GAS  /tmp/ccKy2Hdq.s 			page 24


1257:../../../mod/flash/flash.c **** *******************************************************************************/
1258:../../../mod/flash/flash.c **** static FLASH_STATUS write_disable 
1259:../../../mod/flash/flash.c ****     (
1260:../../../mod/flash/flash.c ****     void 
1261:../../../mod/flash/flash.c ****     )
1262:../../../mod/flash/flash.c **** {
  59              		.loc 1 1262 1 is_stmt 1 view -0
  60              		.cfi_startproc
  61              		@ args = 0, pretend = 0, frame = 8
  62              		@ frame_needed = 0, uses_anonymous_args = 0
  63 0000 30B5     		push	{r4, r5, lr}
  64              	.LCFI0:
  65              		.cfi_def_cfa_offset 12
  66              		.cfi_offset 4, -12
  67              		.cfi_offset 5, -8
  68              		.cfi_offset 14, -4
  69 0002 83B0     		sub	sp, sp, #12
  70              	.LCFI1:
  71              		.cfi_def_cfa_offset 24
1263:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1264:../../../mod/flash/flash.c ****  Local variables  
1265:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1266:../../../mod/flash/flash.c **** uint8_t hal_status;        /* Status code return by hal spi functions         */
  72              		.loc 1 1266 1 view .LVU11
1267:../../../mod/flash/flash.c **** uint8_t flash_opcode;      /* Flash operation/instruction cyle byte           */
  73              		.loc 1 1267 1 view .LVU12
1268:../../../mod/flash/flash.c **** 
1269:../../../mod/flash/flash.c **** 
1270:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1271:../../../mod/flash/flash.c ****  Local variables  
1272:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1273:../../../mod/flash/flash.c **** hal_status    = HAL_OK;
  74              		.loc 1 1273 1 view .LVU13
  75              	.LVL1:
1274:../../../mod/flash/flash.c **** flash_opcode  = FLASH_OP_HW_WRDI;
  76              		.loc 1 1274 1 view .LVU14
  77              		.loc 1 1274 15 is_stmt 0 view .LVU15
  78 0004 0423     		movs	r3, #4
  79 0006 8DF80730 		strb	r3, [sp, #7]
1275:../../../mod/flash/flash.c **** 
1276:../../../mod/flash/flash.c **** 
1277:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
1278:../../../mod/flash/flash.c ****  API function implementation 
1279:../../../mod/flash/flash.c **** ------------------------------------------------------------------------------*/
1280:../../../mod/flash/flash.c **** 
1281:../../../mod/flash/flash.c **** /* Send the write enable instruction to the flash over SPI */
1282:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
  80              		.loc 1 1282 1 is_stmt 1 view .LVU16
  81 000a 0D4D     		ldr	r5, .L6
  82 000c 0022     		movs	r2, #0
  83 000e 4FF48051 		mov	r1, #4096
  84 0012 2846     		mov	r0, r5
  85 0014 FFF7FEFF 		bl	HAL_GPIO_WritePin
  86              	.LVL2:
1283:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
1284:../../../mod/flash/flash.c ****                    GPIO_PIN_RESET );
1285:../../../mod/flash/flash.c **** hal_status = HAL_SPI_Transmit( &( FLASH_SPI )        ,
ARM GAS  /tmp/ccKy2Hdq.s 			page 25


  87              		.loc 1 1285 1 view .LVU17
  88              		.loc 1 1285 14 is_stmt 0 view .LVU18
  89 0018 0A23     		movs	r3, #10
  90 001a 0122     		movs	r2, #1
  91 001c 0DF10701 		add	r1, sp, #7
  92 0020 0848     		ldr	r0, .L6+4
  93 0022 FFF7FEFF 		bl	HAL_SPI_Transmit
  94              	.LVL3:
  95 0026 0446     		mov	r4, r0
  96              	.LVL4:
1286:../../../mod/flash/flash.c ****                                &flash_opcode         ,
1287:../../../mod/flash/flash.c ****                                sizeof( flash_opcode ),
1288:../../../mod/flash/flash.c ****                                HAL_DEFAULT_TIMEOUT );
1289:../../../mod/flash/flash.c **** HAL_GPIO_WritePin( FLASH_SS_GPIO_PORT,
  97              		.loc 1 1289 1 is_stmt 1 view .LVU19
  98 0028 0122     		movs	r2, #1
  99 002a 4FF48051 		mov	r1, #4096
 100 002e 2846     		mov	r0, r5
 101 0030 FFF7FEFF 		bl	HAL_GPIO_WritePin
 102              	.LVL5:
1290:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
1291:../../../mod/flash/flash.c ****                    GPIO_PIN_SET );
1292:../../../mod/flash/flash.c **** 
1293:../../../mod/flash/flash.c **** /* Return results of SPI HAL calls */
1294:../../../mod/flash/flash.c **** if ( hal_status != HAL_OK )
 103              		.loc 1 1294 1 view .LVU20
 104              		.loc 1 1294 4 is_stmt 0 view .LVU21
 105 0034 14B9     		cbnz	r4, .L5
 106              	.LVL6:
 107              	.L3:
1295:../../../mod/flash/flash.c **** 	{
1296:../../../mod/flash/flash.c **** 	return FLASH_SPI_ERROR;
1297:../../../mod/flash/flash.c ****     }
1298:../../../mod/flash/flash.c **** else
1299:../../../mod/flash/flash.c **** 	{
1300:../../../mod/flash/flash.c **** 	return FLASH_OK;
1301:../../../mod/flash/flash.c ****     }
1302:../../../mod/flash/flash.c **** 
1303:../../../mod/flash/flash.c **** } /* write_disable */
 108              		.loc 1 1303 1 view .LVU22
 109 0036 2046     		mov	r0, r4
 110 0038 03B0     		add	sp, sp, #12
 111              	.LCFI2:
 112              		.cfi_remember_state
 113              		.cfi_def_cfa_offset 12
 114              		@ sp needed
 115 003a 30BD     		pop	{r4, r5, pc}
 116              	.LVL7:
 117              	.L5:
 118              	.LCFI3:
 119              		.cfi_restore_state
1296:../../../mod/flash/flash.c ****     }
 120              		.loc 1 1296 9 view .LVU23
 121 003c 0824     		movs	r4, #8
 122              	.LVL8:
1296:../../../mod/flash/flash.c ****     }
 123              		.loc 1 1296 9 view .LVU24
ARM GAS  /tmp/ccKy2Hdq.s 			page 26


 124 003e FAE7     		b	.L3
 125              	.L7:
 126              		.align	2
 127              	.L6:
 128 0040 00040258 		.word	1476527104
 129 0044 00000000 		.word	hspi2
 130              		.cfi_endproc
 131              	.LFE159:
 133              		.section	.text.write_enable,"ax",%progbits
 134              		.align	1
 135              		.syntax unified
 136              		.thumb
 137              		.thumb_func
 139              	write_enable:
 140              	.LFB158:
1205:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 141              		.loc 1 1205 1 is_stmt 1 view -0
 142              		.cfi_startproc
 143              		@ args = 0, pretend = 0, frame = 8
 144              		@ frame_needed = 0, uses_anonymous_args = 0
 145 0000 30B5     		push	{r4, r5, lr}
 146              	.LCFI4:
 147              		.cfi_def_cfa_offset 12
 148              		.cfi_offset 4, -12
 149              		.cfi_offset 5, -8
 150              		.cfi_offset 14, -4
 151 0002 83B0     		sub	sp, sp, #12
 152              	.LCFI5:
 153              		.cfi_def_cfa_offset 24
1209:../../../mod/flash/flash.c **** uint8_t flash_opcode;      /* Flash operation/instruction cyle byte           */
 154              		.loc 1 1209 1 view .LVU26
1210:../../../mod/flash/flash.c **** 
 155              		.loc 1 1210 1 view .LVU27
1216:../../../mod/flash/flash.c **** flash_opcode  = FLASH_OP_HW_WREN;
 156              		.loc 1 1216 1 view .LVU28
 157              	.LVL9:
1217:../../../mod/flash/flash.c **** 
 158              		.loc 1 1217 1 view .LVU29
1217:../../../mod/flash/flash.c **** 
 159              		.loc 1 1217 15 is_stmt 0 view .LVU30
 160 0004 0623     		movs	r3, #6
 161 0006 8DF80730 		strb	r3, [sp, #7]
1225:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 162              		.loc 1 1225 1 is_stmt 1 view .LVU31
 163 000a 0D4D     		ldr	r5, .L12
 164 000c 0022     		movs	r2, #0
 165 000e 4FF48051 		mov	r1, #4096
 166 0012 2846     		mov	r0, r5
 167 0014 FFF7FEFF 		bl	HAL_GPIO_WritePin
 168              	.LVL10:
1228:../../../mod/flash/flash.c ****                                &flash_opcode         ,
 169              		.loc 1 1228 1 view .LVU32
1228:../../../mod/flash/flash.c ****                                &flash_opcode         ,
 170              		.loc 1 1228 14 is_stmt 0 view .LVU33
 171 0018 0A23     		movs	r3, #10
 172 001a 0122     		movs	r2, #1
 173 001c 0DF10701 		add	r1, sp, #7
ARM GAS  /tmp/ccKy2Hdq.s 			page 27


 174 0020 0848     		ldr	r0, .L12+4
 175 0022 FFF7FEFF 		bl	HAL_SPI_Transmit
 176              	.LVL11:
 177 0026 0446     		mov	r4, r0
 178              	.LVL12:
1232:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 179              		.loc 1 1232 1 is_stmt 1 view .LVU34
 180 0028 0122     		movs	r2, #1
 181 002a 4FF48051 		mov	r1, #4096
 182 002e 2846     		mov	r0, r5
 183 0030 FFF7FEFF 		bl	HAL_GPIO_WritePin
 184              	.LVL13:
1237:../../../mod/flash/flash.c **** 	{
 185              		.loc 1 1237 1 view .LVU35
1237:../../../mod/flash/flash.c **** 	{
 186              		.loc 1 1237 4 is_stmt 0 view .LVU36
 187 0034 14B9     		cbnz	r4, .L11
 188              	.LVL14:
 189              	.L9:
1246:../../../mod/flash/flash.c **** 
 190              		.loc 1 1246 1 view .LVU37
 191 0036 2046     		mov	r0, r4
 192 0038 03B0     		add	sp, sp, #12
 193              	.LCFI6:
 194              		.cfi_remember_state
 195              		.cfi_def_cfa_offset 12
 196              		@ sp needed
 197 003a 30BD     		pop	{r4, r5, pc}
 198              	.LVL15:
 199              	.L11:
 200              	.LCFI7:
 201              		.cfi_restore_state
1239:../../../mod/flash/flash.c ****     }
 202              		.loc 1 1239 9 view .LVU38
 203 003c 0824     		movs	r4, #8
 204              	.LVL16:
1239:../../../mod/flash/flash.c ****     }
 205              		.loc 1 1239 9 view .LVU39
 206 003e FAE7     		b	.L9
 207              	.L13:
 208              		.align	2
 209              	.L12:
 210 0040 00040258 		.word	1476527104
 211 0044 00000000 		.word	hspi2
 212              		.cfi_endproc
 213              	.LFE158:
 215              		.section	.text.flash_get_status,"ax",%progbits
 216              		.align	1
 217              		.global	flash_get_status
 218              		.syntax unified
 219              		.thumb
 220              		.thumb_func
 222              	flash_get_status:
 223              	.LVL17:
 224              	.LFB146:
 402:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 225              		.loc 1 402 1 is_stmt 1 view -0
ARM GAS  /tmp/ccKy2Hdq.s 			page 28


 226              		.cfi_startproc
 227              		@ args = 0, pretend = 0, frame = 8
 228              		@ frame_needed = 0, uses_anonymous_args = 0
 402:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 229              		.loc 1 402 1 is_stmt 0 view .LVU41
 230 0000 F0B5     		push	{r4, r5, r6, r7, lr}
 231              	.LCFI8:
 232              		.cfi_def_cfa_offset 20
 233              		.cfi_offset 4, -20
 234              		.cfi_offset 5, -16
 235              		.cfi_offset 6, -12
 236              		.cfi_offset 7, -8
 237              		.cfi_offset 14, -4
 238 0002 83B0     		sub	sp, sp, #12
 239              	.LCFI9:
 240              		.cfi_def_cfa_offset 32
 241 0004 0446     		mov	r4, r0
 406:../../../mod/flash/flash.c **** uint8_t           flash_opcode;   /* Data to be transmitted over SPI          */
 242              		.loc 1 406 1 is_stmt 1 view .LVU42
 407:../../../mod/flash/flash.c **** 
 243              		.loc 1 407 1 view .LVU43
 412:../../../mod/flash/flash.c **** 
 244              		.loc 1 412 1 view .LVU44
 412:../../../mod/flash/flash.c **** 
 245              		.loc 1 412 14 is_stmt 0 view .LVU45
 246 0006 0523     		movs	r3, #5
 247 0008 8DF80330 		strb	r3, [sp, #3]
 420:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 248              		.loc 1 420 1 is_stmt 1 view .LVU46
 249 000c 154E     		ldr	r6, .L19
 250 000e 0022     		movs	r2, #0
 251 0010 4FF48051 		mov	r1, #4096
 252 0014 3046     		mov	r0, r6
 253              	.LVL18:
 420:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 254              		.loc 1 420 1 is_stmt 0 view .LVU47
 255 0016 FFF7FEFF 		bl	HAL_GPIO_WritePin
 256              	.LVL19:
 425:../../../mod/flash/flash.c ****                                   &flash_opcode         ,
 257              		.loc 1 425 1 is_stmt 1 view .LVU48
 425:../../../mod/flash/flash.c ****                                   &flash_opcode         ,
 258              		.loc 1 425 17 is_stmt 0 view .LVU49
 259 001a 134F     		ldr	r7, .L19+4
 260 001c 0A23     		movs	r3, #10
 261 001e 0122     		movs	r2, #1
 262 0020 0DF10301 		add	r1, sp, #3
 263 0024 3846     		mov	r0, r7
 264 0026 FFF7FEFF 		bl	HAL_SPI_Transmit
 265              	.LVL20:
 266 002a 0546     		mov	r5, r0
 425:../../../mod/flash/flash.c ****                                   &flash_opcode         ,
 267              		.loc 1 425 15 view .LVU50
 268 002c 8DF80400 		strb	r0, [sp, #4]
 431:../../../mod/flash/flash.c ****                                  &( pflash_handle      -> status_register ),
 269              		.loc 1 431 1 is_stmt 1 view .LVU51
 431:../../../mod/flash/flash.c ****                                  &( pflash_handle      -> status_register ),
 270              		.loc 1 431 17 is_stmt 0 view .LVU52
ARM GAS  /tmp/ccKy2Hdq.s 			page 29


 271 0030 0A23     		movs	r3, #10
 272 0032 0122     		movs	r2, #1
 273 0034 04F10F01 		add	r1, r4, #15
 274 0038 3846     		mov	r0, r7
 275 003a FFF7FEFF 		bl	HAL_SPI_Receive
 276              	.LVL21:
 277 003e 0446     		mov	r4, r0
 278              	.LVL22:
 431:../../../mod/flash/flash.c ****                                  &( pflash_handle      -> status_register ),
 279              		.loc 1 431 15 view .LVU53
 280 0040 8DF80500 		strb	r0, [sp, #5]
 437:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 281              		.loc 1 437 1 is_stmt 1 view .LVU54
 282 0044 0122     		movs	r2, #1
 283 0046 4FF48051 		mov	r1, #4096
 284 004a 3046     		mov	r0, r6
 285 004c FFF7FEFF 		bl	HAL_GPIO_WritePin
 286              	.LVL23:
 442:../../../mod/flash/flash.c **** 	{
 287              		.loc 1 442 1 view .LVU55
 442:../../../mod/flash/flash.c **** 	{
 288              		.loc 1 442 4 is_stmt 0 view .LVU56
 289 0050 2DB9     		cbnz	r5, .L16
 442:../../../mod/flash/flash.c **** 	{
 290              		.loc 1 442 30 discriminator 1 view .LVU57
 291 0052 14B9     		cbnz	r4, .L18
 292              	.L15:
 451:../../../mod/flash/flash.c **** 
 293              		.loc 1 451 1 view .LVU58
 294 0054 2046     		mov	r0, r4
 295 0056 03B0     		add	sp, sp, #12
 296              	.LCFI10:
 297              		.cfi_remember_state
 298              		.cfi_def_cfa_offset 20
 299              		@ sp needed
 300 0058 F0BD     		pop	{r4, r5, r6, r7, pc}
 301              	.L18:
 302              	.LCFI11:
 303              		.cfi_restore_state
 444:../../../mod/flash/flash.c **** 	}
 304              		.loc 1 444 9 view .LVU59
 305 005a 0824     		movs	r4, #8
 306 005c FAE7     		b	.L15
 307              	.L16:
 308 005e 0824     		movs	r4, #8
 309 0060 F8E7     		b	.L15
 310              	.L20:
 311 0062 00BF     		.align	2
 312              	.L19:
 313 0064 00040258 		.word	1476527104
 314 0068 00000000 		.word	hspi2
 315              		.cfi_endproc
 316              	.LFE146:
 318              		.section	.text.flash_set_status,"ax",%progbits
 319              		.align	1
 320              		.global	flash_set_status
 321              		.syntax unified
ARM GAS  /tmp/ccKy2Hdq.s 			page 30


 322              		.thumb
 323              		.thumb_func
 325              	flash_set_status:
 326              	.LVL24:
 327              	.LFB147:
 467:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 328              		.loc 1 467 1 is_stmt 1 view -0
 329              		.cfi_startproc
 330              		@ args = 0, pretend = 0, frame = 16
 331              		@ frame_needed = 0, uses_anonymous_args = 0
 467:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 332              		.loc 1 467 1 is_stmt 0 view .LVU61
 333 0000 F0B5     		push	{r4, r5, r6, r7, lr}
 334              	.LCFI12:
 335              		.cfi_def_cfa_offset 20
 336              		.cfi_offset 4, -20
 337              		.cfi_offset 5, -16
 338              		.cfi_offset 6, -12
 339              		.cfi_offset 7, -8
 340              		.cfi_offset 14, -4
 341 0002 85B0     		sub	sp, sp, #20
 342              	.LCFI13:
 343              		.cfi_def_cfa_offset 40
 344 0004 8DF80700 		strb	r0, [sp, #7]
 471:../../../mod/flash/flash.c **** uint8_t flash_opcodes[2];   /* Flash instruction cycle bytes                  */
 345              		.loc 1 471 1 is_stmt 1 view .LVU62
 472:../../../mod/flash/flash.c **** 
 346              		.loc 1 472 1 view .LVU63
 478:../../../mod/flash/flash.c **** flash_opcodes[1] = FLASH_OP_HW_WRSR;
 347              		.loc 1 478 1 view .LVU64
 478:../../../mod/flash/flash.c **** flash_opcodes[1] = FLASH_OP_HW_WRSR;
 348              		.loc 1 478 18 is_stmt 0 view .LVU65
 349 0008 5023     		movs	r3, #80
 350 000a 8DF80830 		strb	r3, [sp, #8]
 479:../../../mod/flash/flash.c **** 
 351              		.loc 1 479 1 is_stmt 1 view .LVU66
 479:../../../mod/flash/flash.c **** 
 352              		.loc 1 479 18 is_stmt 0 view .LVU67
 353 000e 0123     		movs	r3, #1
 354 0010 8DF80930 		strb	r3, [sp, #9]
 485:../../../mod/flash/flash.c **** 	{
 355              		.loc 1 485 1 is_stmt 1 view .LVU68
 485:../../../mod/flash/flash.c **** 	{
 356              		.loc 1 485 6 is_stmt 0 view .LVU69
 357 0014 234B     		ldr	r3, .L27
 358 0016 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 485:../../../mod/flash/flash.c **** 	{
 359              		.loc 1 485 4 view .LVU70
 360 0018 DBB3     		cbz	r3, .L23
 496:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 361              		.loc 1 496 1 is_stmt 1 view .LVU71
 362 001a 234E     		ldr	r6, .L27+4
 363 001c 0022     		movs	r2, #0
 364 001e 4FF48051 		mov	r1, #4096
 365 0022 3046     		mov	r0, r6
 366              	.LVL25:
 496:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
ARM GAS  /tmp/ccKy2Hdq.s 			page 31


 367              		.loc 1 496 1 is_stmt 0 view .LVU72
 368 0024 FFF7FEFF 		bl	HAL_GPIO_WritePin
 369              	.LVL26:
 499:../../../mod/flash/flash.c ****                                   &flash_opcodes[0],
 370              		.loc 1 499 1 is_stmt 1 view .LVU73
 499:../../../mod/flash/flash.c ****                                   &flash_opcodes[0],
 371              		.loc 1 499 17 is_stmt 0 view .LVU74
 372 0028 204C     		ldr	r4, .L27+8
 373 002a 0A23     		movs	r3, #10
 374 002c 0122     		movs	r2, #1
 375 002e 02A9     		add	r1, sp, #8
 376 0030 2046     		mov	r0, r4
 377 0032 FFF7FEFF 		bl	HAL_SPI_Transmit
 378              	.LVL27:
 379 0036 0546     		mov	r5, r0
 499:../../../mod/flash/flash.c ****                                   &flash_opcodes[0],
 380              		.loc 1 499 15 view .LVU75
 381 0038 8DF80C00 		strb	r0, [sp, #12]
 503:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 382              		.loc 1 503 1 is_stmt 1 view .LVU76
 383 003c 0122     		movs	r2, #1
 384 003e 4FF48051 		mov	r1, #4096
 385 0042 3046     		mov	r0, r6
 386 0044 FFF7FEFF 		bl	HAL_GPIO_WritePin
 387              	.LVL28:
 508:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 388              		.loc 1 508 1 view .LVU77
 389 0048 0022     		movs	r2, #0
 390 004a 4FF48051 		mov	r1, #4096
 391 004e 3046     		mov	r0, r6
 392 0050 FFF7FEFF 		bl	HAL_GPIO_WritePin
 393              	.LVL29:
 511:../../../mod/flash/flash.c ****                                   &flash_opcodes[1],
 394              		.loc 1 511 1 view .LVU78
 511:../../../mod/flash/flash.c ****                                   &flash_opcodes[1],
 395              		.loc 1 511 17 is_stmt 0 view .LVU79
 396 0054 0A23     		movs	r3, #10
 397 0056 0122     		movs	r2, #1
 398 0058 0DF10901 		add	r1, sp, #9
 399 005c 2046     		mov	r0, r4
 400 005e FFF7FEFF 		bl	HAL_SPI_Transmit
 401              	.LVL30:
 402 0062 0746     		mov	r7, r0
 511:../../../mod/flash/flash.c ****                                   &flash_opcodes[1],
 403              		.loc 1 511 15 view .LVU80
 404 0064 8DF80D00 		strb	r0, [sp, #13]
 515:../../../mod/flash/flash.c ****                                   &flash_status         ,
 405              		.loc 1 515 1 is_stmt 1 view .LVU81
 515:../../../mod/flash/flash.c ****                                   &flash_status         ,
 406              		.loc 1 515 17 is_stmt 0 view .LVU82
 407 0068 0A23     		movs	r3, #10
 408 006a 0122     		movs	r2, #1
 409 006c 0DF10701 		add	r1, sp, #7
 410 0070 2046     		mov	r0, r4
 411 0072 FFF7FEFF 		bl	HAL_SPI_Transmit
 412              	.LVL31:
 413 0076 0446     		mov	r4, r0
ARM GAS  /tmp/ccKy2Hdq.s 			page 32


 515:../../../mod/flash/flash.c ****                                   &flash_status         ,
 414              		.loc 1 515 15 view .LVU83
 415 0078 8DF80E00 		strb	r0, [sp, #14]
 519:../../../mod/flash/flash.c ****                    FLASH_SS_PIN      ,
 416              		.loc 1 519 1 is_stmt 1 view .LVU84
 417 007c 0122     		movs	r2, #1
 418 007e 4FF48051 		mov	r1, #4096
 419 0082 3046     		mov	r0, r6
 420 0084 FFF7FEFF 		bl	HAL_GPIO_WritePin
 421              	.LVL32:
 524:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 422              		.loc 1 524 1 view .LVU85
 524:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 423              		.loc 1 524 4 is_stmt 0 view .LVU86
 424 0088 3DB9     		cbnz	r5, .L24
 524:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 425              		.loc 1 524 30 discriminator 1 view .LVU87
 426 008a 47B9     		cbnz	r7, .L25
 525:../../../mod/flash/flash.c **** 	 hal_status[2] != HAL_OK )
 427              		.loc 1 525 30 view .LVU88
 428 008c 14B1     		cbz	r4, .L22
 528:../../../mod/flash/flash.c **** 	}
 429              		.loc 1 528 9 view .LVU89
 430 008e 0824     		movs	r4, #8
 431 0090 00E0     		b	.L22
 432              	.LVL33:
 433              	.L23:
 487:../../../mod/flash/flash.c **** 	}
 434              		.loc 1 487 9 view .LVU90
 435 0092 0524     		movs	r4, #5
 436              	.LVL34:
 437              	.L22:
 535:../../../mod/flash/flash.c **** 
 438              		.loc 1 535 1 view .LVU91
 439 0094 2046     		mov	r0, r4
 440 0096 05B0     		add	sp, sp, #20
 441              	.LCFI14:
 442              		.cfi_remember_state
 443              		.cfi_def_cfa_offset 20
 444              		@ sp needed
 445 0098 F0BD     		pop	{r4, r5, r6, r7, pc}
 446              	.L24:
 447              	.LCFI15:
 448              		.cfi_restore_state
 528:../../../mod/flash/flash.c **** 	}
 449              		.loc 1 528 9 view .LVU92
 450 009a 0824     		movs	r4, #8
 451 009c FAE7     		b	.L22
 452              	.L25:
 453 009e 0824     		movs	r4, #8
 454 00a0 F8E7     		b	.L22
 455              	.L28:
 456 00a2 00BF     		.align	2
 457              	.L27:
 458 00a4 00000000 		.word	write_enabled
 459 00a8 00040258 		.word	1476527104
 460 00ac 00000000 		.word	hspi2
ARM GAS  /tmp/ccKy2Hdq.s 			page 33


 461              		.cfi_endproc
 462              	.LFE147:
 464              		.section	.text.flash_is_flash_busy,"ax",%progbits
 465              		.align	1
 466              		.global	flash_is_flash_busy
 467              		.syntax unified
 468              		.thumb
 469              		.thumb_func
 471              	flash_is_flash_busy:
 472              	.LFB148:
 552:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 473              		.loc 1 552 1 is_stmt 1 view -0
 474              		.cfi_startproc
 475              		@ args = 0, pretend = 0, frame = 16
 476              		@ frame_needed = 0, uses_anonymous_args = 0
 477 0000 00B5     		push	{lr}
 478              	.LCFI16:
 479              		.cfi_def_cfa_offset 4
 480              		.cfi_offset 14, -4
 481 0002 85B0     		sub	sp, sp, #20
 482              	.LCFI17:
 483              		.cfi_def_cfa_offset 24
 556:../../../mod/flash/flash.c **** FLASH_STATUS  flash_status; /* Flash API return codes                         */
 484              		.loc 1 556 1 view .LVU94
 557:../../../mod/flash/flash.c **** 
 485              		.loc 1 557 1 view .LVU95
 563:../../../mod/flash/flash.c **** flash_handle.status_register = 0xFF;
 486              		.loc 1 563 1 view .LVU96
 487              	.LVL35:
 564:../../../mod/flash/flash.c **** 
 488              		.loc 1 564 1 view .LVU97
 564:../../../mod/flash/flash.c **** 
 489              		.loc 1 564 30 is_stmt 0 view .LVU98
 490 0004 FF23     		movs	r3, #255
 491 0006 8DF80F30 		strb	r3, [sp, #15]
 572:../../../mod/flash/flash.c **** if      ( flash_status != FLASH_OK                          )
 492              		.loc 1 572 1 is_stmt 1 view .LVU99
 572:../../../mod/flash/flash.c **** if      ( flash_status != FLASH_OK                          )
 493              		.loc 1 572 16 is_stmt 0 view .LVU100
 494 000a 6846     		mov	r0, sp
 495 000c FFF7FEFF 		bl	flash_get_status
 496              	.LVL36:
 573:../../../mod/flash/flash.c **** 	{
 497              		.loc 1 573 1 is_stmt 1 view .LVU101
 573:../../../mod/flash/flash.c **** 	{
 498              		.loc 1 573 9 is_stmt 0 view .LVU102
 499 0010 30B9     		cbnz	r0, .L31
 577:../../../mod/flash/flash.c **** 	{
 500              		.loc 1 577 6 is_stmt 1 view .LVU103
 577:../../../mod/flash/flash.c **** 	{
 501              		.loc 1 577 23 is_stmt 0 view .LVU104
 502 0012 9DF80F30 		ldrb	r3, [sp, #15]	@ zero_extendqisi2
 577:../../../mod/flash/flash.c **** 	{
 503              		.loc 1 577 9 view .LVU105
 504 0016 13F0010F 		tst	r3, #1
 505 001a 05D0     		beq	.L32
 579:../../../mod/flash/flash.c **** 	}
ARM GAS  /tmp/ccKy2Hdq.s 			page 34


 506              		.loc 1 579 9 view .LVU106
 507 001c 0120     		movs	r0, #1
 508              	.LVL37:
 579:../../../mod/flash/flash.c **** 	}
 509              		.loc 1 579 9 view .LVU107
 510 001e 00E0     		b	.L30
 511              	.LVL38:
 512              	.L31:
 575:../../../mod/flash/flash.c **** 	}
 513              		.loc 1 575 9 view .LVU108
 514 0020 0120     		movs	r0, #1
 515              	.LVL39:
 516              	.L30:
 586:../../../mod/flash/flash.c **** 
 517              		.loc 1 586 1 view .LVU109
 518 0022 05B0     		add	sp, sp, #20
 519              	.LCFI18:
 520              		.cfi_remember_state
 521              		.cfi_def_cfa_offset 4
 522              		@ sp needed
 523 0024 5DF804FB 		ldr	pc, [sp], #4
 524              	.LVL40:
 525              	.L32:
 526              	.LCFI19:
 527              		.cfi_restore_state
 583:../../../mod/flash/flash.c **** 	}
 528              		.loc 1 583 9 view .LVU110
 529 0028 0020     		movs	r0, #0
 530              	.LVL41:
 583:../../../mod/flash/flash.c **** 	}
 531              		.loc 1 583 9 view .LVU111
 532 002a FAE7     		b	.L30
 533              		.cfi_endproc
 534              	.LFE148:
 536              		.section	.text.flash_write_enable,"ax",%progbits
 537              		.align	1
 538              		.global	flash_write_enable
 539              		.syntax unified
 540              		.thumb
 541              		.thumb_func
 543              	flash_write_enable:
 544              	.LFB149:
 603:../../../mod/flash/flash.c **** write_enabled = true;
 545              		.loc 1 603 1 is_stmt 1 view -0
 546              		.cfi_startproc
 547              		@ args = 0, pretend = 0, frame = 0
 548              		@ frame_needed = 0, uses_anonymous_args = 0
 549              		@ link register save eliminated.
 604:../../../mod/flash/flash.c **** } /* flash_write_enable */
 550              		.loc 1 604 1 view .LVU113
 604:../../../mod/flash/flash.c **** } /* flash_write_enable */
 551              		.loc 1 604 15 is_stmt 0 view .LVU114
 552 0000 014B     		ldr	r3, .L35
 553 0002 0122     		movs	r2, #1
 554 0004 1A70     		strb	r2, [r3]
 605:../../../mod/flash/flash.c **** 
 555              		.loc 1 605 1 view .LVU115
ARM GAS  /tmp/ccKy2Hdq.s 			page 35


 556 0006 7047     		bx	lr
 557              	.L36:
 558              		.align	2
 559              	.L35:
 560 0008 00000000 		.word	write_enabled
 561              		.cfi_endproc
 562              	.LFE149:
 564              		.section	.text.flash_write_disable,"ax",%progbits
 565              		.align	1
 566              		.global	flash_write_disable
 567              		.syntax unified
 568              		.thumb
 569              		.thumb_func
 571              	flash_write_disable:
 572              	.LFB150:
 621:../../../mod/flash/flash.c **** write_enabled = false;
 573              		.loc 1 621 1 is_stmt 1 view -0
 574              		.cfi_startproc
 575              		@ args = 0, pretend = 0, frame = 0
 576              		@ frame_needed = 0, uses_anonymous_args = 0
 577              		@ link register save eliminated.
 622:../../../mod/flash/flash.c **** } /* flash_write_disable */
 578              		.loc 1 622 1 view .LVU117
 622:../../../mod/flash/flash.c **** } /* flash_write_disable */
 579              		.loc 1 622 15 is_stmt 0 view .LVU118
 580 0000 014B     		ldr	r3, .L38
 581 0002 0022     		movs	r2, #0
 582 0004 1A70     		strb	r2, [r3]
 623:../../../mod/flash/flash.c **** 
 583              		.loc 1 623 1 view .LVU119
 584 0006 7047     		bx	lr
 585              	.L39:
 586              		.align	2
 587              	.L38:
 588 0008 00000000 		.word	write_enabled
 589              		.cfi_endproc
 590              	.LFE150:
 592              		.section	.text.flash_init,"ax",%progbits
 593              		.align	1
 594              		.global	flash_init
 595              		.syntax unified
 596              		.thumb
 597              		.thumb_func
 599              	flash_init:
 600              	.LVL42:
 601              	.LFB145:
 309:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 602              		.loc 1 309 1 is_stmt 1 view -0
 603              		.cfi_startproc
 604              		@ args = 0, pretend = 0, frame = 0
 605              		@ frame_needed = 0, uses_anonymous_args = 0
 309:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 606              		.loc 1 309 1 is_stmt 0 view .LVU121
 607 0000 38B5     		push	{r3, r4, r5, lr}
 608              	.LCFI20:
 609              		.cfi_def_cfa_offset 16
 610              		.cfi_offset 3, -16
ARM GAS  /tmp/ccKy2Hdq.s 			page 36


 611              		.cfi_offset 4, -12
 612              		.cfi_offset 5, -8
 613              		.cfi_offset 14, -4
 614 0002 0446     		mov	r4, r0
 313:../../../mod/flash/flash.c **** uint8_t      status_register; /* Desired status register contents       */
 615              		.loc 1 313 1 is_stmt 1 view .LVU122
 314:../../../mod/flash/flash.c **** 
 616              		.loc 1 314 1 view .LVU123
 320:../../../mod/flash/flash.c **** status_register = FLASH_REG_RESET_VAL;
 617              		.loc 1 320 1 view .LVU124
 618              	.LVL43:
 321:../../../mod/flash/flash.c **** 
 619              		.loc 1 321 1 view .LVU125
 329:../../../mod/flash/flash.c **** 	{
 620              		.loc 1 329 1 view .LVU126
 329:../../../mod/flash/flash.c **** 	{
 621              		.loc 1 329 20 is_stmt 0 view .LVU127
 622 0004 407B     		ldrb	r0, [r0, #13]	@ zero_extendqisi2
 623              	.LVL44:
 329:../../../mod/flash/flash.c **** 	{
 624              		.loc 1 329 4 view .LVU128
 625 0006 DC28     		cmp	r0, #220
 626 0008 25D8     		bhi	.L44
 335:../../../mod/flash/flash.c **** status_register |= pflash_handle -> bpl_write_protect;
 627              		.loc 1 335 1 is_stmt 1 view .LVU129
 335:../../../mod/flash/flash.c **** status_register |= pflash_handle -> bpl_write_protect;
 628              		.loc 1 335 17 is_stmt 0 view .LVU130
 629 000a 00F03800 		and	r0, r0, #56
 630              	.LVL45:
 336:../../../mod/flash/flash.c **** 
 631              		.loc 1 336 1 is_stmt 1 view .LVU131
 336:../../../mod/flash/flash.c **** 
 632              		.loc 1 336 34 is_stmt 0 view .LVU132
 633 000e A37B     		ldrb	r3, [r4, #14]	@ zero_extendqisi2
 336:../../../mod/flash/flash.c **** 
 634              		.loc 1 336 17 view .LVU133
 635 0010 43EA0005 		orr	r5, r3, r0
 636              	.LVL46:
 344:../../../mod/flash/flash.c **** 	{
 637              		.loc 1 344 1 is_stmt 1 view .LVU134
 344:../../../mod/flash/flash.c **** 	{
 638              		.loc 1 344 20 is_stmt 0 view .LVU135
 639 0014 237B     		ldrb	r3, [r4, #12]	@ zero_extendqisi2
 344:../../../mod/flash/flash.c **** 	{
 640              		.loc 1 344 4 view .LVU136
 641 0016 D3B9     		cbnz	r3, .L48
 351:../../../mod/flash/flash.c **** 	}
 642              		.loc 1 351 2 is_stmt 1 view .LVU137
 643 0018 FFF7FEFF 		bl	flash_write_enable
 644              	.LVL47:
 355:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 645              		.loc 1 355 1 view .LVU138
 355:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 646              		.loc 1 355 16 is_stmt 0 view .LVU139
 647 001c 2046     		mov	r0, r4
 648 001e FFF7FEFF 		bl	flash_get_status
 649              	.LVL48:
ARM GAS  /tmp/ccKy2Hdq.s 			page 37


 356:../../../mod/flash/flash.c **** 	{
 650              		.loc 1 356 1 is_stmt 1 view .LVU140
 356:../../../mod/flash/flash.c **** 	{
 651              		.loc 1 356 4 is_stmt 0 view .LVU141
 652 0022 B8B9     		cbnz	r0, .L41
 360:../../../mod/flash/flash.c **** 	{
 653              		.loc 1 360 6 is_stmt 1 view .LVU142
 360:../../../mod/flash/flash.c **** 	{
 654              		.loc 1 360 25 is_stmt 0 view .LVU143
 655 0024 E37B     		ldrb	r3, [r4, #15]	@ zero_extendqisi2
 360:../../../mod/flash/flash.c **** 	{
 656              		.loc 1 360 9 view .LVU144
 657 0026 FF2B     		cmp	r3, #255
 658 0028 17D0     		beq	.L45
 366:../../../mod/flash/flash.c **** 	{
 659              		.loc 1 366 1 is_stmt 1 view .LVU145
 366:../../../mod/flash/flash.c **** 	{
 660              		.loc 1 366 6 is_stmt 0 view .LVU146
 661 002a FFF7FEFF 		bl	write_disable
 662              	.LVL49:
 366:../../../mod/flash/flash.c **** 	{
 663              		.loc 1 366 4 view .LVU147
 664 002e B0B9     		cbnz	r0, .L46
 372:../../../mod/flash/flash.c **** 
 665              		.loc 1 372 1 is_stmt 1 view .LVU148
 372:../../../mod/flash/flash.c **** 
 666              		.loc 1 372 16 is_stmt 0 view .LVU149
 667 0030 2846     		mov	r0, r5
 668 0032 FFF7FEFF 		bl	flash_set_status
 669              	.LVL50:
 375:../../../mod/flash/flash.c **** flash_status = flash_get_status( pflash_handle );
 670              		.loc 1 375 1 is_stmt 1 view .LVU150
 671              	.L43:
 375:../../../mod/flash/flash.c **** flash_status = flash_get_status( pflash_handle );
 672              		.loc 1 375 46 discriminator 1 view .LVU151
 375:../../../mod/flash/flash.c **** flash_status = flash_get_status( pflash_handle );
 673              		.loc 1 375 30 discriminator 1 view .LVU152
 375:../../../mod/flash/flash.c **** flash_status = flash_get_status( pflash_handle );
 674              		.loc 1 375 8 is_stmt 0 discriminator 1 view .LVU153
 675 0036 FFF7FEFF 		bl	flash_is_flash_busy
 676              	.LVL51:
 375:../../../mod/flash/flash.c **** flash_status = flash_get_status( pflash_handle );
 677              		.loc 1 375 30 discriminator 1 view .LVU154
 678 003a 0028     		cmp	r0, #0
 679 003c FBD1     		bne	.L43
 376:../../../mod/flash/flash.c **** if ( pflash_handle -> status_register != status_register )
 680              		.loc 1 376 1 is_stmt 1 view .LVU155
 376:../../../mod/flash/flash.c **** if ( pflash_handle -> status_register != status_register )
 681              		.loc 1 376 16 is_stmt 0 view .LVU156
 682 003e 2046     		mov	r0, r4
 683 0040 FFF7FEFF 		bl	flash_get_status
 684              	.LVL52:
 377:../../../mod/flash/flash.c **** 	{
 685              		.loc 1 377 1 is_stmt 1 view .LVU157
 377:../../../mod/flash/flash.c **** 	{
 686              		.loc 1 377 20 is_stmt 0 view .LVU158
 687 0044 E37B     		ldrb	r3, [r4, #15]	@ zero_extendqisi2
ARM GAS  /tmp/ccKy2Hdq.s 			page 38


 377:../../../mod/flash/flash.c **** 	{
 688              		.loc 1 377 4 view .LVU159
 689 0046 AB42     		cmp	r3, r5
 690 0048 04D0     		beq	.L41
 379:../../../mod/flash/flash.c **** 	}
 691              		.loc 1 379 9 view .LVU160
 692 004a 0F20     		movs	r0, #15
 693              	.LVL53:
 379:../../../mod/flash/flash.c **** 	}
 694              		.loc 1 379 9 view .LVU161
 695 004c 02E0     		b	.L41
 696              	.LVL54:
 697              	.L48:
 346:../../../mod/flash/flash.c **** 	return FLASH_OK;
 698              		.loc 1 346 2 is_stmt 1 view .LVU162
 699 004e FFF7FEFF 		bl	flash_write_disable
 700              	.LVL55:
 347:../../../mod/flash/flash.c **** 	}
 701              		.loc 1 347 2 view .LVU163
 347:../../../mod/flash/flash.c **** 	}
 702              		.loc 1 347 9 is_stmt 0 view .LVU164
 703 0052 0020     		movs	r0, #0
 704              	.LVL56:
 705              	.L41:
 386:../../../mod/flash/flash.c **** 
 706              		.loc 1 386 1 view .LVU165
 707 0054 38BD     		pop	{r3, r4, r5, pc}
 708              	.LVL57:
 709              	.L44:
 331:../../../mod/flash/flash.c **** 	}
 710              		.loc 1 331 9 view .LVU166
 711 0056 0A20     		movs	r0, #10
 712 0058 FCE7     		b	.L41
 713              	.LVL58:
 714              	.L45:
 362:../../../mod/flash/flash.c **** 	}
 715              		.loc 1 362 9 view .LVU167
 716 005a 0F20     		movs	r0, #15
 717              	.LVL59:
 362:../../../mod/flash/flash.c **** 	}
 718              		.loc 1 362 9 view .LVU168
 719 005c FAE7     		b	.L41
 720              	.L46:
 368:../../../mod/flash/flash.c **** 	}
 721              		.loc 1 368 9 view .LVU169
 722 005e 0E20     		movs	r0, #14
 723 0060 F8E7     		b	.L41
 724              		.cfi_endproc
 725              	.LFE145:
 727              		.section	.text.flash_write_byte,"ax",%progbits
 728              		.align	1
 729              		.global	flash_write_byte
 730              		.syntax unified
 731              		.thumb
 732              		.thumb_func
 734              	flash_write_byte:
 735              	.LVL60:
ARM GAS  /tmp/ccKy2Hdq.s 			page 39


 736              	.LFB151:
 640:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 737              		.loc 1 640 1 is_stmt 1 view -0
 738              		.cfi_startproc
 739              		@ args = 0, pretend = 0, frame = 16
 740              		@ frame_needed = 0, uses_anonymous_args = 0
 640:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 741              		.loc 1 640 1 is_stmt 0 view .LVU171
 742 0000 F0B5     		push	{r4, r5, r6, r7, lr}
 743              	.LCFI21:
 744              		.cfi_def_cfa_offset 20
 745              		.cfi_offset 4, -20
 746              		.cfi_offset 5, -16
 747              		.cfi_offset 6, -12
 748              		.cfi_offset 7, -8
 749              		.cfi_offset 14, -4
 750 0002 85B0     		sub	sp, sp, #20
 751              	.LCFI22:
 752              		.cfi_def_cfa_offset 40
 753 0004 8DF80710 		strb	r1, [sp, #7]
 644:../../../mod/flash/flash.c **** FLASH_STATUS      flash_status;     /* Status code returned by flash API      */
 754              		.loc 1 644 1 is_stmt 1 view .LVU172
 645:../../../mod/flash/flash.c **** uint8_t           flash_opcode;     /* Data to be transmitted over SPI        */
 755              		.loc 1 645 1 view .LVU173
 646:../../../mod/flash/flash.c **** uint8_t           address[3];       /* Flash memory address in byte form      */
 756              		.loc 1 646 1 view .LVU174
 647:../../../mod/flash/flash.c **** 
 757              		.loc 1 647 1 view .LVU175
 653:../../../mod/flash/flash.c **** flash_opcode  = FLASH_OP_HW_BYTE_PROGRAM;
 758              		.loc 1 653 1 view .LVU176
 759              	.LVL61:
 654:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 760              		.loc 1 654 1 view .LVU177
 654:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 761              		.loc 1 654 15 is_stmt 0 view .LVU178
 762 0008 0223     		movs	r3, #2
 763 000a 8DF80B30 		strb	r3, [sp, #11]
 655:../../../mod/flash/flash.c **** 
 764              		.loc 1 655 1 is_stmt 1 view .LVU179
 765 000e 02A9     		add	r1, sp, #8
 766              	.LVL62:
 655:../../../mod/flash/flash.c **** 
 767              		.loc 1 655 1 is_stmt 0 view .LVU180
 768 0010 4068     		ldr	r0, [r0, #4]
 769              	.LVL63:
 655:../../../mod/flash/flash.c **** 
 770              		.loc 1 655 1 view .LVU181
 771 0012 FFF7FEFF 		bl	address_to_bytes
 772              	.LVL64:
 663:../../../mod/flash/flash.c **** 	{
 773              		.loc 1 663 1 is_stmt 1 view .LVU182
 663:../../../mod/flash/flash.c **** 	{
 774              		.loc 1 663 5 is_stmt 0 view .LVU183
 775 0016 204B     		ldr	r3, .L56
 776 0018 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 663:../../../mod/flash/flash.c **** 	{
 777              		.loc 1 663 3 view .LVU184
ARM GAS  /tmp/ccKy2Hdq.s 			page 40


 778 001a 93B3     		cbz	r3, .L51
 673:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 779              		.loc 1 673 1 is_stmt 1 view .LVU185
 673:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 780              		.loc 1 673 16 is_stmt 0 view .LVU186
 781 001c FFF7FEFF 		bl	write_enable
 782              	.LVL65:
 674:../../../mod/flash/flash.c **** 	{
 783              		.loc 1 674 1 is_stmt 1 view .LVU187
 674:../../../mod/flash/flash.c **** 	{
 784              		.loc 1 674 4 is_stmt 0 view .LVU188
 785 0020 98BB     		cbnz	r0, .L52
 680:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )       ,
 786              		.loc 1 680 1 is_stmt 1 view .LVU189
 787 0022 1E4F     		ldr	r7, .L56+4
 788 0024 0022     		movs	r2, #0
 789 0026 4FF48051 		mov	r1, #4096
 790 002a 3846     		mov	r0, r7
 791              	.LVL66:
 680:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )       ,
 792              		.loc 1 680 1 is_stmt 0 view .LVU190
 793 002c FFF7FEFF 		bl	HAL_GPIO_WritePin
 794              	.LVL67:
 681:../../../mod/flash/flash.c **** 							      &flash_opcode        ,
 795              		.loc 1 681 1 is_stmt 1 view .LVU191
 681:../../../mod/flash/flash.c **** 							      &flash_opcode        ,
 796              		.loc 1 681 17 is_stmt 0 view .LVU192
 797 0030 1B4C     		ldr	r4, .L56+8
 798 0032 0A23     		movs	r3, #10
 799 0034 0122     		movs	r2, #1
 800 0036 0DF10B01 		add	r1, sp, #11
 801 003a 2046     		mov	r0, r4
 802 003c FFF7FEFF 		bl	HAL_SPI_Transmit
 803              	.LVL68:
 804 0040 0546     		mov	r5, r0
 681:../../../mod/flash/flash.c **** 							      &flash_opcode        ,
 805              		.loc 1 681 15 view .LVU193
 806 0042 8DF80C00 		strb	r0, [sp, #12]
 687:../../../mod/flash/flash.c **** 							      &address[0]      ,
 807              		.loc 1 687 1 is_stmt 1 view .LVU194
 687:../../../mod/flash/flash.c **** 							      &address[0]      ,
 808              		.loc 1 687 17 is_stmt 0 view .LVU195
 809 0046 0A23     		movs	r3, #10
 810 0048 0322     		movs	r2, #3
 811 004a 02A9     		add	r1, sp, #8
 812 004c 2046     		mov	r0, r4
 813 004e FFF7FEFF 		bl	HAL_SPI_Transmit
 814              	.LVL69:
 815 0052 0646     		mov	r6, r0
 687:../../../mod/flash/flash.c **** 							      &address[0]      ,
 816              		.loc 1 687 15 view .LVU196
 817 0054 8DF80D00 		strb	r0, [sp, #13]
 693:../../../mod/flash/flash.c **** 							     &byte          ,
 818              		.loc 1 693 1 is_stmt 1 view .LVU197
 693:../../../mod/flash/flash.c **** 							     &byte          ,
 819              		.loc 1 693 17 is_stmt 0 view .LVU198
 820 0058 6423     		movs	r3, #100
ARM GAS  /tmp/ccKy2Hdq.s 			page 41


 821 005a 0122     		movs	r2, #1
 822 005c 0DF10701 		add	r1, sp, #7
 823 0060 2046     		mov	r0, r4
 824 0062 FFF7FEFF 		bl	HAL_SPI_Transmit
 825              	.LVL70:
 826 0066 0446     		mov	r4, r0
 693:../../../mod/flash/flash.c **** 							     &byte          ,
 827              		.loc 1 693 15 view .LVU199
 828 0068 8DF80E00 		strb	r0, [sp, #14]
 697:../../../mod/flash/flash.c **** 
 829              		.loc 1 697 1 is_stmt 1 view .LVU200
 830 006c 0122     		movs	r2, #1
 831 006e 4FF48051 		mov	r1, #4096
 832 0072 3846     		mov	r0, r7
 833 0074 FFF7FEFF 		bl	HAL_GPIO_WritePin
 834              	.LVL71:
 700:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 835              		.loc 1 700 1 view .LVU201
 700:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 836              		.loc 1 700 4 is_stmt 0 view .LVU202
 837 0078 4DB9     		cbnz	r5, .L53
 700:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 838              		.loc 1 700 30 discriminator 1 view .LVU203
 839 007a 56B9     		cbnz	r6, .L54
 701:../../../mod/flash/flash.c **** 	 hal_status[2] != HAL_OK )
 840              		.loc 1 701 30 view .LVU204
 841 007c 14B1     		cbz	r4, .L50
 704:../../../mod/flash/flash.c **** 	}
 842              		.loc 1 704 9 view .LVU205
 843 007e 0824     		movs	r4, #8
 844 0080 00E0     		b	.L50
 845              	.LVL72:
 846              	.L51:
 665:../../../mod/flash/flash.c **** 	}
 847              		.loc 1 665 9 view .LVU206
 848 0082 0524     		movs	r4, #5
 849              	.LVL73:
 850              	.L50:
 711:../../../mod/flash/flash.c **** 
 851              		.loc 1 711 1 view .LVU207
 852 0084 2046     		mov	r0, r4
 853 0086 05B0     		add	sp, sp, #20
 854              	.LCFI23:
 855              		.cfi_remember_state
 856              		.cfi_def_cfa_offset 20
 857              		@ sp needed
 858 0088 F0BD     		pop	{r4, r5, r6, r7, pc}
 859              	.LVL74:
 860              	.L52:
 861              	.LCFI24:
 862              		.cfi_restore_state
 676:../../../mod/flash/flash.c **** 	}
 863              		.loc 1 676 9 view .LVU208
 864 008a 0924     		movs	r4, #9
 865 008c FAE7     		b	.L50
 866              	.LVL75:
 867              	.L53:
ARM GAS  /tmp/ccKy2Hdq.s 			page 42


 704:../../../mod/flash/flash.c **** 	}
 868              		.loc 1 704 9 view .LVU209
 869 008e 0824     		movs	r4, #8
 870 0090 F8E7     		b	.L50
 871              	.L54:
 872 0092 0824     		movs	r4, #8
 873 0094 F6E7     		b	.L50
 874              	.L57:
 875 0096 00BF     		.align	2
 876              	.L56:
 877 0098 00000000 		.word	write_enabled
 878 009c 00040258 		.word	1476527104
 879 00a0 00000000 		.word	hspi2
 880              		.cfi_endproc
 881              	.LFE151:
 883              		.section	.text.flash_write,"ax",%progbits
 884              		.align	1
 885              		.global	flash_write
 886              		.syntax unified
 887              		.thumb
 888              		.thumb_func
 890              	flash_write:
 891              	.LVL76:
 892              	.LFB152:
 727:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 893              		.loc 1 727 1 is_stmt 1 view -0
 894              		.cfi_startproc
 895              		@ args = 0, pretend = 0, frame = 8
 896              		@ frame_needed = 0, uses_anonymous_args = 0
 727:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 897              		.loc 1 727 1 is_stmt 0 view .LVU211
 898 0000 2DE9F04F 		push	{r4, r5, r6, r7, r8, r9, r10, fp, lr}
 899              	.LCFI25:
 900              		.cfi_def_cfa_offset 36
 901              		.cfi_offset 4, -36
 902              		.cfi_offset 5, -32
 903              		.cfi_offset 6, -28
 904              		.cfi_offset 7, -24
 905              		.cfi_offset 8, -20
 906              		.cfi_offset 9, -16
 907              		.cfi_offset 10, -12
 908              		.cfi_offset 11, -8
 909              		.cfi_offset 14, -4
 910 0004 83B0     		sub	sp, sp, #12
 911              	.LCFI26:
 912              		.cfi_def_cfa_offset 48
 913 0006 0446     		mov	r4, r0
 731:../../../mod/flash/flash.c **** FLASH_STATUS      flash_status;     /* Status codes returned by flash API     */
 914              		.loc 1 731 1 is_stmt 1 view .LVU212
 732:../../../mod/flash/flash.c **** uint8_t           flash_opcode;     /* Opcode for flash instructions          */
 915              		.loc 1 732 1 view .LVU213
 733:../../../mod/flash/flash.c **** uint32_t          timeout;          /* Timeout for flash write calls          */
 916              		.loc 1 733 1 view .LVU214
 734:../../../mod/flash/flash.c **** uint32_t          timeout_ctr;      /* Counter to trigger timeout             */
 917              		.loc 1 734 1 view .LVU215
 735:../../../mod/flash/flash.c **** uint8_t*          pbuffer;          /* Pointer to data in flash buffer        */
 918              		.loc 1 735 1 view .LVU216
ARM GAS  /tmp/ccKy2Hdq.s 			page 43


 736:../../../mod/flash/flash.c **** uint8_t           address_bytes[3]; /* Flash memory address in byte form      */
 919              		.loc 1 736 1 view .LVU217
 737:../../../mod/flash/flash.c **** 
 920              		.loc 1 737 1 view .LVU218
 743:../../../mod/flash/flash.c **** flash_status  = FLASH_OK;
 921              		.loc 1 743 1 view .LVU219
 743:../../../mod/flash/flash.c **** flash_status  = FLASH_OK;
 922              		.loc 1 743 15 is_stmt 0 view .LVU220
 923 0008 AD23     		movs	r3, #173
 924 000a 8DF80330 		strb	r3, [sp, #3]
 744:../../../mod/flash/flash.c **** timeout       = pflash_handle -> num_bytes; /* 1 ms/byte timeout */
 925              		.loc 1 744 1 is_stmt 1 view .LVU221
 926              	.LVL77:
 745:../../../mod/flash/flash.c **** timeout_ctr   = 0;
 927              		.loc 1 745 1 view .LVU222
 745:../../../mod/flash/flash.c **** timeout_ctr   = 0;
 928              		.loc 1 745 15 is_stmt 0 view .LVU223
 929 000e 0668     		ldr	r6, [r0]
 930              	.LVL78:
 746:../../../mod/flash/flash.c **** pbuffer       = pflash_handle -> pbuffer;
 931              		.loc 1 746 1 is_stmt 1 view .LVU224
 747:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address_bytes[0] );
 932              		.loc 1 747 1 view .LVU225
 747:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address_bytes[0] );
 933              		.loc 1 747 15 is_stmt 0 view .LVU226
 934 0010 8768     		ldr	r7, [r0, #8]
 935              	.LVL79:
 748:../../../mod/flash/flash.c **** 
 936              		.loc 1 748 1 is_stmt 1 view .LVU227
 937 0012 6946     		mov	r1, sp
 938 0014 4068     		ldr	r0, [r0, #4]
 939              	.LVL80:
 748:../../../mod/flash/flash.c **** 
 940              		.loc 1 748 1 is_stmt 0 view .LVU228
 941 0016 FFF7FEFF 		bl	address_to_bytes
 942              	.LVL81:
 756:../../../mod/flash/flash.c **** 	{
 943              		.loc 1 756 1 is_stmt 1 view .LVU229
 756:../../../mod/flash/flash.c **** 	{
 944              		.loc 1 756 5 is_stmt 0 view .LVU230
 945 001a 5A4B     		ldr	r3, .L80
 946 001c 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 756:../../../mod/flash/flash.c **** 	{
 947              		.loc 1 756 3 view .LVU231
 948 001e 002B     		cmp	r3, #0
 949 0020 00F09880 		beq	.L67
 762:../../../mod/flash/flash.c **** 	{
 950              		.loc 1 762 1 is_stmt 1 view .LVU232
 762:../../../mod/flash/flash.c **** 	{
 951              		.loc 1 762 25 is_stmt 0 view .LVU233
 952 0024 2368     		ldr	r3, [r4]
 762:../../../mod/flash/flash.c **** 	{
 953              		.loc 1 762 9 view .LVU234
 954 0026 012B     		cmp	r3, #1
 955 0028 4BD0     		beq	.L78
 766:../../../mod/flash/flash.c **** 	{
 956              		.loc 1 766 6 is_stmt 1 view .LVU235
ARM GAS  /tmp/ccKy2Hdq.s 			page 44


 766:../../../mod/flash/flash.c **** 	{
 957              		.loc 1 766 9 is_stmt 0 view .LVU236
 958 002a 002B     		cmp	r3, #0
 959 002c 00F09480 		beq	.L68
 777:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 960              		.loc 1 777 1 is_stmt 1 view .LVU237
 777:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 961              		.loc 1 777 16 is_stmt 0 view .LVU238
 962 0030 FFF7FEFF 		bl	write_enable
 963              	.LVL82:
 778:../../../mod/flash/flash.c **** 	{
 964              		.loc 1 778 1 is_stmt 1 view .LVU239
 778:../../../mod/flash/flash.c **** 	{
 965              		.loc 1 778 4 is_stmt 0 view .LVU240
 966 0034 0028     		cmp	r0, #0
 967 0036 40F09480 		bne	.L69
 784:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )        ,
 968              		.loc 1 784 1 is_stmt 1 view .LVU241
 969 003a DFF84CA1 		ldr	r10, .L80+4
 970 003e 0022     		movs	r2, #0
 971 0040 4FF48051 		mov	r1, #4096
 972 0044 5046     		mov	r0, r10
 973              	.LVL83:
 784:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )        ,
 974              		.loc 1 784 1 is_stmt 0 view .LVU242
 975 0046 FFF7FEFF 		bl	HAL_GPIO_WritePin
 976              	.LVL84:
 785:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 977              		.loc 1 785 1 is_stmt 1 view .LVU243
 785:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 978              		.loc 1 785 17 is_stmt 0 view .LVU244
 979 004a DFF84091 		ldr	r9, .L80+8
 980 004e 0A23     		movs	r3, #10
 981 0050 0122     		movs	r2, #1
 982 0052 0DF10301 		add	r1, sp, #3
 983 0056 4846     		mov	r0, r9
 984 0058 FFF7FEFF 		bl	HAL_SPI_Transmit
 985              	.LVL85:
 986 005c 0546     		mov	r5, r0
 785:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 987              		.loc 1 785 15 view .LVU245
 988 005e 8DF80400 		strb	r0, [sp, #4]
 789:../../../mod/flash/flash.c **** 							      &address_bytes[0]      ,
 989              		.loc 1 789 1 is_stmt 1 view .LVU246
 789:../../../mod/flash/flash.c **** 							      &address_bytes[0]      ,
 990              		.loc 1 789 17 is_stmt 0 view .LVU247
 991 0062 0A23     		movs	r3, #10
 992 0064 0322     		movs	r2, #3
 993 0066 6946     		mov	r1, sp
 994 0068 4846     		mov	r0, r9
 995 006a FFF7FEFF 		bl	HAL_SPI_Transmit
 996              	.LVL86:
 997 006e 8046     		mov	r8, r0
 789:../../../mod/flash/flash.c **** 							      &address_bytes[0]      ,
 998              		.loc 1 789 15 view .LVU248
 999 0070 8DF80500 		strb	r0, [sp, #5]
 793:../../../mod/flash/flash.c ****                                   pbuffer       ,
ARM GAS  /tmp/ccKy2Hdq.s 			page 45


 1000              		.loc 1 793 1 is_stmt 1 view .LVU249
 793:../../../mod/flash/flash.c ****                                   pbuffer       ,
 1001              		.loc 1 793 17 is_stmt 0 view .LVU250
 1002 0074 0A23     		movs	r3, #10
 1003 0076 0222     		movs	r2, #2
 1004 0078 3946     		mov	r1, r7
 1005 007a 4846     		mov	r0, r9
 1006 007c FFF7FEFF 		bl	HAL_SPI_Transmit
 1007              	.LVL87:
 1008 0080 8146     		mov	r9, r0
 793:../../../mod/flash/flash.c ****                                   pbuffer       ,
 1009              		.loc 1 793 15 view .LVU251
 1010 0082 8DF80600 		strb	r0, [sp, #6]
 797:../../../mod/flash/flash.c **** 
 1011              		.loc 1 797 1 is_stmt 1 view .LVU252
 1012 0086 0122     		movs	r2, #1
 1013 0088 4FF48051 		mov	r1, #4096
 1014 008c 5046     		mov	r0, r10
 1015 008e FFF7FEFF 		bl	HAL_GPIO_WritePin
 1016              	.LVL88:
 800:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 1017              		.loc 1 800 1 view .LVU253
 800:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 1018              		.loc 1 800 4 is_stmt 0 view .LVU254
 1019 0092 002D     		cmp	r5, #0
 1020 0094 67D1     		bne	.L70
 800:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK ||
 1021              		.loc 1 800 30 discriminator 1 view .LVU255
 1022 0096 B8F1000F 		cmp	r8, #0
 1023 009a 66D1     		bne	.L71
 801:../../../mod/flash/flash.c **** 	 hal_status[2] != HAL_OK )
 1024              		.loc 1 801 30 view .LVU256
 1025 009c B9F1000F 		cmp	r9, #0
 1026 00a0 65D1     		bne	.L72
 1027              	.LBB7:
 808:../../../mod/flash/flash.c **** 	{
 1028              		.loc 1 808 11 view .LVU257
 1029 00a2 4FF0020A 		mov	r10, #2
 1030              	.LVL89:
 1031              	.L61:
 808:../../../mod/flash/flash.c **** 	{
 1032              		.loc 1 808 20 is_stmt 1 discriminator 1 view .LVU258
 808:../../../mod/flash/flash.c **** 	{
 1033              		.loc 1 808 36 is_stmt 0 discriminator 1 view .LVU259
 1034 00a6 2368     		ldr	r3, [r4]
 808:../../../mod/flash/flash.c **** 	{
 1035              		.loc 1 808 20 discriminator 1 view .LVU260
 1036 00a8 5345     		cmp	r3, r10
 1037 00aa 3DD9     		bls	.L65
 811:../../../mod/flash/flash.c **** 
 1038              		.loc 1 811 2 is_stmt 1 view .LVU261
 811:../../../mod/flash/flash.c **** 
 1039              		.loc 1 811 10 is_stmt 0 view .LVU262
 1040 00ac 0237     		adds	r7, r7, #2
 1041              	.LVL90:
 814:../../../mod/flash/flash.c **** 		{
 1042              		.loc 1 814 2 is_stmt 1 view .LVU263
ARM GAS  /tmp/ccKy2Hdq.s 			page 46


 1043              	.L62:
 814:../../../mod/flash/flash.c **** 		{
 1044              		.loc 1 814 31 view .LVU264
 814:../../../mod/flash/flash.c **** 		{
 1045              		.loc 1 814 9 is_stmt 0 view .LVU265
 1046 00ae FFF7FEFF 		bl	flash_is_flash_busy
 1047              	.LVL91:
 814:../../../mod/flash/flash.c **** 		{
 1048              		.loc 1 814 31 view .LVU266
 1049 00b2 68B1     		cbz	r0, .L79
 816:../../../mod/flash/flash.c **** 			{
 1050              		.loc 1 816 3 is_stmt 1 view .LVU267
 816:../../../mod/flash/flash.c **** 			{
 1051              		.loc 1 816 6 is_stmt 0 view .LVU268
 1052 00b4 B542     		cmp	r5, r6
 1053 00b6 5CD2     		bcs	.L73
 822:../../../mod/flash/flash.c **** 			HAL_Delay( 1 );
 1054              		.loc 1 822 4 is_stmt 1 view .LVU269
 822:../../../mod/flash/flash.c **** 			HAL_Delay( 1 );
 1055              		.loc 1 822 15 is_stmt 0 view .LVU270
 1056 00b8 0135     		adds	r5, r5, #1
 1057              	.LVL92:
 823:../../../mod/flash/flash.c **** 			}
 1058              		.loc 1 823 4 is_stmt 1 view .LVU271
 1059 00ba 0120     		movs	r0, #1
 1060 00bc FFF7FEFF 		bl	HAL_Delay
 1061              	.LVL93:
 1062 00c0 F5E7     		b	.L62
 1063              	.LVL94:
 1064              	.L78:
 823:../../../mod/flash/flash.c **** 			}
 1065              		.loc 1 823 4 is_stmt 0 view .LVU272
 1066              	.LBE7:
 764:../../../mod/flash/flash.c **** 	}
 1067              		.loc 1 764 2 is_stmt 1 view .LVU273
 764:../../../mod/flash/flash.c **** 	}
 1068              		.loc 1 764 59 is_stmt 0 view .LVU274
 1069 00c2 A368     		ldr	r3, [r4, #8]
 764:../../../mod/flash/flash.c **** 	}
 1070              		.loc 1 764 9 view .LVU275
 1071 00c4 1978     		ldrb	r1, [r3]	@ zero_extendqisi2
 1072 00c6 2046     		mov	r0, r4
 1073 00c8 FFF7FEFF 		bl	flash_write_byte
 1074              	.LVL95:
 1075 00cc 0546     		mov	r5, r0
 1076 00ce 44E0     		b	.L59
 1077              	.LVL96:
 1078              	.L79:
 1079              	.LBB8:
 828:../../../mod/flash/flash.c **** 	hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )        ,
 1080              		.loc 1 828 2 is_stmt 1 view .LVU276
 1081 00d0 DFF8B4B0 		ldr	fp, .L80+4
 1082 00d4 0022     		movs	r2, #0
 1083 00d6 4FF48051 		mov	r1, #4096
 1084 00da 5846     		mov	r0, fp
 1085 00dc FFF7FEFF 		bl	HAL_GPIO_WritePin
 1086              	.LVL97:
ARM GAS  /tmp/ccKy2Hdq.s 			page 47


 829:../../../mod/flash/flash.c **** 									&flash_opcode         ,
 1087              		.loc 1 829 2 view .LVU277
 829:../../../mod/flash/flash.c **** 									&flash_opcode         ,
 1088              		.loc 1 829 18 is_stmt 0 view .LVU278
 1089 00e0 DFF8A890 		ldr	r9, .L80+8
 1090 00e4 0A23     		movs	r3, #10
 1091 00e6 0122     		movs	r2, #1
 1092 00e8 0DF10301 		add	r1, sp, #3
 1093 00ec 4846     		mov	r0, r9
 1094 00ee FFF7FEFF 		bl	HAL_SPI_Transmit
 1095              	.LVL98:
 1096 00f2 8046     		mov	r8, r0
 829:../../../mod/flash/flash.c **** 									&flash_opcode         ,
 1097              		.loc 1 829 16 view .LVU279
 1098 00f4 8DF80400 		strb	r0, [sp, #4]
 833:../../../mod/flash/flash.c **** 									pbuffer       ,
 1099              		.loc 1 833 2 is_stmt 1 view .LVU280
 833:../../../mod/flash/flash.c **** 									pbuffer       ,
 1100              		.loc 1 833 18 is_stmt 0 view .LVU281
 1101 00f8 0A23     		movs	r3, #10
 1102 00fa 0222     		movs	r2, #2
 1103 00fc 3946     		mov	r1, r7
 1104 00fe 4846     		mov	r0, r9
 1105 0100 FFF7FEFF 		bl	HAL_SPI_Transmit
 1106              	.LVL99:
 1107 0104 8146     		mov	r9, r0
 833:../../../mod/flash/flash.c **** 									pbuffer       ,
 1108              		.loc 1 833 16 view .LVU282
 1109 0106 8DF80500 		strb	r0, [sp, #5]
 837:../../../mod/flash/flash.c **** 
 1110              		.loc 1 837 2 is_stmt 1 view .LVU283
 1111 010a 0122     		movs	r2, #1
 1112 010c 4FF48051 		mov	r1, #4096
 1113 0110 5846     		mov	r0, fp
 1114 0112 FFF7FEFF 		bl	HAL_GPIO_WritePin
 1115              	.LVL100:
 840:../../../mod/flash/flash.c **** 		{
 1116              		.loc 1 840 2 view .LVU284
 840:../../../mod/flash/flash.c **** 		{
 1117              		.loc 1 840 5 is_stmt 0 view .LVU285
 1118 0116 B8F1000F 		cmp	r8, #0
 1119 011a 2CD1     		bne	.L74
 840:../../../mod/flash/flash.c **** 		{
 1120              		.loc 1 840 31 discriminator 1 view .LVU286
 1121 011c B9F1000F 		cmp	r9, #0
 1122 0120 2BD1     		bne	.L75
 808:../../../mod/flash/flash.c **** 	{
 1123              		.loc 1 808 52 is_stmt 1 discriminator 2 view .LVU287
 1124 0122 0AF1020A 		add	r10, r10, #2
 1125              	.LVL101:
 808:../../../mod/flash/flash.c **** 	{
 1126              		.loc 1 808 52 is_stmt 0 discriminator 2 view .LVU288
 1127 0126 BEE7     		b	.L61
 1128              	.L65:
 808:../../../mod/flash/flash.c **** 	{
 1129              		.loc 1 808 52 discriminator 2 view .LVU289
 1130              	.LBE8:
ARM GAS  /tmp/ccKy2Hdq.s 			page 48


 847:../../../mod/flash/flash.c **** 
 1131              		.loc 1 847 47 is_stmt 1 discriminator 1 view .LVU290
 847:../../../mod/flash/flash.c **** 
 1132              		.loc 1 847 31 discriminator 1 view .LVU291
 847:../../../mod/flash/flash.c **** 
 1133              		.loc 1 847 9 is_stmt 0 discriminator 1 view .LVU292
 1134 0128 FFF7FEFF 		bl	flash_is_flash_busy
 1135              	.LVL102:
 847:../../../mod/flash/flash.c **** 
 1136              		.loc 1 847 31 discriminator 1 view .LVU293
 1137 012c 0028     		cmp	r0, #0
 1138 012e FBD1     		bne	.L65
 850:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 1139              		.loc 1 850 1 is_stmt 1 view .LVU294
 850:../../../mod/flash/flash.c **** if ( flash_status != FLASH_OK )
 1140              		.loc 1 850 16 is_stmt 0 view .LVU295
 1141 0130 FFF7FEFF 		bl	write_disable
 1142              	.LVL103:
 851:../../../mod/flash/flash.c **** 	{
 1143              		.loc 1 851 1 is_stmt 1 view .LVU296
 851:../../../mod/flash/flash.c **** 	{
 1144              		.loc 1 851 4 is_stmt 0 view .LVU297
 1145 0134 0546     		mov	r5, r0
 1146              	.LVL104:
 851:../../../mod/flash/flash.c **** 	{
 1147              		.loc 1 851 4 view .LVU298
 1148 0136 10BB     		cbnz	r0, .L76
 1149              	.LVL105:
 1150              	.L66:
 857:../../../mod/flash/flash.c **** 
 1151              		.loc 1 857 47 is_stmt 1 discriminator 1 view .LVU299
 857:../../../mod/flash/flash.c **** 
 1152              		.loc 1 857 31 discriminator 1 view .LVU300
 857:../../../mod/flash/flash.c **** 
 1153              		.loc 1 857 9 is_stmt 0 discriminator 1 view .LVU301
 1154 0138 FFF7FEFF 		bl	flash_is_flash_busy
 1155              	.LVL106:
 857:../../../mod/flash/flash.c **** 
 1156              		.loc 1 857 31 discriminator 1 view .LVU302
 1157 013c 0028     		cmp	r0, #0
 1158 013e FBD1     		bne	.L66
 860:../../../mod/flash/flash.c **** 	{
 1159              		.loc 1 860 1 is_stmt 1 view .LVU303
 860:../../../mod/flash/flash.c **** 	{
 1160              		.loc 1 860 22 is_stmt 0 view .LVU304
 1161 0140 2368     		ldr	r3, [r4]
 860:../../../mod/flash/flash.c **** 	{
 1162              		.loc 1 860 4 view .LVU305
 1163 0142 13F0010F 		tst	r3, #1
 1164 0146 08D0     		beq	.L59
 862:../../../mod/flash/flash.c **** 	return flash_write_byte( pflash_handle, *pbuffer );
 1165              		.loc 1 862 2 is_stmt 1 view .LVU306
 1166              	.LVL107:
 863:../../../mod/flash/flash.c **** 	}
 1167              		.loc 1 863 2 view .LVU307
 863:../../../mod/flash/flash.c **** 	}
 1168              		.loc 1 863 9 is_stmt 0 view .LVU308
ARM GAS  /tmp/ccKy2Hdq.s 			page 49


 1169 0148 7978     		ldrb	r1, [r7, #1]	@ zero_extendqisi2
 1170 014a 2046     		mov	r0, r4
 1171 014c FFF7FEFF 		bl	flash_write_byte
 1172              	.LVL108:
 1173 0150 0546     		mov	r5, r0
 1174 0152 02E0     		b	.L59
 1175              	.LVL109:
 1176              	.L67:
 758:../../../mod/flash/flash.c **** 	}
 1177              		.loc 1 758 9 view .LVU309
 1178 0154 0525     		movs	r5, #5
 1179 0156 00E0     		b	.L59
 1180              	.L68:
 768:../../../mod/flash/flash.c **** 	}
 1181              		.loc 1 768 9 view .LVU310
 1182 0158 0C25     		movs	r5, #12
 1183              	.LVL110:
 1184              	.L59:
 871:../../../mod/flash/flash.c **** 
 1185              		.loc 1 871 1 view .LVU311
 1186 015a 2846     		mov	r0, r5
 1187 015c 03B0     		add	sp, sp, #12
 1188              	.LCFI27:
 1189              		.cfi_remember_state
 1190              		.cfi_def_cfa_offset 36
 1191              		@ sp needed
 1192 015e BDE8F08F 		pop	{r4, r5, r6, r7, r8, r9, r10, fp, pc}
 1193              	.LVL111:
 1194              	.L69:
 1195              	.LCFI28:
 1196              		.cfi_restore_state
 780:../../../mod/flash/flash.c **** 	}
 1197              		.loc 1 780 9 view .LVU312
 1198 0162 0925     		movs	r5, #9
 1199 0164 F9E7     		b	.L59
 1200              	.LVL112:
 1201              	.L70:
 804:../../../mod/flash/flash.c **** 	}
 1202              		.loc 1 804 9 view .LVU313
 1203 0166 0825     		movs	r5, #8
 1204 0168 F7E7     		b	.L59
 1205              	.L71:
 1206 016a 0825     		movs	r5, #8
 1207 016c F5E7     		b	.L59
 1208              	.L72:
 1209 016e 0825     		movs	r5, #8
 1210 0170 F3E7     		b	.L59
 1211              	.LVL113:
 1212              	.L73:
 1213              	.LBB9:
 818:../../../mod/flash/flash.c **** 			}
 1214              		.loc 1 818 11 view .LVU314
 1215 0172 0425     		movs	r5, #4
 1216              	.LVL114:
 818:../../../mod/flash/flash.c **** 			}
 1217              		.loc 1 818 11 view .LVU315
 1218 0174 F1E7     		b	.L59
ARM GAS  /tmp/ccKy2Hdq.s 			page 50


 1219              	.LVL115:
 1220              	.L74:
 842:../../../mod/flash/flash.c **** 		}
 1221              		.loc 1 842 10 view .LVU316
 1222 0176 0B25     		movs	r5, #11
 1223              	.LVL116:
 842:../../../mod/flash/flash.c **** 		}
 1224              		.loc 1 842 10 view .LVU317
 1225 0178 EFE7     		b	.L59
 1226              	.LVL117:
 1227              	.L75:
 842:../../../mod/flash/flash.c **** 		}
 1228              		.loc 1 842 10 view .LVU318
 1229 017a 0B25     		movs	r5, #11
 1230              	.LVL118:
 842:../../../mod/flash/flash.c **** 		}
 1231              		.loc 1 842 10 view .LVU319
 1232 017c EDE7     		b	.L59
 1233              	.LVL119:
 1234              	.L76:
 842:../../../mod/flash/flash.c **** 		}
 1235              		.loc 1 842 10 view .LVU320
 1236              	.LBE9:
 853:../../../mod/flash/flash.c **** 	}
 1237              		.loc 1 853 9 view .LVU321
 1238 017e 0D25     		movs	r5, #13
 1239 0180 EBE7     		b	.L59
 1240              	.L81:
 1241 0182 00BF     		.align	2
 1242              	.L80:
 1243 0184 00000000 		.word	write_enabled
 1244 0188 00040258 		.word	1476527104
 1245 018c 00000000 		.word	hspi2
 1246              		.cfi_endproc
 1247              	.LFE152:
 1249              		.section	.text.flash_read,"ax",%progbits
 1250              		.align	1
 1251              		.global	flash_read
 1252              		.syntax unified
 1253              		.thumb
 1254              		.thumb_func
 1256              	flash_read:
 1257              	.LVL120:
 1258              	.LFB153:
 888:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 1259              		.loc 1 888 1 is_stmt 1 view -0
 1260              		.cfi_startproc
 1261              		@ args = 0, pretend = 0, frame = 16
 1262              		@ frame_needed = 0, uses_anonymous_args = 0
 888:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 1263              		.loc 1 888 1 is_stmt 0 view .LVU323
 1264 0000 2DE9F041 		push	{r4, r5, r6, r7, r8, lr}
 1265              	.LCFI29:
 1266              		.cfi_def_cfa_offset 24
 1267              		.cfi_offset 4, -24
 1268              		.cfi_offset 5, -20
 1269              		.cfi_offset 6, -16
ARM GAS  /tmp/ccKy2Hdq.s 			page 51


 1270              		.cfi_offset 7, -12
 1271              		.cfi_offset 8, -8
 1272              		.cfi_offset 14, -4
 1273 0004 84B0     		sub	sp, sp, #16
 1274              	.LCFI30:
 1275              		.cfi_def_cfa_offset 40
 1276 0006 0546     		mov	r5, r0
 1277 0008 0E46     		mov	r6, r1
 892:../../../mod/flash/flash.c **** uint8_t           flash_opcode;  /* Data to be transmitted over SPI           */
 1278              		.loc 1 892 1 is_stmt 1 view .LVU324
 893:../../../mod/flash/flash.c **** uint8_t           address[3];    /* Flash address in byte format              */
 1279              		.loc 1 893 1 view .LVU325
 894:../../../mod/flash/flash.c **** uint8_t*          pbuffer;       /* Pointer to position in output buffer      */
 1280              		.loc 1 894 1 view .LVU326
 895:../../../mod/flash/flash.c **** uint8_t           dummy_byte;    /* Dummy byte needed for high speed read     */
 1281              		.loc 1 895 1 view .LVU327
 896:../../../mod/flash/flash.c **** 
 1282              		.loc 1 896 1 view .LVU328
 902:../../../mod/flash/flash.c **** dummy_byte   = 0;
 1283              		.loc 1 902 1 view .LVU329
 902:../../../mod/flash/flash.c **** dummy_byte   = 0;
 1284              		.loc 1 902 14 is_stmt 0 view .LVU330
 1285 000a 0B23     		movs	r3, #11
 1286 000c 8DF80B30 		strb	r3, [sp, #11]
 903:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 1287              		.loc 1 903 1 is_stmt 1 view .LVU331
 903:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 1288              		.loc 1 903 14 is_stmt 0 view .LVU332
 1289 0010 0024     		movs	r4, #0
 1290 0012 8DF80740 		strb	r4, [sp, #7]
 904:../../../mod/flash/flash.c **** 
 1291              		.loc 1 904 1 is_stmt 1 view .LVU333
 1292 0016 02A9     		add	r1, sp, #8
 1293              	.LVL121:
 904:../../../mod/flash/flash.c **** 
 1294              		.loc 1 904 1 is_stmt 0 view .LVU334
 1295 0018 4068     		ldr	r0, [r0, #4]
 1296              	.LVL122:
 904:../../../mod/flash/flash.c **** 
 1297              		.loc 1 904 1 view .LVU335
 1298 001a FFF7FEFF 		bl	address_to_bytes
 1299              	.LVL123:
 912:../../../mod/flash/flash.c **** 
 1300              		.loc 1 912 1 is_stmt 1 view .LVU336
 1301 001e 2246     		mov	r2, r4
 1302 0020 4FF48051 		mov	r1, #4096
 1303 0024 2248     		ldr	r0, .L92
 1304 0026 FFF7FEFF 		bl	HAL_GPIO_WritePin
 1305              	.LVL124:
 915:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 1306              		.loc 1 915 1 view .LVU337
 915:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 1307              		.loc 1 915 17 is_stmt 0 view .LVU338
 1308 002a 224F     		ldr	r7, .L92+4
 1309 002c 0A23     		movs	r3, #10
 1310 002e 0122     		movs	r2, #1
 1311 0030 0DF10B01 		add	r1, sp, #11
ARM GAS  /tmp/ccKy2Hdq.s 			page 52


 1312 0034 3846     		mov	r0, r7
 1313 0036 FFF7FEFF 		bl	HAL_SPI_Transmit
 1314              	.LVL125:
 1315 003a 0446     		mov	r4, r0
 915:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 1316              		.loc 1 915 15 view .LVU339
 1317 003c 8DF80C00 		strb	r0, [sp, #12]
 921:../../../mod/flash/flash.c **** 							      &( address[0] )  ,
 1318              		.loc 1 921 1 is_stmt 1 view .LVU340
 921:../../../mod/flash/flash.c **** 							      &( address[0] )  ,
 1319              		.loc 1 921 17 is_stmt 0 view .LVU341
 1320 0040 0A23     		movs	r3, #10
 1321 0042 0322     		movs	r2, #3
 1322 0044 02A9     		add	r1, sp, #8
 1323 0046 3846     		mov	r0, r7
 1324 0048 FFF7FEFF 		bl	HAL_SPI_Transmit
 1325              	.LVL126:
 1326 004c 8046     		mov	r8, r0
 921:../../../mod/flash/flash.c **** 							      &( address[0] )  ,
 1327              		.loc 1 921 15 view .LVU342
 1328 004e 8DF80D00 		strb	r0, [sp, #13]
 927:../../../mod/flash/flash.c **** 							      &( dummy_byte )  ,
 1329              		.loc 1 927 1 is_stmt 1 view .LVU343
 927:../../../mod/flash/flash.c **** 							      &( dummy_byte )  ,
 1330              		.loc 1 927 17 is_stmt 0 view .LVU344
 1331 0052 0A23     		movs	r3, #10
 1332 0054 0122     		movs	r2, #1
 1333 0056 0DF10701 		add	r1, sp, #7
 1334 005a 3846     		mov	r0, r7
 1335 005c FFF7FEFF 		bl	HAL_SPI_Transmit
 1336              	.LVL127:
 927:../../../mod/flash/flash.c **** 							      &( dummy_byte )  ,
 1337              		.loc 1 927 15 view .LVU345
 1338 0060 8DF80E00 		strb	r0, [sp, #14]
 933:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK || 
 1339              		.loc 1 933 1 is_stmt 1 view .LVU346
 933:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK || 
 1340              		.loc 1 933 4 is_stmt 0 view .LVU347
 1341 0064 E4B9     		cbnz	r4, .L86
 1342 0066 0746     		mov	r7, r0
 933:../../../mod/flash/flash.c ****      hal_status[1] != HAL_OK || 
 1343              		.loc 1 933 30 discriminator 1 view .LVU348
 1344 0068 B8F1000F 		cmp	r8, #0
 1345 006c 1AD1     		bne	.L87
 934:../../../mod/flash/flash.c **** 	 hal_status[2] != HAL_OK )
 1346              		.loc 1 934 30 view .LVU349
 1347 006e D8B9     		cbnz	r0, .L88
 1348              	.L84:
 1349              	.LVL128:
 1350              	.LBB10:
 941:../../../mod/flash/flash.c **** 	{
 1351              		.loc 1 941 20 is_stmt 1 discriminator 1 view .LVU350
 1352 0070 B442     		cmp	r4, r6
 1353 0072 0BD2     		bcs	.L91
 943:../../../mod/flash/flash.c **** 	hal_status[3] = HAL_SPI_Receive( &( FLASH_SPI )      ,
 1354              		.loc 1 943 2 view .LVU351
 943:../../../mod/flash/flash.c **** 	hal_status[3] = HAL_SPI_Receive( &( FLASH_SPI )      ,
ARM GAS  /tmp/ccKy2Hdq.s 			page 53


 1355              		.loc 1 943 28 is_stmt 0 view .LVU352
 1356 0074 A968     		ldr	r1, [r5, #8]
 1357              	.LVL129:
 944:../../../mod/flash/flash.c **** 								     pbuffer             ,
 1358              		.loc 1 944 2 is_stmt 1 view .LVU353
 944:../../../mod/flash/flash.c **** 								     pbuffer             ,
 1359              		.loc 1 944 18 is_stmt 0 view .LVU354
 1360 0076 0A23     		movs	r3, #10
 1361 0078 0122     		movs	r2, #1
 1362 007a 2144     		add	r1, r1, r4
 1363              	.LVL130:
 944:../../../mod/flash/flash.c **** 								     pbuffer             ,
 1364              		.loc 1 944 18 view .LVU355
 1365 007c 0D48     		ldr	r0, .L92+4
 1366 007e FFF7FEFF 		bl	HAL_SPI_Receive
 1367              	.LVL131:
 944:../../../mod/flash/flash.c **** 								     pbuffer             ,
 1368              		.loc 1 944 16 view .LVU356
 1369 0082 8DF80F00 		strb	r0, [sp, #15]
 949:../../../mod/flash/flash.c **** 		{
 1370              		.loc 1 949 2 is_stmt 1 view .LVU357
 949:../../../mod/flash/flash.c **** 		{
 1371              		.loc 1 949 5 is_stmt 0 view .LVU358
 1372 0086 88B9     		cbnz	r0, .L89
 941:../../../mod/flash/flash.c **** 	{
 1373              		.loc 1 941 33 is_stmt 1 discriminator 2 view .LVU359
 1374 0088 0134     		adds	r4, r4, #1
 1375              	.LVL132:
 941:../../../mod/flash/flash.c **** 	{
 1376              		.loc 1 941 33 is_stmt 0 discriminator 2 view .LVU360
 1377 008a F1E7     		b	.L84
 1378              	.LVL133:
 1379              	.L91:
 941:../../../mod/flash/flash.c **** 	{
 1380              		.loc 1 941 33 discriminator 2 view .LVU361
 1381              	.LBE10:
 956:../../../mod/flash/flash.c **** 
 1382              		.loc 1 956 1 is_stmt 1 view .LVU362
 1383 008c 0122     		movs	r2, #1
 1384 008e 4FF48051 		mov	r1, #4096
 1385 0092 0748     		ldr	r0, .L92
 1386 0094 FFF7FEFF 		bl	HAL_GPIO_WritePin
 1387              	.LVL134:
 959:../../../mod/flash/flash.c **** 
 1388              		.loc 1 959 1 view .LVU363
 1389              	.L83:
 961:../../../mod/flash/flash.c **** 
 1390              		.loc 1 961 1 is_stmt 0 view .LVU364
 1391 0098 3846     		mov	r0, r7
 1392 009a 04B0     		add	sp, sp, #16
 1393              	.LCFI31:
 1394              		.cfi_remember_state
 1395              		.cfi_def_cfa_offset 24
 1396              		@ sp needed
 1397 009c BDE8F081 		pop	{r4, r5, r6, r7, r8, pc}
 1398              	.LVL135:
 1399              	.L86:
ARM GAS  /tmp/ccKy2Hdq.s 			page 54


 1400              	.LCFI32:
 1401              		.cfi_restore_state
 937:../../../mod/flash/flash.c **** 	}
 1402              		.loc 1 937 9 view .LVU365
 1403 00a0 0827     		movs	r7, #8
 1404 00a2 F9E7     		b	.L83
 1405              	.L87:
 1406 00a4 0827     		movs	r7, #8
 1407 00a6 F7E7     		b	.L83
 1408              	.L88:
 1409 00a8 0827     		movs	r7, #8
 1410 00aa F5E7     		b	.L83
 1411              	.LVL136:
 1412              	.L89:
 1413              	.LBB11:
 951:../../../mod/flash/flash.c **** 		}
 1414              		.loc 1 951 10 view .LVU366
 1415 00ac 0827     		movs	r7, #8
 1416 00ae F3E7     		b	.L83
 1417              	.L93:
 1418              		.align	2
 1419              	.L92:
 1420 00b0 00040258 		.word	1476527104
 1421 00b4 00000000 		.word	hspi2
 1422              	.LBE11:
 1423              		.cfi_endproc
 1424              	.LFE153:
 1426              		.section	.text.flash_erase,"ax",%progbits
 1427              		.align	1
 1428              		.global	flash_erase
 1429              		.syntax unified
 1430              		.thumb
 1431              		.thumb_func
 1433              	flash_erase:
 1434              	.LVL137:
 1435              	.LFB154:
 977:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 1436              		.loc 1 977 1 is_stmt 1 view -0
 1437              		.cfi_startproc
 1438              		@ args = 0, pretend = 0, frame = 8
 1439              		@ frame_needed = 0, uses_anonymous_args = 0
 977:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 1440              		.loc 1 977 1 is_stmt 0 view .LVU368
 1441 0000 70B5     		push	{r4, r5, r6, lr}
 1442              	.LCFI33:
 1443              		.cfi_def_cfa_offset 16
 1444              		.cfi_offset 4, -16
 1445              		.cfi_offset 5, -12
 1446              		.cfi_offset 6, -8
 1447              		.cfi_offset 14, -4
 1448 0002 82B0     		sub	sp, sp, #8
 1449              	.LCFI34:
 1450              		.cfi_def_cfa_offset 24
 981:../../../mod/flash/flash.c **** uint8_t      flash_opcode;  /* Data to be transmitted over SPI                */
 1451              		.loc 1 981 1 is_stmt 1 view .LVU369
 982:../../../mod/flash/flash.c **** FLASH_STATUS flash_status;
 1452              		.loc 1 982 1 view .LVU370
ARM GAS  /tmp/ccKy2Hdq.s 			page 55


 983:../../../mod/flash/flash.c **** 
 1453              		.loc 1 983 1 view .LVU371
 989:../../../mod/flash/flash.c **** 
 1454              		.loc 1 989 1 view .LVU372
 989:../../../mod/flash/flash.c **** 
 1455              		.loc 1 989 14 is_stmt 0 view .LVU373
 1456 0004 6023     		movs	r3, #96
 1457 0006 8DF80730 		strb	r3, [sp, #7]
 997:../../../mod/flash/flash.c ****     {
 1458              		.loc 1 997 1 is_stmt 1 view .LVU374
 997:../../../mod/flash/flash.c ****     {
 1459              		.loc 1 997 5 is_stmt 0 view .LVU375
 1460 000a 124B     		ldr	r3, .L99
 1461 000c 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 997:../../../mod/flash/flash.c ****     {
 1462              		.loc 1 997 3 view .LVU376
 1463 000e DBB1     		cbz	r3, .L96
1008:../../../mod/flash/flash.c **** 
 1464              		.loc 1 1008 1 is_stmt 1 view .LVU377
1008:../../../mod/flash/flash.c **** 
 1465              		.loc 1 1008 16 is_stmt 0 view .LVU378
 1466 0010 FFF7FEFF 		bl	write_enable
 1467              	.LVL138:
1008:../../../mod/flash/flash.c **** 
 1468              		.loc 1 1008 16 view .LVU379
 1469 0014 0446     		mov	r4, r0
 1470              	.LVL139:
1011:../../../mod/flash/flash.c **** hal_status = HAL_SPI_Transmit( &( FLASH_SPI )        ,
 1471              		.loc 1 1011 1 is_stmt 1 view .LVU380
 1472 0016 104E     		ldr	r6, .L99+4
 1473 0018 0022     		movs	r2, #0
 1474 001a 4FF48051 		mov	r1, #4096
 1475 001e 3046     		mov	r0, r6
 1476 0020 FFF7FEFF 		bl	HAL_GPIO_WritePin
 1477              	.LVL140:
1012:../../../mod/flash/flash.c **** 							   &flash_opcode         ,
 1478              		.loc 1 1012 1 view .LVU381
1012:../../../mod/flash/flash.c **** 							   &flash_opcode         ,
 1479              		.loc 1 1012 14 is_stmt 0 view .LVU382
 1480 0024 0A23     		movs	r3, #10
 1481 0026 0122     		movs	r2, #1
 1482 0028 0DF10701 		add	r1, sp, #7
 1483 002c 0B48     		ldr	r0, .L99+8
 1484 002e FFF7FEFF 		bl	HAL_SPI_Transmit
 1485              	.LVL141:
 1486 0032 0546     		mov	r5, r0
 1487              	.LVL142:
1016:../../../mod/flash/flash.c **** 
 1488              		.loc 1 1016 1 is_stmt 1 view .LVU383
 1489 0034 0122     		movs	r2, #1
 1490 0036 4FF48051 		mov	r1, #4096
 1491 003a 3046     		mov	r0, r6
 1492 003c FFF7FEFF 		bl	HAL_GPIO_WritePin
 1493              	.LVL143:
1019:../../../mod/flash/flash.c **** 	{
 1494              		.loc 1 1019 1 view .LVU384
1019:../../../mod/flash/flash.c **** 	{
ARM GAS  /tmp/ccKy2Hdq.s 			page 56


 1495              		.loc 1 1019 9 is_stmt 0 view .LVU385
 1496 0040 35B9     		cbnz	r5, .L97
1023:../../../mod/flash/flash.c **** 	{
 1497              		.loc 1 1023 6 is_stmt 1 view .LVU386
1023:../../../mod/flash/flash.c **** 	{
 1498              		.loc 1 1023 9 is_stmt 0 view .LVU387
 1499 0042 14B1     		cbz	r4, .L95
1025:../../../mod/flash/flash.c **** 	}
 1500              		.loc 1 1025 9 view .LVU388
 1501 0044 0124     		movs	r4, #1
 1502              	.LVL144:
1025:../../../mod/flash/flash.c **** 	}
 1503              		.loc 1 1025 9 view .LVU389
 1504 0046 00E0     		b	.L95
 1505              	.LVL145:
 1506              	.L96:
 999:../../../mod/flash/flash.c ****     }
 1507              		.loc 1 999 12 view .LVU390
 1508 0048 0524     		movs	r4, #5
 1509              	.LVL146:
 1510              	.L95:
1032:../../../mod/flash/flash.c **** 
 1511              		.loc 1 1032 1 view .LVU391
 1512 004a 2046     		mov	r0, r4
 1513 004c 02B0     		add	sp, sp, #8
 1514              	.LCFI35:
 1515              		.cfi_remember_state
 1516              		.cfi_def_cfa_offset 16
 1517              		@ sp needed
 1518 004e 70BD     		pop	{r4, r5, r6, pc}
 1519              	.LVL147:
 1520              	.L97:
 1521              	.LCFI36:
 1522              		.cfi_restore_state
1021:../../../mod/flash/flash.c **** 	}
 1523              		.loc 1 1021 9 view .LVU392
 1524 0050 0824     		movs	r4, #8
 1525              	.LVL148:
1021:../../../mod/flash/flash.c **** 	}
 1526              		.loc 1 1021 9 view .LVU393
 1527 0052 FAE7     		b	.L95
 1528              	.L100:
 1529              		.align	2
 1530              	.L99:
 1531 0054 00000000 		.word	write_enabled
 1532 0058 00040258 		.word	1476527104
 1533 005c 00000000 		.word	hspi2
 1534              		.cfi_endproc
 1535              	.LFE154:
 1537              		.section	.text.flash_cmd_execute,"ax",%progbits
 1538              		.align	1
 1539              		.global	flash_cmd_execute
 1540              		.syntax unified
 1541              		.thumb
 1542              		.thumb_func
 1544              	flash_cmd_execute:
 1545              	.LVL149:
ARM GAS  /tmp/ccKy2Hdq.s 			page 57


 1546              	.LFB144:
  95:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 1547              		.loc 1 95 1 is_stmt 1 view -0
 1548              		.cfi_startproc
 1549              		@ args = 0, pretend = 0, frame = 520
 1550              		@ frame_needed = 0, uses_anonymous_args = 0
  95:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 1551              		.loc 1 95 1 is_stmt 0 view .LVU395
 1552 0000 70B5     		push	{r4, r5, r6, lr}
 1553              	.LCFI37:
 1554              		.cfi_def_cfa_offset 16
 1555              		.cfi_offset 4, -16
 1556              		.cfi_offset 5, -12
 1557              		.cfi_offset 6, -8
 1558              		.cfi_offset 14, -4
 1559 0002 ADF5027D 		sub	sp, sp, #520
 1560              	.LCFI38:
 1561              		.cfi_def_cfa_offset 536
 1562 0006 0C46     		mov	r4, r1
  99:../../../mod/flash/flash.c **** uint8_t          num_bytes;           /* Number of bytes on which to 
 1563              		.loc 1 99 1 is_stmt 1 view .LVU396
 100:../../../mod/flash/flash.c ****                                          operate                              */
 1564              		.loc 1 100 1 view .LVU397
 102:../../../mod/flash/flash.c **** uint8_t*         pbuffer;             /* Position within flash buffer         */
 1565              		.loc 1 102 1 view .LVU398
 103:../../../mod/flash/flash.c **** uint8_t          buffer[512];         /* buffer (flash extract)               */
 1566              		.loc 1 103 1 view .LVU399
 104:../../../mod/flash/flash.c **** FLASH_STATUS     flash_status;        /* Return value of flash API calls      */
 1567              		.loc 1 104 1 view .LVU400
 105:../../../mod/flash/flash.c **** USB_STATUS       usb_status;          /* Return value of USB API calls        */
 1568              		.loc 1 105 1 view .LVU401
 106:../../../mod/flash/flash.c **** 
 1569              		.loc 1 106 1 view .LVU402
 112:../../../mod/flash/flash.c **** num_bytes = ( subcommand & FLASH_NBYTES_BITMASK    ); 
 1570              		.loc 1 112 1 view .LVU403
 112:../../../mod/flash/flash.c **** num_bytes = ( subcommand & FLASH_NBYTES_BITMASK    ); 
 1571              		.loc 1 112 11 is_stmt 0 view .LVU404
 1572 0008 4609     		lsrs	r6, r0, #5
 1573              	.LVL150:
 113:../../../mod/flash/flash.c **** pflash_handle -> num_bytes = num_bytes;
 1574              		.loc 1 113 1 is_stmt 1 view .LVU405
 113:../../../mod/flash/flash.c **** pflash_handle -> num_bytes = num_bytes;
 1575              		.loc 1 113 11 is_stmt 0 view .LVU406
 1576 000a 00F01F05 		and	r5, r0, #31
 1577              	.LVL151:
 114:../../../mod/flash/flash.c **** pbuffer   = &buffer[0];
 1578              		.loc 1 114 1 is_stmt 1 view .LVU407
 114:../../../mod/flash/flash.c **** pbuffer   = &buffer[0];
 1579              		.loc 1 114 28 is_stmt 0 view .LVU408
 1580 000e 0D60     		str	r5, [r1]
 115:../../../mod/flash/flash.c **** memset( pbuffer, 0, sizeof( buffer ) );
 1581              		.loc 1 115 1 is_stmt 1 view .LVU409
 1582              	.LVL152:
 116:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 1583              		.loc 1 116 1 view .LVU410
 1584 0010 4FF40072 		mov	r2, #512
 1585 0014 0021     		movs	r1, #0
ARM GAS  /tmp/ccKy2Hdq.s 			page 58


 1586              	.LVL153:
 116:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 1587              		.loc 1 116 1 is_stmt 0 view .LVU411
 1588 0016 01A8     		add	r0, sp, #4
 1589              	.LVL154:
 116:../../../mod/flash/flash.c **** address_to_bytes( pflash_handle -> address, &address[0] );
 1590              		.loc 1 116 1 view .LVU412
 1591 0018 FFF7FEFF 		bl	memset
 1592              	.LVL155:
 117:../../../mod/flash/flash.c **** 
 1593              		.loc 1 117 1 is_stmt 1 view .LVU413
 1594 001c 81A9     		add	r1, sp, #516
 1595 001e 6068     		ldr	r0, [r4, #4]
 1596 0020 FFF7FEFF 		bl	address_to_bytes
 1597              	.LVL156:
 123:../../../mod/flash/flash.c **** 	{
 1598              		.loc 1 123 1 view .LVU414
 1599 0024 062E     		cmp	r6, #6
 1600 0026 00F28780 		bhi	.L115
 1601 002a DFE806F0 		tbb	[pc, r6]
 1602              	.L104:
 1603 002e 04       		.byte	(.L110-.L104)/2
 1604 002f 26       		.byte	(.L109-.L104)/2
 1605 0030 2D       		.byte	(.L108-.L104)/2
 1606 0031 31       		.byte	(.L107-.L104)/2
 1607 0032 53       		.byte	(.L106-.L104)/2
 1608 0033 58       		.byte	(.L105-.L104)/2
 1609 0034 67       		.byte	(.L103-.L104)/2
 1610 0035 00       		.p2align 1
 1611              	.L110:
 130:../../../mod/flash/flash.c ****                                   sizeof( address ), 
 1612              		.loc 1 130 3 view .LVU415
 130:../../../mod/flash/flash.c ****                                   sizeof( address ), 
 1613              		.loc 1 130 16 is_stmt 0 view .LVU416
 1614 0036 0A22     		movs	r2, #10
 1615 0038 0321     		movs	r1, #3
 1616 003a 81A8     		add	r0, sp, #516
 1617 003c FFF7FEFF 		bl	usb_receive
 1618              	.LVL157:
 134:../../../mod/flash/flash.c **** 			{
 1619              		.loc 1 134 3 is_stmt 1 view .LVU417
 134:../../../mod/flash/flash.c **** 			{
 1620              		.loc 1 134 6 is_stmt 0 view .LVU418
 1621 0040 0028     		cmp	r0, #0
 1622 0042 7BD1     		bne	.L116
 141:../../../mod/flash/flash.c **** 			flash_status = flash_read( pflash_handle, num_bytes );
 1623              		.loc 1 141 4 is_stmt 1 view .LVU419
 1624              	.LVL158:
 1625              	.LBB12:
 1626              	.LBI12:
1181:../../../mod/flash/flash.c **** 	(
 1627              		.loc 1 1181 24 view .LVU420
 1628              	.LBB13:
1186:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[1] << 8  ) |
 1629              		.loc 1 1186 1 view .LVU421
1186:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[1] << 8  ) |
 1630              		.loc 1 1186 34 is_stmt 0 view .LVU422
ARM GAS  /tmp/ccKy2Hdq.s 			page 59


 1631 0044 9DF80422 		ldrb	r2, [sp, #516]	@ zero_extendqisi2
1187:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
 1632              		.loc 1 1187 31 view .LVU423
 1633 0048 9DF80532 		ldrb	r3, [sp, #517]	@ zero_extendqisi2
1187:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
 1634              		.loc 1 1187 35 view .LVU424
 1635 004c 1B02     		lsls	r3, r3, #8
1186:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[1] << 8  ) |
 1636              		.loc 1 1186 46 view .LVU425
 1637 004e 43EA0243 		orr	r3, r3, r2, lsl #16
1188:../../../mod/flash/flash.c **** } /* address_to_bytes */
 1638              		.loc 1 1188 31 view .LVU426
 1639 0052 9DF80622 		ldrb	r2, [sp, #518]	@ zero_extendqisi2
1187:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
 1640              		.loc 1 1187 43 view .LVU427
 1641 0056 1343     		orrs	r3, r3, r2
 1642              	.LVL159:
1187:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
 1643              		.loc 1 1187 43 view .LVU428
 1644              	.LBE13:
 1645              	.LBE12:
 141:../../../mod/flash/flash.c **** 			flash_status = flash_read( pflash_handle, num_bytes );
 1646              		.loc 1 141 29 view .LVU429
 1647 0058 6360     		str	r3, [r4, #4]
 142:../../../mod/flash/flash.c **** 			
 1648              		.loc 1 142 4 is_stmt 1 view .LVU430
 142:../../../mod/flash/flash.c **** 			
 1649              		.loc 1 142 19 is_stmt 0 view .LVU431
 1650 005a 2946     		mov	r1, r5
 1651 005c 2046     		mov	r0, r4
 1652              	.LVL160:
 142:../../../mod/flash/flash.c **** 			
 1653              		.loc 1 142 19 view .LVU432
 1654 005e FFF7FEFF 		bl	flash_read
 1655              	.LVL161:
 145:../../../mod/flash/flash.c **** 				{
 1656              		.loc 1 145 4 is_stmt 1 view .LVU433
 145:../../../mod/flash/flash.c **** 				{
 1657              		.loc 1 145 7 is_stmt 0 view .LVU434
 1658 0062 08B1     		cbz	r0, .L123
 148:../../../mod/flash/flash.c **** 				}
 1659              		.loc 1 148 12 view .LVU435
 1660 0064 0125     		movs	r5, #1
 1661              	.LVL162:
 148:../../../mod/flash/flash.c **** 				}
 1662              		.loc 1 148 12 view .LVU436
 1663 0066 0BE0     		b	.L102
 1664              	.LVL163:
 1665              	.L123:
 152:../../../mod/flash/flash.c ****                                        num_bytes               ,
 1666              		.loc 1 152 4 is_stmt 1 view .LVU437
 152:../../../mod/flash/flash.c ****                                        num_bytes               ,
 1667              		.loc 1 152 17 is_stmt 0 view .LVU438
 1668 0068 6422     		movs	r2, #100
 1669 006a 2946     		mov	r1, r5
 1670 006c A068     		ldr	r0, [r4, #8]
 1671              	.LVL164:
ARM GAS  /tmp/ccKy2Hdq.s 			page 60


 152:../../../mod/flash/flash.c ****                                        num_bytes               ,
 1672              		.loc 1 152 17 view .LVU439
 1673 006e FFF7FEFF 		bl	usb_transmit
 1674              	.LVL165:
 156:../../../mod/flash/flash.c **** 				{
 1675              		.loc 1 156 4 is_stmt 1 view .LVU440
 156:../../../mod/flash/flash.c **** 				{
 1676              		.loc 1 156 7 is_stmt 0 view .LVU441
 1677 0072 0546     		mov	r5, r0
 1678              	.LVL166:
 156:../../../mod/flash/flash.c **** 				{
 1679              		.loc 1 156 7 view .LVU442
 1680 0074 20B1     		cbz	r0, .L102
 159:../../../mod/flash/flash.c **** 				}
 1681              		.loc 1 159 12 view .LVU443
 1682 0076 0725     		movs	r5, #7
 1683 0078 02E0     		b	.L102
 1684              	.LVL167:
 1685              	.L109:
 172:../../../mod/flash/flash.c **** 		return FLASH_OK;
 1686              		.loc 1 172 3 is_stmt 1 view .LVU444
 1687 007a FFF7FEFF 		bl	flash_write_enable
 1688              	.LVL168:
 173:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_ENABLE */
 1689              		.loc 1 173 3 view .LVU445
 173:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_ENABLE */
 1690              		.loc 1 173 10 is_stmt 0 view .LVU446
 1691 007e 0025     		movs	r5, #0
 1692              	.LVL169:
 1693              	.L102:
 293:../../../mod/flash/flash.c **** 
 1694              		.loc 1 293 1 view .LVU447
 1695 0080 2846     		mov	r0, r5
 1696 0082 0DF5027D 		add	sp, sp, #520
 1697              	.LCFI39:
 1698              		.cfi_remember_state
 1699              		.cfi_def_cfa_offset 16
 1700              		@ sp needed
 1701 0086 70BD     		pop	{r4, r5, r6, pc}
 1702              	.LVL170:
 1703              	.L108:
 1704              	.LCFI40:
 1705              		.cfi_restore_state
 179:../../../mod/flash/flash.c **** 		return FLASH_OK;
 1706              		.loc 1 179 3 is_stmt 1 view .LVU448
 1707 0088 FFF7FEFF 		bl	flash_write_disable
 1708              	.LVL171:
 180:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_DISABLE */
 1709              		.loc 1 180 3 view .LVU449
 180:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_DISABLE */
 1710              		.loc 1 180 10 is_stmt 0 view .LVU450
 1711 008c 0025     		movs	r5, #0
 1712              	.LVL172:
 180:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_DISABLE */
 1713              		.loc 1 180 10 view .LVU451
 1714 008e F7E7     		b	.L102
 1715              	.LVL173:
ARM GAS  /tmp/ccKy2Hdq.s 			page 61


 1716              	.L107:
 187:../../../mod/flash/flash.c ****                                   sizeof( address ),
 1717              		.loc 1 187 3 is_stmt 1 view .LVU452
 187:../../../mod/flash/flash.c ****                                   sizeof( address ),
 1718              		.loc 1 187 16 is_stmt 0 view .LVU453
 1719 0090 0A22     		movs	r2, #10
 1720 0092 0321     		movs	r1, #3
 1721 0094 81A8     		add	r0, sp, #516
 1722 0096 FFF7FEFF 		bl	usb_receive
 1723              	.LVL174:
 191:../../../mod/flash/flash.c **** 			{
 1724              		.loc 1 191 3 is_stmt 1 view .LVU454
 191:../../../mod/flash/flash.c **** 			{
 1725              		.loc 1 191 6 is_stmt 0 view .LVU455
 1726 009a 0028     		cmp	r0, #0
 1727 009c 50D1     		bne	.L119
 199:../../../mod/flash/flash.c **** 
 1728              		.loc 1 199 4 is_stmt 1 view .LVU456
 1729              	.LVL175:
 1730              	.LBB14:
 1731              	.LBI14:
1181:../../../mod/flash/flash.c **** 	(
 1732              		.loc 1 1181 24 view .LVU457
 1733              	.LBB15:
1186:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[1] << 8  ) |
 1734              		.loc 1 1186 1 view .LVU458
1186:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[1] << 8  ) |
 1735              		.loc 1 1186 34 is_stmt 0 view .LVU459
 1736 009e 9DF80422 		ldrb	r2, [sp, #516]	@ zero_extendqisi2
1187:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
 1737              		.loc 1 1187 31 view .LVU460
 1738 00a2 9DF80532 		ldrb	r3, [sp, #517]	@ zero_extendqisi2
1187:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
 1739              		.loc 1 1187 35 view .LVU461
 1740 00a6 1B02     		lsls	r3, r3, #8
1186:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[1] << 8  ) |
 1741              		.loc 1 1186 46 view .LVU462
 1742 00a8 43EA0243 		orr	r3, r3, r2, lsl #16
1188:../../../mod/flash/flash.c **** } /* address_to_bytes */
 1743              		.loc 1 1188 31 view .LVU463
 1744 00ac 9DF80622 		ldrb	r2, [sp, #518]	@ zero_extendqisi2
1187:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
 1745              		.loc 1 1187 43 view .LVU464
 1746 00b0 1343     		orrs	r3, r3, r2
 1747              	.LVL176:
1187:../../../mod/flash/flash.c **** 	   ( (uint32_t) address_bytes[2] << 0  );
 1748              		.loc 1 1187 43 view .LVU465
 1749              	.LBE15:
 1750              	.LBE14:
 199:../../../mod/flash/flash.c **** 
 1751              		.loc 1 199 29 view .LVU466
 1752 00b2 6360     		str	r3, [r4, #4]
 202:../../../mod/flash/flash.c **** 				{
 1753              		.loc 1 202 4 is_stmt 1 view .LVU467
 1754              	.LBB16:
 202:../../../mod/flash/flash.c **** 				{
 1755              		.loc 1 202 10 view .LVU468
ARM GAS  /tmp/ccKy2Hdq.s 			page 62


 1756              	.LVL177:
 202:../../../mod/flash/flash.c **** 				{
 1757              		.loc 1 202 14 is_stmt 0 view .LVU469
 1758 00b4 0026     		movs	r6, #0
 1759              	.LVL178:
 202:../../../mod/flash/flash.c **** 				{
 1760              		.loc 1 202 4 view .LVU470
 1761 00b6 06E0     		b	.L111
 1762              	.LVL179:
 1763              	.L112:
 204:../../../mod/flash/flash.c **** 				flash_status = usb_receive( pbuffer          , 
 1764              		.loc 1 204 5 is_stmt 1 view .LVU471
 204:../../../mod/flash/flash.c **** 				flash_status = usb_receive( pbuffer          , 
 1765              		.loc 1 204 31 is_stmt 0 view .LVU472
 1766 00b8 A068     		ldr	r0, [r4, #8]
 1767              	.LVL180:
 205:../../../mod/flash/flash.c ****                                             sizeof( uint8_t ),
 1768              		.loc 1 205 5 is_stmt 1 view .LVU473
 205:../../../mod/flash/flash.c ****                                             sizeof( uint8_t ),
 1769              		.loc 1 205 20 is_stmt 0 view .LVU474
 1770 00ba 0A22     		movs	r2, #10
 1771 00bc 0121     		movs	r1, #1
 1772 00be 3044     		add	r0, r0, r6
 1773              	.LVL181:
 205:../../../mod/flash/flash.c ****                                             sizeof( uint8_t ),
 1774              		.loc 1 205 20 view .LVU475
 1775 00c0 FFF7FEFF 		bl	usb_receive
 1776              	.LVL182:
 210:../../../mod/flash/flash.c **** 					{
 1777              		.loc 1 210 5 is_stmt 1 view .LVU476
 202:../../../mod/flash/flash.c **** 				{
 1778              		.loc 1 202 37 view .LVU477
 1779 00c4 0136     		adds	r6, r6, #1
 1780              	.LVL183:
 1781              	.L111:
 202:../../../mod/flash/flash.c **** 				{
 1782              		.loc 1 202 23 discriminator 1 view .LVU478
 1783 00c6 B542     		cmp	r5, r6
 1784 00c8 F6DC     		bgt	.L112
 1785              	.LBE16:
 220:../../../mod/flash/flash.c **** 
 1786              		.loc 1 220 3 view .LVU479
 220:../../../mod/flash/flash.c **** 
 1787              		.loc 1 220 18 is_stmt 0 view .LVU480
 1788 00ca 2046     		mov	r0, r4
 1789 00cc FFF7FEFF 		bl	flash_write
 1790              	.LVL184:
 1791 00d0 0546     		mov	r5, r0
 1792              	.LVL185:
 222:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_WRITE */
 1793              		.loc 1 222 6 is_stmt 1 view .LVU481
 222:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_WRITE */
 1794              		.loc 1 222 13 is_stmt 0 view .LVU482
 1795 00d2 D5E7     		b	.L102
 1796              	.LVL186:
 1797              	.L106:
 229:../../../mod/flash/flash.c **** 
ARM GAS  /tmp/ccKy2Hdq.s 			page 63


 1798              		.loc 1 229 3 is_stmt 1 view .LVU483
 229:../../../mod/flash/flash.c **** 
 1799              		.loc 1 229 18 is_stmt 0 view .LVU484
 1800 00d4 2046     		mov	r0, r4
 1801 00d6 FFF7FEFF 		bl	flash_erase
 1802              	.LVL187:
 1803 00da 0546     		mov	r5, r0
 1804              	.LVL188:
 231:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_ERASE */
 1805              		.loc 1 231 3 is_stmt 1 view .LVU485
 231:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_ERASE */
 1806              		.loc 1 231 10 is_stmt 0 view .LVU486
 1807 00dc D0E7     		b	.L102
 1808              	.LVL189:
 1809              	.L105:
 238:../../../mod/flash/flash.c **** 
 1810              		.loc 1 238 3 is_stmt 1 view .LVU487
 238:../../../mod/flash/flash.c **** 
 1811              		.loc 1 238 18 is_stmt 0 view .LVU488
 1812 00de 2046     		mov	r0, r4
 1813 00e0 FFF7FEFF 		bl	flash_get_status
 1814              	.LVL190:
 1815 00e4 0546     		mov	r5, r0
 1816              	.LVL191:
 241:../../../mod/flash/flash.c ****                                    sizeof( uint8_t )                    ,
 1817              		.loc 1 241 3 is_stmt 1 view .LVU489
 241:../../../mod/flash/flash.c ****                                    sizeof( uint8_t )                    ,
 1818              		.loc 1 241 16 is_stmt 0 view .LVU490
 1819 00e6 0A22     		movs	r2, #10
 1820 00e8 0121     		movs	r1, #1
 1821 00ea 04F10F00 		add	r0, r4, #15
 1822 00ee FFF7FEFF 		bl	usb_transmit
 1823              	.LVL192:
 246:../../../mod/flash/flash.c **** 			{
 1824              		.loc 1 246 3 is_stmt 1 view .LVU491
 246:../../../mod/flash/flash.c **** 			{
 1825              		.loc 1 246 11 is_stmt 0 view .LVU492
 1826 00f2 38BB     		cbnz	r0, .L120
 250:../../../mod/flash/flash.c **** 			{
 1827              		.loc 1 250 8 is_stmt 1 view .LVU493
 250:../../../mod/flash/flash.c **** 			{
 1828              		.loc 1 250 11 is_stmt 0 view .LVU494
 1829 00f4 002D     		cmp	r5, #0
 1830 00f6 C3D0     		beq	.L102
 252:../../../mod/flash/flash.c **** 			}
 1831              		.loc 1 252 11 view .LVU495
 1832 00f8 0825     		movs	r5, #8
 1833              	.LVL193:
 252:../../../mod/flash/flash.c **** 			}
 1834              		.loc 1 252 11 view .LVU496
 1835 00fa C1E7     		b	.L102
 1836              	.LVL194:
 1837              	.L103:
 264:../../../mod/flash/flash.c **** 		pflash_handle->address = 0;
 1838              		.loc 1 264 3 is_stmt 1 view .LVU497
 264:../../../mod/flash/flash.c **** 		pflash_handle->address = 0;
 1839              		.loc 1 264 26 is_stmt 0 view .LVU498
ARM GAS  /tmp/ccKy2Hdq.s 			page 64


 1840 00fc 01AB     		add	r3, sp, #4
 1841              	.LVL195:
 264:../../../mod/flash/flash.c **** 		pflash_handle->address = 0;
 1842              		.loc 1 264 26 view .LVU499
 1843 00fe A360     		str	r3, [r4, #8]
 265:../../../mod/flash/flash.c **** 		while( pflash_handle->address <= FLASH_MAX_ADDR )
 1844              		.loc 1 265 3 is_stmt 1 view .LVU500
 265:../../../mod/flash/flash.c **** 		while( pflash_handle->address <= FLASH_MAX_ADDR )
 1845              		.loc 1 265 26 is_stmt 0 view .LVU501
 1846 0100 0023     		movs	r3, #0
 1847              	.LVL196:
 265:../../../mod/flash/flash.c **** 		while( pflash_handle->address <= FLASH_MAX_ADDR )
 1848              		.loc 1 265 26 view .LVU502
 1849 0102 6360     		str	r3, [r4, #4]
 266:../../../mod/flash/flash.c **** 			{
 1850              		.loc 1 266 3 is_stmt 1 view .LVU503
 266:../../../mod/flash/flash.c **** 			{
 1851              		.loc 1 266 8 is_stmt 0 view .LVU504
 1852 0104 09E0     		b	.L113
 1853              	.LVL197:
 1854              	.L125:
 271:../../../mod/flash/flash.c **** 				}
 1855              		.loc 1 271 5 is_stmt 1 view .LVU505
 1856 0106 6422     		movs	r2, #100
 1857 0108 4FF40071 		mov	r1, #512
 1858 010c 01A8     		add	r0, sp, #4
 1859              	.LVL198:
 271:../../../mod/flash/flash.c **** 				}
 1860              		.loc 1 271 5 is_stmt 0 view .LVU506
 1861 010e FFF7FEFF 		bl	usb_transmit
 1862              	.LVL199:
 280:../../../mod/flash/flash.c **** 			}
 1863              		.loc 1 280 4 is_stmt 1 view .LVU507
 280:../../../mod/flash/flash.c **** 			}
 1864              		.loc 1 280 18 is_stmt 0 view .LVU508
 1865 0112 6368     		ldr	r3, [r4, #4]
 280:../../../mod/flash/flash.c **** 			}
 1866              		.loc 1 280 29 view .LVU509
 1867 0114 03F50073 		add	r3, r3, #512
 1868 0118 6360     		str	r3, [r4, #4]
 1869              	.LVL200:
 1870              	.L113:
 266:../../../mod/flash/flash.c **** 			{
 1871              		.loc 1 266 33 is_stmt 1 view .LVU510
 266:../../../mod/flash/flash.c **** 			{
 1872              		.loc 1 266 23 is_stmt 0 view .LVU511
 1873 011a 6368     		ldr	r3, [r4, #4]
 266:../../../mod/flash/flash.c **** 			{
 1874              		.loc 1 266 33 view .LVU512
 1875 011c B3F5002F 		cmp	r3, #524288
 1876 0120 08D2     		bcs	.L124
 268:../../../mod/flash/flash.c **** 			if( flash_status == FLASH_OK )
 1877              		.loc 1 268 4 is_stmt 1 view .LVU513
 268:../../../mod/flash/flash.c **** 			if( flash_status == FLASH_OK )
 1878              		.loc 1 268 19 is_stmt 0 view .LVU514
 1879 0122 4FF40071 		mov	r1, #512
 1880 0126 2046     		mov	r0, r4
ARM GAS  /tmp/ccKy2Hdq.s 			page 65


 1881 0128 FFF7FEFF 		bl	flash_read
 1882              	.LVL201:
 269:../../../mod/flash/flash.c **** 				{
 1883              		.loc 1 269 4 is_stmt 1 view .LVU515
 269:../../../mod/flash/flash.c **** 				{
 1884              		.loc 1 269 6 is_stmt 0 view .LVU516
 1885 012c 0028     		cmp	r0, #0
 1886 012e EAD0     		beq	.L125
 276:../../../mod/flash/flash.c **** 				}
 1887              		.loc 1 276 12 view .LVU517
 1888 0130 1025     		movs	r5, #16
 1889              	.LVL202:
 276:../../../mod/flash/flash.c **** 				}
 1890              		.loc 1 276 12 view .LVU518
 1891 0132 A5E7     		b	.L102
 1892              	.LVL203:
 1893              	.L124:
 283:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_EXTRACT */
 1894              		.loc 1 283 10 view .LVU519
 1895 0134 0025     		movs	r5, #0
 1896              	.LVL204:
 283:../../../mod/flash/flash.c ****         } /* FLASH_SUBCMD_EXTRACT */
 1897              		.loc 1 283 10 view .LVU520
 1898 0136 A3E7     		b	.L102
 1899              	.LVL205:
 1900              	.L115:
 123:../../../mod/flash/flash.c **** 	{
 1901              		.loc 1 123 1 view .LVU521
 1902 0138 0325     		movs	r5, #3
 1903              	.LVL206:
 123:../../../mod/flash/flash.c **** 	{
 1904              		.loc 1 123 1 view .LVU522
 1905 013a A1E7     		b	.L102
 1906              	.LVL207:
 1907              	.L116:
 136:../../../mod/flash/flash.c **** 			}
 1908              		.loc 1 136 11 view .LVU523
 1909 013c 0725     		movs	r5, #7
 1910              	.LVL208:
 136:../../../mod/flash/flash.c **** 			}
 1911              		.loc 1 136 11 view .LVU524
 1912 013e 9FE7     		b	.L102
 1913              	.LVL209:
 1914              	.L119:
 194:../../../mod/flash/flash.c ****             }
 1915              		.loc 1 194 11 view .LVU525
 1916 0140 0725     		movs	r5, #7
 1917              	.LVL210:
 194:../../../mod/flash/flash.c ****             }
 1918              		.loc 1 194 11 view .LVU526
 1919 0142 9DE7     		b	.L102
 1920              	.LVL211:
 1921              	.L120:
 248:../../../mod/flash/flash.c **** 			}
 1922              		.loc 1 248 11 view .LVU527
 1923 0144 0725     		movs	r5, #7
 1924              	.LVL212:
ARM GAS  /tmp/ccKy2Hdq.s 			page 66


 248:../../../mod/flash/flash.c **** 			}
 1925              		.loc 1 248 11 view .LVU528
 1926 0146 9BE7     		b	.L102
 1927              		.cfi_endproc
 1928              	.LFE144:
 1930              		.section	.text.flash_block_erase,"ax",%progbits
 1931              		.align	1
 1932              		.global	flash_block_erase
 1933              		.syntax unified
 1934              		.thumb
 1935              		.thumb_func
 1937              	flash_block_erase:
 1938              	.LVL213:
 1939              	.LFB155:
1049:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 1940              		.loc 1 1049 1 is_stmt 1 view -0
 1941              		.cfi_startproc
 1942              		@ args = 0, pretend = 0, frame = 8
 1943              		@ frame_needed = 0, uses_anonymous_args = 0
1049:../../../mod/flash/flash.c **** /*------------------------------------------------------------------------------
 1944              		.loc 1 1049 1 is_stmt 0 view .LVU530
 1945 0000 F0B5     		push	{r4, r5, r6, r7, lr}
 1946              	.LCFI41:
 1947              		.cfi_def_cfa_offset 20
 1948              		.cfi_offset 4, -20
 1949              		.cfi_offset 5, -16
 1950              		.cfi_offset 6, -12
 1951              		.cfi_offset 7, -8
 1952              		.cfi_offset 14, -4
 1953 0002 83B0     		sub	sp, sp, #12
 1954              	.LCFI42:
 1955              		.cfi_def_cfa_offset 32
 1956 0004 0446     		mov	r4, r0
1053:../../../mod/flash/flash.c **** uint8_t      flash_opcode;        /* Data to be transmitted over SPI          */
 1957              		.loc 1 1053 1 is_stmt 1 view .LVU531
1054:../../../mod/flash/flash.c **** FLASH_STATUS flash_status;        /* Return codes from flash API              */
 1958              		.loc 1 1054 1 view .LVU532
1055:../../../mod/flash/flash.c **** uint32_t     flash_addr;          /* Address of block to erase                */
 1959              		.loc 1 1055 1 view .LVU533
1056:../../../mod/flash/flash.c **** uint8_t      flash_addr_bytes[3]; /* Address of block to erase in byte form   */
 1960              		.loc 1 1056 1 view .LVU534
1057:../../../mod/flash/flash.c **** 
 1961              		.loc 1 1057 1 view .LVU535
1063:../../../mod/flash/flash.c **** 
 1962              		.loc 1 1063 1 view .LVU536
 1963              	.LVL214:
1071:../../../mod/flash/flash.c **** 	{
 1964              		.loc 1 1071 1 view .LVU537
 1965 0006 0129     		cmp	r1, #1
 1966 0008 37D0     		beq	.L127
 1967 000a 0229     		cmp	r1, #2
 1968 000c 3DD0     		beq	.L128
 1969 000e 61B3     		cbz	r1, .L136
 1970              	.LVL215:
 1971              	.L129:
1105:../../../mod/flash/flash.c ****     {
 1972              		.loc 1 1105 1 view .LVU538
ARM GAS  /tmp/ccKy2Hdq.s 			page 67


1105:../../../mod/flash/flash.c ****     {
 1973              		.loc 1 1105 5 is_stmt 0 view .LVU539
 1974 0010 274B     		ldr	r3, .L137
 1975 0012 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
1105:../../../mod/flash/flash.c ****     {
 1976              		.loc 1 1105 3 view .LVU540
 1977 0014 002B     		cmp	r3, #0
 1978 0016 43D0     		beq	.L132
1116:../../../mod/flash/flash.c **** 
 1979              		.loc 1 1116 1 is_stmt 1 view .LVU541
1116:../../../mod/flash/flash.c **** 
 1980              		.loc 1 1116 16 is_stmt 0 view .LVU542
 1981 0018 FFF7FEFF 		bl	write_enable
 1982              	.LVL216:
 1983 001c 0446     		mov	r4, r0
 1984              	.LVL217:
1119:../../../mod/flash/flash.c **** hal_status[0] = HAL_SPI_Transmit( &( FLASH_SPI )        ,
 1985              		.loc 1 1119 1 is_stmt 1 view .LVU543
 1986 001e 254F     		ldr	r7, .L137+4
 1987 0020 0022     		movs	r2, #0
 1988 0022 4FF48051 		mov	r1, #4096
 1989 0026 3846     		mov	r0, r7
 1990 0028 FFF7FEFF 		bl	HAL_GPIO_WritePin
 1991              	.LVL218:
1120:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 1992              		.loc 1 1120 1 view .LVU544
1120:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 1993              		.loc 1 1120 17 is_stmt 0 view .LVU545
 1994 002c 224E     		ldr	r6, .L137+8
 1995 002e 0A23     		movs	r3, #10
 1996 0030 0122     		movs	r2, #1
 1997 0032 0DF10301 		add	r1, sp, #3
 1998 0036 3046     		mov	r0, r6
 1999 0038 FFF7FEFF 		bl	HAL_SPI_Transmit
 2000              	.LVL219:
 2001 003c 45B2     		sxtb	r5, r0
1120:../../../mod/flash/flash.c **** 							      &flash_opcode         ,
 2002              		.loc 1 1120 15 view .LVU546
 2003 003e 8DF80450 		strb	r5, [sp, #4]
1124:../../../mod/flash/flash.c ****                                   &flash_addr_bytes[0]      ,
 2004              		.loc 1 1124 1 is_stmt 1 view .LVU547
1124:../../../mod/flash/flash.c ****                                   &flash_addr_bytes[0]      ,
 2005              		.loc 1 1124 17 is_stmt 0 view .LVU548
 2006 0042 0A23     		movs	r3, #10
 2007 0044 0322     		movs	r2, #3
 2008 0046 6946     		mov	r1, sp
 2009 0048 3046     		mov	r0, r6
 2010 004a FFF7FEFF 		bl	HAL_SPI_Transmit
 2011              	.LVL220:
 2012 004e 46B2     		sxtb	r6, r0
1124:../../../mod/flash/flash.c ****                                   &flash_addr_bytes[0]      ,
 2013              		.loc 1 1124 15 view .LVU549
 2014 0050 8DF80560 		strb	r6, [sp, #5]
1128:../../../mod/flash/flash.c **** 
 2015              		.loc 1 1128 1 is_stmt 1 view .LVU550
 2016 0054 0122     		movs	r2, #1
 2017 0056 4FF48051 		mov	r1, #4096
ARM GAS  /tmp/ccKy2Hdq.s 			page 68


 2018 005a 3846     		mov	r0, r7
 2019 005c FFF7FEFF 		bl	HAL_GPIO_WritePin
 2020              	.LVL221:
1131:../../../mod/flash/flash.c **** 	{
 2021              		.loc 1 1131 1 view .LVU551
1131:../../../mod/flash/flash.c **** 	{
 2022              		.loc 1 1131 9 is_stmt 0 view .LVU552
 2023 0060 15BB     		cbnz	r5, .L133
1131:../../../mod/flash/flash.c **** 	{
 2024              		.loc 1 1131 35 discriminator 1 view .LVU553
 2025 0062 1EBB     		cbnz	r6, .L134
1135:../../../mod/flash/flash.c **** 	{
 2026              		.loc 1 1135 6 is_stmt 1 view .LVU554
1135:../../../mod/flash/flash.c **** 	{
 2027              		.loc 1 1135 9 is_stmt 0 view .LVU555
 2028 0064 ECB1     		cbz	r4, .L130
1137:../../../mod/flash/flash.c **** 	}
 2029              		.loc 1 1137 9 view .LVU556
 2030 0066 0124     		movs	r4, #1
 2031              	.LVL222:
1137:../../../mod/flash/flash.c **** 	}
 2032              		.loc 1 1137 9 view .LVU557
 2033 0068 1BE0     		b	.L130
 2034              	.LVL223:
 2035              	.L136:
1075:../../../mod/flash/flash.c **** 		flash_addr   = flash_block_num*(0x1000);
 2036              		.loc 1 1075 3 is_stmt 1 view .LVU558
1075:../../../mod/flash/flash.c **** 		flash_addr   = flash_block_num*(0x1000);
 2037              		.loc 1 1075 16 is_stmt 0 view .LVU559
 2038 006a 2023     		movs	r3, #32
 2039 006c 8DF80330 		strb	r3, [sp, #3]
1076:../../../mod/flash/flash.c **** 		address_to_bytes( flash_addr, &flash_addr_bytes[0] );
 2040              		.loc 1 1076 3 is_stmt 1 view .LVU560
 2041              	.LVL224:
1077:../../../mod/flash/flash.c **** 		break;
 2042              		.loc 1 1077 3 view .LVU561
 2043 0070 6946     		mov	r1, sp
 2044              	.LVL225:
1077:../../../mod/flash/flash.c **** 		break;
 2045              		.loc 1 1077 3 is_stmt 0 view .LVU562
 2046 0072 0003     		lsls	r0, r0, #12
 2047              	.LVL226:
1077:../../../mod/flash/flash.c **** 		break;
 2048              		.loc 1 1077 3 view .LVU563
 2049 0074 FFF7FEFF 		bl	address_to_bytes
 2050              	.LVL227:
1078:../../../mod/flash/flash.c **** 		}
 2051              		.loc 1 1078 3 is_stmt 1 view .LVU564
 2052 0078 CAE7     		b	.L129
 2053              	.LVL228:
 2054              	.L127:
1083:../../../mod/flash/flash.c **** 		flash_addr   = flash_block_num*(0x8000);
 2055              		.loc 1 1083 3 view .LVU565
1083:../../../mod/flash/flash.c **** 		flash_addr   = flash_block_num*(0x8000);
 2056              		.loc 1 1083 16 is_stmt 0 view .LVU566
 2057 007a 5223     		movs	r3, #82
 2058 007c 8DF80330 		strb	r3, [sp, #3]
ARM GAS  /tmp/ccKy2Hdq.s 			page 69


1084:../../../mod/flash/flash.c **** 		address_to_bytes( flash_addr, &flash_addr_bytes[0] );
 2059              		.loc 1 1084 3 is_stmt 1 view .LVU567
 2060              	.LVL229:
1085:../../../mod/flash/flash.c **** 		break;
 2061              		.loc 1 1085 3 view .LVU568
 2062 0080 6946     		mov	r1, sp
 2063              	.LVL230:
1085:../../../mod/flash/flash.c **** 		break;
 2064              		.loc 1 1085 3 is_stmt 0 view .LVU569
 2065 0082 C003     		lsls	r0, r0, #15
 2066              	.LVL231:
1085:../../../mod/flash/flash.c **** 		break;
 2067              		.loc 1 1085 3 view .LVU570
 2068 0084 FFF7FEFF 		bl	address_to_bytes
 2069              	.LVL232:
1086:../../../mod/flash/flash.c **** 		}
 2070              		.loc 1 1086 3 is_stmt 1 view .LVU571
 2071 0088 C2E7     		b	.L129
 2072              	.LVL233:
 2073              	.L128:
1091:../../../mod/flash/flash.c **** 		flash_addr   = flash_block_num*(0x10000);
 2074              		.loc 1 1091 3 view .LVU572
1091:../../../mod/flash/flash.c **** 		flash_addr   = flash_block_num*(0x10000);
 2075              		.loc 1 1091 16 is_stmt 0 view .LVU573
 2076 008a D823     		movs	r3, #216
 2077 008c 8DF80330 		strb	r3, [sp, #3]
1092:../../../mod/flash/flash.c **** 		address_to_bytes( flash_addr, &flash_addr_bytes[0] );
 2078              		.loc 1 1092 3 is_stmt 1 view .LVU574
 2079              	.LVL234:
1093:../../../mod/flash/flash.c **** 
 2080              		.loc 1 1093 3 view .LVU575
 2081 0090 6946     		mov	r1, sp
 2082              	.LVL235:
1093:../../../mod/flash/flash.c **** 
 2083              		.loc 1 1093 3 is_stmt 0 view .LVU576
 2084 0092 0004     		lsls	r0, r0, #16
 2085              	.LVL236:
1093:../../../mod/flash/flash.c **** 
 2086              		.loc 1 1093 3 view .LVU577
 2087 0094 FFF7FEFF 		bl	address_to_bytes
 2088              	.LVL237:
1096:../../../mod/flash/flash.c **** 			{
 2089              		.loc 1 1096 3 is_stmt 1 view .LVU578
1096:../../../mod/flash/flash.c **** 			{
 2090              		.loc 1 1096 6 is_stmt 0 view .LVU579
 2091 0098 072C     		cmp	r4, #7
 2092 009a B9D9     		bls	.L129
1098:../../../mod/flash/flash.c **** 			}
 2093              		.loc 1 1098 11 view .LVU580
 2094 009c 1124     		movs	r4, #17
 2095              	.LVL238:
1098:../../../mod/flash/flash.c **** 			}
 2096              		.loc 1 1098 11 view .LVU581
 2097 009e 00E0     		b	.L130
 2098              	.LVL239:
 2099              	.L132:
1107:../../../mod/flash/flash.c ****     }
ARM GAS  /tmp/ccKy2Hdq.s 			page 70


 2100              		.loc 1 1107 12 view .LVU582
 2101 00a0 0524     		movs	r4, #5
 2102              	.LVL240:
 2103              	.L130:
1143:../../../mod/flash/flash.c **** 
 2104              		.loc 1 1143 1 view .LVU583
 2105 00a2 2046     		mov	r0, r4
 2106 00a4 03B0     		add	sp, sp, #12
 2107              	.LCFI43:
 2108              		.cfi_remember_state
 2109              		.cfi_def_cfa_offset 20
 2110              		@ sp needed
 2111 00a6 F0BD     		pop	{r4, r5, r6, r7, pc}
 2112              	.LVL241:
 2113              	.L133:
 2114              	.LCFI44:
 2115              		.cfi_restore_state
1133:../../../mod/flash/flash.c **** 	}
 2116              		.loc 1 1133 9 view .LVU584
 2117 00a8 0824     		movs	r4, #8
 2118              	.LVL242:
1133:../../../mod/flash/flash.c **** 	}
 2119              		.loc 1 1133 9 view .LVU585
 2120 00aa FAE7     		b	.L130
 2121              	.LVL243:
 2122              	.L134:
1133:../../../mod/flash/flash.c **** 	}
 2123              		.loc 1 1133 9 view .LVU586
 2124 00ac 0824     		movs	r4, #8
 2125              	.LVL244:
1133:../../../mod/flash/flash.c **** 	}
 2126              		.loc 1 1133 9 view .LVU587
 2127 00ae F8E7     		b	.L130
 2128              	.L138:
 2129              		.align	2
 2130              	.L137:
 2131 00b0 00000000 		.word	write_enabled
 2132 00b4 00040258 		.word	1476527104
 2133 00b8 00000000 		.word	hspi2
 2134              		.cfi_endproc
 2135              	.LFE155:
 2137              		.section	.bss.write_enabled,"aw",%nobits
 2140              	write_enabled:
 2141 0000 00       		.space	1
 2142              		.text
 2143              	.Letext0:
 2144              		.file 2 "/usr/lib/gcc/arm-none-eabi/12.2.1/include/stddef.h"
 2145              		.file 3 "/usr/lib/gcc/arm-none-eabi/12.2.1/include/stdint.h"
 2146              		.file 4 "../../../lib/Drivers/CMSIS/Device/ST/STM32H7xx/Include/stm32h750xx.h"
 2147              		.file 5 "../../../lib/Drivers/STM32H7xx_HAL_Driver/Inc/stm32h7xx_hal_def.h"
 2148              		.file 6 "../../../lib/Drivers/STM32H7xx_HAL_Driver/Inc/stm32h7xx_hal_gpio.h"
 2149              		.file 7 "../../../lib/Drivers/STM32H7xx_HAL_Driver/Inc/stm32h7xx_hal_dma.h"
 2150              		.file 8 "../../../lib/Drivers/STM32H7xx_HAL_Driver/Inc/stm32h7xx_hal_spi.h"
 2151              		.file 9 "../../../mod/flash/flash.h"
 2152              		.file 10 "../../../mod/usb/usb.h"
 2153              		.file 11 "../../../lib/Drivers/STM32H7xx_HAL_Driver/Inc/stm32h7xx_hal.h"
 2154              		.file 12 "/usr/include/newlib/string.h"
ARM GAS  /tmp/ccKy2Hdq.s 			page 71


 2155              		.file 13 "../../../lib/sdr_pin_defines_A0002.h"
 2156              		.file 14 "<built-in>"
ARM GAS  /tmp/ccKy2Hdq.s 			page 72


DEFINED SYMBOLS
                            *ABS*:0000000000000000 flash.c
     /tmp/ccKy2Hdq.s:20     .text.address_to_bytes:0000000000000000 $t
     /tmp/ccKy2Hdq.s:25     .text.address_to_bytes:0000000000000000 address_to_bytes
     /tmp/ccKy2Hdq.s:52     .text.write_disable:0000000000000000 $t
     /tmp/ccKy2Hdq.s:57     .text.write_disable:0000000000000000 write_disable
     /tmp/ccKy2Hdq.s:128    .text.write_disable:0000000000000040 $d
     /tmp/ccKy2Hdq.s:134    .text.write_enable:0000000000000000 $t
     /tmp/ccKy2Hdq.s:139    .text.write_enable:0000000000000000 write_enable
     /tmp/ccKy2Hdq.s:210    .text.write_enable:0000000000000040 $d
     /tmp/ccKy2Hdq.s:216    .text.flash_get_status:0000000000000000 $t
     /tmp/ccKy2Hdq.s:222    .text.flash_get_status:0000000000000000 flash_get_status
     /tmp/ccKy2Hdq.s:313    .text.flash_get_status:0000000000000064 $d
     /tmp/ccKy2Hdq.s:319    .text.flash_set_status:0000000000000000 $t
     /tmp/ccKy2Hdq.s:325    .text.flash_set_status:0000000000000000 flash_set_status
     /tmp/ccKy2Hdq.s:458    .text.flash_set_status:00000000000000a4 $d
     /tmp/ccKy2Hdq.s:2140   .bss.write_enabled:0000000000000000 write_enabled
     /tmp/ccKy2Hdq.s:465    .text.flash_is_flash_busy:0000000000000000 $t
     /tmp/ccKy2Hdq.s:471    .text.flash_is_flash_busy:0000000000000000 flash_is_flash_busy
     /tmp/ccKy2Hdq.s:537    .text.flash_write_enable:0000000000000000 $t
     /tmp/ccKy2Hdq.s:543    .text.flash_write_enable:0000000000000000 flash_write_enable
     /tmp/ccKy2Hdq.s:560    .text.flash_write_enable:0000000000000008 $d
     /tmp/ccKy2Hdq.s:565    .text.flash_write_disable:0000000000000000 $t
     /tmp/ccKy2Hdq.s:571    .text.flash_write_disable:0000000000000000 flash_write_disable
     /tmp/ccKy2Hdq.s:588    .text.flash_write_disable:0000000000000008 $d
     /tmp/ccKy2Hdq.s:593    .text.flash_init:0000000000000000 $t
     /tmp/ccKy2Hdq.s:599    .text.flash_init:0000000000000000 flash_init
     /tmp/ccKy2Hdq.s:728    .text.flash_write_byte:0000000000000000 $t
     /tmp/ccKy2Hdq.s:734    .text.flash_write_byte:0000000000000000 flash_write_byte
     /tmp/ccKy2Hdq.s:877    .text.flash_write_byte:0000000000000098 $d
     /tmp/ccKy2Hdq.s:884    .text.flash_write:0000000000000000 $t
     /tmp/ccKy2Hdq.s:890    .text.flash_write:0000000000000000 flash_write
     /tmp/ccKy2Hdq.s:1243   .text.flash_write:0000000000000184 $d
     /tmp/ccKy2Hdq.s:1250   .text.flash_read:0000000000000000 $t
     /tmp/ccKy2Hdq.s:1256   .text.flash_read:0000000000000000 flash_read
     /tmp/ccKy2Hdq.s:1420   .text.flash_read:00000000000000b0 $d
     /tmp/ccKy2Hdq.s:1427   .text.flash_erase:0000000000000000 $t
     /tmp/ccKy2Hdq.s:1433   .text.flash_erase:0000000000000000 flash_erase
     /tmp/ccKy2Hdq.s:1531   .text.flash_erase:0000000000000054 $d
     /tmp/ccKy2Hdq.s:1538   .text.flash_cmd_execute:0000000000000000 $t
     /tmp/ccKy2Hdq.s:1544   .text.flash_cmd_execute:0000000000000000 flash_cmd_execute
     /tmp/ccKy2Hdq.s:1603   .text.flash_cmd_execute:000000000000002e $d
     /tmp/ccKy2Hdq.s:1931   .text.flash_block_erase:0000000000000000 $t
     /tmp/ccKy2Hdq.s:1937   .text.flash_block_erase:0000000000000000 flash_block_erase
     /tmp/ccKy2Hdq.s:2131   .text.flash_block_erase:00000000000000b0 $d
     /tmp/ccKy2Hdq.s:2141   .bss.write_enabled:0000000000000000 $d
     /tmp/ccKy2Hdq.s:1610   .text.flash_cmd_execute:0000000000000035 $d
     /tmp/ccKy2Hdq.s:1610   .text.flash_cmd_execute:0000000000000036 $t

UNDEFINED SYMBOLS
HAL_GPIO_WritePin
HAL_SPI_Transmit
hspi2
HAL_SPI_Receive
HAL_Delay
memset
usb_receive
ARM GAS  /tmp/ccKy2Hdq.s 			page 73


usb_transmit
